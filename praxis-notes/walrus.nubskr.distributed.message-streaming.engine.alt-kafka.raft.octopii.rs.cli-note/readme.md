[src/gh]: https://github.com/nubskr/walrus.git "(MIT) (Languages: Rust 95.1%, Python 3.4%, Makefile 0.7%, Shell 0.4%, TLA 0.2%, Java 0.2%) ğŸ¦­ High Performance kafka alternative written in rust // ğŸ¦­ ç”¨ Rust ç¼–å†™çš„é«˜æ€§èƒ½ Kafka æ›¿ä»£æ–¹æ¡ˆ /// Walrus: A Distributed Message Streaming Engine // Walrusï¼šä¸€ç§åˆ†å¸ƒå¼æ¶ˆæ¯æµå¼•æ“ /// Walrus is a distributed message streaming platform built on a high-performance log storage engine. It provides fault-tolerant streaming with automatic leadership rotation, segment-based partitioning, and Raft consensus for metadata coordination. // Walrus æ˜¯ä¸€ä¸ªåŸºäºé«˜æ€§èƒ½æ—¥å¿—å­˜å‚¨å¼•æ“æ„å»ºçš„åˆ†å¸ƒå¼æ¶ˆæ¯æµå¹³å°ã€‚å®ƒæä¾›å®¹é”™æµä¼ è¾“åŠŸèƒ½ï¼Œå…·æœ‰è‡ªåŠ¨é¢†å¯¼æƒè½®æ¢ã€åŸºäºåˆ†æ®µçš„åˆ†åŒºä»¥åŠç”¨äºå…ƒæ•°æ®åè°ƒçš„ Raft å…±è¯†æœºåˆ¶ã€‚ /// Key Features: // ä¸»è¦ç‰¹ç‚¹ï¼š /// - Automatic load balancing via segment-based leadership rotation // é€šè¿‡åŸºäºåˆ†æ®µçš„é¢†å¯¼è½®æ¢å®ç°è‡ªåŠ¨è´Ÿè½½å‡è¡¡ /// - Fault tolerance through Raft consensus (3+ nodes) // é€šè¿‡ Raft å…±è¯†å®ç°å®¹é”™ ï¼ˆ3 ä¸ªä»¥ä¸ŠèŠ‚ç‚¹ï¼‰ /// - Simple client protocol (connect to any node, auto-forwarding) // ç®€å•å®¢æˆ·ç«¯åè®® ï¼ˆå¯è¿æ¥åˆ°ä»»ä½•èŠ‚ç‚¹ï¼Œè‡ªåŠ¨è½¬å‘ï¼‰ /// - Sealed segments for historical reads from any replica // å¯†å°çš„ç‰‡æ®µ ï¼Œå¯ç”¨äºä»»ä½•å¤åˆ¶å“çš„å†å²é˜…è¯»ã€‚ /// - High-performance storage with io_uring on Linux // Linux ç³»ç»Ÿä¸ŠåŸºäº io_uring çš„é«˜æ€§èƒ½å­˜å‚¨ /// Producers and consumers connect to any node (or via load balancer). The cluster automatically routes requests to the appropriate leader and manages segment rollovers for load distribution. // ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¯ä»¥è¿æ¥åˆ°ä»»ä½•èŠ‚ç‚¹ï¼ˆæˆ–é€šè¿‡è´Ÿè½½å‡è¡¡å™¨ï¼‰ã€‚é›†ç¾¤ä¼šè‡ªåŠ¨å°†è¯·æ±‚è·¯ç”±åˆ°ç›¸åº”çš„é¢†å¯¼è€…èŠ‚ç‚¹ï¼Œå¹¶ç®¡ç†åˆ†æ®µè½®æ¢ä»¥å®ç°è´Ÿè½½å‡è¡¡ã€‚ /// Each node contains four key components: Node Controller (routing and lease management), Raft Engine (consensus for metadata), Cluster Metadata (replicated state), and Bucket Storage (Walrus engine with write fencing). // æ¯ä¸ªèŠ‚ç‚¹åŒ…å«å››ä¸ªå…³é”®ç»„ä»¶ï¼šèŠ‚ç‚¹æ§åˆ¶å™¨ï¼ˆè·¯ç”±å’Œç§Ÿçº¦ç®¡ç†ï¼‰ã€Raft å¼•æ“ï¼ˆå…ƒæ•°æ®å…±è¯†ï¼‰ã€é›†ç¾¤å…ƒæ•°æ®ï¼ˆå¤åˆ¶çŠ¶æ€ï¼‰å’Œå­˜å‚¨æ¡¶ï¼ˆå¸¦æœ‰å†™éš”ç¦»åŠŸèƒ½çš„ Walrus å¼•æ“ï¼‰ã€‚ /// Core Components // æ ¸å¿ƒç»„ä»¶ /// Node Controller // èŠ‚ç‚¹æ§åˆ¶å™¨ /// - Routes client requests to appropriate segment leaders // å°†å®¢æˆ·è¯·æ±‚è·¯ç”±è‡³ç›¸åº”çš„ä¸šåŠ¡éƒ¨é—¨è´Ÿè´£äººã€‚ /// - Manages write leases (synced from cluster metadata every 100ms) // ç®¡ç†å†™å…¥ç§Ÿçº¦ï¼ˆæ¯ 100 æ¯«ç§’ä»é›†ç¾¤å…ƒæ•°æ®åŒæ­¥ä¸€æ¬¡ï¼‰ /// - Tracks logical offsets for rollover detection // è·Ÿè¸ªç¿»è½¬æ£€æµ‹çš„é€»è¾‘åç§»é‡ /// - Forwards operations to remote leaders when needed // å¿…è¦æ—¶å°†æ“ä½œè½¬å‘ç»™è¿œç¨‹é¢†å¯¼ /// Raft Engine (Octopii) // ç­å¼å¼•æ“ ï¼ˆç« é±¼ï¼‰ /// - Maintains Raft consensus for metadata changes only (not data!) // ä»…å¯¹å…ƒæ•°æ®å˜æ›´ç»´æŠ¤ Raft å…±è¯†ï¼ˆä¸æ¶‰åŠæ•°æ®ï¼ï¼‰ /// - Handles leader election and log replication // å¤„ç†é¢†å¯¼è€…é€‰ä¸¾å’Œæ—¥å¿—å¤åˆ¶ /// - Syncs metadata across all nodes via AppendEntries RPCs // é€šè¿‡ AppendEntries RPC åœ¨æ‰€æœ‰èŠ‚ç‚¹é—´åŒæ­¥å…ƒæ•°æ® /// Cluster Metadata (Raft State Machine) // é›†ç¾¤å…ƒæ•°æ® ï¼ˆRaft çŠ¶æ€æœºï¼‰ /// - Stores topic â†’ segment â†’ leader mappings // å­˜å‚¨ä¸»é¢˜ â†’ ç»†åˆ† â†’ é¢†å¯¼è€…æ˜ å°„ /// - Tracks sealed segments and their entry counts // è½¨é“å¯†å°æ®µåŠå…¶è¿›å…¥æ¬¡æ•° /// - Maintains node addresses for routing // ç»´æŠ¤ç”¨äºè·¯ç”±çš„èŠ‚ç‚¹åœ°å€ /// - Replicated identically across all nodes // æ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„å‰¯æœ¬å®Œå…¨ç›¸åŒ /// Storage Engine // å­˜å‚¨å¼•æ“ /// - Wraps Walrus engine with lease-based write fencing // ä½¿ç”¨åŸºäºç§Ÿèµçš„å†™éš”ç¦»åŠŸèƒ½å°è£… Walrus å¼•æ“ /// - Only accepts writes if node holds lease for that segment // ä»…å½“èŠ‚ç‚¹æŒæœ‰è¯¥æ®µçš„ç§Ÿçº¦æ—¶æ‰æ¥å—å†™å…¥æ“ä½œã€‚ /// - Stores actual data in WAL files on disk // å°†å®é™…æ•°æ®å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„ WAL æ–‡ä»¶ä¸­ã€‚ /// - Serves reads from any segment (sealed or active) // æä¾›æ¥è‡ªä»»ä½•æ®µï¼ˆå·²å¯†å°æˆ–å·²æ¿€æ´»ï¼‰çš„è¯»å–æœåŠ¡"
[lib.cargo/crates]: https://crates.io/crates/walrus-rust "(: cargo add -- walrus-rust) (MIT) (6.1K SLoC) (99.3 KiB) A high-performance Write-Ahead Log (WAL) implementation in Rust // ç”¨ Rust å®ç°çš„é«˜æ€§èƒ½é¢„å†™å¼æ—¥å¿— (WAL)ã€‚ (src: gh:nubskr/walrus.git)"

