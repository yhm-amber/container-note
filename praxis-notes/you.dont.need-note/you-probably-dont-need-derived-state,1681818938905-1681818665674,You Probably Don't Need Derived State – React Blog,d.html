<!DOCTYPE html> <html lang=en style=--header-height-large:60px;--header-height-normal:50px;--header-height-small:40px;--survey-banner-display:none;--survey-banner-height-normal:0px;--survey-banner-height-small:0px;--social-banner-display:block;--social-banner-height-normal:50px;--social-banner-height-small:75px><!--
 Page saved with SingleFile 
 url: https://legacy.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html 
 saved date: Tue Apr 18 2023 19:55:38 GMT+0800 (中国标准时间)
--><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-title content=React><style data-href=/styles.aa479e982b16a410ac78.css id=gatsby-global-css>/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{margin:.67em 0}hr{box-sizing:content-box;overflow:visible}a{background-color:transparent}strong{font-weight:bolder}code{font-size:1em}img{border-style:none}button,input{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button{text-transform:none}button{-webkit-appearance:button}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:400;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body{overflow-x:hidden;position:relative}*{margin:0;padding:0}*,:after,:before{box-sizing:inherit}a{color:inherit;text-decoration:none}ul{list-style:none}img{display:inline-block;vertical-align:top}code,pre{font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace}.scary>blockquote{background-color:rgba(237,51,21,.2) !important;border-left-color:#ed3315 !important}@-webkit-keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}to{-webkit-transform:none;transform:none;opacity:1}}@keyframes sbx-reset-in{0%{-webkit-transform:translate3d(-20%,0,0);transform:translate3d(-20%,0,0);opacity:0}to{-webkit-transform:none;transform:none;opacity:1}}.algolia-autocomplete .ds-dropdown-menu:before{display:block;position:absolute;content:"";width:14px;height:14px;background:#373940;z-index:1000;top:-7px;border-top:1px solid #373940;border-right:1px solid #373940;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);border-radius:2px}.algolia-autocomplete .ds-dropdown-menu{box-shadow:0 1px 0 0 rgba(0,0,0,.2),0 2px 3px 0 rgba(0,0,0,.1)}@media(min-width:601px){.algolia-autocomplete .ds-dropdown-menu{border-radius:4px;margin:6px 0 0;padding:0;text-align:left;height:auto;background:transparent;border:0;max-width:600px;min-width:500px}}@media(max-width:600px){.algolia-autocomplete .ds-dropdown-menu{position:fixed !important;top:40px !important;left:auto !important;right:1rem !important;width:600px;max-width:calc(100% - 2rem);max-height:calc(100% - 5rem)}.algolia-autocomplete .ds-dropdown-menu:before{right:6rem}}.algolia-autocomplete .ds-dropdown-menu [class^=ds-dataset-]{position:relative;border-radius:4px;overflow:auto;padding:0}.algolia-autocomplete .ds-dropdown-menu *{box-sizing:border-box}</style><meta name=generator content="Gatsby 2.32.13"><style>.css-xbsqlp{flex:1 0 auto;margin-top:calc(var(--header-height-large) + var(--survey-banner-height-normal) + var(--social-banner-height-normal));-webkit-flex:1 0 auto}@media(min-width:780px) and (max-width:979px){.css-xbsqlp{margin-top:calc(var(--header-height-normal) + var(--survey-banner-height-normal) + var(--social-banner-height-normal))}}@media(max-width:599px){.css-xbsqlp{margin-top:calc(var(--header-height-small) + var(--survey-banner-height-small) + var(--social-banner-height-small))}}.css-190hivd{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;flex-direction:column;min-height:calc(100vh - 40px);-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column}.css-184keb2{color:inherit;margin-left:10px;font-weight:700;font-size:20px;line-height:20px}@media(max-width:979px){.css-184keb2{font-size:16px;margin-top:1px}}@media(max-width:599px){.css-184keb2{position:absolute;overflow:hidden;clip:rect(0 0 0 0);height:1px;width:1px;margin:-1px;padding:0;border:0}}.css-4ivotw{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;margin-right:10px;height:100%;align-items:center;color:#61dafb;-webkit-box-align:center;-webkit-align-items:center}.css-4ivotw:focus,[data-css-4ivotw]:focus{outline:0;color:#fff}@media(min-width:600px){.css-4ivotw{width:calc(100%/6)}}@media(max-width:599px){.css-4ivotw{flex:0 0 auto;-webkit-flex:0 0 auto}}.css-79txt3{flex:1;display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;flex-direction:row;align-items:stretch;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch;height:100%;-ms-overflow-style:none;-webkit-flex:1;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-webkit-box-align:stretch;-webkit-align-items:stretch}.css-79txt3::-webkit-scrollbar,[data-css-79txt3]::-webkit-scrollbar{display:none}@media(min-width:0px) and (max-width:599px){.css-79txt3{flex-grow:1;width:auto;-webkit-flex-grow:1}}@media(max-width:599px){.css-79txt3{mask-image:-webkit-linear-gradient(to right,transparent,black 20px,black 90%,transparent);mask-image:-moz-linear-gradient(to right,transparent,black 20px,black 90%,transparent);-webkit-mask-image:-webkit-linear-gradient(to right,transparent,black 20px,black 90%,transparent);-webkit-mask-image:-moz-linear-gradient(to right,transparent,black 20px,black 90%,transparent);-webkit-mask-image:linear-gradient(to right,transparent,black 20px,black 90%,transparent)}}.css-zvm479{padding:5px 10px;white-space:nowrap;font-size:14px}.css-zvm479:hover,[data-css-zvm479]:hover{color:#61dafb}.css-zvm479:focus,[data-css-zvm479]:focus{outline:0;background-color:#373940;border-radius:15px}@media(max-width:779px){.css-zvm479{display:none}}.css-1rsw1pf{margin-left:.5rem}@media(max-width:779px){.css-1rsw1pf{display:none}}.css-1upvlu3{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;align-items:center;padding:5px 10px;white-space:nowrap;font-size:14px;-webkit-box-align:center;-webkit-align-items:center}.css-1upvlu3:hover,[data-css-1upvlu3]:hover{color:#61dafb}.css-1upvlu3:focus,[data-css-1upvlu3]:focus{outline:0;background-color:#373940;border-radius:15px}.css-6oo1gu{padding:5px 10px;margin-left:10px;white-space:nowrap;font-size:14px}.css-6oo1gu:hover,[data-css-6oo1gu]:hover{color:#61dafb}.css-6oo1gu:focus,[data-css-6oo1gu]:focus{outline:0;background-color:#373940;border-radius:15px}@media(max-width:979px){.css-6oo1gu{display:none}}.css-nypjs8{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;align-items:center;justify-content:flex-end;width:auto;-webkit-box-align:center;-webkit-align-items:center;-webkit-box-pack:end;-webkit-justify-content:flex-end}.css-heonw3{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;flex-direction:row;align-items:center;height:var(--header-height-large);-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-webkit-box-align:center;-webkit-align-items:center}@media(min-width:780px) and (max-width:979px){.css-heonw3{height:var(--header-height-normal)}}@media(max-width:599px){.css-heonw3{height:var(--header-height-small)}}.css-19rsoyj{background-color:#20232a;color:#fff;position:fixed;z-index:1;width:100%;top:0;left:0}@media print{.css-19rsoyj{display:none}}.css-1loxuh3{background-color:hsl(222,14%,10%)}.css-tctv7l{padding-left:20px;padding-right:20px;margin-left:auto;margin-right:auto}@media(min-width:780px){.css-tctv7l{width:90%}}@media(min-width:1340px){.css-tctv7l{max-width:1260px}}.css-w4tulb{width:auto;height:35px}.css-t4a06n{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;margin-right:1rem}@media(max-width:779px){.css-t4a06n{display:none}}.css-1e8x600{margin-right:.5rem}.css-1og5p3u{color:#61dafb}.css-15dgx4v{color:#ddd;transition:color 200ms ease-out;-webkit-transition:color 200ms ease-out;-moz-transition:color 200ms ease-out}.css-15dgx4v:hover,[data-css-15dgx4v]:hover{color:#fff}.css-lcvzl3{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex}@media(max-width:599px){.css-lcvzl3{flex-direction:column;line-height:1.5;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column}}.css-s3feo0{width:10px;height:10px}.css-w59gkz{background:transparent;padding:.25rem .5rem;border-radius:.25rem;border:0;background-color:hsl(222,14%,30%);color:#ddd;cursor:pointer;transition:color 200ms ease-out;margin-left:2rem;font-size:14px;-webkit-transition:color 200ms ease-out;-moz-transition:color 200ms ease-out}.css-w59gkz:hover,[data-css-w59gkz]:hover{color:#fff}.css-p5tzjw{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;justify-content:flex-end;flex-grow:1;-webkit-box-pack:end;-webkit-justify-content:flex-end;-webkit-flex-grow:1}.css-lpiycv{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;justify-content:center;align-items:center;height:100%;-webkit-box-pack:center;-webkit-justify-content:center;-webkit-box-align:center;-webkit-align-items:center}.css-ebdw9u{display:var(--survey-banner-display);height:var(--survey-banner-height-normal);font-size:18px}@media(max-width:979px){.css-ebdw9u{font-size:16px}}@media(max-width:599px){.css-ebdw9u{height:var(--survey-banner-height-small);font-size:14px}}.css-1ookbab{vertical-align:-2px;display:inline-block;margin-left:.5rem;color:inherit}.css-714dwk{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex}@media(max-width:599px){.css-714dwk{flex-direction:column;line-height:1.5;text-align:center;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column}}.css-1hu70yk{display:var(--social-banner-display);height:var(--social-banner-height-normal);font-size:18px;font-weight:bold}@media(max-width:979px){.css-1hu70yk{font-size:16px}}@media(max-width:599px){.css-1hu70yk{height:var(--social-banner-height-small);font-size:14px}}.css-hobwqm{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;flex-direction:row;align-items:center;color:#fff;transition:color .2s ease-out;padding-left:15px;padding-right:15px;font-weight:300;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-webkit-box-align:center;-webkit-align-items:center;-webkit-transition:color .2s ease-out;-moz-transition:color .2s ease-out}.css-hobwqm:focus,[data-css-hobwqm]:focus{outline:0;background-color:#373940;color:#fff}@media(min-width:0px) and (max-width:599px){.css-hobwqm{padding-left:8px;padding-right:8px}}@media(min-width:600px) and (max-width:979px){.css-hobwqm{padding-left:10px;padding-right:10px}}@media(min-width:1280px){.css-hobwqm{padding-left:20px;padding-right:20px;font-size:18px}.css-hobwqm:hover:not(:focus),[data-css-hobwqm]:hover:not(:focus){color:#61dafb}}.css-7dpbpx{width:100%;appearance:none;background:transparent;border:0;color:#fff;font-size:18px;font-weight:300;font-family:inherit;padding:4px 4px 4px 29px;background-image:/* original URL: https://legacy.reactjs.org/search.svg */url(data:image/svg+xml;base64,PHN2ZwogIGFsdD0iU2VhcmNoIgogIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICB2aWV3Qm94PSIwIDAgMTYgMTYiCj4KICA8cGF0aAogICAgZD0iCiAgICAgIE02LjAyOTQ1LDEwLjIwMzI3YTQuMTczODIsNC4xNzM4MiwwLDEsMSw0LjE3MzgyLTQuMTczODJBNC4xNTYwOSw0LjE1NjA5LAogICAgICAwLDAsMSw2LjAyOTQ1LDEwLjIwMzI3Wm05LjY5MTk1LDQuMjE5OUwxMC44OTg5LDkuNTk5NzlBNS44ODAyMSw1Ljg4MDIxLAogICAgICAwLDAsMCwxMi4wNTgsNi4wMjg1Niw2LjAwNDY3LDYuMDA0NjcsMCwxLDAsOS41OTk3OSwxMC44OTg5bDQuODIzMzgsCiAgICAgIDQuODIzMzhhLjg5NzI5Ljg5NzI5LDAsMCwwLDEuMjk5MTIsMCwuODk3NDkuODk3NDksMCwwLDAtLjAwMDg3LTEuMjk5MDlaIgogICAgZmlsbD0iI2ZmZmZmZiIKICAvPgo8L3N2Zz4=);background-size:16px 16px;background-repeat:no-repeat;background-position-y:center;background-position-x:4px;-webkit-appearance:none;-moz-appearance:none}.css-7dpbpx:focus,[data-css-7dpbpx]:focus{outline:0;background-color:#373940;border-radius:.25rem}@media(max-width:1179px){.css-7dpbpx{font-size:16px;width:16px;transition:width .2s ease,padding .2s ease;padding-left:16px;-webkit-transition:width .2s ease,padding .2s ease;-moz-transition:width .2s ease,padding .2s ease}.css-7dpbpx:focus,[data-css-7dpbpx]:focus{padding-left:29px;width:8rem;outline:0}}.css-7vmqep{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;flex:0 0 auto;flex-direction:row;align-items:center;padding-left:.25rem;padding-right:.25rem;-webkit-flex:0 0 auto;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-webkit-box-align:center;-webkit-align-items:center}@media(max-width:1179px){.css-7vmqep{justify-content:flex-end;margin-right:10px;-webkit-box-pack:end;-webkit-justify-content:flex-end}}@media(min-width:1180px){.css-7vmqep{min-width:100px;width:calc(100%/5)}}.css-c4d79v{fill:currentColor}.css-1yyhkcy{margin-left:5px;vertical-align:-2px;color:#6b6b6b}.css-15lkjjo{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;flex-direction:column;flex-grow:1;flex-shrink:0;flex-basis:auto;justify-content:stretch;align-items:flex-start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-webkit-flex-grow:1;-webkit-flex-shrink:0;-webkit-flex-basis:auto;-webkit-box-pack:stretch;-webkit-justify-content:stretch;-webkit-box-align:start;-webkit-align-items:flex-start}.css-1q9mcvr{flex-wrap:wrap;display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-box-lines:multiple;-webkit-flex-wrap:wrap}@media(max-width:979px){.css-1q9mcvr{width:100%}}@media(min-width:1280px){.css-1q9mcvr{width:calc(100%/3*2);padding-left:40px}}.css-1izr7si{max-width:160px;height:auto}.css-1yy5aal{color:#999;padding-top:15px}.css-vn0yrr{background-color:#20232a;color:#fff;padding-top:10px;padding-bottom:50px}@media(min-width:2000px){.css-vn0yrr{padding-top:40px}}@media print{.css-vn0yrr{display:none}}.css-1m3wp4q{display:-webkit-inline-box;display:-moz-inline-box;display:-ms-inline-flexbox;display:-webkit-inline-flex;display:inline-flex;flex-direction:column;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column}.css-12bsqfj{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;flex-direction:column;align-items:flex-start;width:50%;padding-top:40px;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-webkit-box-align:start;-webkit-align-items:flex-start}@media(min-width:2000px){.css-12bsqfj{padding-top:0;width:25%}}.css-krwajx{color:#999;font-size:14px;font-weight:700;line-height:3;text-transform:uppercase;text-align:start;letter-spacing:.08em}.css-8l81zy{line-height:2}.css-8l81zy:hover,[data-css-8l81zy]:hover{color:#61dafb}.css-6na5q4{vertical-align:-2px;display:inline-block;margin-left:5px;color:#6b6b6b}@media(min-width:600px){.css-2y24fj{position:absolute;bottom:-1px;height:4px;background:#61dafb;left:0;right:0;z-index:1}}.css-li68ai{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;flex-direction:row;align-items:center;color:#61dafb;transition:color .2s ease-out;padding-left:15px;padding-right:15px;font-weight:300;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-webkit-box-align:center;-webkit-align-items:center;-webkit-transition:color .2s ease-out;-moz-transition:color .2s ease-out}.css-li68ai:focus,[data-css-li68ai]:focus{outline:0;background-color:#373940;color:#fff}@media(min-width:0px) and (max-width:599px){.css-li68ai{padding-left:8px;padding-right:8px}}@media(min-width:600px) and (max-width:979px){.css-li68ai{padding-left:10px;padding-right:10px}}@media(min-width:1280px){.css-li68ai{padding-left:20px;padding-right:20px;font-size:18px}.css-li68ai:hover:not(:focus),[data-css-li68ai]:hover:not(:focus){color:#61dafb}}@media(min-width:600px){.css-li68ai{position:relative}}.css-1hs4uiz{background-color:rgba(187,239,253,0.3);border-bottom:1px solid rgba(0,0,0,0.2);color:#1a1a1a}.css-1hs4uiz:hover,[data-css-1hs4uiz]:hover{background-color:#bbeffd;border-bottom-color:#1a1a1a}.css-1glzrmu{line-height:1.75}.css-acl5jg{margin-top:15px}.css-6nf64v{line-height:25px}.css-6nf64v .gatsby-highlight{margin-top:25px;margin-left:-30px;margin-right:-30px;margin-bottom:25px;padding-left:15px;padding-right:15px}.css-6nf64v a:not(.anchor):not(.gatsby-resp-image-link),[data-css-6nf64v] a:not(.anchor):not(.gatsby-resp-image-link){background-color:rgba(187,239,253,0.3);border-bottom:1px solid rgba(0,0,0,0.2);color:#1a1a1a}.css-6nf64v a:not(.anchor):not(.gatsby-resp-image-link):hover,[data-css-6nf64v] a:not(.anchor):not(.gatsby-resp-image-link):hover{background-color:#bbeffd;border-bottom-color:#1a1a1a}.css-6nf64v>p:first-child,[data-css-6nf64v]>p:first-child{font-size:18px;font-weight:300;color:#6b6b6b}.css-6nf64v>p:first-child a,[data-css-6nf64v]>p:first-child a,.css-6nf64v>p:first-child strong,[data-css-6nf64v]>p:first-child strong{font-weight:400}.css-6nf64v p{margin-top:30px;font-size:17px;line-height:1.7;max-width:42em}.css-6nf64v p:first-of-type,[data-css-6nf64v] p:first-of-type{margin-top:15px}.css-6nf64v p:first-child,[data-css-6nf64v] p:first-child{margin-top:0}.css-6nf64v h3+p,.css-6nf64v h3+p:first-of-type{margin-top:20px}.css-6nf64v p>code,.css-6nf64v li>code{background:rgba(255,229,100,0.2);color:#1a1a1a}.css-6nf64v p>code,.css-6nf64v li>code,.css-6nf64v p>a>code{padding:0 3px;font-size:.94em;word-break:break-word}.css-6nf64v hr{height:1px;margin-bottom:-1px;border:0;border-bottom:1px solid #ececec;margin-top:40px}.css-6nf64v hr:first-child,[data-css-6nf64v] hr:first-child{margin-top:0}.css-6nf64v h2::before,[data-css-6nf64v] h2::before{content:" ";display:block;border-bottom:1px solid #ececec;padding-top:44px;margin-bottom:40px}.css-6nf64v h2{line-height:1.2}.css-6nf64v h2:first-child::before,[data-css-6nf64v] h2:first-child::before{content:" ";display:block;border-bottom:0;padding-top:40px;margin-top:-80px}.css-6nf64v h3::before,[data-css-6nf64v] h3::before{content:" ";display:block;padding-top:90px;margin-top:-45px}.css-6nf64v h2+h3::before,[data-css-6nf64v] h2+h3::before,.css-6nf64v h2+h3:first-of-type::before,[data-css-6nf64v] h2+h3:first-of-type::before{content:" ";display:block;padding-top:60px;margin-top:-30px}.css-6nf64v h4::before,[data-css-6nf64v] h4::before{content:" ";display:block;padding-top:100px;margin-top:-50px}.css-6nf64v h4{font-size:20px;color:#6b6b6b;line-height:1.3;font-weight:400}.css-6nf64v h4+p{margin-top:20px}.css-6nf64v ol,.css-6nf64v ul{margin-top:20px;font-size:16px;color:#1a1a1a;padding-left:20px}.css-6nf64v ul p,.css-6nf64v ul p:first-of-type{font-size:16px;margin-top:0;line-height:1.2}.css-6nf64v ol li,.css-6nf64v ul li{margin-top:10px}.css-6nf64v ul ul{margin-left:20px;margin-top:10px}.css-6nf64v ol{list-style:decimal}.css-6nf64v ul{list-style:disc}.css-6nf64v blockquote{background-color:rgba(255,229,100,0.3);border-left-color:#ffe564;border-left-width:9px;border-left-style:solid;padding:20px 45px 20px 26px;margin-bottom:30px;margin-top:20px;margin-left:-30px;margin-right:-30px}.css-6nf64v blockquote p{margin-top:15px}.css-6nf64v blockquote p:first-of-type,[data-css-6nf64v] blockquote p:first-of-type{font-weight:700;margin-top:0}.css-6nf64v blockquote p:nth-of-type(2),[data-css-6nf64v] blockquote p:nth-of-type(2){margin-top:0}.css-6nf64v .gatsby-highlight+blockquote{margin-top:40px}@media(max-width:599px){.css-6nf64v .gatsby-highlight{margin-left:-20px;margin-right:-20px;border-radius:0}.css-6nf64v h3{overflow-wrap:break-word;word-break:break-word}.css-6nf64v blockquote{margin-left:-20px;margin-right:-20px}}@media(min-width:1280px){.css-6nf64v>p:first-child,[data-css-6nf64v]>p:first-child{font-size:24px}.css-6nf64v h2{font-size:35px}.css-6nf64v h3{font-size:25px;line-height:1.3}}@media(max-width:979px){.css-6nf64v p{font-size:16px;margin-top:25px}.css-6nf64v h2{font-size:20px}}.css-11xil2b{white-space:nowrap;padding-bottom:1em;margin-right:36px;display:inline-block;color:#6b6b6b}.css-1epz0fh{color:#373940;border-color:#ececec;transition:color .2s ease,border-color .2s ease;white-space:nowrap;border-bottom-width:1px;border-bottom-style:solid;-webkit-transition:color .2s ease,border-color .2s ease;-moz-transition:color .2s ease,border-color .2s ease}.css-1epz0fh:hover,[data-css-1epz0fh]:hover{color:#1a1a1a;border-color:#1a1a1a}.css-1epz0fh:focus,[data-css-1epz0fh]:focus{color:#1a1a1a;border-color:#1a1a1a}.css-1m173d1{margin-top:80px}.css-124oy3v{margin-top:40px;margin-bottom:120px}@media(min-width:780px){.css-124oy3v{margin-top:50px}}.css-1kbu8hg{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;flex-direction:column;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column}@media(min-width:600px){.css-1kbu8hg{border-left:1px solid #ececec;margin-left:80px}}@media(min-width:600px) and (max-width:1339px){.css-1kbu8hg{flex:0 0 200px;margin-left:80px;-webkit-flex:0 0 200px}}@media(min-width:600px) and (max-width:979px){.css-1kbu8hg{margin-left:40px}}@media(min-width:1100px){.css-1kbu8hg{flex:0 0 300px;-webkit-flex:0 0 300px}}@media(min-width:2000px){.css-1kbu8hg{position:fixed;right:0;width:300px;z-index:2}}.css-10335ra{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;min-height:calc(100vh - 60px)}@media(min-width:2000px){.css-10335ra{max-width:840px;margin-left:auto;margin-right:auto}}@media(max-width:599px){.css-10335ra{flex-direction:column;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column}}.css-12vsfho{flex:1 0 auto;-webkit-flex:1 0 auto}.css-1m1176{width:100%;flex:1 0 auto;position:relative;z-index:0;-webkit-flex:1 0 auto}.css-1m1176 h1,.css-1m1176 h2,.css-1m1176 h3,.css-1m1176 h4{scroll-margin-top:60px}@media(max-width:779px){.css-1m1176 h1,.css-1m1176 h2,.css-1m1176 h3,.css-1m1176 h4{scroll-margin-top:40px}}.css-95xunl{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;flex-direction:column;flex-grow:1;flex-shrink:0;flex-basis:auto;justify-content:flex-start;align-items:stretch;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-webkit-flex-grow:1;-webkit-flex-shrink:0;-webkit-flex-basis:auto;-webkit-box-pack:start;-webkit-justify-content:flex-start;-webkit-box-align:stretch;-webkit-align-items:stretch}.css-174qq1k{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;flex-direction:column;flex-grow:1;flex-shrink:1;flex-basis:auto;justify-content:flex-start;align-items:stretch;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-webkit-flex-grow:1;-webkit-flex-shrink:1;-webkit-flex-basis:auto;-webkit-box-pack:start;-webkit-justify-content:flex-start;-webkit-box-align:stretch;-webkit-align-items:stretch}.css-1obw60b{color:#282c34;margin-bottom:0;margin-top:80px;font-size:60px;line-height:65px;font-weight:700}@media(max-width:599px){.css-1obw60b{margin-top:40px}}@media(max-width:779px){.css-1obw60b{font-size:40px;line-height:45px}}@media(min-width:780px) and (max-width:979px){.css-1obw60b{margin-top:60px}}.css-hgc6lu{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;flex-direction:row;flex-grow:0;flex-shrink:1;flex-basis:auto;justify-content:space-between;align-items:baseline;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-webkit-flex-grow:0;-webkit-flex-shrink:1;-webkit-flex-basis:auto;-webkit-box-pack:justify;-webkit-justify-content:space-between;-webkit-box-align:baseline;-webkit-align-items:baseline}.css-15scox9{transform:translateY(0.1em);-webkit-transform:translateY(0.1em)}.css-1k9fay3{border:0;background:0;cursor:pointer;margin-left:6px}.css-1k9fay3:focus,[data-css-1k9fay3]:focus{color:#1a1a1a;border-color:#1a1a1a}.css-1k9fay3:focus svg,[data-css-1k9fay3]:focus svg{fill:#1a1a1a}.css-1k9fay3:hover,[data-css-1k9fay3]:hover{color:#1a1a1a;border-color:#1a1a1a}.css-1k9fay3:hover svg,[data-css-1k9fay3]:hover svg{fill:#1a1a1a}.css-1k9fay3 svg{height:1.5em;width:1.5em;fill:#6b6b6b;transition:fill .2s ease;-webkit-transition:fill .2s ease;-moz-transition:fill .2s ease}.css-shr7pv{transform:scale(-1,-1) translateY(-.6em);-webkit-transform:scale(-1,-1) translateY(-.6em)}.css-1s9d23n{border:0;background:0;cursor:pointer;margin-left:3px}.css-1s9d23n:focus,[data-css-1s9d23n]:focus{color:#1a1a1a;border-color:#1a1a1a}.css-1s9d23n:focus svg,[data-css-1s9d23n]:focus svg{fill:#1a1a1a}.css-1s9d23n:hover,[data-css-1s9d23n]:hover{color:#1a1a1a;border-color:#1a1a1a}.css-1s9d23n:hover svg,[data-css-1s9d23n]:hover svg{fill:#1a1a1a}.css-1s9d23n svg{height:1.5em;width:1.5em;fill:#6b6b6b;transition:fill .2s ease;-webkit-transition:fill .2s ease;-moz-transition:fill .2s ease}.css-dnl0w7{margin-top:60px}@media(min-width:0px) and (max-width:599px){.css-dnl0w7{margin-top:40px}}@media(min-width:600px) and (max-width:979px){.css-dnl0w7{margin-top:20px}}@media(min-width:780px) and (max-width:1279px){.css-dnl0w7{margin-top:50px}}@media(min-width:600px){.css-dnl0w7{transform:none !important;-webkit-transform:none !important}}@media(max-width:599px){.css-1gf3j5r{top:calc(var(--survey-banner-height-small) + var(--social-banner-height-small));left:0;bottom:0;right:0;position:fixed;background-color:#fff;z-index:2;height:100vh;overflow-y:auto;-webkit-overflow-scrolling:touch;pointer-events:none}}@media(min-width:780px){.css-1gf3j5r{margin-right:-999px;padding-right:999px;background-color:#f7f7f7}}@media(min-width:780px) and (max-width:1999px){.css-1gf3j5r{position:fixed;z-index:2;height:100%}}@media(min-width:600px){.css-1gf3j5r{position:fixed;z-index:2;height:calc(100vh - 60px);overflow-y:auto;-webkit-overflow-scrolling:touch;margin-right:-999px;padding-right:999px;background-color:#f7f7f7;opacity:1 !important}}@media(min-width:600px) and (max-width:779px){.css-1gf3j5r{height:calc(100vh - 40px)}}@media(min-width:780px) and (max-width:1279px){.css-1gf3j5r{height:calc(100vh - 50px)}}@media(min-width:2000px){.css-1gf3j5r{border-left:1px solid #ececec}}.css-1dgtft4{width:20px;height:20px;align-self:center;display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;flex-direction:column;color:#61dafb;-webkit-align-self:center;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column}.css-7ef8f8{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;flex-direction:row;align-items:center;height:60px;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-webkit-box-align:center;-webkit-align-items:center}@media(min-width:780px) and (max-width:1279px){.css-7ef8f8{height:50px}}@media(max-width:599px){.css-7ef8f8{height:60px;overflow:hidden;align-items:flex-start;-webkit-box-align:start;-webkit-align-items:flex-start}}.css-yx40kw{background-color:#20232a;bottom:44px;color:#61dafb;display:none;cursor:pointer;position:fixed;right:20px;z-index:3;border-radius:50%;border:1px solid rgba(255,255,255,0.1);box-shadow:0 0 20px rgba(0,0,0,0.3)}@media(max-width:599px){.css-yx40kw{display:inline-block}}.css-7stz2q{width:100%;padding-left:20px;position:relative}@media(min-width:1100px){.css-7stz2q{padding-left:40px}}@media(max-width:599px){.css-7stz2q{padding-bottom:100px}}.css-1aai96l{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;flex-direction:column;flex-grow:0;flex-shrink:1;flex-basis:auto;justify-content:flex-start;align-items:stretch;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-webkit-flex-grow:0;-webkit-flex-shrink:1;-webkit-flex-basis:auto;-webkit-box-pack:start;-webkit-justify-content:flex-start;-webkit-box-align:stretch;-webkit-align-items:stretch}.css-1j8jxus{cursor:pointer;background-color:transparent;border:0;margin-top:10px}.css-e8rm5m{color:#1a1a1a;display:inline-block;border-bottom:1px solid transparent;transition:border .2s ease;margin-top:5px;-webkit-transition:border .2s ease;-moz-transition:border .2s ease}.css-e8rm5m:hover,[data-css-e8rm5m]:hover{color:#6b6b6b}.css-atv6j6{margin-top:5px}.css-ts0qly{font-feature-settings:"tnum";margin-bottom:10px;-webkit-font-feature-settings:"tnum"}@media(min-width:600px){.css-ts0qly{display:block}}.css-1luyeat{color:#6b6b6b;font-size:14px;font-weight:700;line-height:3;text-transform:uppercase;text-align:start;letter-spacing:.08em}@media(min-width:600px){.css-1luyeat{color:#1a1a1a;padding-right:7px;padding-left:7px}.css-1luyeat:hover,[data-css-1luyeat]:hover{color:#1a1a1a}}.css-1mwek35{margin-left:7px;transform:rotateX(180deg);transition:-webkit-transform .2s ease,transform .2s ease;-webkit-transform:rotateX(180deg);-webkit-transition:-webkit-transform .2s ease,transform .2s ease;-moz-transition:transform .2s ease}@media(max-width:599px){.css-1mwek35{display:none}}.css-sg9l1i{transform:translate(2px,-4px) rotate(180deg);transition:-webkit-transform .2s ease,transform .2s ease;-webkit-transform:translate(2px,-4px) rotate(180deg);-webkit-transition:-webkit-transform .2s ease,transform .2s ease;-moz-transition:transform .2s ease}.css-o1zbu3{transform:translate(2px,4px);transition:-webkit-transform .2s ease,transform .2s ease;-webkit-transform:translate(2px,4px);-webkit-transition:-webkit-transform .2s ease,transform .2s ease;-moz-transition:transform .2s ease}.css-1ac8j74{padding-top:40px;display:block !important}@media(min-width:1280px){.css-1ac8j74{width:calc(100%/3);order:-1;-webkit-order:-1}}@media(min-width:980px){.css-1ac8j74{order:-1;-webkit-order:-1}}@media(max-width:979px){.css-1ac8j74{text-align:center;width:100%;padding-top:40px}}.css-ftk3jl{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;flex-direction:row;flex-wrap:wrap;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-webkit-box-lines:multiple;-webkit-flex-wrap:wrap}@media(min-width:600px) and (max-width:979px){.css-ftk3jl{padding-right:240px}}@media(min-width:980px) and (max-width:1339px){.css-ftk3jl{padding-right:280px}}@media(min-width:1100px) and (max-width:1999px){.css-ftk3jl{padding-right:380px}}.anchor{float:left;padding-right:4px;margin-left:-20px}h2 .anchor svg,h3 .anchor svg,h4 .anchor svg{visibility:hidden}h1:hover .anchor svg,h2:hover .anchor svg,h3:hover .anchor svg,h4:hover .anchor svg,h5:hover .anchor svg,h6:hover .anchor svg,h1 .anchor:focus svg,h2 .anchor:focus svg,h3 .anchor:focus svg,h4 .anchor:focus svg,h5 .anchor:focus svg,h6 .anchor:focus svg{visibility:visible}</style><title>You Probably Don't Need Derived State – React Blog ~ 你可能不需要派生状态 – React 博客</title><link data-react-helmet=true rel=canonical href=https://legacy.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html><link data-react-helmet=true rel=alternate href=https://legacy.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html hreflang=x-default><link data-react-helmet=true rel=alternate hreflang=en href=https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html><link data-react-helmet=true rel=alternate hreflang=ar href=https://ar.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html><link data-react-helmet=true rel=alternate hreflang=az href=https://az.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html><link data-react-helmet=true rel=alternate hreflang=es href=https://es.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html><link data-react-helmet=true rel=alternate hreflang=fr href=https://fr.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html><link data-react-helmet=true rel=alternate hreflang=hu href=https://hu.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html><link data-react-helmet=true rel=alternate hreflang=it href=https://it.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html><link data-react-helmet=true rel=alternate hreflang=ja href=https://ja.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html><link data-react-helmet=true rel=alternate hreflang=ko href=https://ko.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html><link data-react-helmet=true rel=alternate hreflang=mn href=https://mn.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html><link data-react-helmet=true rel=alternate hreflang=pl href=https://pl.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html><link data-react-helmet=true rel=alternate hreflang=pt-br href=https://pt-br.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html><link data-react-helmet=true rel=alternate hreflang=ru href=https://ru.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html><link data-react-helmet=true rel=alternate hreflang=tr href=https://tr.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html><link data-react-helmet=true rel=alternate hreflang=uk href=https://uk.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html><link data-react-helmet=true rel=alternate hreflang=zh-hans href=https://zh-hans.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html><link data-react-helmet=true rel=alternate hreflang=zh-hant href=https://zh-hant.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html><meta data-react-helmet=true property=og:title content="You Probably Don't Need Derived State – React Blog"><meta data-react-helmet=true property=og:type content=article><meta data-react-helmet=true property=og:url content=https://legacy.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html><meta data-react-helmet=true property=og:image content=https://legacy.reactjs.org/logo-og.png><meta data-react-helmet=true property=og:description content="This blog site has been archived. Go to react.dev/blog to see the recent posts. React 16.4 included a bugfix for getDerivedStateFromProps which caused some existing bugs in React components to reproduce more consistently. If this release exposed a case where your application was using an anti-pattern and didn’t work properly after the fix, we’re sorry for the churn. In this post, we will explain some common anti-patterns with derived state and our preferred alternatives. For a long time, the…"><meta data-react-helmet=true property=fb:app_id content=623268441017527><link rel=icon href=data:image/png;base64,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 type=image/png data-sf-original-href="https://legacy.reactjs.org/favicon-32x32.png?v=f4d46f030265b4c48a05c999b8d93791"><meta name=theme-color content=#20232a><style data-title=hcfy>.gatsby-highlight{background:#282c34;color:#fff;border-radius:10px;overflow:auto;tab-size:1.5em}.gatsby-highlight>pre[class*="gatsby-code-"]{margin:1rem;font-size:14px;line-height:20px;white-space:pre-wrap;word-break:break-word;height:auto !important}.token.attr-name{color:#c5a5c5}.token.comment{color:#b2b2b2}.token.property{color:#5a9bcf}.token.tag{color:#fc929e}.token.string{color:#8dc891}.token.punctuation{color:#88c6be}.token.function{color:#79b6f2}.token.operator{color:#d7deea}.token.keyword{color:#c5a5c5}.token.class-name{color:#fac863}@-webkit-keyframes nprogress-spinner{0%{-webkit-transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg)}}@keyframes nprogress-spinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}hcfy-result{--hcfy-result-main-color:#cf77ff}.__hcfy-result-comparison__{border-left:3px solid var(--hcfy-result-main-color,#008b45);padding-left:6px}.__hcfy-result-comparison-block__{padding:6px 0 6px 12px}.__hcfy-result-comparison-inline__{margin-left:.4em}</style><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:; object-src 'self' data:; frame-src 'self' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style><body><div id=___gatsby><div style=outline:none tabindex=-1 id=gatsby-focus-wrapper><div class=css-190hivd><header class=css-19rsoyj><div class=css-1loxuh3><div class=css-tctv7l><div style=position:relative><div class=css-ebdw9u><div class=css-lpiycv><a href="https://surveys.savanta.com/survey/selfserve/21e3/210643?list=2" target=_blank rel=noopener class=css-t4a06n><svg xmlns=http://www.w3.org/2000/svg preserveAspectRatio="xMidYMid meet" viewBox="0 0 134 58" class=css-w4tulb><g><path fill=#ffffff d="m60.25002,1.61335l32.24974,1.38664l25.24993,5.24999l10.99997,7.99998l3.74999,8.24998l-1.5,8.24998l-6.24998,5.24999l-10.49997,5.24999l-8.99998,2.24999l0.25,2.99999l4.99999,3.74999c0.00018,0.11336 8.50016,3.11335 8.50016,3.11335c0,0 -11.49997,0.5 -11.50015,0.38664c0.00018,0.11336 -13.24979,-1.38664 -13.24996,-1.5c0.00018,0.11336 -4.49981,-2.63663 -4.49999,-2.74999c0.00018,0.11336 -2.74981,-1.63664 -2.74999,-1.75c0.00018,0.11336 -7.9998,1.36336 -7.99998,1.25c0.00018,0.11336 -25.24976,1.61336 -25.24993,1.5c0.00018,0.11336 -21.99976,-1.38664 -21.99994,-1.5c0.00018,0.11336 -17.74978,-3.38663 -17.74995,-3.49999c0.00018,0.11336 -9.7498,-6.38662 -9.74997,-6.49998c0.00018,0.11336 -3.24982,-6.38662 -3.24999,-6.49998c0.00018,0.11336 2.00017,-9.88662 1.99999,-9.99997c0.00018,0.11336 7.75016,-9.38662 7.74998,-9.49997c0.00018,0.11336 19.75012,-9.38662 19.74995,-9.49997c0.00018,0.11336 23.50012,-4.13663 23.49994,-4.24999"></path><rect transform="rotate(-5 37.25019073486327,27.62502670288089)" height=18 width=18 y=18.62503 x=25.7502 fill=#ccc></rect><rect transform="rotate(-5 66.00012207031251,28.125024795532198)" height=18 width=18 y=19.37502 x=56.00012 fill=#ccc></rect><rect transform="rotate(-5 91.75005340576159,25.875030517578093)" height=18 width=18 y=19 x=85.00004 fill=#ccc></rect><g transform="translate(0,58) scale(0.10000000149011612,-0.10000000149011612) "><path fill=#ffffff d="m570,574c-14,-2 -65,-9 -115,-15c-139,-18 -275,-69 -356,-134c-75,-60 -115,-163 -88,-226c41,-99 236,-151 564,-150c122,1 210,6 246,14c51,13 57,12 67,-4c28,-44 237,-67 326,-35l40,14l-45,6c-86,13 -100,18 -130,44c-29,24 -30,27 -13,34c18,8 18,8 0,5c-53,-6 -4,-72 69,-93c49,-14 49,-14 -51,-9c-117,7 -159,16 -189,45c-18,17 -26,18 -56,9c-18,-5 -114,-13 -211,-16c-165,-5 -197,-3 -363,23c-207,34 -284,116 -224,241c57,119 236,203 479,225c197,18 545,-20 671,-74c110,-47 157,-153 104,-234c-14,-22 -97,-73 -150,-92c-16,-6 -23,-11 -15,-11c25,-2 133,54 162,84c59,59 56,147 -9,211c-33,34 -97,68 -146,79c-124,27 -166,35 -257,44c-124,12 -275,19 -310,15z"></path><path fill=#1a1a1a d="m377.00009,403.25c-1,-10 -16,-47 -34,-82l-33,-63l-21,36c-24,40 -29,42 -56,21c-21,-16 -18,-22 43,-90l33,-38l19,24c10,13 35,49 56,79c20,30 48,67 62,82c13,15 23,30 20,32c-2,2 -23,7 -46,11c-38,6 -43,4 -43,-12z"></path><path fill=#1a1a1a d="m674.7493,403c-1,-10 -16,-47 -34,-82l-33,-63l-21,36c-24,40 -29,42 -56,21c-21,-16 -18,-22 43,-90l33,-38l19,24c10,13 35,49 56,79c20,30 48,67 62,82c13,15 23,30 20,32c-2,2 -23,7 -46,11c-38,6 -43,4 -43,-12z"></path><path fill=#1a1a1a d="m965.49854,402.99999c-1,-10 -16,-47 -34,-82l-33,-63l-21,36c-24,40 -29,42 -56,21c-21,-16 -18,-22 43,-90l33,-38l19,24c10,13 35,49 56,79c20,30 48,67 62,82c13,15 23,30 20,32c-2,2 -23,7 -46,11c-38,6 -43,4 -43,-12z"></path></g></g></svg></a><span class=css-lcvzl3><span class=css-1e8x600>We want to hear from you!</span><a href="https://surveys.savanta.com/survey/selfserve/21e3/210643?list=2" target=_blank rel=noopener class=css-15dgx4v><span class=css-1og5p3u>Take our 2021 Community Survey!</span><svg x=0px y=0px viewBox="0 0 100 100" width=15 height=15 class=css-1ookbab><path fill=currentColor d="
      M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,
      0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z
    "></path><polygon fill=currentColor points="
      45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,
      14.9 62.8,22.9 71.5,22.9
      "></polygon></svg></a></span><hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>我们希望收到您的来信！参加我们的 2021 年社区调查！</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result><div class=css-p5tzjw><button class=css-w59gkz><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 5.8 5.8" alt=close class=css-s3feo0><path d="M5.8 5.16L3.54 2.9 5.8.65 5.16 0 2.9 2.26.65 0 0 .65 2.26 2.9 0 5.16l.65.64L2.9 3.54 5.16 5.8l.64-.64z" fill=currentColor></path></svg></button></div></div></div><div class=css-1hu70yk><div class=css-lpiycv><span class=css-714dwk><span class=css-1e8x600>This site is no longer updated.</span><a href=https://react.dev/blog/2023/03/16/introducing-react-dev target=_blank rel=noopener class=css-1og5p3u><span class=css-1og5p3u>Go to react.dev</span></a><hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>本站不再更新。
转到 react.dev</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></span></div></div></div></div></div><div class=css-tctv7l><div class=css-heonw3><a class=css-4ivotw href=https://legacy.reactjs.org/><img src=data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9Ii0xMS41IC0xMC4yMzE3NCAyMyAyMC40NjM0OCI+CiAgPHRpdGxlPlJlYWN0IExvZ288L3RpdGxlPgogIDxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSIyLjA1IiBmaWxsPSIjNjFkYWZiIi8+CiAgPGcgc3Ryb2tlPSIjNjFkYWZiIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIi8+CiAgICA8ZWxsaXBzZSByeD0iMTEiIHJ5PSI0LjIiIHRyYW5zZm9ybT0icm90YXRlKDYwKSIvPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIiB0cmFuc2Zvcm09InJvdGF0ZSgxMjApIi8+CiAgPC9nPgo8L3N2Zz4K alt height=20><span class=css-184keb2>React<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>反应</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></span></a><nav class=css-79txt3><a class=css-hobwqm href=https://legacy.reactjs.org/docs/getting-started.html>Docs<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>文档</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><a class=css-hobwqm href=https://legacy.reactjs.org/tutorial/tutorial.html>Tutorial<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>教程</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><a class=css-li68ai href=https://legacy.reactjs.org/blog/>Blog<span class=css-2y24fj></span><hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>博客</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><a class=css-hobwqm href=https://legacy.reactjs.org/community/support.html>Community<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>社区</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a></nav><form class=css-7vmqep><span class=algolia-autocomplete style=position:relative;display:inline-block;direction:ltr><input type=search id=algolia-doc-search placeholder=Search aria-label="Search docs" class="css-7dpbpx ds-input" autocomplete=off spellcheck=false role=combobox aria-autocomplete=list aria-expanded=false aria-labelledby=algolia-doc-search aria-owns=algolia-autocomplete-listbox-0 dir=auto style=position:relative;vertical-align:top value><pre aria-hidden=true style='position:absolute;visibility:hidden;white-space:pre;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif;font-size:18px;font-style:normal;font-variant:normal;font-weight:300;word-spacing:0px;letter-spacing:normal;text-indent:0px;text-rendering:auto;text-transform:none'></pre><span class=ds-dropdown-menu role=listbox id=algolia-autocomplete-listbox-0 style=position:absolute;top:100%;z-index:100;display:none;left:0px;right:auto><div class=ds-dataset-1></div></span></span></form><div class=css-nypjs8><a class=css-zvm479 href=https://legacy.reactjs.org/versions>v18.2.0<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>v18.2.0</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><a class=css-1upvlu3 href=https://legacy.reactjs.org/languages><svg xmlns=http://www.w3.org/2000/svg width=24 height=24 viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill=none></path><path d=" M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z " class=css-c4d79v></path></svg> <span class=css-1rsw1pf>Languages<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>语言</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></span></a><a href=https://github.com/facebook/react/ target=_blank rel=noopener class=css-6oo1gu>GitHub<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>GitHub</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result><svg x=0px y=0px viewBox="0 0 100 100" width=15 height=15 class=css-1yyhkcy><path fill=currentColor d="
      M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,
      0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z
    "></path><polygon fill=currentColor points="
      45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,
      14.9 62.8,22.9 71.5,22.9
      "></polygon></svg></a></div></div></div></header><div class="css-xbsqlp css-15lkjjo"><div class="css-1m1176 css-95xunl"><div class=css-12vsfho><div class=css-tctv7l><div class=css-10335ra><article class=css-174qq1k><header class=css-hgc6lu><h1 class=css-1obw60b>You Probably Don't Need Derived State<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>你可能不需要派生状态</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></h1></header><div class=css-acl5jg>June 07, 2018 <span class=css-1glzrmu>by <a href=https://github.com/bvaughn class=css-1hs4uiz>Brian Vaughn</a></span><hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>2018 年 6 月 7 日，布赖恩·沃恩 (Brian Vaughn)</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></div><div class=css-124oy3v><div class=css-6nf64v><div class=scary>
<blockquote>
<p>This blog site has been archived. Go to <a href=https://react.dev/blog target=_blank rel="nofollow noopener noreferrer">react.dev/blog</a> to see the recent posts.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>此博客站点已存档。转到 react.dev/blog 查看最近的帖子。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
</blockquote>
</div>
<p>React 16.4 included a <a href=https://legacy.reactjs.org/blog/2018/05/23/react-v-16-4.html#bugfix-for-getderivedstatefromprops>bugfix for getDerivedStateFromProps</a> which caused some existing bugs in React components to reproduce more consistently. If this release exposed a case where your application was using an anti-pattern and didn’t work properly after the fix, we’re sorry for the churn. In this post, we will explain some common anti-patterns with derived state and our preferred alternatives.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>React 16.4 包含一个针对 getDerivedStateFromProps 的错误修复，它导致 React 组件中的一些现有错误更一致地重现。如果此版本暴露了您的应用程序使用反模式并且在修复后无法正常工作的情况，我们对造成的流失深表歉意。在这篇文章中，我们将解释一些常见的派生状态反模式和我们首选的替代方案。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>For a long time, the lifecycle <code class=gatsby-code-text>componentWillReceiveProps</code> was the only way to update state in response to a change in props without an additional render. In version 16.3, <a href=https://legacy.reactjs.org/blog/2018/03/29/react-v-16-3.html#component-lifecycle-changes>we introduced a replacement lifecycle, <code class=gatsby-code-text>getDerivedStateFromProps</code></a> to solve the same use cases in a safer way. At the same time, we’ve realized that people have many misconceptions about how to use both methods, and we’ve found anti-patterns that result in subtle and confusing bugs. The <code class=gatsby-code-text>getDerivedStateFromProps</code> bugfix in 16.4 <a href=https://github.com/facebook/react/issues/12898 target=_blank rel="nofollow noopener noreferrer">makes derived state more predictable</a>, so the results of misusing it are easier to notice.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>很长一段时间，生命周期 componentWillReceiveProps 是更新状态以响应 props 变化而无需额外渲染的唯一方法。在 16.3 版本中，我们引入了替换生命周期 getDerivedStateFromProps 以更安全的方式解决相同的用例。同时，我们意识到人们对如何使用这两种方法有很多误解，并且我们发现了导致微妙和令人困惑的错误的反模式。 16.4 中的 getDerivedStateFromProps 错误修复使派生状态更具可预测性，因此滥用它的结果更容易被注意到。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<blockquote>
<p>Note<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>笔记</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>All of the anti-patterns described in this post apply to both the older <code class=gatsby-code-text>componentWillReceiveProps</code> and the newer <code class=gatsby-code-text>getDerivedStateFromProps</code>.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>这篇文章中描述的所有反模式都适用于旧的 componentWillReceiveProps 和新的 getDerivedStateFromProps。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
</blockquote>
<p> This blog post will cover the following topics:<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>这篇博文将涵盖以下主题：</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<ul>
<li><a href=#when-to-use-derived-state>When to use derived state<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>何时使用派生状态</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a></li>
<li>
<p><a href=#common-bugs-when-using-derived-state>Common bugs when using derived state<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>使用派生状态时的常见错误</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a></p>
<ul>
<li><a href=#anti-pattern-unconditionally-copying-props-to-state>Anti-pattern: Unconditionally copying props to state<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>反模式：无条件地将 props 复制到 state</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a></li>
<li><a href=#anti-pattern-erasing-state-when-props-change>Anti-pattern: Erasing state when props change<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>反模式：当 props 改变时擦除状态</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a></li>
</ul>
</li>
<li><a href=#preferred-solutions>Preferred solutions<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>首选解决方案</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a></li>
<li><a href=#what-about-memoization>What about memoization?<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>记忆化呢？</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a></li>
</ul>
<h2 id=when-to-use-derived-state><a href=#when-to-use-derived-state aria-hidden class=anchor><svg aria-hidden=true height=16 version=1.1 viewBox="0 0 16 16" width=16><path fill-rule=evenodd d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>When to Use Derived State <hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>何时使用派生状态</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></h2>
<p><code class=gatsby-code-text>getDerivedStateFromProps</code> exists for only one purpose. It enables a component to update its internal state as the result of <strong>changes in props</strong>. Our previous blog post provided some examples, like <a href=https://legacy.reactjs.org/blog/2018/03/27/update-on-async-rendering.html#updating-state-based-on-props>recording the current scroll direction based on a changing offset prop</a> or <a href=https://legacy.reactjs.org/blog/2018/03/27/update-on-async-rendering.html#fetching-external-data-when-props-change>loading external data specified by a source prop</a>.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>getDerivedStateFromProps 的存在只有一个目的。它使组件能够根据 props 的变化更新其内部状态。我们之前的博文提供了一些示例，例如根据不断变化的 offset prop 记录当前滚动方向或加载由 source prop 指定的外部数据。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>We did not provide many examples, because as a general rule, <strong>derived state should be used sparingly</strong>. All problems with derived state that we have seen can be ultimately reduced to either (1) unconditionally updating state from props or (2) updating state whenever props and state don’t match. (We’ll go over both in more detail below.)<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>我们没有提供很多示例，因为作为一般规则，应该谨慎使用派生状态。我们所看到的派生状态的所有问题最终都可以归结为（1）无条件地从 props 更新状态或（2）只要 props 和状态不匹配就更新状态。 （我们将在下面更详细地讨论两者。）</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<ul>
<li>If you’re using derived state to memoize some computation based only on the current props, you don’t need derived state. See <a href=#what-about-memoization>What about memoization?</a> below.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>如果您使用派生状态来记忆一些仅基于当前 props 的计算，则不需要派生状态。请参阅记忆化怎么样？以下。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></li>
<li>If you’re updating derived state unconditionally or updating it whenever props and state don’t match, your component likely resets its state too frequently. Read on for more details.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>如果您无条件地更新派生状态或在 props 和状态不匹配时更新它，您的组件可能会过于频繁地重置其状态。请阅读以获得更多详情。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></li>
</ul>
<h2 id=common-bugs-when-using-derived-state><a href=#common-bugs-when-using-derived-state aria-hidden class=anchor><svg aria-hidden=true height=16 version=1.1 viewBox="0 0 16 16" width=16><path fill-rule=evenodd d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Common Bugs When Using Derived State <hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>使用派生状态时的常见错误</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></h2>
<p>The terms <a href=https://legacy.reactjs.org/docs/forms.html#controlled-components>“controlled”</a> and <a href=https://legacy.reactjs.org/docs/uncontrolled-components.html>“uncontrolled”</a> usually refer to form inputs, but they can also describe where any component’s data lives. Data passed in as props can be thought of as <strong>controlled</strong> (because the parent component <em>controls</em> that data). Data that exists only in internal state can be thought of as <strong>uncontrolled</strong> (because the parent can’t directly change it).<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>术语“受控”和“不受控”通常指的是表单输入，但它们也可以描述任何组件的数据所在的位置。作为 props 传入的数据可以被认为是受控的（因为父组件控制该数据）。仅存在于内部状态的数据可以被认为是不受控制的（因为父级不能直接更改它）。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>The most common mistake with derived state is mixing these two; when a derived state value is also updated by <code class=gatsby-code-text>setState</code> calls, there isn’t a single source of truth for the data. The <a href=https://legacy.reactjs.org/blog/2018/03/27/update-on-async-rendering.html#fetching-external-data-when-props-change>external data loading example</a> mentioned above may sound similar, but it’s different in a few important ways. In the loading example, there is a clear source of truth for both the “source” prop and the “loading” state. When the source prop changes, the loading state should <strong>always</strong> be overridden. Conversely, the state is overridden only when the prop <strong>changes</strong> and is otherwise managed by the component.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>派生状态最常见的错误是将这两者混为一谈；当派生状态值也被 setState 调用更新时，数据没有单一的真实来源。上面提到的外部数据加载示例可能听起来很相似，但在几个重要方面有所不同。在加载示例中，“source”属性和“loading”状态都有明确的真实来源。当源属性改变时，加载状态应该总是被覆盖。相反，状态仅在 prop 更改时被覆盖，否则由组件管理。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>Problems arise when any of these constraints are changed. This typically comes in two forms. Let’s take a look at both.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>当这些约束中的任何一个发生变化时，就会出现问题。这通常有两种形式。让我们来看看两者。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<h3 id=anti-pattern-unconditionally-copying-props-to-state><a href=#anti-pattern-unconditionally-copying-props-to-state aria-hidden class=anchor><svg aria-hidden=true height=16 version=1.1 viewBox="0 0 16 16" width=16><path fill-rule=evenodd d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Anti-pattern: Unconditionally copying props to state <hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>反模式：无条件地将 props 复制到 state</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></h3>
<p>A common misconception is that <code class=gatsby-code-text>getDerivedStateFromProps</code> and <code class=gatsby-code-text>componentWillReceiveProps</code> are only called when props “change”. These lifecycles are called any time a parent component rerenders, regardless of whether the props are “different” from before. Because of this, it has always been unsafe to <em>unconditionally</em> override state using either of these lifecycles. <strong>Doing so will cause state updates to be lost.</strong><hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>一个常见的误解是 getDerivedStateFromProps 和 componentWillReceiveProps 只在 props “改变”时被调用。每当父组件重新渲染时，都会调用这些生命周期，而不管 props 是否与之前“不同”。因此，使用这些生命周期中的任何一个来无条件地覆盖状态一直是不安全的。这样做会导致状态更新丢失。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>Let’s consider an example to demonstrate the problem. Here is an <code class=gatsby-code-text>EmailInput</code> component that “mirrors” an email prop&nbsp;in state:<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>让我们考虑一个例子来说明这个问题。这是一个 EmailInput 组件，它“镜像”状态中的 email 属性：</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<div class=gatsby-highlight data-language=jsx><pre class=gatsby-code-jsx><code class=gatsby-code-jsx><span class="token keyword">class</span> <span class="token class-name">EmailInput</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>email <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>email<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">email</span><span class="token operator">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span><span class="token parameter">nextProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// This will erase any local state updates!</span>
    <span class="token comment">// Do not do this.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">email</span><span class="token operator">:</span> nextProps<span class="token punctuation">.</span>email <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>At first, this component might look okay. State is initialized to the value specified by props&nbsp;and updated when we type into the <code class=gatsby-code-text>&lt;input&gt;</code>. But if our component’s parent rerenders, anything we’ve typed into the <code class=gatsby-code-text>&lt;input&gt;</code> will be lost! (<a href=https://codesandbox.io/s/m3w9zn1z8x target=_blank rel="nofollow noopener noreferrer">See this demo for an example.</a>) This holds true even if we were to compare <code class=gatsby-code-text>nextProps.email !== this.state.email</code> before resetting.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>起初，这个组件可能看起来不错。 State 被初始化为 props 指定的值，并在我们输入 &lt;input&gt; 时更新。但是如果我们组件的父组件重新渲染，我们在 &lt;input&gt; 中输入的任何内容都将丢失！ （有关示例，请参见此演示。）即使我们在重置之前比较 nextProps.email !== this.state.email 也是如此。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>In this simple example, adding <code class=gatsby-code-text>shouldComponentUpdate</code> to rerender only when the email prop has changed could fix this. However in practice, components usually accept multiple props; another prop changing would still cause a rerender and improper reset. Function and object props are also often created inline, making it hard to implement a <code class=gatsby-code-text>shouldComponentUpdate</code> that reliably returns true only when a material change has happened. <a href=https://codesandbox.io/s/jl0w6r9w59 target=_blank rel="nofollow noopener noreferrer">Here is a demo that shows that happening.</a> As a result, <code class=gatsby-code-text>shouldComponentUpdate</code> is best used as a performance optimization, not to ensure correctness of derived state.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>在这个简单的示例中，添加 shouldComponentUpdate 以仅在 email 属性更改时重新呈现可以解决此问题。然而在实践中，组件通常接受多个 props；另一个道具改变仍然会导致重新渲染和不正确的重置。函数和对象 props 也经常内联创建，这使得很难实现仅在发生重大更改时才可靠地返回 true 的 shouldComponentUpdate。这是一个展示这种情况的演示。因此，shouldComponentUpdate 最好用作性能优化，而不是确保派生状态的正确性。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>Hopefully it’s clear by now why <strong>it is a bad idea to unconditionally copy props to state</strong>. Before reviewing possible solutions, let’s look at a related problematic pattern: what if we were to only update the state when the email prop changes?<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>希望现在已经清楚为什么无条件地将 props 复制到 state 是一个坏主意。在回顾可能的解决方案之前，让我们看一下相关的问题模式：如果我们只在 email 属性更改时更新状态怎么办？</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<h3 id=anti-pattern-erasing-state-when-props-change><a href=#anti-pattern-erasing-state-when-props-change aria-hidden class=anchor><svg aria-hidden=true height=16 version=1.1 viewBox="0 0 16 16" width=16><path fill-rule=evenodd d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Anti-pattern: Erasing state when props change <hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>反模式：当 props 改变时擦除状态</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></h3>
<p>Continuing the example above, we could avoid accidentally erasing state by only updating it when <code class=gatsby-code-text>props.email</code> changes:<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>继续上面的示例，我们可以通过仅在 props.email 更改时更新它来避免意外删除状态：</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<div class=gatsby-highlight data-language=jsx><pre class=gatsby-code-jsx><code class=gatsby-code-jsx><span class="token keyword">class</span> <span class="token class-name">EmailInput</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>email
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span><span class="token parameter">nextProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Any time props.email changes, update state.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>email <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">email</span><span class="token operator">:</span> nextProps<span class="token punctuation">.</span>email
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<blockquote>
<p>Note<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>笔记</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>Even though the example above shows <code class=gatsby-code-text>componentWillReceiveProps</code>, the same anti-pattern applies to <code class=gatsby-code-text>getDerivedStateFromProps</code>.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>即使上面的示例显示了 componentWillReceiveProps，相同的反模式也适用于 getDerivedStateFromProps。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
</blockquote>
<p>We’ve just made a big improvement. Now our component will erase what we’ve typed only when the props actually change.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>我们刚刚做了很大的改进。现在我们的组件只会在 props 实际改变时擦除我们输入的内容。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>There is still a subtle problem. Imagine a password manager app using the above input component. When navigating between details for two accounts with the same email, the input would fail to reset. This is because the prop value passed to the component would be the same for both accounts! This would be a surprise to the user, as an unsaved change to one account would appear to affect other accounts that happened to share the same email. (<a href=https://codesandbox.io/s/mz2lnkjkrx target=_blank rel="nofollow noopener noreferrer">See demo here.</a>)<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>还有一个微妙的问题。想象一个使用上述输入组件的密码管理器应用程序。在使用同一电子邮件的两个帐户的详细信息之间导航时，输入将无法重置。这是因为传递给组件的 prop 值对于两个帐户来说是相同的！这会让用户感到意外，因为对一个帐户的未保存更改似乎会影响碰巧共享同一电子邮件的其他帐户。 （请参阅此处的演示。）</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>This design is fundamentally flawed, but it’s also an easy mistake to make. (<a href=https://twitter.com/brian_d_vaughn/status/959600888242307072 target=_blank rel="nofollow noopener noreferrer">I’ve made it myself!</a>) Fortunately there are two alternatives that work better. The key to both is that <strong>for any piece of data, you need to pick a single component that owns it as the source of truth, and avoid duplicating it in other components.</strong> Let’s take a look at each of the alternatives.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>这种设计存在根本性缺陷，但也很容易犯错误。 （我自己做的！）幸运的是，有两种更好的选择。两者的关键在于，对于任何数据，您都需要选择拥有它的单个组件作为真实来源，并避免在其他组件中重复它。让我们来看看每个备选方案。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<h2 id=preferred-solutions><a href=#preferred-solutions aria-hidden class=anchor><svg aria-hidden=true height=16 version=1.1 viewBox="0 0 16 16" width=16><path fill-rule=evenodd d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Preferred Solutions <hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>首选解决方案</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></h2>
<h3 id=recommendation-fully-controlled-component><a href=#recommendation-fully-controlled-component aria-hidden class=anchor><svg aria-hidden=true height=16 version=1.1 viewBox="0 0 16 16" width=16><path fill-rule=evenodd d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Recommendation: Fully controlled component <hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>建议：完全受控组件</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></h3>
<p>One way to avoid the problems mentioned above is to remove state from our component entirely. If the email address only exists as a prop, then we don’t have to worry about conflicts with state. We could even convert <code class=gatsby-code-text>EmailInput</code> to a lighter-weight function component:<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>避免上述问题的一种方法是从我们的组件中完全删除状态。如果电子邮件地址仅作为 prop 存在，那么我们就不必担心与状态发生冲突。我们甚至可以将 EmailInput 转换为更轻量级的函数组件：</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<div class=gatsby-highlight data-language=jsx><pre class=gatsby-code-jsx><code class=gatsby-code-jsx><span class="token keyword">function</span> <span class="token function">EmailInput</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>onChange<span class="token punctuation">}</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>email<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This approach simplifies the implementation of our component, but if we still want to store a draft value, the parent form component will now need to do that manually. (<a href=https://codesandbox.io/s/7154w1l551 target=_blank rel="nofollow noopener noreferrer">Click here to see a demo of this pattern.</a>)<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>这种方法简化了我们组件的实现，但如果我们仍想存储草稿值，则父表单组件现在需要手动执行此操作。 （单击此处查看此模式的演示。）</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<h3 id=recommendation-fully-uncontrolled-component-with-a-key><a href=#recommendation-fully-uncontrolled-component-with-a-key aria-hidden class=anchor><svg aria-hidden=true height=16 version=1.1 viewBox="0 0 16 16" width=16><path fill-rule=evenodd d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Recommendation: Fully uncontrolled component with a <code class=gatsby-code-text>key</code><hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>建议：带钥匙的完全不受控制的组件</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result> </h3>
<p>Another alternative would be for our component to fully own the “draft” email state. In that case, our component could still accept a prop for the <em>initial</em> value, but it would ignore subsequent changes to that prop:<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>另一种选择是让我们的组件完全拥有“草稿”电子邮件状态。在这种情况下，我们的组件仍然可以接受初始值的 prop，但它会忽略对该 prop 的后续更改：</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<div class=gatsby-highlight data-language=jsx><pre class=gatsby-code-jsx><code class=gatsby-code-jsx><span class="token keyword">class</span> <span class="token class-name">EmailInput</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>defaultEmail <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">email</span><span class="token operator">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>email<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>In order to reset the value when moving to a different item (as in our password manager scenario), we can use the special React attribute called <code class=gatsby-code-text>key</code>. When a <code class=gatsby-code-text>key</code> changes, React will <a href=https://legacy.reactjs.org/docs/reconciliation.html#keys><em>create</em> a new component instance rather than <em>update</em> the current one</a>. Keys are usually used for dynamic lists but are also useful here. In our case, we could use the user ID to recreate the email input any time a new user is selected:<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>为了在移动到不同的项目时重置值（如在我们的密码管理器场景中），我们可以使用称为 key 的特殊 React 属性。当键更改时，React 将创建一个新的组件实例而不是更新当前组件实例。键通常用于动态列表，但在这里也很有用。在我们的例子中，我们可以在选择新用户时使用用户 ID 重新创建电子邮件输入：</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<div class=gatsby-highlight data-language=jsx><pre class=gatsby-code-jsx><code class=gatsby-code-jsx><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">EmailInput</span></span>
  <span class="token attr-name">defaultEmail</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>user<span class="token punctuation">.</span>email<span class="token punctuation">}</span></span>
  <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span>
<span class="token punctuation">/&gt;</span></span></code></pre></div>
<p>Each time the ID changes, the <code class=gatsby-code-text>EmailInput</code> will be recreated and its state will be reset to the latest <code class=gatsby-code-text>defaultEmail</code> value. (<a href=https://codesandbox.io/s/6v1znlxyxn target=_blank rel="nofollow noopener noreferrer">Click here to see a demo of this pattern.</a>) With this approach, you don’t have to add <code class=gatsby-code-text>key</code> to every input. It might make more sense to put a <code class=gatsby-code-text>key</code> on the whole form instead. Every time the key changes, all components within the form will be recreated with a freshly initialized state.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>每次 ID 更改时，都会重新创建 EmailInput 并将其状态重置为最新的 defaultEmail 值。 （单击此处查看此模式的演示。）使用这种方法，您不必为每个输入都添加键。相反，在整个表单上放置一个键可能更有意义。每次键更改时，表单中的所有组件都将以新的初始化状态重新创建。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>In most cases, this is the best way to handle state that needs to be reset.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>在大多数情况下，这是处理需要重置的状态的最佳方式。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<blockquote>
<p>Note<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>笔记</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>While this may sound slow, the performance difference is usually insignificant. Using a key can even be faster if the components have heavy logic that runs on updates since diffing gets bypassed for that subtree.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>虽然这听起来可能很慢，但性能差异通常是微不足道的。如果组件具有在更新时运行的繁重逻辑，则使用密钥甚至可以更快，因为该子树绕过了 diffing。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
</blockquote>
<h4 id=alternative-1-reset-uncontrolled-component-with-an-id-prop><a href=#alternative-1-reset-uncontrolled-component-with-an-id-prop aria-hidden class=anchor><svg aria-hidden=true height=16 version=1.1 viewBox="0 0 16 16" width=16><path fill-rule=evenodd d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Alternative 1: Reset uncontrolled component with an ID prop <hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>备选方案 1：使用 ID 道具重置不受控制的组件</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></h4>
<p>If <code class=gatsby-code-text>key</code> doesn’t work for some reason (perhaps the component is very expensive to initialize), a workable but cumbersome solution would be to watch for changes to “userID” in <code class=gatsby-code-text>getDerivedStateFromProps</code>:<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>如果 key 由于某种原因不起作用（也许组件的初始化成本非常高），一个可行但麻烦的解决方案是在 getDerivedStateFromProps 中观察“userID”的变化：</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<div class=gatsby-highlight data-language=jsx><pre class=gatsby-code-jsx><code class=gatsby-code-jsx><span class="token keyword">class</span> <span class="token class-name">EmailInput</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>defaultEmail<span class="token punctuation">,</span>
    <span class="token literal-property property">prevPropsUserID</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>userID
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Any time the current user changes,</span>
    <span class="token comment">// Reset any parts of state that are tied to that user.</span>
    <span class="token comment">// In this simple example, that's just the email.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>userID <span class="token operator">!==</span> state<span class="token punctuation">.</span>prevPropsUserID<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">prevPropsUserID</span><span class="token operator">:</span> props<span class="token punctuation">.</span>userID<span class="token punctuation">,</span>
        <span class="token literal-property property">email</span><span class="token operator">:</span> props<span class="token punctuation">.</span>defaultEmail
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This also provides the flexibility to only reset parts of our component’s internal state if we so choose. (<a href=https://codesandbox.io/s/rjyvp7l3rq target=_blank rel="nofollow noopener noreferrer">Click here to see a demo of this pattern.</a>)<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>如果我们愿意，这也提供了仅重置组件内部状态的一部分的灵活性。 （单击此处查看此模式的演示。）</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<blockquote>
<p>Note<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>笔记</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>Even though the example above shows <code class=gatsby-code-text>getDerivedStateFromProps</code>, the same technique can be used&nbsp;with <code class=gatsby-code-text>componentWillReceiveProps</code>.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>即使上面的示例显示了 getDerivedStateFromProps，相同的技术也可以用于 componentWillReceiveProps。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
</blockquote>
<h4 id=alternative-2-reset-uncontrolled-component-with-an-instance-method><a href=#alternative-2-reset-uncontrolled-component-with-an-instance-method aria-hidden class=anchor><svg aria-hidden=true height=16 version=1.1 viewBox="0 0 16 16" width=16><path fill-rule=evenodd d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Alternative 2: Reset uncontrolled component with an instance method <hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>备选方案 2：使用实例方法重置不受控组件</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></h4>
<p>More rarely, you may need to reset state even if there’s no appropriate ID to use as <code class=gatsby-code-text>key</code>. One solution is to reset the key to a random value or autoincrementing number each time you want to reset. One other viable alternative is to expose an instance method to imperatively reset the internal state:<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>更罕见的情况是，即使没有合适的 ID 用作键，您也可能需要重置状态。一种解决方案是每次要重置时将密钥重置为随机值或自动递增数字。另一种可行的替代方法是公开一个实例方法来强制重置内部状态：</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<div class=gatsby-highlight data-language=jsx><pre class=gatsby-code-jsx><code class=gatsby-code-jsx><span class="token keyword">class</span> <span class="token class-name">EmailInput</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>defaultEmail
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">resetEmailForNewUser</span><span class="token punctuation">(</span><span class="token parameter">newEmail</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">email</span><span class="token operator">:</span> newEmail <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The parent form component could then <a href=https://legacy.reactjs.org/docs/glossary.html#refs>use a <code class=gatsby-code-text>ref</code> to call this method</a>. (<a href=https://codesandbox.io/s/l70krvpykl target=_blank rel="nofollow noopener noreferrer">Click here to see a demo of this pattern.</a>)<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>然后父表单组件可以使用 ref 来调用此方法。 （单击此处查看此模式的演示。）</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>Refs can be useful in certain cases like this one, but generally we recommend you use them sparingly. Even in the demo, this imperative method is nonideal because two renders will occur instead of one.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>Refs 在某些情况下很有用，例如这种情况，但通常我们建议您谨慎使用它们。即使在演示中，这种命令式方法也不是理想的，因为将出现两个渲染而不是一个。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<hr>
<div class=scary>
<blockquote>
<p>This blog site has been archived. Go to <a href=https://react.dev/blog target=_blank rel="nofollow noopener noreferrer">react.dev/blog</a> to see the recent posts.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>此博客站点已存档。转到 react.dev/blog 查看最近的帖子。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
</blockquote>
</div>
<h3 id=recap><a href=#recap aria-hidden class=anchor><svg aria-hidden=true height=16 version=1.1 viewBox="0 0 16 16" width=16><path fill-rule=evenodd d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Recap <hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>回顾</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></h3>
<p>To recap, when designing a component, it is important to decide whether its data will be controlled or uncontrolled.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>回顾一下，在设计组件时，重要的是要决定其数据是受控还是不受控。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>Instead of trying to <strong>“mirror” a prop value in state</strong>, make the component <strong>controlled</strong>, and consolidate the two diverging values in the state of some parent component. For example, rather than a child accepting a “committed” <code class=gatsby-code-text>props.value</code> and tracking a “draft” <code class=gatsby-code-text>state.value</code>, have the parent manage both <code class=gatsby-code-text>state.draftValue</code> and <code class=gatsby-code-text>state.committedValue</code> and control the child’s value directly. This makes the data flow more explicit and predictable.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>与其尝试在状态中“镜像”prop 值，不如让组件受控，并在某些父组件的状态中合并两个不同的值。例如，与其让孩子接受“提交的”props.value 并跟踪“草稿”state.value，不如让父母同时管理 state.draftValue 和 state.committedValue 并直接控制孩子的值。这使得数据流更加明确和可预测。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>For <strong>uncontrolled</strong> components, if you’re trying to reset state when a particular prop (usually an ID) changes, you have a few options:<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>对于不受控制的组件，如果你试图在特定属性（通常是 ID）更改时重置状态，你有几个选择：</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<ul>
<li><strong>Recommendation: To reset <em>all internal state</em>, use the <code class=gatsby-code-text>key</code> attribute.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>建议：要重置所有内部状态，请使用 key 属性。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></strong></li>
<li>Alternative 1: To reset <em>only certain state fields</em>, watch for changes in a special property (e.g. <code class=gatsby-code-text>props.userID</code>).<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>备选方案 1：要仅重置某些状态字段，请注意特殊属性（例如 props.userID）的变化。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></li>
<li>Alternative 2: You can also consider fall back to an imperative instance method using refs.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>备选方案 2：您还可以考虑回退到使用 refs 的命令式实例方法。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></li>
</ul>
<h2 id=what-about-memoization><a href=#what-about-memoization aria-hidden class=anchor><svg aria-hidden=true height=16 version=1.1 viewBox="0 0 16 16" width=16><path fill-rule=evenodd d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What about memoization? <hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>记忆化呢？</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></h2>
<p>We’ve also seen derived state used to ensure an expensive value used in <code class=gatsby-code-text>render</code> is recomputed only when the inputs change. This technique is known as <a href=https://en.wikipedia.org/wiki/Memoization target=_blank rel="nofollow noopener noreferrer">memoization</a>.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>我们还看到派生状态用于确保渲染中使用的昂贵值仅在输入更改时才重新计算。这种技术被称为记忆。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>Using derived state for memoization isn’t necessarily bad, but it’s usually not the best solution. There is inherent complexity in managing derived state, and this complexity increases with each additional property. For example, if we add a second derived field to our component state then our implementation would need to separately track changes to both.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>使用派生状态进行记忆不一定是坏事，但通常不是最好的解决方案。管理派生状态存在固有的复杂性，并且这种复杂性随着每个附加属性的增加而增加。例如，如果我们将第二个派生字段添加到我们的组件状态，那么我们的实现将需要分别跟踪对这两个字段的更改。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>Let’s look at an example of one component that takes one prop—a list of items—and renders the items that match a search query entered by the user. We could use derived state to store the filtered list:<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>让我们看一个组件的示例，该组件采用一个道具（项目列表）并呈现与用户输入的搜索查询匹配的项目。我们可以使用派生状态来存储过滤后的列表：</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<div class=gatsby-highlight data-language=jsx><pre class=gatsby-code-jsx><code class=gatsby-code-jsx><span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">filterText</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// *******************************************************</span>
  <span class="token comment">// NOTE: this example is NOT the recommended approach.</span>
  <span class="token comment">// See the examples below for our recommendations instead.</span>
  <span class="token comment">// *******************************************************</span>

  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Re-run the filter whenever the list array or filter text change.</span>
    <span class="token comment">// Note we need to store prevPropsList and prevFilterText to detect changes.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      props<span class="token punctuation">.</span>list <span class="token operator">!==</span> state<span class="token punctuation">.</span>prevPropsList <span class="token operator">||</span>
      state<span class="token punctuation">.</span>prevFilterText <span class="token operator">!==</span> state<span class="token punctuation">.</span>filterText
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">prevPropsList</span><span class="token operator">:</span> props<span class="token punctuation">.</span>list<span class="token punctuation">,</span>
        <span class="token literal-property property">prevFilterText</span><span class="token operator">:</span> state<span class="token punctuation">.</span>filterText<span class="token punctuation">,</span>
        <span class="token literal-property property">filteredList</span><span class="token operator">:</span> props<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>filterText<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">filterText</span><span class="token operator">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Fragment</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>filterText<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>filteredList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Fragment</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This implementation avoids recalculating <code class=gatsby-code-text>filteredList</code> more often than necessary. But it is more complicated than it needs to be, because it has to separately track and detect changes in both props and state in order to properly update the filtered list. In this example, we could simplify things by using <code class=gatsby-code-text>PureComponent</code> and moving the filter operation into the render method: <hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>此实现避免了不必要地更频繁地重新计算 filteredList。但它比它需要的更复杂，因为它必须单独跟踪和检测 props 和状态的变化，以便正确更新过滤列表。在这个例子中，我们可以通过使用 PureComponent 并将过滤操作移到渲染方法中来简化事情：</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<div class=gatsby-highlight data-language=jsx><pre class=gatsby-code-jsx><code class=gatsby-code-jsx><span class="token comment">// PureComponents only rerender if at least one state or prop value changes.</span>
<span class="token comment">// Change is determined by doing a shallow comparison of state and prop keys.</span>
<span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token comment">// State only needs to hold the current filter text value:</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">filterText</span><span class="token operator">:</span> <span class="token string">""</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">filterText</span><span class="token operator">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The render method on this PureComponent is called only if</span>
    <span class="token comment">// props.list or state.filterText has changed.</span>
    <span class="token keyword">const</span> filteredList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>
      <span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>filterText<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Fragment</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>filterText<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>filteredList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Fragment</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The above approach is much cleaner and simpler than the derived state version. Occasionally, this won’t be good enough—filtering may be slow for large lists, and <code class=gatsby-code-text>PureComponent</code> won’t prevent rerenders if another prop were to change. To address both of these concerns, we could add a memoization helper to avoid unnecessarily re-filtering our list:<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>上述方法比派生状态版本更清晰、更简单。有时，这还不够好——对于大型列表，过滤可能会很慢，如果另一个 prop 发生变化，PureComponent 不会阻止重新渲染。为了解决这两个问题，我们可以添加一个记忆助手来避免不必要地重新过滤我们的列表：</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<div class=gatsby-highlight data-language=jsx><pre class=gatsby-code-jsx><code class=gatsby-code-jsx><span class="token keyword">import</span> memoize <span class="token keyword">from</span> <span class="token string">"memoize-one"</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token comment">// State only needs to hold the current filter text value:</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">filterText</span><span class="token operator">:</span> <span class="token string">""</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// Re-run the filter whenever the list array or filter text changes:</span>
  filter <span class="token operator">=</span> <span class="token function">memoize</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> filterText</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> list<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>filterText<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">filterText</span><span class="token operator">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Calculate the latest filtered list. If these arguments haven't changed</span>
    <span class="token comment">// since the last render, `memoize-one` will reuse the last return value.</span>
    <span class="token keyword">const</span> filteredList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>list<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>filterText<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Fragment</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>filterText<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>filteredList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Fragment</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This is much simpler and performs just as well as the derived state version!<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>这比派生状态版本简单得多，性能也一样好！</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>When using memoization, remember a couple of constraints:<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>使用记忆时，请记住几个限制条件：</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<ol>
<li>In most cases, you’ll want to <strong>attach the memoized function to a component instance</strong>. This prevents multiple instances of a component from resetting each other’s memoized keys.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>在大多数情况下，您需要将记忆函数附加到组件实例。这可以防止组件的多个实例重置彼此的记忆键。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></li>
<li>Typically you’ll want to use a memoization helper with a <strong>limited cache size</strong> in order to prevent memory leaks over time. (In the example above, we used <code class=gatsby-code-text>memoize-one</code> because it only caches the most recent arguments and result.)<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>通常，您会希望使用缓存大小有限的记忆助手，以防止内存随时间泄漏。 （在上面的例子中，我们使用了 memoize-one，因为它只缓存最近的参数和结果。）</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></li>
<li>None of the implementations shown in this section will work if <code class=gatsby-code-text>props.list</code> is recreated each time the parent component renders. But in most cases, this setup is appropriate.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>如果每次父组件渲染时都重新创建 props.list，则本节中显示的所有实现都将不起作用。但在大多数情况下，这种设置是合适的。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></li>
</ol>
<h2 id=in-closing><a href=#in-closing aria-hidden class=anchor><svg aria-hidden=true height=16 version=1.1 viewBox="0 0 16 16" width=16><path fill-rule=evenodd d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>In closing <hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>在结束</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></h2>
<p>In real world applications, components often contain a mix of controlled and uncontrolled behaviors. This is okay! If each value has a clear source of truth, you can avoid the anti-patterns mentioned above.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>在现实世界的应用程序中，组件通常包含受控和非受控行为的混合体。这没关系！如果每个值都有明确的真实来源，则可以避免上述反模式。</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p>
<p>It is also worth re-iterating that <code class=gatsby-code-text>getDerivedStateFromProps</code> (and derived state in general) is an advanced feature and should be used sparingly because of this complexity. If your use case falls outside of these patterns, please share it with us on <a href=https://github.com/reactjs/reactjs.org/issues/new target=_blank rel="nofollow noopener noreferrer">GitHub</a> or <a href=https://twitter.com/reactjs target=_blank rel="nofollow noopener noreferrer">Twitter</a>!<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>同样值得重申的是，getDerivedStateFromProps（以及一般的派生状态）是一项高级功能，由于这种复杂性，应谨慎使用。如果您的用例不属于这些模式，请在 GitHub 或 Twitter 上与我们分享！</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p></div><div class=css-1m173d1><span class=css-11xil2b><span>Is this page useful?<button aria-label=Yes class=css-1k9fay3><svg focusable=false xmlns=http://www.w3.org/2000/svg viewBox="0 0 81.13 89.76" class=css-15scox9><path d="M22.9 6a18.57 18.57 0 002.67 8.4 25.72 25.72 0 008.65 7.66c3.86 2 8.67 7.13 13.51 11 3.86 3.11 8.57 7.11 11.54 8.45s13.59.26 14.64 1.17c1.88 1.63 1.55 9-.11 15.25-1.61 5.86-5.96 10.55-6.48 16.86-.4 4.83-2.7 4.88-10.93 4.88h-1.35c-3.82 0-8.24 2.93-12.92 3.62a68 68 0 01-9.73.5c-3.57 0-7.86-.08-13.25-.08-3.56 0-4.71-1.83-4.71-4.48h8.42a3.51 3.51 0 000-7H12.28a2.89 2.89 0 01-2.88-2.88 1.91 1.91 0 01.77-1.78h16.46a3.51 3.51 0 000-7H12.29c-3.21 0-4.84-1.83-4.84-4a6.41 6.41 0 011.17-3.78h19.06a3.5 3.5 0 100-7H9.75A3.51 3.51 0 016 42.27a3.45 3.45 0 013.75-3.48h13.11c5.61 0 7.71-3 5.71-5.52-4.43-4.74-10.84-12.62-11-18.71-.15-6.51 2.6-7.83 5.36-8.56m0-6a6.18 6.18 0 00-1.53.2c-6.69 1.77-10 6.65-9.82 14.5.08 5.09 2.99 11.18 8.52 18.09H9.74a9.52 9.52 0 00-6.23 16.9 12.52 12.52 0 00-2.07 6.84 9.64 9.64 0 003.65 7.7 7.85 7.85 0 00-1.7 5.13 8.9 8.9 0 005.3 8.13 6 6 0 00-.26 1.76c0 6.37 4.2 10.48 10.71 10.48h13.25a73.75 73.75 0 0010.6-.56 35.89 35.89 0 007.58-2.18 17.83 17.83 0 014.48-1.34h1.35c4.69 0 7.79 0 10.5-1 3.85-1.44 6-4.59 6.41-9.38.2-2.46 1.42-4.85 2.84-7.62a41.3 41.3 0 003.42-8.13 48 48 0 001.59-10.79c.1-5.13-1-8.48-3.35-10.55-2.16-1.87-4.64-1.87-9.6-1.88a46.86 46.86 0 01-6.64-.29c-1.92-.94-5.72-4-8.51-6.3l-1.58-1.28c-1.6-1.3-3.27-2.79-4.87-4.23-3.33-3-6.47-5.79-9.61-7.45a20.2 20.2 0 01-6.43-5.53 12.44 12.44 0 01-1.72-5.36 6 6 0 00-6-5.86z"></path></svg></button><button aria-label=No class=css-1s9d23n><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 81.13 89.76" class=css-shr7pv><path d="M22.9 6a18.57 18.57 0 002.67 8.4 25.72 25.72 0 008.65 7.66c3.86 2 8.67 7.13 13.51 11 3.86 3.11 8.57 7.11 11.54 8.45s13.59.26 14.64 1.17c1.88 1.63 1.55 9-.11 15.25-1.61 5.86-5.96 10.55-6.48 16.86-.4 4.83-2.7 4.88-10.93 4.88h-1.35c-3.82 0-8.24 2.93-12.92 3.62a68 68 0 01-9.73.5c-3.57 0-7.86-.08-13.25-.08-3.56 0-4.71-1.83-4.71-4.48h8.42a3.51 3.51 0 000-7H12.28a2.89 2.89 0 01-2.88-2.88 1.91 1.91 0 01.77-1.78h16.46a3.51 3.51 0 000-7H12.29c-3.21 0-4.84-1.83-4.84-4a6.41 6.41 0 011.17-3.78h19.06a3.5 3.5 0 100-7H9.75A3.51 3.51 0 016 42.27a3.45 3.45 0 013.75-3.48h13.11c5.61 0 7.71-3 5.71-5.52-4.43-4.74-10.84-12.62-11-18.71-.15-6.51 2.6-7.83 5.36-8.56m0-6a6.18 6.18 0 00-1.53.2c-6.69 1.77-10 6.65-9.82 14.5.08 5.09 2.99 11.18 8.52 18.09H9.74a9.52 9.52 0 00-6.23 16.9 12.52 12.52 0 00-2.07 6.84 9.64 9.64 0 003.65 7.7 7.85 7.85 0 00-1.7 5.13 8.9 8.9 0 005.3 8.13 6 6 0 00-.26 1.76c0 6.37 4.2 10.48 10.71 10.48h13.25a73.75 73.75 0 0010.6-.56 35.89 35.89 0 007.58-2.18 17.83 17.83 0 014.48-1.34h1.35c4.69 0 7.79 0 10.5-1 3.85-1.44 6-4.59 6.41-9.38.2-2.46 1.42-4.85 2.84-7.62a41.3 41.3 0 003.42-8.13 48 48 0 001.59-10.79c.1-5.13-1-8.48-3.35-10.55-2.16-1.87-4.64-1.87-9.6-1.88a46.86 46.86 0 01-6.64-.29c-1.92-.94-5.72-4-8.51-6.3l-1.58-1.28c-1.6-1.3-3.27-2.79-4.87-4.23-3.33-3-6.47-5.79-9.61-7.45a20.2 20.2 0 01-6.43-5.53 12.44 12.44 0 01-1.72-5.36 6 6 0 00-6-5.86z"></path></svg></button></span></span><a href=https://github.com/reactjs/reactjs.org/tree/main/content/blog/2018-06-07-you-probably-dont-need-derived-state.md class=css-1epz0fh>Edit this page</a><hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>这个页面有用吗？编辑这个页面</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></div></div></article><div class=css-1kbu8hg><div><div style="opacity:0;transition:opacity .5s ease" class=css-1gf3j5r><div style="transform:translate(0px,40px);transition:transform .5s ease" class=css-dnl0w7><nav class="css-7stz2q css-1aai96l"><div><button aria-expanded=true aria-controls=section_08749859226964403 class=css-1j8jxus><div class=css-1luyeat>Recent Posts<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>最近的帖子</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result><svg viewBox="0 0 926.23699 573.74994" version=1.1 x=0px y=0px width=10 height=10 class=css-1mwek35><g transform=translate(904.92214,-879.1482)><path d="
          m -673.67664,1221.6502 -231.2455,-231.24803 55.6165,
          -55.627 c 30.5891,-30.59485 56.1806,-55.627 56.8701,-55.627 0.6894,
          0 79.8637,78.60862 175.9427,174.68583 l 174.6892,174.6858 174.6892,
          -174.6858 c 96.079,-96.07721 175.253196,-174.68583 175.942696,
          -174.68583 0.6895,0 26.281,25.03215 56.8701,
          55.627 l 55.6165,55.627 -231.245496,231.24803 c -127.185,127.1864
          -231.5279,231.248 -231.873,231.248 -0.3451,0 -104.688,
          -104.0616 -231.873,-231.248 z
        " fill=currentColor></path></g></svg></div></button><ul id=section_08749859226964403 class=css-ts0qly><li class=css-atv6j6><a class=css-e8rm5m href=https://legacy.reactjs.org/blog/2022/06/15/react-labs-what-we-have-been-working-on-june-2022.html>React Labs: What We've Been Working On – June 2022<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>React Labs：我们一直在做的事情——2022 年 6 月</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><li class=css-atv6j6><a class=css-e8rm5m href=https://legacy.reactjs.org/blog/2022/03/29/react-v18.html>React v18.0<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>反应 v18.0</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><li class=css-atv6j6><a class=css-e8rm5m href=https://legacy.reactjs.org/blog/2022/03/08/react-18-upgrade-guide.html>How to Upgrade to React 18<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>如何升级到 React 18</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><li class=css-atv6j6><a class=css-e8rm5m href=https://legacy.reactjs.org/blog/2021/12/17/react-conf-2021-recap.html>React Conf 2021 Recap<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>React Conf 2021 回顾</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><li class=css-atv6j6><a class=css-e8rm5m href=https://legacy.reactjs.org/blog/2021/06/08/the-plan-for-react-18.html>The Plan for React 18<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>React 18 的计划</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><li class=css-atv6j6><a class=css-e8rm5m href=https://legacy.reactjs.org/blog/2020/12/21/data-fetching-with-react-server-components.html>Introducing Zero-Bundle-Size React Server Components<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>引入零捆绑大小的 React 服务器组件</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><li class=css-atv6j6><a class=css-e8rm5m href=https://legacy.reactjs.org/blog/2020/10/20/react-v17.html>React v17.0<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>反应 v17.0</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><li class=css-atv6j6><a class=css-e8rm5m href=https://legacy.reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html>Introducing the New JSX Transform<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>引入新的 JSX 转换</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><li class=css-atv6j6><a class=css-e8rm5m href=https://legacy.reactjs.org/blog/2020/08/10/react-v17-rc.html>React v17.0 Release Candidate: No New Features<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>React v17.0 候选发布版：无新功能</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><li class=css-atv6j6><a class=css-e8rm5m href=https://legacy.reactjs.org/blog/2020/02/26/react-v16.13.0.html>React v16.13.0<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>反应 v16.13.0</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><li class=css-atv6j6><a class=css-e8rm5m href=https://legacy.reactjs.org/blog/all.html>All posts ...<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>所有帖子...</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a></ul></div></nav></div></div><div role=button tabindex=0 class=css-yx40kw><div class=css-tctv7l><div class=css-7ef8f8><div class=css-1dgtft4><svg viewBox="0 0 926.23699 573.74994" version=1.1 x=0px y=0px width=15 height=15 class=css-sg9l1i><g transform=translate(904.92214,-879.1482)><path d="
          m -673.67664,1221.6502 -231.2455,-231.24803 55.6165,
          -55.627 c 30.5891,-30.59485 56.1806,-55.627 56.8701,-55.627 0.6894,
          0 79.8637,78.60862 175.9427,174.68583 l 174.6892,174.6858 174.6892,
          -174.6858 c 96.079,-96.07721 175.253196,-174.68583 175.942696,
          -174.68583 0.6895,0 26.281,25.03215 56.8701,
          55.627 l 55.6165,55.627 -231.245496,231.24803 c -127.185,127.1864
          -231.5279,231.248 -231.873,231.248 -0.3451,0 -104.688,
          -104.0616 -231.873,-231.248 z
        " fill=currentColor></path></g></svg><svg viewBox="0 0 926.23699 573.74994" version=1.1 x=0px y=0px width=15 height=15 class=css-o1zbu3><g transform=translate(904.92214,-879.1482)><path d="
          m -673.67664,1221.6502 -231.2455,-231.24803 55.6165,
          -55.627 c 30.5891,-30.59485 56.1806,-55.627 56.8701,-55.627 0.6894,
          0 79.8637,78.60862 175.9427,174.68583 l 174.6892,174.6858 174.6892,
          -174.6858 c 96.079,-96.07721 175.253196,-174.68583 175.942696,
          -174.68583 0.6895,0 26.281,25.03215 56.8701,
          55.627 l 55.6165,55.627 -231.245496,231.24803 c -127.185,127.1864
          -231.5279,231.248 -231.873,231.248 -0.3451,0 -104.688,
          -104.0616 -231.873,-231.248 z
        " fill=currentColor></path></g></svg></div></div></div></div></div></div></div></div></div></div></div><footer class=css-vn0yrr><div class=css-tctv7l><div class=css-ftk3jl><div class=css-1q9mcvr><div class=css-12bsqfj><div class=css-1m3wp4q><div class=css-krwajx>Docs<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>文档</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></div><a class=css-8l81zy href=https://legacy.reactjs.org/docs/getting-started.html>Installation<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>安装</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><a class=css-8l81zy href=https://legacy.reactjs.org/docs/hello-world.html>Main Concepts<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>主要概念</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><a class=css-8l81zy href=https://legacy.reactjs.org/docs/accessibility.html>Advanced Guides<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>高级指南</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><a class=css-8l81zy href=https://legacy.reactjs.org/docs/react-api.html>API Reference<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>API参考</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><a class=css-8l81zy href=https://legacy.reactjs.org/docs/hooks-intro.html>Hooks<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>挂钩</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><a class=css-8l81zy href=https://legacy.reactjs.org/docs/testing.html>Testing<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>测试</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><a class=css-8l81zy href=https://legacy.reactjs.org/docs/how-to-contribute.html>Contributing<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>贡献</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><a class=css-8l81zy href=https://legacy.reactjs.org/docs/faq-ajax.html>FAQ<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>常问问题</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a></div></div><div class=css-12bsqfj><div class=css-1m3wp4q><div class=css-krwajx>Channels<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>频道</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></div><a href=https://github.com/facebook/react target=_blank rel=noopener class=css-8l81zy>GitHub<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>GitHub</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result><svg x=0px y=0px viewBox="0 0 100 100" width=15 height=15 class=css-6na5q4><path fill=currentColor d="
      M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,
      0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z
    "></path><polygon fill=currentColor points="
      45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,
      14.9 62.8,22.9 71.5,22.9
      "></polygon></svg></a><a href=https://stackoverflow.com/questions/tagged/reactjs target=_blank rel=noopener class=css-8l81zy>Stack Overflow<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>堆栈溢出</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result><svg x=0px y=0px viewBox="0 0 100 100" width=15 height=15 class=css-6na5q4><path fill=currentColor d="
      M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,
      0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z
    "></path><polygon fill=currentColor points="
      45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,
      14.9 62.8,22.9 71.5,22.9
      "></polygon></svg></a><a href=https://reactjs.org/community/support.html#popular-discussion-forums target=_blank rel=noopener class=css-8l81zy>Discussion Forums<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>论坛</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result><svg x=0px y=0px viewBox="0 0 100 100" width=15 height=15 class=css-6na5q4><path fill=currentColor d="
      M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,
      0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z
    "></path><polygon fill=currentColor points="
      45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,
      14.9 62.8,22.9 71.5,22.9
      "></polygon></svg></a><a href=https://discord.gg/reactiflux target=_blank rel=noopener class=css-8l81zy>Reactiflux Chat<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>Reactiflux 聊天室</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result><svg x=0px y=0px viewBox="0 0 100 100" width=15 height=15 class=css-6na5q4><path fill=currentColor d="
      M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,
      0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z
    "></path><polygon fill=currentColor points="
      45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,
      14.9 62.8,22.9 71.5,22.9
      "></polygon></svg></a><a href=https://dev.to/t/react target=_blank rel=noopener class=css-8l81zy>DEV Community<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>开发社区</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result><svg x=0px y=0px viewBox="0 0 100 100" width=15 height=15 class=css-6na5q4><path fill=currentColor d="
      M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,
      0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z
    "></path><polygon fill=currentColor points="
      45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,
      14.9 62.8,22.9 71.5,22.9
      "></polygon></svg></a><a href=https://www.facebook.com/react target=_blank rel=noopener class=css-8l81zy>Facebook<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>Facebook</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result><svg x=0px y=0px viewBox="0 0 100 100" width=15 height=15 class=css-6na5q4><path fill=currentColor d="
      M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,
      0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z
    "></path><polygon fill=currentColor points="
      45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,
      14.9 62.8,22.9 71.5,22.9
      "></polygon></svg></a><a href=https://twitter.com/reactjs target=_blank rel=noopener class=css-8l81zy>Twitter<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>推特</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result><svg x=0px y=0px viewBox="0 0 100 100" width=15 height=15 class=css-6na5q4><path fill=currentColor d="
      M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,
      0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z
    "></path><polygon fill=currentColor points="
      45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,
      14.9 62.8,22.9 71.5,22.9
      "></polygon></svg></a></div></div><div class=css-12bsqfj><div class=css-1m3wp4q><div class=css-krwajx>Community<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>社区</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></div><a href=https://github.com/facebook/react/blob/main/CODE_OF_CONDUCT.md class=css-8l81zy>Code of Conduct<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>行为守则</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result><svg x=0px y=0px viewBox="0 0 100 100" width=15 height=15 class=css-6na5q4><path fill=currentColor d="
      M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,
      0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z
    "></path><polygon fill=currentColor points="
      45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,
      14.9 62.8,22.9 71.5,22.9
      "></polygon></svg></a><a class=css-8l81zy href=https://legacy.reactjs.org/community/support.html>Community Resources<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>社区资源</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a></div></div><div class=css-12bsqfj><div class=css-1m3wp4q><div class=css-krwajx>More<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>更多的</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></div><a class=css-8l81zy href=https://legacy.reactjs.org/tutorial/tutorial.html>Tutorial<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>教程</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><a class=css-8l81zy href=https://legacy.reactjs.org/blog>Blog<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>博客</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><a class=css-8l81zy href=https://legacy.reactjs.org/acknowledgements.html>Acknowledgements<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>致谢</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></a><a href=https://reactnative.dev/ target=_blank rel=noopener class=css-8l81zy>React Native<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>反应本机</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result><svg x=0px y=0px viewBox="0 0 100 100" width=15 height=15 class=css-6na5q4><path fill=currentColor d="
      M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,
      0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z
    "></path><polygon fill=currentColor points="
      45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,
      14.9 62.8,22.9 71.5,22.9
      "></polygon></svg></a><a href=https://opensource.facebook.com/legal/privacy class=css-8l81zy>Privacy<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>隐私</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result><svg x=0px y=0px viewBox="0 0 100 100" width=15 height=15 class=css-6na5q4><path fill=currentColor d="
      M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,
      0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z
    "></path><polygon fill=currentColor points="
      45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,
      14.9 62.8,22.9 71.5,22.9
      "></polygon></svg></a><a href=https://opensource.facebook.com/legal/terms class=css-8l81zy>Terms<hcfy-result style=display:inline-block class="__hcfy-result-comparison__ __hcfy-result-comparison-inline__"><hcfy-result-content contenteditable=false>条款</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result><svg x=0px y=0px viewBox="0 0 100 100" width=15 height=15 class=css-6na5q4><path fill=currentColor d="
      M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,
      0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z
    "></path><polygon fill=currentColor points="
      45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,
      14.9 62.8,22.9 71.5,22.9
      "></polygon></svg></a></div></div></div><section class=css-1ac8j74><a href=https://opensource.facebook.com/projects/ target=_blank rel=noopener><img alt="Facebook Open Source" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVQAAABaCAMAAADQMV5DAAAC3FBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+GTFYVAAAA9HRSTlMAG7O/KQR48v/+hA5W2+piObG8RBSU/fehIG7stSWl9nkIStbYU0XN4FUvrHoDcOi3OAuLmheOmRVm4rtBNbDucsnfXlDUJpuGB3vtM3+mHBKMEF3FSDzmaMLpWN7PRh2XkAaAo3X4riuiBctS3WAxtvFx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" class=css-1izr7si></a><p class=css-1yy5aal>Copyright © 2023 Meta Platforms, Inc.<hcfy-result style=display:block class="__hcfy-result-comparison__ __hcfy-result-comparison-block__"><hcfy-result-content contenteditable=false>版权所有 © 2023 Meta Platforms, Inc.</hcfy-result-content><hcfy-result-actions></hcfy-result-actions></hcfy-result></p></section></div></div></footer></div></div><div id=gatsby-announcer style=position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0 aria-live=assertive aria-atomic=true></div></div><script>document.currentScript.remove();!function(){"use strict";(t=>{const n="singlefile-infobar",e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABAAgMAAADXB5lNAAABhmlDQ1BJQ0MgcHJvZmlsZQAAKJF9kj1Iw0AYht+mSkUrDnYQcchQnSyIijqWKhbBQmkrtOpgcukfNGlIUlwcBdeCgz+LVQcXZ10dXAVB8AfEydFJ0UVK/C4ptIjx4LiH9+59+e67A4RGhalm1wSgapaRisfEbG5VDLyiDwEAvZiVmKkn0osZeI6ve/j4ehfhWd7n/hz9St5kgE8kjjLdsIg3iGc2LZ3zPnGIlSSF+Jx43KACiR+5Lrv8xrnosMAzQ0YmNU8cIhaLHSx3MCsZKvE0cVhRNcoXsi4rnLc4q5Uaa9XJbxjMaytprtMcQRxLSCAJETJqKKMCCxFaNVJMpGg/5uEfdvxJcsnkKoORYwFVqJAcP/gb/O6tWZiadJOCMaD7xbY/RoHALtCs2/b3sW03TwD/M3Cltf3VBjD3SXq9rYWPgIFt4OK6rcl7wOUOMPSkS4bkSH6aQqEAvJ/RM+WAwVv6EGtu31r7OH0AMtSr5Rvg4BAYK1L2use9ezr79u+ZVv9+AFlNcp0UUpiqAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH5AsHAB8H+DhhoQAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAJUExURQAAAICHi4qKioTuJAkAAAABdFJOUwBA5thmAAAAAWJLR0QCZgt8ZAAAAJJJREFUOI3t070NRCEMA2CnYAOyDyPwpHj/Va7hJ3FzV7zy3ET5JIwoAF6Jk4wzAJAkzxAYG9YRTgB+24wBgKmfrGAKTcEfAY4KRlRoIeBTgKOCERVaCPgU4Khge2GqKOBTgKOCERVaAEC/4PNcnyoSWHpjqkhwKxbcig0Q6AorXYF/+A6eIYD1lVbwG/jdA6/kA2THRAURVubcAAAAAElFTkSuQmCC",o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABAAgMAAADXB5lNAAABhmlDQ1BJQ0MgcHJvZmlsZQAAKJF9kj1Iw0AYht+mSkUrDnYQcchQnSyIijqWKhbBQmkrtOpgcukfNGlIUlwcBdeCgz+LVQcXZ10dXAVB8AfEydFJ0UVK/C4ptIjx4LiH9+59+e67A4RGhalm1wSgapaRisfEbG5VDLyiDwEAvZiVmKkn0osZeI6ve/j4ehfhWd7n/hz9St5kgE8kjjLdsIg3iGc2LZ3zPnGIlSSF+Jx43KACiR+5Lrv8xrnosMAzQ0YmNU8cIhaLHSx3MCsZKvE0cVhRNcoXsi4rnLc4q5Uaa9XJbxjMaytprtMcQRxLSCAJETJqKKMCCxFaNVJMpGg/5uEfdvxJcsnkKoORYwFVqJAcP/gb/O6tWZiadJOCMaD7xbY/RoHALtCs2/b3sW03TwD/M3Cltf3VBjD3SXq9rYWPgIFt4OK6rcl7wOUOMPSkS4bkSH6aQqEAvJ/RM+WAwVv6EGtu31r7OH0AMtSr5Rvg4BAYK1L2use9ezr79u+ZVv9+AFlNcp0UUpiqAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH5AsHAB8VC4EQ6QAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAJUExURQAAAICHi4qKioTuJAkAAAABdFJOUwBA5thmAAAAAWJLR0QCZgt8ZAAAAJtJREFUOI3NkrsBgCAMRLFwBPdxBArcfxXFkO8rbKWAAJfHJ9faf9vuYX/749T5NmShm3bEwbe2SxeuM4+2oxDL1cDoKtVUjRy+tH78Cv2CS+wIiQNC1AEhk4AQeUTMWUJMfUJMSEJMSEY8kIx4IONroaYAimNxsXp1PA7PxwfVL8QnowwoVC0lig07wDDVUjAdbAnjwtow/z/bDW7eI4M2KruJAAAAAElFTkSuQmCC",i="SingleFile",A="single-file-ui-element",r="\n\t.infobar {\n\t\tbackground-color: #737373;\n\t\tcolor: white;\n\t\tdisplay: flex;\n\t\tposition: fixed;\n\t\ttop: 16px;\n\t\tright: 16px;\n\t\theight: auto;\n\t\twidth: auto;\n\t\tmin-height: 24px;\n\t\tmin-width: 24px;\n\t\tbackground-position: center;\n\t\tbackground-repeat: no-repeat;\n\t\tz-index: 2147483647;\n\t\tmargin: 0 0 0 16px;\n\t\tbackground-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABABAMAAABYR2ztAAABhmlDQ1BJQ0MgcHJvZmlsZQAAKJF9kj1Iw0AYht+mSkUrDnYQcchQnSyIijqWKhbBQmkrtOpgcukfNGlIUlwcBdeCgz+LVQcXZ10dXAVB8AfEydFJ0UVK/C4ptIjx4LiH9+59+e67A4RGhalm1wSgapaRisfEbG5VDLyiDwEAvZiVmKkn0osZeI6ve/j4ehfhWd7n/hz9St5kgE8kjjLdsIg3iGc2LZ3zPnGIlSSF+Jx43KACiR+5Lrv8xrnosMAzQ0YmNU8cIhaLHSx3MCsZKvE0cVhRNcoXsi4rnLc4q5Uaa9XJbxjMaytprtMcQRxLSCAJETJqKKMCCxFaNVJMpGg/5uEfdvxJcsnkKoORYwFVqJAcP/gb/O6tWZiadJOCMaD7xbY/RoHALtCs2/b3sW03TwD/M3Cltf3VBjD3SXq9rYWPgIFt4OK6rcl7wOUOMPSkS4bkSH6aQqEAvJ/RM+WAwVv6EGtu31r7OH0AMtSr5Rvg4BAYK1L2use9ezr79u+ZVv9+AFlNcp0UUpiqAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH5AsHADIRLMaOHwAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAPUExURQAAAIqKioyNjY2OjvDw8L2y1DEAAAABdFJOUwBA5thmAAAAAWJLR0QB/wIt3gAAAGNJREFUSMdjYCAJsLi4OBCQx6/CBQwIGIDPCBcXAkYQUsACU+AwlBVQHg6Eg5pgZBGOboIJZugDFwRwoJECJCUOhJI1wZwzqmBUwagCuipgIqTABG9h7YIKaKGAURAFEF/6AQAO4HqSoDP8bgAAAABJRU5ErkJggg==);\n\t\tborder-radius: 16px;\n\t\tuser-select: none;\n\t\t-moz-user-select: none;\n\t\topacity: .7;\n\t\tcursor: pointer;\n\t\tpadding-left: 0;\n\t\tpadding-right: 0;\n\t\tpadding-top: 0;\n\t\tpadding-bottom: 0;\n\t\tborder: 2px solid #eee;\n\t\tbackground-size: 70% 70%;\n\t\ttransition: all 250ms;\n\t\tfont-size: 13px;\n\t}\n\t.infobar:hover {\n\t\topacity: 1;\n\t}\n\t.infobar-open {\n\t\topacity: 1;\n\t\tbackground-color: #f9f9f9;\n\t\tcursor: auto;\n\t\tcolor: #2d2d2d;\n\t\tpadding-top: 2px;\n\t\tpadding-bottom: 2px;\n\t\tborder: 2px solid #878787;\n\t\tbackground-image: none;\n\t\tborder-radius: 8px;\n\t\tuser-select: initial;\n\t\t-moz-user-select: initial;\n\t}\n\t.infobar-close-button {\n\t\tdisplay: none;\n\t\topacity: .7;\n\t\tpadding-top: 4px;\n\t\tpadding-left: 8px;\n\t\tpadding-right: 8px;\n\t\tcursor: pointer;\n\t\ttransition: opacity 250ms;\n\t\theight: 16px;\n\t}\n\t.infobar-close-button:hover {\n\t\topacity: 1;\n\t}\n\t.infobar-content {\n\t\tdisplay: none;\n\t\tfont-family: Arial;\n\t\tfont-size: 14px;\n\t\tline-height: 22px;\n\t\tword-break: break-word;\n\t\twhite-space: pre-wrap;\n\t\tposition: relative;\n\t\ttop: 1px;\n\t\ttext-align: left;\n\t}\n\t.infobar-link {\n\t\tdisplay: none;\n\t\tpadding-left: 8px;\n\t\tpadding-right: 8px;\n\t\tline-height: 11px;\n\t\tcursor: pointer;\n\t\tuser-select: none;\n\t\toutline: 0;\n\t}\n\t.infobar-link-icon {\n\t\tpadding-top: 4px;\n\t\tpadding-left: 2px;\n\t\tcursor: pointer;\n\t\topacity: .7;\n\t\ttransition: opacity 250ms;\n\t\theight: 16px;\n\t}\n\t.infobar-link-icon:hover {\n\t\topacity: 1;\n\t}\n\t.infobar-open .infobar-close-button, .infobar-open .infobar-content, .infobar-open .infobar-link {\n\t\tdisplay: inline-block;\n\t}";let a=!0;const c=t.browser;async function s(){const t=document.evaluate("//comment()",document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);let s=t&&t.singleNodeValue;if(s&&((p=s).nodeType==Node.COMMENT_NODE&&p.textContent.includes(i))){const t=s.textContent.split("\n"),[,,i,...p]=t,g=i.match(/^ url: (.*) $/),h=g&&g[1];if(h){let t;if(c&&c.runtime&&c.runtime.sendMessage)try{t=await c.runtime.sendMessage({method:"tabs.getOptions",url:h})}catch(n){t={displayInfobar:!0}}else t={displayInfobar:!0};t.displayInfobar&&await async function(t,i){let c=document.querySelector(n);if(!c){let s="";if(i.length){const t=i[0].split("saved date: ")[1];if(t&&i.shift(),i.length>1){let t=i[0].split("info: ")[1].trim();for(let n=1;n<i.length-1;n++)t+="\n"+i[n].trim();s=t.trim()}else s=t}s=s||"No info",c=d(n,document.body),c.className=A;const p=await async function(t){if(t.attachShadow)return t.attachShadow({mode:"open"});{a=!1;const n=d("iframe",t);return n.style.setProperty("background-color","transparent","important"),n.style.setProperty("position","fixed","important"),n.style.setProperty("top",0,"important"),n.style.setProperty("right",0,"important"),n.style.setProperty("width","44px","important"),n.style.setProperty("height","48px","important"),n.style.setProperty("z-index",2147483647,"important"),new Promise((t=>{n.contentDocument.body.style.setProperty("margin",0),n.onload=()=>t(n.contentDocument.body)}))}}(c),g=document.createElement("style");g.textContent=r,p.appendChild(g);const h=document.createElement("div");h.classList.add("infobar"),p.appendChild(h);const u=document.createElement("img");u.classList.add("infobar-close-button"),h.appendChild(u),u.src=o,u.onclick=t=>{0===t.button&&c.remove()};const m=document.createElement("span");h.appendChild(m),m.classList.add("infobar-content"),m.textContent=s;const f=document.createElement("a");f.classList.add("infobar-link"),h.appendChild(f),f.target="_blank",f.rel="noopener noreferrer",f.title="Open source URL: "+t,f.href=t;const b=document.createElement("img");b.classList.add("infobar-link-icon"),f.appendChild(b),b.src=e,l(h),document.addEventListener("click",(t=>{if(0===t.button){let n=t.target;for(;n&&n!=c;)n=n.parentElement;n!=c&&l(h)}}))}}(h,p)}}var p}function l(t){if(t.classList.remove("infobar-open"),t.onclick=e=>{if(0===e.button)return function(t){a||document.querySelector(n).childNodes[0].contentWindow.getSelection().removeAllRanges();if(t.classList.add("infobar-open"),t.onclick=null,t.onmouseout=null,!a){const e=document.querySelector(n).childNodes[0];e.style.setProperty("width","100vw","important"),e.style.setProperty("height","100vh","important"),e.style.setProperty("width",t.getBoundingClientRect().width+33+"px","important"),e.style.setProperty("height",t.getBoundingClientRect().height+21+"px","important")}}(t),!1},!a){const t=document.querySelector(n).childNodes[0];t.style.setProperty("width","44px","important"),t.style.setProperty("height","48px","important")}}function d(t,n){const e=document.createElement(t);return n.appendChild(e),Array.from(getComputedStyle(e)).forEach((t=>e.style.setProperty(t,"initial","important"))),e}t.window==t.top&&("loading"==document.readyState?document.addEventListener("DOMContentLoaded",s,!1):s())})("object"==typeof globalThis?globalThis:window)}();
</script>