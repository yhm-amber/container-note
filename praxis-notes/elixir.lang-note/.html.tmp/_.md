
~~~ html
<div id="container">
    <div class="wrap">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="content">
  <div class="hfeed">
  <div class="hentry post">
    <div class="entry-summary">
      <h5>Elixir is a dynamic, functional language for building scalable and maintainable applications.</h5>

      <p>Elixir runs on the Erlang VM, known for creating low-latency, distributed, and fault-tolerant systems. These capabilities and Elixir tooling allow developers to be productive in several domains, such as web development, embedded software, data pipelines, and multimedia processing, across a wide range of industries.</p>

      <p>Here is a peek:</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"Elixir"</span> <span class="o">|&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">graphemes</span><span class="p">()</span> <span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">frequencies</span><span class="p">()</span>
<span class="p">%{</span><span class="s2">"E"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"i"</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"l"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"r"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"x"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">}</span></code></pre></figure>

      <p>Check our <a href="/getting-started/introduction.html">getting started guide</a> and our <a href="/learning.html">learning page</a> to begin your journey with Elixir. Or keep scrolling for an overview of the platform, language, and tools.
    </p></div>
  </div>

  <div class="hentry post">
    <div class="cases-header">
      <h4>Companies using Elixir in production</h4>
      <a href="/cases.html">See more cases →</a>
    </div>

    <div class="cases-boxes" id="shuffled-cases">
      
        <a class="cases-box" href="/blog/2021/07/29/bootstraping-a-multiplayer-server-with-elixir-at-x-plane/" title="Case: Bootstrapping a multiplayer server with Elixir at X-Plane">
          
            <div class="cases-image" style="background-image: url('/images/cases/logos/x-plane.png')"></div>
          
          <div class="cases-tag">
            
              <span>#multiplayer</span>
            
              <span>#udp</span>
            
              <span>#otp</span>
            
          </div>
        </a>
      
        <a class="cases-box" href="/blog/2020/10/27/delivering-social-change-with-elixir-at-change.org/" title="Case: Delivering social change with Elixir at Change.org">
          
            <div class="cases-image" style="background-image: url('/images/cases/logos/change.png')"></div>
          
          <div class="cases-tag">
            
              <span>#social</span>
            
              <span>#broadway</span>
            
          </div>
        </a>
      
        <a class="cases-box" href="/blog/2020/11/17/real-time-collaboration-with-elixir-at-slab/" title="Case: Real-time collaboration with Elixir at Slab">
          
            <div class="cases-image" style="background-image: url('/images/cases/logos/slab.png')"></div>
          
          <div class="cases-tag">
            
              <span>#collab</span>
            
              <span>#phoenix</span>
            
              <span>#otp</span>
            
          </div>
        </a>
      
        <a class="cases-box" href="/blog/2020/09/24/paas-with-elixir-at-Heroku/" title="Case: PaaS with Elixir at Heroku">
          
            <div class="cases-image" style="background-image: url('/images/cases/logos/heroku.png')"></div>
          
          <div class="cases-tag">
            
              <span>#paas</span>
            
              <span>#phoenix</span>
            
          </div>
        </a>
      
        <a class="cases-box" href="/blog/2020/08/20/embedded-elixir-at-farmbot/" title="Case: Embedded Elixir at Farmbot">
          
            <div class="cases-image" style="background-image: url('/images/cases/logos/farmbot.png')"></div>
          
          <div class="cases-tag">
            
              <span>#embedded</span>
            
              <span>#nerves</span>
            
          </div>
        </a>
      
        <a class="cases-box" href="/blog/2020/10/08/real-time-communication-at-scale-with-elixir-at-discord/" title="Case: Real time communication at scale with Elixir at Discord">
          
            <div class="cases-image" style="background-image: url('/images/cases/logos/discord.png')"></div>
          
          <div class="cases-tag">
            
              <span>#real-time</span>
            
              <span>#genstage</span>
            
              <span>#otp</span>
            
          </div>
        </a>
      
        <a class="cases-box" href="/blog/2021/02/03/social-messaging-with-elixir-at-community/" title="Case: Social messaging with Elixir at Community">
          
            <div class="cases-image" style="background-image: url('/images/cases/logos/community.png')"></div>
          
          <div class="cases-tag">
            
              <span>#messaging</span>
            
              <span>#broadway</span>
            
          </div>
        </a>
      
        <a class="cases-box" href="/blog/2021/04/02/marketing-and-sales-intelligence-with-elixir-at-pepsico/" title="Case: Marketing and sales intelligence with Elixir at PepsiCo">
          
            <div class="cases-image" style="background-image: url('/images/cases/logos/pepsico.png')"></div>
          
          <div class="cases-tag">
            
              <span>#biz-intelligence</span>
            
              <span>#phoenix</span>
            
          </div>
        </a>
      
        <a class="cases-box" href="/blog/2021/06/02/social-virtual-spaces-with-elixir-at-mozilla/" title="Case: Social virtual spaces with Elixir at Mozilla">
          
            <div class="cases-image" style="background-image: url('/images/cases/logos/mozilla-hubs.png')"></div>
          
          <div class="cases-tag">
            
              <span>#virtual-spaces</span>
            
              <span>#phoenix</span>
            
          </div>
        </a>
      
        <a class="cases-box" href="/blog/2021/11/10/embracing-open-data-with-elixir-at-the-ministry-of-ecological-transition-in-france/" title="Case: Embracing open data with Elixir at the Ministry of Ecological Transition in France">
          
            <div class="cases-image" style="background-image: url('/images/cases/logos/met-france.svg')"></div>
          
          <div class="cases-tag">
            
              <span>#open-data</span>
            
              <span>#gov</span>
            
              <span>#phoenix</span>
            
          </div>
        </a>
      
        <a class="cases-box" href="/blog/2021/01/13/orchestrating-computer-vision-with-elixir-at-v7/" title="Case: Orchestrating computer vision with Elixir at V7">
          
            <div class="cases-image" style="background-image: url('/images/cases/logos/v7.png')"></div>
          
          <div class="cases-tag">
            
              <span>#computer-vision</span>
            
              <span>#phoenix</span>
            
          </div>
        </a>
      
        <a class="cases-box" href="/blog/2020/12/10/integrating-travel-with-elixir-at-duffel/" title="Case: Integrating travel with Elixir at Duffel">
          
            <div class="cases-image" style="background-image: url('/images/cases/logos/duffel.png')"></div>
          
          <div class="cases-tag">
            
              <span>#api</span>
            
              <span>#integration</span>
            
              <span>#xml</span>
            
          </div>
        </a>
      
    </div>
  </div>

  <div class="hentry post">
    <h3>Platform features</h3>
  </div>

  <div class="hentry post">
    <h4>Scalability</h4>
    <div class="entry-summary">

      <p>All Elixir code runs inside lightweight threads of execution (called processes) that are isolated and exchange information via messages:</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="n">current_process</span> <span class="o">=</span> <span class="n">self</span><span class="p">()</span>

<span class="c1"># Spawn an Elixir process (not an operating system one!)</span>
<span class="n">spawn_link</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span>
  <span class="n">send</span><span class="p">(</span><span class="n">current_process</span><span class="p">,</span> <span class="p">{</span><span class="ss">:msg</span><span class="p">,</span> <span class="s2">"hello world"</span><span class="p">})</span>
<span class="k">end</span><span class="p">)</span>

<span class="c1"># Block until the message is received</span>
<span class="k">receive</span> <span class="k">do</span>
  <span class="p">{</span><span class="ss">:msg</span><span class="p">,</span> <span class="n">contents</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
<span class="k">end</span></code></pre></figure>

      <p>Due to their lightweight nature, it is not uncommon to have hundreds of thousands of processes running <i>concurrently</i> in the same machine. Isolation allows processes to be garbage collected independently, reducing system-wide pauses, and using all machine resources as efficiently as possible (vertical scaling).</p>

      <p>Processes are also able to communicate with other processes running on different machines in the same network. This provides the foundation for distribution, allowing developers to coordinate work across multiple nodes (horizontal scaling).</p>
    </div>
  </div>

  <div class="hentry post">
    <h4>Fault-tolerance</h4>

    <div class="entry-summary">
      <p>The unavoidable truth about software running in production is that <i>things will go wrong</i>. Even more when we take network, file systems, and other third-party resources into account.</p>

      <p>To cope with failures, Elixir provides supervisors which describe how to restart parts of your system when things go awry, going back to a known initial state that is guaranteed to work:</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
  <span class="no">TCP</span><span class="o">.</span><span class="no">Pool</span><span class="p">,</span>
  <span class="p">{</span><span class="no">TCP</span><span class="o">.</span><span class="no">Acceptor</span><span class="p">,</span> <span class="ss">port:</span> <span class="mi">4040</span><span class="p">}</span>
<span class="p">]</span>

<span class="no">Supervisor</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="ss">strategy:</span> <span class="ss">:one_for_one</span><span class="p">)</span></code></pre></figure>

      <p>The combination of fault-tolerance and event-driven programming via message passing makes Elixir an excellent choice for reactive programming and robust architectures. Frameworks, <a href="https://www.nerves-project.org/">such as Nerves</a>, build on this foundation to enable productive development of reliable embedded/IoT systems.</p>
    </div>
  </div>

  <div class="hentry post">
    <h3>Language features</h3>
  </div>

  <div class="hentry post">
    <h4>Functional programming</h4>

    <div class="entry-summary">
      <p>Functional programming promotes a coding style that helps developers write code that is short, concise, and maintainable. For example, pattern matching allows developers to easily destructure data and access its contents:</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="p">%</span><span class="no">User</span><span class="p">{</span><span class="ss">name:</span> <span class="n">name</span><span class="p">,</span> <span class="ss">age:</span> <span class="n">age</span><span class="p">}</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"John Doe"</span><span class="p">)</span>
<span class="n">name</span> <span class="c1">#=&gt; "John Doe"</span></code></pre></figure>

      <p>When mixed with guards, pattern matching allows us to elegantly match and assert specific conditions for some code to execute:</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="k">def</span> <span class="n">drive</span><span class="p">(%</span><span class="no">User</span><span class="p">{</span><span class="ss">age:</span> <span class="n">age</span><span class="p">})</span> <span class="ow">when</span> <span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">16</span> <span class="k">do</span>
  <span class="c1"># Code that drives a car</span>
<span class="k">end</span>

<span class="n">drive</span><span class="p">(</span><span class="no">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"John Doe"</span><span class="p">))</span>
<span class="c1">#=&gt; Fails if the user is under 16</span></code></pre></figure>

      <p>Elixir relies heavily on those features to ensure your software is working under the expected constraints. And when it is not, don't worry, supervisors have your back!</p>
    </div>
  </div>

  <div class="hentry post">
    <h4>Extensibility and DSLs</h4>

    <div class="entry-summary">
      <p>Elixir has been designed to be extensible, letting developers naturally extend the language to particular domains, in order to increase their productivity.</p>

      <p>As an example, let's write a simple test case using <a href="https://hexdocs.pm/ex_unit/">Elixir's test framework called ExUnit</a>:</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="k">defmodule</span> <span class="no">MathTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ExUnit</span><span class="o">.</span><span class="no">Case</span><span class="p">,</span> <span class="ss">async:</span> <span class="no">true</span>

  <span class="n">test</span> <span class="s2">"can add two numbers"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">2</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

      <p>The <code>async: true</code> option allows <code>test</code>s to run in parallel, using as many CPU cores as possible, while the <code>assert</code> functionality can introspect your code, providing great reports in case of failures.</p>

      <p>Other examples include using <a href="https://github.com/elixir-ecto/ecto">Elixir to write SQL queries</a>, <a href="https://github.com/elixir-nx/nx">compiling a subset of Elixir to the GPU</a>, and many more.</p>
    </div>
  </div>

  <div class="hentry post">
    <h3>Tooling features</h3>
  </div>

  <div class="hentry post">
    <h4>A growing ecosystem</h4>

    <div class="entry-summary">
      <p>Elixir ships with a great set of tools to ease development. <a href="https://hexdocs.pm/mix/">Mix is a build tool</a> that allows you to easily create projects, manage tasks, run tests and more:</p>

<pre><code>$ mix new my_app
$ cd my_app
$ mix test
<span style="color:#919D41">.</span>

Finished in 0.04 seconds (0.04s on load, 0.00s on tests)
<span style="color:#919D41">1 test, 0 failures</span>
</code></pre>

      <p>Mix is also able to manage dependencies and integrates with the <a href="https://hex.pm/">Hex package manager</a>, which performs dependency resolution, fetches remote packages, and <a href="https://hexdocs.pm/">hosts documentation</a> for the whole ecosystem.</p>
    </div>
  </div>

  <div class="hentry post">
    <h4>Interactive development</h4>

    <div class="entry-summary">
      <p>Tools like <a href="https://hexdocs.pm/iex/">IEx (Elixir's interactive shell)</a> are able to leverage many aspects of the language and platform to provide auto-complete, debugging tools, code reloading, as well as nicely formatted documentation:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">$ iex
Interactive Elixir - press Ctrl+C to exit (type h() ENTER for help)
iex&gt; h String.trim           # Prints the documentation for function
iex&gt; i "Hello, World"        # Prints information about the given data type
iex&gt; break! String.trim/1    # Sets a breakpoint in the String.trim/1 function
iex&gt; recompile               # Recompiles the current project on the fly</code></pre></figure>

      <p>Code notebooks like <a href="https://livebook.dev/">Livebook</a> allow you to interact with Elixir directly from your browser, including support for plotting, flowcharts, data tables, machine learning, and much more!</p>
    </div>
  </div>

  <div class="hentry post">
    <h4>Erlang compatible</h4>

    <div class="entry-summary">
      <p>Elixir runs on the Erlang VM giving developers complete access to Erlang's ecosystem, used by companies like <a href="https://www.heroku.com">Heroku</a>, <a href="https://www.whatsapp.com">WhatsApp</a>, <a href="https://klarna.com">Klarna</a> and many more to build distributed, fault-tolerant applications. An Elixir programmer can invoke any Erlang function with no runtime cost:</p>

<figure class="highlight"><pre><code class="language-elixir" data-lang="elixir"><span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:crypto</span><span class="o">.</span><span class="n">hash</span><span class="p">(</span><span class="ss">:md5</span><span class="p">,</span> <span class="s2">"Using crypto from Erlang OTP"</span><span class="p">)</span>
<span class="o">&lt;&lt;</span><span class="mi">192</span><span class="p">,</span> <span class="mi">223</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="o">...&gt;&gt;</span></code></pre></figure>

      <p>To learn more about Elixir, check our <a href="/getting-started/introduction.html">getting started guide</a>. We also have <a href="/docs.html">online documentation available</a> and a <a href="/crash-course.html">Crash Course for Erlang developers</a>.</p>
    </div>
  </div>
</div>

</div><!-- #content -->

<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>

  <div class="widget">
  <h3 class="widget-title">Important links</h3>
  <ul>
    <li class="menu-item development"><a class="spec" href="/development.html">Development &amp; Team</a></li>
    <li><a class="spec" href="https://github.com/elixir-lang/elixir">Source code &amp; issues tracker</a></li>
  </ul>
</div>

<div id="mini-docu" class="widget">
  <a href="https://cult.honeypot.io/originals/elixir-the-documentary">
    <div class="mini-docu-cta">
      <div class="mini-docu-copy">Watch the Elixir<br>mini-documentary!</div>
    </div>
  </a>
</div>

<!-- <div class="widget events">
  <h3 class="widget-title">Upcoming events</h3>
  
</div> -->


<div class="widget">
  <h3 class="widget-title">Join the Community</h3>
  <ul>
    <li><a class="spec" href="https://hex.pm">Hex.pm package manager</a></li>
    <li><a class="spec" href="https://twitter.com/elixirlang">@elixirlang on Twitter</a></li>
    <li><a class="spec" href="irc://irc.libera.chat/elixir">#elixir on irc.libera.chat</a></li>
    <li><a class="spec" href="http://elixirforum.com">Elixir Forum</a></li>
    <li><a class="spec" href="https://elixir-slackin.herokuapp.com/">Elixir on Slack</a></li>
    <li><a class="spec" href="https://discord.gg/elixir">Elixir on Discord</a></li>
    <li><a class="spec" href="https://www.meetup.com/topics/elixir/">Meetups around the world</a></li>
    <li><a class="spec" href="https://github.com/elixir-lang/elixir/wiki">Wiki with events and resources maintained by the community</a></li>
  </ul>
</div>

<div id="eef" class="widget">
  <a href="https://erlef.org/" title="Join the Erlang Ecosystem Foundation"><img src="/images/logo/eef.png" alt="Join the Erlang Ecosystem Foundation" width="174" style="margin-top:-10px"></a>
</div>

</div>

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div path="/getting-started/" page=":GUIDES:"><div page=":GETTING_STARTED:"><div class="wrap" path="/getting-started/introduction.html" page=":1:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><span title="Introduction">Introduction</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Introduction</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#installation">Installation</a></li><li><a href="#interactive-mode">Interactive mode</a></li><li><a href="#running-scripts">Running scripts</a></li><li><a href="#asking-questions">Asking questions</a></li></ol></div>

    
<p>Welcome!</p>

<p>In this tutorial, we are going to teach you about Elixir fundamentals - the language syntax, how to define modules, how to manipulate the characteristics of common data structures, and more. This chapter will focus on ensuring that Elixir is installed and that you can successfully run Elixir’s Interactive Shell, called IEx.</p>

<p>Our requirements are (see <code class="language-plaintext highlighter-rouge">elixir -v</code>):</p>

<ul>
  <li>Elixir 1.11.0 onwards</li>
  <li>Erlang/OTP 22 onwards</li>
</ul>

<p>Let’s get started!</p>

<blockquote>
  <p>If you find any errors in the tutorial or on the website, <a href="https://github.com/elixir-lang/elixir-lang.github.com">please report a bug or send a pull request to our issue tracker</a>.</p>
</blockquote>

<blockquote>
  <p>The Elixir guides are also available in EPUB format:</p>

  <ul>
    <li><a href="https://elixir-lang.org/downloads/books/elixir-getting-started-guide.epub">Getting started guide</a></li>
    <li><a href="https://elixir-lang.org/downloads/books/mix-and-otp.epub">Mix and OTP guide</a></li>
    <li><a href="https://elixir-lang.org/downloads/books/meta-programming-in-elixir.epub">Meta-programming guide</a></li>
  </ul>
</blockquote>

<h2 id="installation" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Installation</span><a href="#installation" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>If you haven’t yet installed Elixir, visit our <a href="/install.html">installation page</a>. Once you are done, you can run <code class="language-plaintext highlighter-rouge">elixir --version</code> to get the current Elixir version.</p>

<h2 id="interactive-mode" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Interactive mode</span><a href="#interactive-mode" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>When you install Elixir, you will have three new executables: <code class="language-plaintext highlighter-rouge">iex</code>, <code class="language-plaintext highlighter-rouge">elixir</code> and <code class="language-plaintext highlighter-rouge">elixirc</code>. If you compiled Elixir from source or are using a packaged version, you can find these inside the <code class="language-plaintext highlighter-rouge">bin</code> directory.</p>

<p>For now, let’s start by running <code class="language-plaintext highlighter-rouge">iex</code> (or <code class="language-plaintext highlighter-rouge">iex.bat</code> if you are on Windows PowerShell, where <code class="language-plaintext highlighter-rouge">iex</code> is a PowerShell command) which stands for Interactive Elixir. In interactive mode, we can type any Elixir expression and get its result. Let’s warm up with some basic expressions.</p>

<p>Open up <code class="language-plaintext highlighter-rouge">iex</code> and type the following expressions:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Erlang</span><span class="o">/</span><span class="no">OTP</span> <span class="mf">23.0</span> <span class="p">[</span><span class="mi">64</span><span class="o">-</span><span class="n">bit</span><span class="p">]</span> <span class="p">[</span><span class="ss">smp:</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>

<span class="no">Interactive</span> <span class="no">Elixir</span> <span class="p">(</span><span class="mf">1.14</span><span class="o">.</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">press</span> <span class="no">Ctrl</span><span class="o">+</span><span class="no">C</span> <span class="n">to</span> <span class="k">exit</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="mi">40</span> <span class="o">+</span> <span class="mi">2</span>
<span class="mi">42</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"hello"</span> <span class="o">&lt;&gt;</span> <span class="s2">" world"</span>
<span class="s2">"hello world"</span>
</code></pre></div></div>

<p>Please note that some details like version numbers may differ a bit in your session; that’s not important. From now on <code class="language-plaintext highlighter-rouge">iex</code> sessions will be stripped down to focus on the code. To exit <code class="language-plaintext highlighter-rouge">iex</code> press <code class="language-plaintext highlighter-rouge">Ctrl+C</code> twice.</p>

<p>It seems we are ready to go! We will use the interactive shell quite a lot in the next chapters to get a bit more familiar with the language constructs and basic types, starting in the next chapter.</p>

<blockquote>
  <p>Note: if you are on Windows, you can also try <code class="language-plaintext highlighter-rouge">iex --werl</code> (<code class="language-plaintext highlighter-rouge">iex.bat --werl</code> on PowerShell) which may provide a better experience depending on which console you are using.</p>
</blockquote>

<h2 id="running-scripts" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Running scripts</span><a href="#running-scripts" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>After getting familiar with the basics of the language you may want to try writing simple programs. This can be accomplished by putting the following Elixir code into a file:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="s2">"Hello world from Elixir"</span><span class="p">)</span>
</code></pre></div></div>

<p>Save it as <code class="language-plaintext highlighter-rouge">simple.exs</code> and execute it with <code class="language-plaintext highlighter-rouge">elixir</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>elixir simple.exs
<span class="go">Hello world from Elixir
</span></code></pre></div></div>

<p>Later on we will learn how to compile Elixir code (in <a href="/getting-started/modules-and-functions.html">Chapter 8</a>) and how to use the Mix build tool (in the <a href="/getting-started/mix-otp/introduction-to-mix.html">Mix &amp; OTP guide</a>). For now, let’s move on to <a href="/getting-started/basic-types.html">Chapter 2</a>.</p>

<h2 id="asking-questions" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Asking questions</span><a href="#asking-questions" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>When going through this getting started guide, it is common to have questions; after all, that is part of the learning process! There are many places where you can ask questions, here are some of them:</p>

<ul>
  <li><a href="irc://irc.libera.chat/elixir">#elixir on irc.libera.chat</a></li>
  <li><a href="http://elixirforum.com">Elixir Forum</a></li>
  <li><a href="https://elixir-slackin.herokuapp.com/">Elixir on Slack</a></li>
  <li><a href="https://discord.gg/elixir">Elixir on Discord</a></li>
  <li><a href="https://stackoverflow.com/questions/tagged/elixir">elixir tag on StackOverflow</a></li>
</ul>

<p>When asking questions, remember these two tips:</p>

<ul>
  <li>
    <p>Instead of asking “how to do X in Elixir”, ask “how to solve Y in Elixir”. In other words, don’t ask how to implement a particular solution, instead describe the problem at hand. Stating the problem gives more context and less bias for a correct answer.</p>
  </li>
  <li>
    <p>In case things are not working as expected, please include as much information as you can in your report, for example: your Elixir version, the code snippet and the error message alongside the error stacktrace. Use sites like <a href="https://gist.github.com/">Gist</a> to paste this information.</p>
  </li>
</ul>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
          <div class="pagination loop-pagination">
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/basic-types.html" class="previous page-numbers spec" title="Basic types">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/introduction.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/basic-types.html" page=":2:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><span title="Basic types">Basic types</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Basic types</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#basic-arithmetic">Basic arithmetic</a></li><li><a href="#identifying-functions-and-documentation">Identifying functions and documentation</a></li><li><a href="#booleans">Booleans</a></li><li><a href="#atoms">Atoms</a></li><li><a href="#strings">Strings</a></li><li><a href="#anonymous-functions">Anonymous functions</a></li><li><a href="#linked-lists">(Linked) Lists</a></li><li><a href="#tuples">Tuples</a></li><li><a href="#lists-or-tuples">Lists or tuples?</a></li></ol></div>

    <p>In this chapter we will learn more about Elixir basic types: integers, floats, booleans, atoms, strings, lists and tuples. Some basic types are:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="mi">1</span>          <span class="c1"># integer</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="mh">0x1F</span>       <span class="c1"># integer</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="mf">1.0</span>        <span class="c1"># float</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">true</span>       <span class="c1"># boolean</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:atom</span>      <span class="c1"># atom / symbol</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"elixir"</span>   <span class="c1"># string</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>  <span class="c1"># list</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>  <span class="c1"># tuple</span>
</code></pre></div></div>

<h2 id="basic-arithmetic" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Basic arithmetic</span><a href="#basic-arithmetic" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Open up <code class="language-plaintext highlighter-rouge">iex</code> and type the following expressions:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span>
<span class="mi">3</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">5</span>
<span class="mi">25</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="mi">10</span> <span class="o">/</span> <span class="mi">2</span>
<span class="mf">5.0</span>
</code></pre></div></div>

<p>Notice that <code class="language-plaintext highlighter-rouge">10 / 2</code> returned a float <code class="language-plaintext highlighter-rouge">5.0</code> instead of an integer <code class="language-plaintext highlighter-rouge">5</code>. This is expected. In Elixir, the operator <code class="language-plaintext highlighter-rouge">/</code> always returns a float. If you want to do integer division or get the division remainder, you can invoke the <code class="language-plaintext highlighter-rouge">div</code> and <code class="language-plaintext highlighter-rouge">rem</code> functions:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">div</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="mi">5</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">div</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span>
<span class="mi">5</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">rem</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span>
<span class="mi">1</span>
</code></pre></div></div>

<p>Notice that Elixir allows you to drop the parentheses when invoking named functions with at least one argument. This feature gives a cleaner syntax when writing declarations and control-flow constructs. However, Elixir developers generally prefer to use parentheses.</p>

<p>Elixir also supports shortcut notations for entering binary, octal, and hexadecimal numbers:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="mb">0b1010</span>
<span class="mi">10</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="mo">0o777</span>
<span class="mi">511</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="mh">0x1F</span>
<span class="mi">31</span>
</code></pre></div></div>

<p>Float numbers require a dot followed by at least one digit and also support <code class="language-plaintext highlighter-rouge">e</code> for scientific notation:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="mf">1.0</span>
<span class="mf">1.0</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="mf">1.0e-10</span>
<span class="mf">1.0e-10</span>
</code></pre></div></div>

<p>Floats in Elixir are 64-bit double precision.</p>

<p>You can invoke the <code class="language-plaintext highlighter-rouge">round</code> function to get the closest integer to a given float, or the <code class="language-plaintext highlighter-rouge">trunc</code> function to get the integer part of a float.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">round</span><span class="p">(</span><span class="mf">3.58</span><span class="p">)</span>
<span class="mi">4</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">trunc</span><span class="p">(</span><span class="mf">3.58</span><span class="p">)</span>
<span class="mi">3</span>
</code></pre></div></div>

<h2 id="identifying-functions-and-documentation" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Identifying functions and documentation</span><a href="#identifying-functions-and-documentation" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Functions in Elixir are identified by both their name and their arity. The arity of a function describes the number of arguments that the function takes. From this point on we will use both the function name and its arity to describe functions throughout the documentation. <code class="language-plaintext highlighter-rouge">trunc/1</code> identifies the function which is named <code class="language-plaintext highlighter-rouge">trunc</code> and takes <code class="language-plaintext highlighter-rouge">1</code> argument, whereas <code class="language-plaintext highlighter-rouge">trunc/2</code> identifies a different (nonexistent) function with the same name but with an arity of <code class="language-plaintext highlighter-rouge">2</code>.</p>

<p>We can also use this syntax to access documentation. The Elixir shell defines the <code class="language-plaintext highlighter-rouge">h</code> function, which you can use to access documentation for any function. For example, typing <code class="language-plaintext highlighter-rouge">h trunc/1</code> is going to print the documentation for the <code class="language-plaintext highlighter-rouge">trunc/1</code> function:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">h</span> <span class="n">trunc</span><span class="o">/</span><span class="mi">1</span>
                             <span class="k">def</span> <span class="n">trunc</span><span class="p">()</span>

<span class="no">Returns</span> <span class="n">the</span> <span class="n">integer</span> <span class="n">part</span> <span class="n">of</span> <span class="n">number</span><span class="o">.</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">h trunc/1</code> works because it is defined in the <code class="language-plaintext highlighter-rouge">Kernel</code> module. All functions in the <code class="language-plaintext highlighter-rouge">Kernel</code> module are automatically imported into our namespace. Most often you will also include the module name when looking up for documentation for a given function:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">h</span> <span class="no">Kernel</span><span class="o">.</span><span class="n">trunc</span><span class="o">/</span><span class="mi">1</span>
                             <span class="k">def</span> <span class="n">trunc</span><span class="p">()</span>

<span class="no">Returns</span> <span class="n">the</span> <span class="n">integer</span> <span class="n">part</span> <span class="n">of</span> <span class="n">number</span><span class="o">.</span>
</code></pre></div></div>

<p>You can use the module+function to lookup for anything, including operators (try <code class="language-plaintext highlighter-rouge">h Kernel.+/2</code>). Invoking <code class="language-plaintext highlighter-rouge">h</code> without arguments displays the documentation for <code class="language-plaintext highlighter-rouge">IEx.Helpers</code>, which is where <code class="language-plaintext highlighter-rouge">h</code> and other functionality is defined.</p>

<h2 id="booleans" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Booleans</span><a href="#booleans" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir supports <code class="language-plaintext highlighter-rouge">true</code> and <code class="language-plaintext highlighter-rouge">false</code> as booleans:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">true</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">true</span> <span class="o">==</span> <span class="no">false</span>
<span class="no">false</span>
</code></pre></div></div>

<p>Elixir provides a bunch of predicate functions to check for a value type. For example, the <code class="language-plaintext highlighter-rouge">is_boolean/1</code> function can be used to check if a value is a boolean or not:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_boolean</span><span class="p">(</span><span class="no">true</span><span class="p">)</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_boolean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="no">false</span>
</code></pre></div></div>

<p>You can also use <code class="language-plaintext highlighter-rouge">is_integer/1</code>, <code class="language-plaintext highlighter-rouge">is_float/1</code> or <code class="language-plaintext highlighter-rouge">is_number/1</code> to check, respectively, if an argument is an integer, a float, or either.</p>

<h2 id="atoms" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Atoms</span><a href="#atoms" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>An atom is a constant whose value is its own name. Some other languages call these symbols. They are often useful to enumerate over distinct values, such as:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:apple</span>
<span class="ss">:apple</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:orange</span>
<span class="ss">:orange</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:watermelon</span>
<span class="ss">:watermelon</span>
</code></pre></div></div>

<p>Atoms are equal if their names are equal.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:apple</span> <span class="o">==</span> <span class="ss">:apple</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:apple</span> <span class="o">==</span> <span class="ss">:orange</span>
<span class="no">false</span>
</code></pre></div></div>

<p>Often they are used to express the state of an operation, by using values such as <code class="language-plaintext highlighter-rouge">:ok</code> and <code class="language-plaintext highlighter-rouge">:error</code>.</p>

<p>The booleans <code class="language-plaintext highlighter-rouge">true</code> and <code class="language-plaintext highlighter-rouge">false</code> are also atoms:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">true</span> <span class="o">==</span> <span class="ss">:true</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_atom</span><span class="p">(</span><span class="no">false</span><span class="p">)</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_boolean</span><span class="p">(</span><span class="ss">:false</span><span class="p">)</span>
<span class="no">true</span>
</code></pre></div></div>

<p>Elixir allows you to skip the leading <code class="language-plaintext highlighter-rouge">:</code> for the atoms <code class="language-plaintext highlighter-rouge">false</code>, <code class="language-plaintext highlighter-rouge">true</code> and <code class="language-plaintext highlighter-rouge">nil</code>.</p>

<p>Finally, Elixir has a construct called aliases which we will explore later. Aliases start in upper case and are also atoms:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_atom</span><span class="p">(</span><span class="no">Hello</span><span class="p">)</span>
<span class="no">true</span>
</code></pre></div></div>

<h2 id="strings" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Strings</span><a href="#strings" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Strings in Elixir are delimited by double quotes, and they are encoded in UTF-8:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"hellö"</span>
<span class="s2">"hellö"</span>
</code></pre></div></div>

<blockquote>
  <p>Note: if you are running on Windows, there is a chance your terminal does not use UTF-8 by default. You can change the encoding of your current session by running <code class="language-plaintext highlighter-rouge">chcp 65001</code> before entering IEx.</p>
</blockquote>

<p>Elixir also supports string interpolation:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">string</span> <span class="o">=</span> <span class="ss">:world</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"hellö </span><span class="si">#{</span><span class="n">string</span><span class="si">}</span><span class="s2">"</span>
<span class="s2">"hellö world"</span>
</code></pre></div></div>

<p>Strings can have line breaks in them. You can introduce them using escape sequences:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"hello
...&gt; world"</span>
<span class="s2">"hello</span><span class="se">\n</span><span class="s2">world"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"hello</span><span class="se">\n</span><span class="s2">world"</span>
<span class="s2">"hello</span><span class="se">\n</span><span class="s2">world"</span>
</code></pre></div></div>

<p>You can print a string using the <code class="language-plaintext highlighter-rouge">IO.puts/1</code> function from the <code class="language-plaintext highlighter-rouge">IO</code> module:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="s2">"hello</span><span class="se">\n</span><span class="s2">world"</span><span class="p">)</span>
<span class="n">hello</span>
<span class="n">world</span>
<span class="ss">:ok</span>
</code></pre></div></div>

<p>Notice that the <code class="language-plaintext highlighter-rouge">IO.puts/1</code> function returns the atom <code class="language-plaintext highlighter-rouge">:ok</code> after printing.</p>

<p>Strings in Elixir are represented internally by contiguous sequences of bytes known as binaries:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_binary</span><span class="p">(</span><span class="s2">"hellö"</span><span class="p">)</span>
<span class="no">true</span>
</code></pre></div></div>

<p>We can also get the number of bytes in a string:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">byte_size</span><span class="p">(</span><span class="s2">"hellö"</span><span class="p">)</span>
<span class="mi">6</span>
</code></pre></div></div>

<p>Notice that the number of bytes in that string is 6, even though it has 5 graphemes. That’s because the grapheme “ö” takes 2 bytes to be represented in UTF-8. We can get the actual length of the string, based on the number of graphemes, by using the <code class="language-plaintext highlighter-rouge">String.length/1</code> function:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">length</span><span class="p">(</span><span class="s2">"hellö"</span><span class="p">)</span>
<span class="mi">5</span>
</code></pre></div></div>

<p>The <a href="https://hexdocs.pm/elixir/String.html">String module</a> contains a bunch of functions that operate on strings as defined in the Unicode standard:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">upcase</span><span class="p">(</span><span class="s2">"hellö"</span><span class="p">)</span>
<span class="s2">"HELLÖ"</span>
</code></pre></div></div>

<h2 id="anonymous-functions" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Anonymous functions</span><a href="#anonymous-functions" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir also provides anonymous functions. Anonymous functions allow us to store and pass executable code around as if it was an integer or a string. They are delimited by the keywords <code class="language-plaintext highlighter-rouge">fn</code> and <code class="language-plaintext highlighter-rouge">end</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">add</span> <span class="o">=</span> <span class="k">fn</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="k">end</span>
<span class="c1">#Function&lt;12.71889879/2 in :erl_eval.expr/5&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">add</span><span class="o">.</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="mi">3</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_function</span><span class="p">(</span><span class="n">add</span><span class="p">)</span>
<span class="no">true</span>
</code></pre></div></div>

<p>In the example above, we defined an anonymous function that receives two arguments, <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code>, and returns the result of <code class="language-plaintext highlighter-rouge">a + b</code>. The arguments are always on the left-hand side of <code class="language-plaintext highlighter-rouge">-&gt;</code> and the code to be executed on the right-hand side. The anonymous function is stored in the variable <code class="language-plaintext highlighter-rouge">add</code>.</p>

<p>We can invoke anonymous functions by passing arguments to it. Note that a dot (<code class="language-plaintext highlighter-rouge">.</code>) between the variable and parentheses is required to invoke an anonymous function. The dot ensures there is no ambiguity between calling the anonymous function matched to a variable <code class="language-plaintext highlighter-rouge">add</code> and a named function <code class="language-plaintext highlighter-rouge">add/2</code>. We will write our own named functions when dealing with <a href="/getting-started/modules-and-functions.html">Modules and Functions</a>. For now, just remember that Elixir makes a clear distinction between anonymous functions and named functions.</p>

<p>Anonymous functions in Elixir are also identified by the number of arguments they receive. We can check if a function is of any given arity by using <code class="language-plaintext highlighter-rouge">is_function/2</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># check if add is a function that expects exactly 2 arguments</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_function</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="no">true</span>
<span class="c1"># check if add is a function that expects exactly 1 argument</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_function</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="no">false</span>
</code></pre></div></div>

<p>Finally, anonymous functions can also access variables that are in scope when the function is defined. This is typically referred to as closures, as they close over their scope. Let’s define a new anonymous function that uses the <code class="language-plaintext highlighter-rouge">add</code> anonymous function we have previously defined:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">double</span> <span class="o">=</span> <span class="k">fn</span> <span class="n">a</span> <span class="o">-&gt;</span> <span class="n">add</span><span class="o">.</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">end</span>
<span class="c1">#Function&lt;6.71889879/1 in :erl_eval.expr/5&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">double</span><span class="o">.</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="mi">4</span>
</code></pre></div></div>

<p>A variable assigned inside a function does not affect its surrounding environment:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">42</span>
<span class="mi">42</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">end</span><span class="p">)</span><span class="o">.</span><span class="p">()</span>
<span class="mi">0</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">x</span>
<span class="mi">42</span>
</code></pre></div></div>

<h2 id="linked-lists" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">(Linked) Lists</span><a href="#linked-lists" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir uses square brackets to specify a list of values. Values can be of any type:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="no">true</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="no">true</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">length</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="mi">3</span>
</code></pre></div></div>

<p>Two lists can be concatenated or subtracted using the <code class="language-plaintext highlighter-rouge">++/2</code> and <code class="language-plaintext highlighter-rouge">--/2</code> operators respectively:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">++</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="no">true</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="no">false</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="no">true</span><span class="p">]</span> <span class="o">--</span> <span class="p">[</span><span class="no">true</span><span class="p">,</span> <span class="no">false</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="no">true</span><span class="p">]</span>
</code></pre></div></div>

<p>List operators never modify the existing list. Concatenating to or removing elements from a list returns a new list. We say that Elixir data structures are <em>immutable</em>. One advantage of immutability is that it leads to clearer code. You can freely pass the data around with the guarantee no one will mutate it in memory - only transform it.</p>

<p>Throughout the tutorial, we will talk a lot about the head and tail of a list. The head is the first element of a list and the tail is the remainder of the list. They can be retrieved with the functions <code class="language-plaintext highlighter-rouge">hd/1</code> and <code class="language-plaintext highlighter-rouge">tl/1</code>. Let’s assign a list to a variable and retrieve its head and tail:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">hd</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">tl</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre></div></div>

<p>Getting the head or the tail of an empty list throws an error:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">hd</span><span class="p">([])</span>
<span class="o">**</span> <span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span> <span class="n">argument</span> <span class="n">error</span>
</code></pre></div></div>

<p>Sometimes you will create a list and it will return a value in single quotes. For example:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span>
<span class="s1">'</span><span class="se">\v\f\r</span><span class="s1">'</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="mi">104</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">111</span><span class="p">]</span>
<span class="s1">'hello'</span>
</code></pre></div></div>

<p>When Elixir sees a list of printable ASCII numbers, Elixir will print that as a charlist (literally a list of characters). Charlists are quite common when interfacing with existing Erlang code. Whenever you see a value in IEx and you are not quite sure what it is, you can use the <code class="language-plaintext highlighter-rouge">i/1</code> to retrieve information about it:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">i</span> <span class="s1">'hello'</span>
<span class="no">Term</span>
  <span class="s1">'hello'</span>
<span class="no">Data</span> <span class="n">type</span>
  <span class="no">List</span>
<span class="no">Description</span>
  <span class="o">...</span>
<span class="no">Raw</span> <span class="n">representation</span>
  <span class="p">[</span><span class="mi">104</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">111</span><span class="p">]</span>
<span class="no">Reference</span> <span class="n">modules</span>
  <span class="no">List</span>
<span class="no">Implemented</span> <span class="n">protocols</span>
  <span class="o">...</span>
</code></pre></div></div>

<p>Keep in mind single-quoted and double-quoted representations are not equivalent in Elixir as they are represented by different types:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="s1">'hello'</span> <span class="o">==</span> <span class="s2">"hello"</span>
<span class="no">false</span>
</code></pre></div></div>

<p>Single quotes are charlists, double quotes are strings. We will talk more about them in the <a href="/getting-started/binaries-strings-and-char-lists.html">“Binaries, strings and charlists”</a> chapter.</p>

<h2 id="tuples" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Tuples</span><a href="#tuples" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir uses curly brackets to define tuples. Like lists, tuples can hold any value:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"hello"</span><span class="p">}</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"hello"</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">tuple_size</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"hello"</span><span class="p">}</span>
<span class="mi">2</span>
</code></pre></div></div>

<p>Tuples store elements contiguously in memory. This means accessing a tuple element by index or getting the tuple size is a fast operation. Indexes start from zero:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">tuple</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"hello"</span><span class="p">}</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"hello"</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">elem</span><span class="p">(</span><span class="n">tuple</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="s2">"hello"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">tuple_size</span><span class="p">(</span><span class="n">tuple</span><span class="p">)</span>
<span class="mi">2</span>
</code></pre></div></div>

<p>It is also possible to put an element at a particular index in a tuple with <code class="language-plaintext highlighter-rouge">put_elem/3</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">tuple</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"hello"</span><span class="p">}</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"hello"</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">put_elem</span><span class="p">(</span><span class="n">tuple</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">tuple</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"hello"</span><span class="p">}</span>
</code></pre></div></div>

<p>Notice that <code class="language-plaintext highlighter-rouge">put_elem/3</code> returned a new tuple. The original tuple stored in the <code class="language-plaintext highlighter-rouge">tuple</code> variable was not modified. Like lists, tuples are also immutable. Every operation on a tuple returns a new tuple, it never changes the given one.</p>

<h2 id="lists-or-tuples" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Lists or tuples?</span><a href="#lists-or-tuples" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>What is the difference between lists and tuples?</p>

<p>Lists are stored in memory as linked lists, meaning that each element in a list holds its value and points to the following element until the end of the list is reached. This means accessing the length of a list is a linear operation: we need to traverse the whole list in order to figure out its size.</p>

<p>Similarly, the performance of list concatenation depends on the length of the left-hand list:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="c1"># This is fast as we only need to traverse `[0]` to prepend to `list`</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">++</span> <span class="n">list</span>
<span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="c1"># This is slow as we need to traverse `list` to append 4</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">++</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</code></pre></div></div>

<p>Tuples, on the other hand, are stored contiguously in memory. This means getting the tuple size or accessing an element by index is fast. However, updating or adding elements to tuples is expensive because it requires creating a new tuple in memory:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">tuple</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:a</span><span class="p">,</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:c</span><span class="p">,</span> <span class="ss">:d</span><span class="p">}</span>
<span class="p">{</span><span class="ss">:a</span><span class="p">,</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:c</span><span class="p">,</span> <span class="ss">:d</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">put_elem</span><span class="p">(</span><span class="n">tuple</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="ss">:e</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:a</span><span class="p">,</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:e</span><span class="p">,</span> <span class="ss">:d</span><span class="p">}</span>
</code></pre></div></div>

<p>Note that this applies only to the tuple itself, not its contents. For instance, when you update a tuple, all entries are shared between the old and the new tuple, except for the entry that has been replaced. In other words, tuples and lists in Elixir are capable of sharing their contents. This reduces the amount of memory allocation the language needs to perform and is only possible thanks to the immutable semantics of the language.</p>

<p>Those performance characteristics dictate the usage of those data structures. One very common use case for tuples is to use them to return extra information from a function. For example, <code class="language-plaintext highlighter-rouge">File.read/1</code> is a function that can be used to read file contents. It returns a tuple:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">"path/to/existing/file"</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"... contents ..."</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">"path/to/unknown/file"</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="ss">:enoent</span><span class="p">}</span>
</code></pre></div></div>

<p>If the path given to <code class="language-plaintext highlighter-rouge">File.read/1</code> exists, it returns a tuple with the atom <code class="language-plaintext highlighter-rouge">:ok</code> as the first element and the file contents as the second. Otherwise, it returns a tuple with <code class="language-plaintext highlighter-rouge">:error</code> and the error description.</p>

<p>Most of the time, Elixir is going to guide you to do the right thing. For example, there is an <code class="language-plaintext highlighter-rouge">elem/2</code> function to access a tuple item but there is no built-in equivalent for lists:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">tuple</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"hello"</span><span class="p">}</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"hello"</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">elem</span><span class="p">(</span><span class="n">tuple</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="s2">"hello"</span>
</code></pre></div></div>

<p>When counting the elements in a data structure, Elixir also abides by a simple rule: the function is named <code class="language-plaintext highlighter-rouge">size</code> if the operation is in constant time (i.e. the value is pre-calculated) or <code class="language-plaintext highlighter-rouge">length</code> if the operation is linear (i.e. calculating the length gets slower as the input grows). As a mnemonic, both “length” and “linear” start with “l”.</p>

<p>For example, we have used 4 counting functions so far: <code class="language-plaintext highlighter-rouge">byte_size/1</code> (for the number of bytes in a string), <code class="language-plaintext highlighter-rouge">tuple_size/1</code> (for tuple size), <code class="language-plaintext highlighter-rouge">length/1</code> (for list length) and <code class="language-plaintext highlighter-rouge">String.length/1</code> (for the number of graphemes in a string). We use <code class="language-plaintext highlighter-rouge">byte_size</code> to get the number of bytes in a string – a cheap operation. Retrieving the number of Unicode graphemes, on the other hand, uses <code class="language-plaintext highlighter-rouge">String.length</code>, and may be expensive as it relies on a traversal of the entire string.</p>

<p>Elixir also provides <code class="language-plaintext highlighter-rouge">Port</code>, <code class="language-plaintext highlighter-rouge">Reference</code>, and <code class="language-plaintext highlighter-rouge">PID</code> as data types (usually used in process communication), and we will take a quick look at them when talking about processes. For now, let’s take a look at some of the basic operators that go with our basic types.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/introduction.html" class="previous page-numbers spec" title="Introduction">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/basic-operators.html" class="previous page-numbers spec" title="Basic operators">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/basic-types.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/basic-operators.html" page=":3:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><span title="Basic operators">Basic operators</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Basic operators</h1>
    </div>

    <div id="toc" class="toc"></div>

    <p>In the <a href="/getting-started/basic-types.html">previous chapter</a>, we saw Elixir provides <code class="language-plaintext highlighter-rouge">+</code>, <code class="language-plaintext highlighter-rouge">-</code>, <code class="language-plaintext highlighter-rouge">*</code>, <code class="language-plaintext highlighter-rouge">/</code> as arithmetic operators, plus the functions <code class="language-plaintext highlighter-rouge">div/2</code> and <code class="language-plaintext highlighter-rouge">rem/2</code> for integer division and remainder.</p>

<p>Elixir also provides <code class="language-plaintext highlighter-rouge">++</code> and <code class="language-plaintext highlighter-rouge">--</code> to manipulate lists:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">++</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">--</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre></div></div>

<p>String concatenation is done with <code class="language-plaintext highlighter-rouge">&lt;&gt;</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"foo"</span> <span class="o">&lt;&gt;</span> <span class="s2">"bar"</span>
<span class="s2">"foobar"</span>
</code></pre></div></div>

<p>Elixir also provides three boolean operators: <code class="language-plaintext highlighter-rouge">or</code>, <code class="language-plaintext highlighter-rouge">and</code> and <code class="language-plaintext highlighter-rouge">not</code>. These operators are strict in the sense that they expect something that evaluates to a boolean (<code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>) as their first argument:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">true</span> <span class="ow">and</span> <span class="no">true</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">false</span> <span class="ow">or</span> <span class="n">is_atom</span><span class="p">(</span><span class="ss">:example</span><span class="p">)</span>
<span class="no">true</span>
</code></pre></div></div>

<p>Providing a non-boolean will raise an exception:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="no">true</span>
<span class="o">**</span> <span class="p">(</span><span class="no">BadBooleanError</span><span class="p">)</span> <span class="n">expected</span> <span class="n">a</span> <span class="n">boolean</span> <span class="n">on</span> <span class="n">left</span><span class="o">-</span><span class="n">side</span> <span class="n">of</span> <span class="s2">"and"</span><span class="p">,</span> <span class="ss">got:</span> <span class="mi">1</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">or</code> and <code class="language-plaintext highlighter-rouge">and</code> are short-circuit operators. They only execute the right side if the left side is not enough to determine the result:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">false</span> <span class="ow">and</span> <span class="k">raise</span><span class="p">(</span><span class="s2">"This error will never be raised"</span><span class="p">)</span>
<span class="no">false</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">true</span> <span class="ow">or</span> <span class="k">raise</span><span class="p">(</span><span class="s2">"This error will never be raised"</span><span class="p">)</span>
<span class="no">true</span>
</code></pre></div></div>

<p>Besides these boolean operators, Elixir also provides <code class="language-plaintext highlighter-rouge">||</code>, <code class="language-plaintext highlighter-rouge">&amp;&amp;</code> and <code class="language-plaintext highlighter-rouge">!</code> which accept arguments of any type. For these operators, all values except <code class="language-plaintext highlighter-rouge">false</code> and <code class="language-plaintext highlighter-rouge">nil</code> will evaluate to true:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># or</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="no">true</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">false</span> <span class="o">||</span> <span class="mi">11</span>
<span class="mi">11</span>

<span class="c1"># and</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">nil</span> <span class="o">&amp;&amp;</span> <span class="mi">13</span>
<span class="no">nil</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">true</span> <span class="o">&amp;&amp;</span> <span class="mi">17</span>
<span class="mi">17</span>

<span class="c1"># not</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">!true</span>
<span class="no">false</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">!1</span>
<span class="no">false</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">!nil</span>
<span class="no">true</span>
</code></pre></div></div>

<p>As a rule of thumb, use <code class="language-plaintext highlighter-rouge">and</code>, <code class="language-plaintext highlighter-rouge">or</code> and <code class="language-plaintext highlighter-rouge">not</code> when you are expecting booleans. If any of the arguments are non-boolean, use <code class="language-plaintext highlighter-rouge">&amp;&amp;</code>, <code class="language-plaintext highlighter-rouge">||</code> and <code class="language-plaintext highlighter-rouge">!</code>.</p>

<p>Elixir also provides <code class="language-plaintext highlighter-rouge">==</code>, <code class="language-plaintext highlighter-rouge">!=</code>, <code class="language-plaintext highlighter-rouge">===</code>, <code class="language-plaintext highlighter-rouge">!==</code>, <code class="language-plaintext highlighter-rouge">&lt;=</code>, <code class="language-plaintext highlighter-rouge">&gt;=</code>, <code class="language-plaintext highlighter-rouge">&lt;</code> and <code class="language-plaintext highlighter-rouge">&gt;</code> as comparison operators:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="o">!=</span> <span class="mi">2</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">2</span>
<span class="no">true</span>
</code></pre></div></div>

<p>The difference between <code class="language-plaintext highlighter-rouge">==</code> and <code class="language-plaintext highlighter-rouge">===</code> is that the latter is more strict when comparing integers and floats:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="o">==</span> <span class="mf">1.0</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="o">===</span> <span class="mf">1.0</span>
<span class="no">false</span>
</code></pre></div></div>

<p>We say these operators perform <em>structural comparison</em>. For more information, you can read our documentation on <a href="https://hexdocs.pm/elixir/Kernel.html#module-structural-comparison">Structural vs Semantic comparisons</a>.</p>

<p>In the next chapter, we are going to discuss pattern matching through the use of <code class="language-plaintext highlighter-rouge">=</code>, the match operator.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/basic-types.html" class="previous page-numbers spec" title="Basic types">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/pattern-matching.html" class="previous page-numbers spec" title="Pattern matching">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/basic-operators.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/pattern-matching.html" page=":4:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><span title="Pattern matching">Pattern matching</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Pattern matching</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#the-match-operator">The match operator</a></li><li><a href="#pattern-matching">Pattern matching</a></li><li><a href="#the-pin-operator">The pin operator</a></li></ol></div>

    <p>In this chapter, we will show how the <code class="language-plaintext highlighter-rouge">=</code> operator in Elixir is actually a match operator and how to use it to pattern match inside data structures. Finally, we will learn about the pin operator <code class="language-plaintext highlighter-rouge">^</code> used to access previously bound values.</p>

<h2 id="the-match-operator" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The match operator</span><a href="#the-match-operator" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>We have used the <code class="language-plaintext highlighter-rouge">=</code> operator a couple times to assign variables in Elixir:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">x</span>
<span class="mi">1</span>
</code></pre></div></div>

<p>In Elixir, the <code class="language-plaintext highlighter-rouge">=</code> operator is actually called <em>the match operator</em>. Let’s see why:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="o">=</span> <span class="n">x</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="mi">2</span> <span class="o">=</span> <span class="n">x</span>
<span class="o">**</span> <span class="p">(</span><span class="no">MatchError</span><span class="p">)</span> <span class="n">no</span> <span class="n">match</span> <span class="n">of</span> <span class="n">right</span> <span class="n">hand</span> <span class="n">side</span> <span class="ss">value:</span> <span class="mi">1</span>
</code></pre></div></div>

<p>Notice that <code class="language-plaintext highlighter-rouge">1 = x</code> is a valid expression, and it matched because both the left and right side are equal to 1. When the sides do not match, a <code class="language-plaintext highlighter-rouge">MatchError</code> is raised.</p>

<p>A variable can only be assigned on the left side of <code class="language-plaintext highlighter-rouge">=</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="o">=</span> <span class="n">unknown</span>
<span class="o">**</span> <span class="p">(</span><span class="no">CompileError</span><span class="p">)</span> <span class="ss">iex:</span><span class="mi">1</span><span class="p">:</span> <span class="n">undefined</span> <span class="n">function</span> <span class="n">unknown</span><span class="o">/</span><span class="mi">0</span>
</code></pre></div></div>

<p>Since there is no variable <code class="language-plaintext highlighter-rouge">unknown</code> previously defined, Elixir assumed you were trying to call a function named <code class="language-plaintext highlighter-rouge">unknown/0</code>, but such a function does not exist.</p>

<h2 id="pattern-matching" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Pattern matching</span><a href="#pattern-matching" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>The match operator is not only used to match against simple values, but it is also useful for destructuring more complex data types. For example, we can pattern match on tuples:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">}</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:hello</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">,</span> <span class="mi">42</span><span class="p">}</span>
<span class="p">{</span><span class="ss">:hello</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">,</span> <span class="mi">42</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">a</span>
<span class="ss">:hello</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">b</span>
<span class="s2">"world"</span>
</code></pre></div></div>

<p>A pattern match error will occur if the sides can’t be matched, for example if the tuples have different sizes:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">}</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:hello</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">}</span>
<span class="o">**</span> <span class="p">(</span><span class="no">MatchError</span><span class="p">)</span> <span class="n">no</span> <span class="n">match</span> <span class="n">of</span> <span class="n">right</span> <span class="n">hand</span> <span class="n">side</span> <span class="ss">value:</span> <span class="p">{</span><span class="ss">:hello</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">}</span>
</code></pre></div></div>

<p>And also when comparing different types, for example if matching a tuple on the left side with a list on the right side:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">}</span> <span class="o">=</span> <span class="p">[</span><span class="ss">:hello</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">,</span> <span class="mi">42</span><span class="p">]</span>
<span class="o">**</span> <span class="p">(</span><span class="no">MatchError</span><span class="p">)</span> <span class="n">no</span> <span class="n">match</span> <span class="n">of</span> <span class="n">right</span> <span class="n">hand</span> <span class="n">side</span> <span class="ss">value:</span> <span class="p">[</span><span class="ss">:hello</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">,</span> <span class="mi">42</span><span class="p">]</span>
</code></pre></div></div>

<p>More interestingly, we can match on specific values. The example below asserts that the left side will only match the right side when the right side is a tuple that starts with the atom <code class="language-plaintext highlighter-rouge">:ok</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">result</span><span class="p">}</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="mi">13</span><span class="p">}</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="mi">13</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">result</span>
<span class="mi">13</span>

<span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">result</span><span class="p">}</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="ss">:oops</span><span class="p">}</span>
<span class="o">**</span> <span class="p">(</span><span class="no">MatchError</span><span class="p">)</span> <span class="n">no</span> <span class="n">match</span> <span class="n">of</span> <span class="n">right</span> <span class="n">hand</span> <span class="n">side</span> <span class="ss">value:</span> <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="ss">:oops</span><span class="p">}</span>
</code></pre></div></div>

<p>We can pattern match on lists:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">a</span>
<span class="mi">1</span>
</code></pre></div></div>

<p>A list also supports matching on its own head and tail:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">head</span> <span class="o">|</span> <span class="n">tail</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">head</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">tail</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre></div></div>

<p>Similar to the <code class="language-plaintext highlighter-rouge">hd/1</code> and <code class="language-plaintext highlighter-rouge">tl/1</code> functions, we can’t match an empty list with a head and tail pattern:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">head</span> <span class="o">|</span> <span class="n">tail</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="o">**</span> <span class="p">(</span><span class="no">MatchError</span><span class="p">)</span> <span class="n">no</span> <span class="n">match</span> <span class="n">of</span> <span class="n">right</span> <span class="n">hand</span> <span class="n">side</span> <span class="ss">value:</span> <span class="p">[]</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">[head | tail]</code> format is not only used on pattern matching but also for prepending items to a list:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="mi">0</span> <span class="o">|</span> <span class="n">list</span><span class="p">]</span>
<span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre></div></div>

<p>Pattern matching allows developers to easily destructure data types such as tuples and lists. As we will see in the following chapters, it is one of the foundations of recursion in Elixir and applies to other types as well, like maps and binaries.</p>

<h2 id="the-pin-operator" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The pin operator</span><a href="#the-pin-operator" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Variables in Elixir can be rebound:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="mi">2</span>
</code></pre></div></div>
<p>However, there are times when we don’t want variables to be rebound.</p>

<p>Use the pin operator <code class="language-plaintext highlighter-rouge">^</code> when you want to pattern match against a variable’s <em>existing value</em> rather than rebinding the variable.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="o">^</span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="o">**</span> <span class="p">(</span><span class="no">MatchError</span><span class="p">)</span> <span class="n">no</span> <span class="n">match</span> <span class="n">of</span> <span class="n">right</span> <span class="n">hand</span> <span class="n">side</span> <span class="ss">value:</span> <span class="mi">2</span>
</code></pre></div></div>

<p>Because we have pinned <code class="language-plaintext highlighter-rouge">x</code> when it was bound to the value of <code class="language-plaintext highlighter-rouge">1</code>, it is equivalent to the following:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">2</span>
<span class="o">**</span> <span class="p">(</span><span class="no">MatchError</span><span class="p">)</span> <span class="n">no</span> <span class="n">match</span> <span class="n">of</span> <span class="n">right</span> <span class="n">hand</span> <span class="n">side</span> <span class="ss">value:</span> <span class="mi">2</span>
</code></pre></div></div>

<p>Notice that we even see the exact same error message.</p>

<p>We can use the pin operator inside other pattern matches, such as tuples or lists:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">^</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="n">y</span><span class="p">,</span> <span class="o">^</span><span class="n">x</span><span class="p">}</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">y</span>
<span class="mi">2</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="n">y</span><span class="p">,</span> <span class="o">^</span><span class="n">x</span><span class="p">}</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">}</span>
<span class="o">**</span> <span class="p">(</span><span class="no">MatchError</span><span class="p">)</span> <span class="n">no</span> <span class="n">match</span> <span class="n">of</span> <span class="n">right</span> <span class="n">hand</span> <span class="n">side</span> <span class="ss">value:</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">}</span>
</code></pre></div></div>

<p>Because <code class="language-plaintext highlighter-rouge">x</code> was bound to the value of <code class="language-plaintext highlighter-rouge">1</code> when it was pinned, this last example could have been written as:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">}</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">}</span>
<span class="o">**</span> <span class="p">(</span><span class="no">MatchError</span><span class="p">)</span> <span class="n">no</span> <span class="n">match</span> <span class="n">of</span> <span class="n">right</span> <span class="n">hand</span> <span class="n">side</span> <span class="ss">value:</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">}</span>
</code></pre></div></div>

<p>If a variable is mentioned more than once in a pattern, all references should bind to the same value:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">}</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">}</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">}</span>
<span class="o">**</span> <span class="p">(</span><span class="no">MatchError</span><span class="p">)</span> <span class="n">no</span> <span class="n">match</span> <span class="n">of</span> <span class="n">right</span> <span class="n">hand</span> <span class="n">side</span> <span class="ss">value:</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">}</span>
</code></pre></div></div>

<p>In some cases, you don’t care about a particular value in a pattern. It is a common practice to bind those values to the underscore, <code class="language-plaintext highlighter-rouge">_</code>. For example, if only the head of the list matters to us, we can assign the tail to underscore:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">head</span> <span class="o">|</span> <span class="n">_</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">head</span>
<span class="mi">1</span>
</code></pre></div></div>

<p>The variable <code class="language-plaintext highlighter-rouge">_</code> is special in that it can never be read from. Trying to read from it gives a compile error:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">_</span>
<span class="o">**</span> <span class="p">(</span><span class="no">CompileError</span><span class="p">)</span> <span class="ss">iex:</span><span class="mi">1</span><span class="p">:</span> <span class="n">invalid</span> <span class="kn">use</span> <span class="n">of</span> <span class="n">_</span><span class="o">.</span> <span class="s2">"_"</span> <span class="n">represents</span> <span class="n">a</span> <span class="n">value</span> <span class="n">to</span> <span class="n">be</span> <span class="n">ignored</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">pattern</span> <span class="ow">and</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">expressions</span>
</code></pre></div></div>

<p>Although pattern matching allows us to build powerful constructs, its usage is limited. For instance, you cannot make function calls on the left side of a match. The following example is invalid:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">length</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">3</span><span class="p">])</span> <span class="o">=</span> <span class="mi">3</span>
<span class="o">**</span> <span class="p">(</span><span class="no">CompileError</span><span class="p">)</span> <span class="ss">iex:</span><span class="mi">1</span><span class="p">:</span> <span class="n">cannot</span> <span class="n">invoke</span> <span class="n">remote</span> <span class="n">function</span> <span class="ss">:erlang</span><span class="o">.</span><span class="n">length</span><span class="o">/</span><span class="mi">1</span> <span class="n">inside</span> <span class="n">match</span>
</code></pre></div></div>

<p>This finishes our introduction to pattern matching. As we will see in the next chapter, pattern matching is very common in many language constructs.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/basic-operators.html" class="previous page-numbers spec" title="Basic operators">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/case-cond-and-if.html" class="previous page-numbers spec" title="case, cond, and if">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/pattern-matching.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/case-cond-and-if.html" page=":5:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><span title="case, cond, and if">case, cond, and if</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>case, cond, and if</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#case"><code class="language-plaintext highlighter-rouge">case</code></a></li><li><a href="#cond"><code class="language-plaintext highlighter-rouge">cond</code></a></li><li><a href="#if-and-unless"><code class="language-plaintext highlighter-rouge">if</code> and <code class="language-plaintext highlighter-rouge">unless</code></a></li></ol></div>

    <p>In this chapter, we will learn about the <code class="language-plaintext highlighter-rouge">case</code>, <code class="language-plaintext highlighter-rouge">cond</code>, and <code class="language-plaintext highlighter-rouge">if</code> control flow structures.</p>

<h2 id="case" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper"><code class="language-plaintext highlighter-rouge">case</code></span><a href="#case" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p><code class="language-plaintext highlighter-rouge">case</code> allows us to compare a value against many patterns until we find a matching one:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">case</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">}</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="s2">"This clause won't match"</span>
<span class="o">...&gt;</span>   <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="s2">"This clause will match and bind x to 2 in this clause"</span>
<span class="o">...&gt;</span>   <span class="n">_</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="s2">"This clause would match any value"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="s2">"This clause will match and bind x to 2 in this clause"</span>
</code></pre></div></div>

<p>If you want to pattern match against an existing variable, you need to use the <code class="language-plaintext highlighter-rouge">^</code> operator:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="k">case</span> <span class="mi">10</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="o">^</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="s2">"Won't match"</span>
<span class="o">...&gt;</span>   <span class="n">_</span> <span class="o">-&gt;</span> <span class="s2">"Will match"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="s2">"Will match"</span>
</code></pre></div></div>

<p>Clauses also allow extra conditions to be specified via guards:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">case</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span> <span class="ow">when</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="s2">"Will match"</span>
<span class="o">...&gt;</span>   <span class="n">_</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="s2">"Would match, if guard condition were not satisfied"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="s2">"Will match"</span>
</code></pre></div></div>

<p>The first clause above will only match when <code class="language-plaintext highlighter-rouge">x</code> is positive.</p>

<p>Keep in mind errors in guards do not leak but simply make the guard fail:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">hd</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="o">**</span> <span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span> <span class="n">argument</span> <span class="n">error</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="k">case</span> <span class="mi">1</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="n">x</span> <span class="ow">when</span> <span class="n">hd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"Won't match"</span>
<span class="o">...&gt;</span>   <span class="n">x</span> <span class="o">-&gt;</span> <span class="s2">"Got </span><span class="si">#{</span><span class="n">x</span><span class="si">}</span><span class="s2">"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="s2">"Got 1"</span>
</code></pre></div></div>

<p>If none of the clauses match, an error is raised:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">case</span> <span class="ss">:ok</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="ss">:error</span> <span class="o">-&gt;</span> <span class="s2">"Won't match"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="o">**</span> <span class="p">(</span><span class="no">CaseClauseError</span><span class="p">)</span> <span class="n">no</span> <span class="k">case</span> <span class="n">clause</span> <span class="ss">matching:</span> <span class="ss">:ok</span>
</code></pre></div></div>

<p>Consult <a href="https://hexdocs.pm/elixir/patterns-and-guards.html#guards">the full documentation for guards</a> for more information about guards, how they are used, and what expressions are allowed in them.</p>

<p>Note anonymous functions can also have multiple clauses and guards:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="k">fn</span>
<span class="o">...&gt;</span>   <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">when</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="o">...&gt;</span>   <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="c1">#Function&lt;12.71889879/2 in :erl_eval.expr/5&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">f</span><span class="o">.</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="mi">4</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">f</span><span class="o">.</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="o">-</span><span class="mi">3</span>
</code></pre></div></div>

<p>The number of arguments in each anonymous function clause needs to be the same, otherwise an error is raised.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">f2</span> <span class="o">=</span> <span class="k">fn</span>
<span class="o">...&gt;</span>   <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">when</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="o">...&gt;</span>   <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="o">**</span> <span class="p">(</span><span class="no">CompileError</span><span class="p">)</span> <span class="ss">iex:</span><span class="mi">1</span><span class="p">:</span> <span class="n">cannot</span> <span class="n">mix</span> <span class="n">clauses</span> <span class="n">with</span> <span class="n">different</span> <span class="n">arities</span> <span class="ow">in</span> <span class="n">anonymous</span> <span class="n">functions</span>
</code></pre></div></div>

<h2 id="cond" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper"><code class="language-plaintext highlighter-rouge">cond</code></span><a href="#cond" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p><code class="language-plaintext highlighter-rouge">case</code> is useful when you need to match against different values. However, in many circumstances, we want to check different conditions and find the first one that does not evaluate to <code class="language-plaintext highlighter-rouge">nil</code> or <code class="language-plaintext highlighter-rouge">false</code>. In such cases, one may use <code class="language-plaintext highlighter-rouge">cond</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">cond</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">5</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="s2">"This will not be true"</span>
<span class="o">...&gt;</span>   <span class="mi">2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="s2">"Nor this"</span>
<span class="o">...&gt;</span>   <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="s2">"But this will"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="s2">"But this will"</span>
</code></pre></div></div>

<p>This is equivalent to <code class="language-plaintext highlighter-rouge">else if</code> clauses in many imperative languages - although used less frequently in Elixir.</p>

<p>If all of the conditions return <code class="language-plaintext highlighter-rouge">nil</code> or <code class="language-plaintext highlighter-rouge">false</code>, an error (<code class="language-plaintext highlighter-rouge">CondClauseError</code>) is raised. For this reason, it may be necessary to add a final condition, equal to <code class="language-plaintext highlighter-rouge">true</code>, which will always match:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">cond</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">5</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="s2">"This is never true"</span>
<span class="o">...&gt;</span>   <span class="mi">2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="s2">"Nor this"</span>
<span class="o">...&gt;</span>   <span class="no">true</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="s2">"This is always true (equivalent to else)"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="s2">"This is always true (equivalent to else)"</span>
</code></pre></div></div>

<p>Finally, note <code class="language-plaintext highlighter-rouge">cond</code> considers any value besides <code class="language-plaintext highlighter-rouge">nil</code> and <code class="language-plaintext highlighter-rouge">false</code> to be true:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">cond</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="n">hd</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="s2">"1 is considered as true"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="s2">"1 is considered as true"</span>
</code></pre></div></div>

<h2 id="if-and-unless" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper"><code class="language-plaintext highlighter-rouge">if</code> and <code class="language-plaintext highlighter-rouge">unless</code></span><a href="#if-and-unless" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Besides <code class="language-plaintext highlighter-rouge">case</code> and <code class="language-plaintext highlighter-rouge">cond</code>, Elixir also provides <code class="language-plaintext highlighter-rouge">if/2</code> and <code class="language-plaintext highlighter-rouge">unless/2</code>, which are useful when you need to check for only one condition:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">if</span> <span class="no">true</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="s2">"This works!"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="s2">"This works!"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="k">unless</span> <span class="no">true</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="s2">"This will never be seen"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="no">nil</span>
</code></pre></div></div>

<p>If the condition given to <code class="language-plaintext highlighter-rouge">if/2</code> returns <code class="language-plaintext highlighter-rouge">false</code> or <code class="language-plaintext highlighter-rouge">nil</code>, the body given between <code class="language-plaintext highlighter-rouge">do</code>-<code class="language-plaintext highlighter-rouge">end</code> is not executed and instead it returns <code class="language-plaintext highlighter-rouge">nil</code>. The opposite happens with <code class="language-plaintext highlighter-rouge">unless/2</code>.</p>

<p>They also support <code class="language-plaintext highlighter-rouge">else</code> blocks:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">if</span> <span class="no">nil</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="s2">"This won't be seen"</span>
<span class="o">...&gt;</span> <span class="k">else</span>
<span class="o">...&gt;</span>   <span class="s2">"This will"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="s2">"This will"</span>
</code></pre></div></div>

<p>This is also a good opportunity to talk about variable scoping in Elixir. If any variable is declared or changed inside <code class="language-plaintext highlighter-rouge">if</code>, <code class="language-plaintext highlighter-rouge">case</code>, and similar constructs, the declaration and change will only be visible inside the construct. For example:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="k">if</span> <span class="no">true</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="mi">2</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">x</span>
<span class="mi">1</span>
</code></pre></div></div>

<p>In said cases, if you want to change a value, you must return the value from the <code class="language-plaintext highlighter-rouge">if</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="k">if</span> <span class="no">true</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
<span class="o">...&gt;</span> <span class="k">else</span>
<span class="o">...&gt;</span>   <span class="n">x</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="mi">2</span>
</code></pre></div></div>

<blockquote>
  <p>Note: An interesting note regarding <code class="language-plaintext highlighter-rouge">if/2</code> and <code class="language-plaintext highlighter-rouge">unless/2</code> is that they are implemented as macros in the language; they aren’t special language constructs as they would be in many languages. You can check the documentation and the source of <code class="language-plaintext highlighter-rouge">if/2</code> in <a href="https://hexdocs.pm/elixir/Kernel.html">the <code class="language-plaintext highlighter-rouge">Kernel</code> module docs</a>. The <code class="language-plaintext highlighter-rouge">Kernel</code> module is also where operators like <code class="language-plaintext highlighter-rouge">+/2</code> and functions like <code class="language-plaintext highlighter-rouge">is_function/2</code> are defined, all automatically imported and available in your code by default.</p>
</blockquote>

<p>We have concluded the introduction to the most fundamental control-flow constructs in Elixir. Now it is time to talk about “Binaries, strings, and char lists”.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/pattern-matching.html" class="previous page-numbers spec" title="Pattern matching">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/binaries-strings-and-char-lists.html" class="previous page-numbers spec" title="Binaries, strings, and charlists">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/case-cond-and-if.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/binaries-strings-and-char-lists.html" page=":6:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><span title="Binaries, strings, and charlists">Binaries, strings, and charlists</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Binaries, strings, and charlists</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#unicode-and-code-points">Unicode and Code Points</a></li><li><a href="#utf-8-and-encodings">UTF-8 and Encodings</a></li><li><a href="#bitstrings">Bitstrings</a></li><li><a href="#binaries">Binaries</a></li><li><a href="#charlists">Charlists</a></li></ol></div>

    <p>In “Basic types”, we learned a little bit about strings and we used the <code class="language-plaintext highlighter-rouge">is_binary/1</code> function for checks:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">string</span> <span class="o">=</span> <span class="s2">"hello"</span>
<span class="s2">"hello"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_binary</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="no">true</span>
</code></pre></div></div>

<p>In this chapter, we will gain clarity on what exactly binaries are, how they relate to strings, and what single-quoted values, <code class="language-plaintext highlighter-rouge">'like this'</code>, mean in Elixir. Although strings are one of the most common data types in computer languages, they are subtly complex and are often misunderstood. To understand strings in Elixir, we have to educate ourselves about <a href="https://en.wikipedia.org/wiki/Unicode">Unicode</a> and character encodings, specifically the <a href="https://en.wikipedia.org/wiki/UTF-8">UTF-8</a> encoding.</p>

<h2 id="unicode-and-code-points" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Unicode and Code Points</span><a href="#unicode-and-code-points" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>In order to facilitate meaningful communication between computers across multiple languages, a standard is required so that the ones and zeros on one machine mean the same thing when they are transmitted to another. The <a href="https://unicode.org/standard/standard.html">Unicode Standard</a> acts as an official registry of virtually all the characters we know: this includes characters from classical and historical texts, emoji, and formatting and control characters as well.</p>

<p>Unicode organizes all of the characters in its repertoire into code charts, and each character is given a unique numerical index. This numerical index is known as a <a href="https://en.wikipedia.org/wiki/Code_point">Code Point</a>.</p>

<p>In Elixir you can use a <code class="language-plaintext highlighter-rouge">?</code> in front of a character literal to reveal its code point:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="sx">?a</span>
<span class="mi">97</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="sx">?ł</span>
<span class="mi">322</span>
</code></pre></div></div>

<p>Note that most Unicode code charts will refer to a code point by its hexadecimal (hex) representation, e.g. <code class="language-plaintext highlighter-rouge">97</code> translates to <code class="language-plaintext highlighter-rouge">0061</code> in hex, and we can represent any Unicode character in an Elixir string by using the <code class="language-plaintext highlighter-rouge">\uXXXX</code> notation and the hex representation of its code point number:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"</span><span class="se">\u0061</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"a"</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="mh">0x0061</span> <span class="o">=</span> <span class="mi">97</span> <span class="o">=</span> <span class="sx">?a</span>
<span class="mi">97</span>
</code></pre></div></div>

<p>The hex representation will also help you look up information about a code point, e.g. <a href="https://codepoints.net/U+0061">https://codepoints.net/U+0061</a> has a data sheet all about the lower case <code class="language-plaintext highlighter-rouge">a</code>, a.k.a. code point 97.</p>

<h2 id="utf-8-and-encodings" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">UTF-8 and Encodings</span><a href="#utf-8-and-encodings" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Now that we understand what the Unicode standard is and what code points are, we can finally talk about encodings. Whereas the code point is <strong>what</strong> we store, an encoding deals with <strong>how</strong> we store it: encoding is an implementation. In other words, we need a mechanism to convert the code point numbers into bytes so they can be stored in memory, written to disk, etc.</p>

<p>Elixir uses UTF-8 to encode its strings, which means that code points are encoded as a series of 8-bit bytes. UTF-8 is a <strong>variable width</strong> character encoding that uses one to four bytes to store each code point. It is capable of encoding all valid Unicode code points. Let’s see an example:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">string</span> <span class="o">=</span> <span class="s2">"héllo"</span>
<span class="s2">"héllo"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">length</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="mi">5</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">byte_size</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="mi">6</span>
</code></pre></div></div>

<p>Although the string above has 5 characters, it uses 6 bytes, as two bytes are used to represent the character <code class="language-plaintext highlighter-rouge">é</code>.</p>

<blockquote>
  <p>Note: if you are running on Windows, there is a chance your terminal does not use UTF-8 by default. You can change the encoding of your current session by running <code class="language-plaintext highlighter-rouge">chcp 65001</code> before entering <code class="language-plaintext highlighter-rouge">iex</code> (<code class="language-plaintext highlighter-rouge">iex.bat</code>).</p>
</blockquote>

<p>Besides defining characters, UTF-8 also provides a notion of graphemes. Graphemes may consist of multiple characters that are often perceived as one. For example, the <a href="https://emojipedia.org/woman-firefighter/">woman firefighter emoji</a> is represented as the combination of three characters: the woman emoji (👩), a hidden zero-width joiner, and the fire engine emoji (🚒):</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">codepoints</span><span class="p">(</span><span class="s2">"👩&zwj;🚒"</span><span class="p">)</span>
<span class="p">[</span><span class="s2">"👩"</span><span class="p">,</span> <span class="s2">"&zwj;"</span><span class="p">,</span> <span class="s2">"🚒"</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">graphemes</span><span class="p">(</span><span class="s2">"👩&zwj;🚒"</span><span class="p">)</span>
<span class="p">[</span><span class="s2">"👩&zwj;🚒"</span><span class="p">]</span>
</code></pre></div></div>

<p>However, Elixir is smart enough to know they are seen as a single character, and therefore the length is still one:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">length</span><span class="p">(</span><span class="s2">"👩&zwj;🚒"</span><span class="p">)</span>
<span class="mi">1</span>
</code></pre></div></div>

<blockquote>
  <p>Note: if you can’t see the emoji above in your terminal, you need to make sure your terminal supports emoji and that you are using a font that can render them.</p>
</blockquote>

<p>Although these rules may sound complicated, UTF-8 encoded documents are everywhere. This page itself is encoded in UTF-8. The encoding information is given to your browser which then knows how to render all of the bytes, characters, and graphemes accordingly.</p>

<p>If you want to see the exact bytes that a string would be stored in a file, a common trick is to concatenate the null byte <code class="language-plaintext highlighter-rouge">&lt;&lt;0&gt;&gt;</code> to it:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"hełło"</span> <span class="o">&lt;&gt;</span> <span class="o">&lt;&lt;</span><span class="mi">0</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="mi">104</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">0</span><span class="o">&gt;&gt;</span>
</code></pre></div></div>

<p>Alternatively, you can view a string’s binary representation by using <a href="https://hexdocs.pm/elixir/IO.html#inspect/2">IO.inspect/2</a>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="s2">"hełło"</span><span class="p">,</span> <span class="ss">binaries:</span> <span class="ss">:as_binaries</span><span class="p">)</span>
<span class="o">&lt;&lt;</span><span class="mi">104</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">111</span><span class="o">&gt;&gt;</span>
</code></pre></div></div>

<p>We are getting a little bit ahead of ourselves. Let’s talk about bitstrings to learn about what exactly the <code class="language-plaintext highlighter-rouge">&lt;&lt;&gt;&gt;</code> constructor means.</p>

<h2 id="bitstrings" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Bitstrings</span><a href="#bitstrings" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Although we have covered code points and UTF-8 encoding, we still need to go a bit deeper into how exactly we store the encoded bytes, and this is where we introduce the <strong>bitstring</strong>. A bitstring is a fundamental data type in Elixir, denoted with the <code class="language-plaintext highlighter-rouge">&lt;&lt;&gt;&gt;</code> syntax. <strong>A bitstring is a contiguous sequence of bits in memory.</strong></p>

<p>A complete reference about the binary / bitstring constructor <code class="language-plaintext highlighter-rouge">&lt;&lt;&gt;&gt;</code> can be found <a href="https://hexdocs.pm/elixir/Kernel.SpecialForms.html#%3C%3C%3E%3E/1">in the Elixir documentation</a>.</p>

<p>By default, 8 bits (i.e. 1 byte) is used to store each number in a bitstring, but you can manually specify the number of bits via a <code class="language-plaintext highlighter-rouge">::n</code> modifier to denote the size in <code class="language-plaintext highlighter-rouge">n</code> bits, or you can use the more verbose declaration <code class="language-plaintext highlighter-rouge">::size(n)</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span><span class="mi">42</span><span class="o">&gt;&gt;</span> <span class="o">==</span> <span class="o">&lt;&lt;</span><span class="mi">42</span><span class="p">::</span><span class="mi">8</span><span class="o">&gt;&gt;</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">::</span><span class="mi">4</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">::</span><span class="n">size</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">&gt;&gt;</span>
</code></pre></div></div>

<p>For example, the decimal number <code class="language-plaintext highlighter-rouge">3</code> when represented with 4 bits in base 2 would be <code class="language-plaintext highlighter-rouge">0011</code>, which is equivalent to the values <code class="language-plaintext highlighter-rouge">0</code>, <code class="language-plaintext highlighter-rouge">0</code>, <code class="language-plaintext highlighter-rouge">1</code>, <code class="language-plaintext highlighter-rouge">1</code>, each stored using 1 bit:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">::</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">::</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">1</span><span class="o">&gt;&gt;</span> <span class="o">==</span> <span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">::</span><span class="mi">4</span><span class="o">&gt;&gt;</span>
<span class="no">true</span>
</code></pre></div></div>

<p>Any value that exceeds what can be stored by the number of bits provisioned is truncated:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span><span class="mi">1</span><span class="o">&gt;&gt;</span> <span class="o">==</span> <span class="o">&lt;&lt;</span><span class="mi">257</span><span class="o">&gt;&gt;</span>
<span class="no">true</span>
</code></pre></div></div>

<p>Here, 257 in base 2 would be represented as <code class="language-plaintext highlighter-rouge">100000001</code>, but since we have reserved only 8 bits for its representation (by default), the left-most bit is ignored and the value becomes truncated to <code class="language-plaintext highlighter-rouge">00000001</code>, or simply <code class="language-plaintext highlighter-rouge">1</code> in decimal.</p>

<h2 id="binaries" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Binaries</span><a href="#binaries" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p><strong>A binary is a bitstring where the number of bits is divisible by 8.</strong> That means that every binary is a bitstring, but not every bitstring is a binary. We can use the <code class="language-plaintext highlighter-rouge">is_bitstring/1</code> and <code class="language-plaintext highlighter-rouge">is_binary/1</code> functions to demonstrate this.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_bitstring</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">::</span><span class="mi">4</span><span class="o">&gt;&gt;</span><span class="p">)</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_binary</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">::</span><span class="mi">4</span><span class="o">&gt;&gt;</span><span class="p">)</span>
<span class="no">false</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_bitstring</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">42</span><span class="o">&gt;&gt;</span><span class="p">)</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_binary</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">42</span><span class="o">&gt;&gt;</span><span class="p">)</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_binary</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="mi">42</span><span class="p">::</span><span class="mi">16</span><span class="o">&gt;&gt;</span><span class="p">)</span>
<span class="no">true</span>
</code></pre></div></div>

<p>We can pattern match on binaries / bitstrings:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">&gt;&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">x</span>
<span class="mi">2</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;&gt;</span>
<span class="o">**</span> <span class="p">(</span><span class="no">MatchError</span><span class="p">)</span> <span class="n">no</span> <span class="n">match</span> <span class="n">of</span> <span class="n">right</span> <span class="n">hand</span> <span class="n">side</span> <span class="ss">value:</span> <span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;&gt;</span>
</code></pre></div></div>

<p>Note that unless you explicitly use <code class="language-plaintext highlighter-rouge">::</code> modifiers, each entry in the binary pattern is expected to match a single byte (exactly 8 bits). If we want to match on a binary of unknown size, we can use the <code class="language-plaintext highlighter-rouge">binary</code> modifier at the end of the pattern:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">::</span><span class="n">binary</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">x</span>
<span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;&gt;</span>
</code></pre></div></div>

<p>There are a couple other modifiers that can be useful when doing pattern matches on binaries. The <code class="language-plaintext highlighter-rouge">binary-size(n)</code> modifier will match <code class="language-plaintext highlighter-rouge">n</code> bytes in a binary:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span><span class="n">head</span><span class="p">::</span><span class="n">binary</span><span class="o">-</span><span class="n">size</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">rest</span><span class="p">::</span><span class="n">binary</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">head</span>
<span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">rest</span>
<span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;&gt;</span>
</code></pre></div></div>

<p><strong>A string is a UTF-8 encoded binary</strong>, where the code point for each character is encoded using 1 to 4 bytes. Thus every string is a binary, but due to the UTF-8 standard encoding rules, not every binary is a valid string.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_binary</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_binary</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="mi">239</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">19</span><span class="o">&gt;&gt;</span><span class="p">)</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">valid?</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="mi">239</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">19</span><span class="o">&gt;&gt;</span><span class="p">)</span>
<span class="no">false</span>
</code></pre></div></div>

<p>The string concatenation operator <code class="language-plaintext highlighter-rouge">&lt;&gt;</code> is actually a binary concatenation operator:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"a"</span> <span class="o">&lt;&gt;</span> <span class="s2">"ha"</span>
<span class="s2">"aha"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;&gt;</span> <span class="o">&lt;&gt;</span> <span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;&gt;</span>
</code></pre></div></div>

<p>Given that strings are binaries, we can also pattern match on strings:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span><span class="n">head</span><span class="p">,</span> <span class="n">rest</span><span class="p">::</span><span class="n">binary</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="s2">"banana"</span>
<span class="s2">"banana"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">head</span> <span class="o">==</span> <span class="sx">?b</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">rest</span>
<span class="s2">"anana"</span>
</code></pre></div></div>

<p>However, remember that binary pattern matching works on <em>bytes</em>, so matching on the string like “über” with multibyte characters won’t match on the <em>character</em>, it will match on the <em>first byte of that character</em>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"ü"</span> <span class="o">&lt;&gt;</span> <span class="o">&lt;&lt;</span><span class="mi">0</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="mi">195</span><span class="p">,</span> <span class="mi">188</span><span class="p">,</span> <span class="mi">0</span><span class="o">&gt;&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span><span class="n">x</span><span class="p">,</span> <span class="n">rest</span><span class="p">::</span><span class="n">binary</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="s2">"über"</span>
<span class="s2">"über"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">x</span> <span class="o">==</span> <span class="sx">?ü</span>
<span class="no">false</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">rest</span>
<span class="o">&lt;&lt;</span><span class="mi">188</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">114</span><span class="o">&gt;&gt;</span>
</code></pre></div></div>

<p>Above, <code class="language-plaintext highlighter-rouge">x</code> matched on only the first byte of the multibyte <code class="language-plaintext highlighter-rouge">ü</code> character.</p>

<p>Therefore, when pattern matching on strings, it is important to use the <code class="language-plaintext highlighter-rouge">utf8</code> modifier:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span><span class="n">x</span><span class="p">::</span><span class="n">utf8</span><span class="p">,</span> <span class="n">rest</span><span class="p">::</span><span class="n">binary</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="s2">"über"</span>
<span class="s2">"über"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">x</span> <span class="o">==</span> <span class="sx">?ü</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">rest</span>
<span class="s2">"ber"</span>
</code></pre></div></div>

<h2 id="charlists" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Charlists</span><a href="#charlists" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Our tour of our bitstrings, binaries, and strings is nearly complete, but we have one more data type to explain: the charlist.</p>

<p><strong>A charlist is a list of integers where all the integers are valid code points.</strong> In practice, you will not come across them often, only in specific scenarios such as interfacing with older Erlang libraries that do not accept binaries as arguments.</p>

<p>Whereas double-quotes creates strings, single-quotes create charlist literals:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="s1">'hello'</span>
<span class="s1">'hello'</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="sx">?h</span><span class="p">,</span> <span class="sx">?e</span><span class="p">,</span> <span class="sx">?l</span><span class="p">,</span> <span class="sx">?l</span><span class="p">,</span> <span class="sx">?o</span><span class="p">]</span>
<span class="s1">'hello'</span>
</code></pre></div></div>

<p>The key takeaway is that <code class="language-plaintext highlighter-rouge">"hello"</code> is not the same as <code class="language-plaintext highlighter-rouge">'hello'</code>. Generally speaking, <strong>double-quotes must always be used to represent strings in Elixir</strong>. In any case, let’s learn how charlists work.</p>

<p>Instead of containing bytes, a charlist contains integer code points. However, the list is only printed in single-quotes if all code points are within the ASCII range:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="s1">'hełło'</span>
<span class="p">[</span><span class="mi">104</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">322</span><span class="p">,</span> <span class="mi">322</span><span class="p">,</span> <span class="mi">111</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_list</span><span class="p">(</span><span class="s1">'hełło'</span><span class="p">)</span>
<span class="no">true</span>
</code></pre></div></div>

<p>Interpreting integers as code points may lead to some surprising behavior. For example, if you are storing a list of integers that happen to range between 0 and 127, by default IEx will interpret this as a charlist and it will display the corresponding ASCII characters.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">heartbeats_per_minute</span> <span class="o">=</span> <span class="p">[</span><span class="mi">99</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">116</span><span class="p">]</span>
<span class="s1">'cat'</span>
</code></pre></div></div>

<p>You can convert a charlist to a string and back by using the <code class="language-plaintext highlighter-rouge">to_string/1</code> and <code class="language-plaintext highlighter-rouge">to_charlist/1</code> functions:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">to_charlist</span><span class="p">(</span><span class="s2">"hełło"</span><span class="p">)</span>
<span class="p">[</span><span class="mi">104</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">322</span><span class="p">,</span> <span class="mi">322</span><span class="p">,</span> <span class="mi">111</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">to_string</span><span class="p">(</span><span class="s1">'hełło'</span><span class="p">)</span>
<span class="s2">"hełło"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">to_string</span><span class="p">(</span><span class="ss">:hello</span><span class="p">)</span>
<span class="s2">"hello"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">to_string</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="s2">"1"</span>
</code></pre></div></div>

<p>Note that those functions are polymorphic - not only do they convert charlists to strings, they also operate on integers, atoms, and so on.</p>

<p>String (binary) concatenation uses the <code class="language-plaintext highlighter-rouge">&lt;&gt;</code> operator but charlists, being lists, use the list concatenation operator <code class="language-plaintext highlighter-rouge">++</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="s1">'this '</span> <span class="o">&lt;&gt;</span> <span class="s1">'fails'</span>
<span class="o">**</span> <span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span> <span class="n">expected</span> <span class="n">binary</span> <span class="n">argument</span> <span class="ow">in</span> <span class="o">&lt;&gt;</span> <span class="n">operator</span> <span class="n">but</span> <span class="ss">got:</span> <span class="s1">'this '</span>
    <span class="p">(</span><span class="n">elixir</span><span class="p">)</span> <span class="n">lib</span><span class="o">/</span><span class="n">kernel</span><span class="o">.</span><span class="ss">ex:</span><span class="mi">1821</span><span class="p">:</span> <span class="no">Kernel</span><span class="o">.</span><span class="n">wrap_concatenation</span><span class="o">/</span><span class="mi">3</span>
    <span class="p">(</span><span class="n">elixir</span><span class="p">)</span> <span class="n">lib</span><span class="o">/</span><span class="n">kernel</span><span class="o">.</span><span class="ss">ex:</span><span class="mi">1808</span><span class="p">:</span> <span class="no">Kernel</span><span class="o">.</span><span class="n">extract_concatenations</span><span class="o">/</span><span class="mi">2</span>
    <span class="p">(</span><span class="n">elixir</span><span class="p">)</span> <span class="n">expanding</span> <span class="ss">macro:</span> <span class="no">Kernel</span><span class="o">.&lt;&gt;/</span><span class="mi">2</span>
    <span class="ss">iex:</span><span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="s1">'this '</span> <span class="o">++</span> <span class="s1">'works'</span>
<span class="s1">'this works'</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"he"</span> <span class="o">++</span> <span class="s2">"llo"</span>
<span class="o">**</span> <span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span> <span class="n">argument</span> <span class="n">error</span>
    <span class="ss">:erlang</span><span class="o">.++</span><span class="p">(</span><span class="s2">"he"</span><span class="p">,</span> <span class="s2">"llo"</span><span class="p">)</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"he"</span> <span class="o">&lt;&gt;</span> <span class="s2">"llo"</span>
<span class="s2">"hello"</span>
</code></pre></div></div>

<p>With binaries, strings, and charlists out of the way, it is time to talk about key-value data structures.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/case-cond-and-if.html" class="previous page-numbers spec" title="case, cond, and if">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/keywords-and-maps.html" class="previous page-numbers spec" title="Keyword lists and maps">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/binaries-strings-and-char-lists.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/keywords-and-maps.html" page=":7:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><span title="Keyword lists and maps">Keyword lists and maps</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Keyword lists and maps</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#keyword-lists">Keyword lists</a></li><li><a href="#maps">Maps</a></li><li><a href="#do-blocks-and-keywords"><code class="language-plaintext highlighter-rouge">do</code>-blocks and keywords</a></li><li><a href="#nested-data-structures">Nested data structures</a></li></ol></div>

    <p>Now let’s talk about associative data structures. Associative data structures are able to associate a key to a certain value. Different languages call these different names like dictionaries, hashes, associative arrays, etc.</p>

<p>In Elixir, we have two main associative data structures: keyword lists and maps. It’s time to learn more about them!</p>

<h2 id="keyword-lists" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Keyword lists</span><a href="#keyword-lists" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Keyword lists are a data-structure used to pass options to functions. Imagine you want to split a string of numbers. We can use <code class="language-plaintext highlighter-rouge">String.split/2</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"1 2 3"</span><span class="p">,</span> <span class="s2">" "</span><span class="p">)</span>
<span class="p">[</span><span class="s2">"1"</span><span class="p">,</span> <span class="s2">"2"</span><span class="p">,</span> <span class="s2">"3"</span><span class="p">]</span>
</code></pre></div></div>

<p>However, what happens if there is an additional space between the numbers:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"1  2  3"</span><span class="p">,</span> <span class="s2">" "</span><span class="p">)</span>
<span class="p">[</span><span class="s2">"1"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">"2"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">"3"</span><span class="p">]</span>
</code></pre></div></div>

<p>As you can see, there are now empty strings in our results. Luckily, the <code class="language-plaintext highlighter-rouge">String.split/3</code> function allows the <code class="language-plaintext highlighter-rouge">trim</code> option to be set to true:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"1  2  3"</span><span class="p">,</span> <span class="s2">" "</span><span class="p">,</span> <span class="p">[</span><span class="ss">trim:</span> <span class="no">true</span><span class="p">])</span>
<span class="p">[</span><span class="s2">"1"</span><span class="p">,</span> <span class="s2">"2"</span><span class="p">,</span> <span class="s2">"3"</span><span class="p">]</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">[trim: true]</code> is a keyword list. Furthermore, when a keyword list is the last argument of a function, we can skip the brackets and write:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"1  2  3"</span><span class="p">,</span> <span class="s2">" "</span><span class="p">,</span> <span class="ss">trim:</span> <span class="no">true</span><span class="p">)</span>
<span class="p">[</span><span class="s2">"1"</span><span class="p">,</span> <span class="s2">"2"</span><span class="p">,</span> <span class="s2">"3"</span><span class="p">]</span>
</code></pre></div></div>

<p>As the name implies, keyword lists are simply lists. In particular, they are lists consisting of 2-item tuples where the first element (the key) is an atom and the second element can be any value. Both representations are the same:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">[{</span><span class="ss">:trim</span><span class="p">,</span> <span class="no">true</span><span class="p">}]</span> <span class="o">==</span> <span class="p">[</span><span class="ss">trim:</span> <span class="no">true</span><span class="p">]</span>
<span class="no">true</span>
</code></pre></div></div>

<p>Since keyword lists are lists, we can use all operations available to lists. For example, we can use <code class="language-plaintext highlighter-rouge">++</code> to add new values to a keyword list:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="p">[</span><span class="ss">a:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">b:</span> <span class="mi">2</span><span class="p">]</span>
<span class="p">[</span><span class="ss">a:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">b:</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">++</span> <span class="p">[</span><span class="ss">c:</span> <span class="mi">3</span><span class="p">]</span>
<span class="p">[</span><span class="ss">a:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">b:</span> <span class="mi">2</span><span class="p">,</span> <span class="ss">c:</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="ss">a:</span> <span class="mi">0</span><span class="p">]</span> <span class="o">++</span> <span class="n">list</span>
<span class="p">[</span><span class="ss">a:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">a:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">b:</span> <span class="mi">2</span><span class="p">]</span>
</code></pre></div></div>

<p>You can read the value of a keyword list using the brackets syntax:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">list</span><span class="p">[</span><span class="ss">:a</span><span class="p">]</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">list</span><span class="p">[</span><span class="ss">:b</span><span class="p">]</span>
<span class="mi">2</span>
</code></pre></div></div>

<p>In case of duplicate keys, values added to the front are the ones fetched:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">new_list</span> <span class="o">=</span> <span class="p">[</span><span class="ss">a:</span> <span class="mi">0</span><span class="p">]</span> <span class="o">++</span> <span class="n">list</span>
<span class="p">[</span><span class="ss">a:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">a:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">b:</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">new_list</span><span class="p">[</span><span class="ss">:a</span><span class="p">]</span>
<span class="mi">0</span>
</code></pre></div></div>

<p>Keyword lists are important because they have three special characteristics:</p>

<ul>
  <li>Keys must be atoms.</li>
  <li>Keys are ordered, as specified by the developer.</li>
  <li>Keys can be given more than once.</li>
</ul>

<p>For example, <a href="https://github.com/elixir-lang/ecto">the Ecto library</a> makes use of these features to provide an elegant DSL for writing database queries:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">query</span> <span class="o">=</span>
  <span class="n">from</span> <span class="n">w</span> <span class="ow">in</span> <span class="no">Weather</span><span class="p">,</span>
    <span class="ss">where:</span> <span class="n">w</span><span class="o">.</span><span class="n">prcp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="ss">where:</span> <span class="n">w</span><span class="o">.</span><span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">,</span>
    <span class="ss">select:</span> <span class="n">w</span>
</code></pre></div></div>

<p>Although we can pattern match on keyword lists, it is rarely done in practice since pattern matching on lists requires the number of items and their order to match:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="ss">a:</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="ss">a:</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">[</span><span class="ss">a:</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">a</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="ss">a:</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="ss">a:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">b:</span> <span class="mi">2</span><span class="p">]</span>
<span class="o">**</span> <span class="p">(</span><span class="no">MatchError</span><span class="p">)</span> <span class="n">no</span> <span class="n">match</span> <span class="n">of</span> <span class="n">right</span> <span class="n">hand</span> <span class="n">side</span> <span class="ss">value:</span> <span class="p">[</span><span class="ss">a:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">b:</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="ss">b:</span> <span class="n">b</span><span class="p">,</span> <span class="ss">a:</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="ss">a:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">b:</span> <span class="mi">2</span><span class="p">]</span>
<span class="o">**</span> <span class="p">(</span><span class="no">MatchError</span><span class="p">)</span> <span class="n">no</span> <span class="n">match</span> <span class="n">of</span> <span class="n">right</span> <span class="n">hand</span> <span class="n">side</span> <span class="ss">value:</span> <span class="p">[</span><span class="ss">a:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">b:</span> <span class="mi">2</span><span class="p">]</span>
</code></pre></div></div>

<p>In order to manipulate keyword lists, Elixir provides <a href="https://hexdocs.pm/elixir/Keyword.html">the <code class="language-plaintext highlighter-rouge">Keyword</code> module</a>. Remember, though, keyword lists are simply lists, and as such they provide the same linear performance characteristics as them: the longer the list, the longer it will take to find a key, to count the number of items, and so on. For this reason, keyword lists are used in Elixir mainly for passing optional values. If you need to store many items or guarantee one-key associates with at maximum one-value, you should use maps instead.</p>

<h2 id="maps" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Maps</span><a href="#maps" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Whenever you need a key-value store, maps are the “go to” data structure in Elixir. A map is created using the <code class="language-plaintext highlighter-rouge">%{}</code> syntax:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="p">%{</span><span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:b</span><span class="p">}</span>
<span class="p">%{</span><span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">map</span><span class="p">[</span><span class="ss">:a</span><span class="p">]</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">map</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="ss">:b</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">map</span><span class="p">[</span><span class="ss">:c</span><span class="p">]</span>
<span class="no">nil</span>
</code></pre></div></div>

<p>Compared to keyword lists, we can already see two differences:</p>

<ul>
  <li>Maps allow any value as a key.</li>
  <li>Maps’ keys do not follow any ordering.</li>
</ul>

<p>In contrast to keyword lists, maps are very useful with pattern matching. When a map is used in a pattern, it will always match on a subset of the given value:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">%{}</span> <span class="o">=</span> <span class="p">%{</span><span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:b</span><span class="p">}</span>
<span class="p">%{</span><span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">%{</span><span class="ss">:a</span> <span class="o">=&gt;</span> <span class="n">a</span><span class="p">}</span> <span class="o">=</span> <span class="p">%{</span><span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:b</span><span class="p">}</span>
<span class="p">%{</span><span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">a</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">%{</span><span class="ss">:c</span> <span class="o">=&gt;</span> <span class="n">c</span><span class="p">}</span> <span class="o">=</span> <span class="p">%{</span><span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:b</span><span class="p">}</span>
<span class="o">**</span> <span class="p">(</span><span class="no">MatchError</span><span class="p">)</span> <span class="n">no</span> <span class="n">match</span> <span class="n">of</span> <span class="n">right</span> <span class="n">hand</span> <span class="n">side</span> <span class="ss">value:</span> <span class="p">%{</span><span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">}</span>
</code></pre></div></div>

<p>As shown above, a map matches as long as the keys in the pattern exist in the given map. Therefore, an empty map matches all maps.</p>

<p>Variables can be used when accessing, matching and adding map keys:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="p">%{</span><span class="n">n</span> <span class="o">=&gt;</span> <span class="ss">:one</span><span class="p">}</span>
<span class="p">%{</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="ss">:one</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">map</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
<span class="ss">:one</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">%{</span><span class="o">^</span><span class="n">n</span> <span class="o">=&gt;</span> <span class="ss">:one</span><span class="p">}</span> <span class="o">=</span> <span class="p">%{</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="ss">:one</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:two</span><span class="p">,</span> <span class="mi">3</span> <span class="o">=&gt;</span> <span class="ss">:three</span><span class="p">}</span>
<span class="p">%{</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="ss">:one</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:two</span><span class="p">,</span> <span class="mi">3</span> <span class="o">=&gt;</span> <span class="ss">:three</span><span class="p">}</span>
</code></pre></div></div>

<p><a href="https://hexdocs.pm/elixir/Map.html">The <code class="language-plaintext highlighter-rouge">Map</code> module</a> provides a very similar API to the <code class="language-plaintext highlighter-rouge">Keyword</code> module with convenience functions to manipulate maps:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">get</span><span class="p">(%{</span><span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:b</span><span class="p">},</span> <span class="ss">:a</span><span class="p">)</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(%{</span><span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:b</span><span class="p">},</span> <span class="ss">:c</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">%{</span><span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">:c</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">to_list</span><span class="p">(%{</span><span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:b</span><span class="p">})</span>
<span class="p">[{</span><span class="mi">2</span><span class="p">,</span> <span class="ss">:b</span><span class="p">},</span> <span class="p">{</span><span class="ss">:a</span><span class="p">,</span> <span class="mi">1</span><span class="p">}]</span>
</code></pre></div></div>

<p>Maps have the following syntax for updating a key’s value:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="p">%{</span><span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:b</span><span class="p">}</span>
<span class="p">%{</span><span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">}</span>

<span class="n">iex</span><span class="o">&gt;</span> <span class="p">%{</span><span class="n">map</span> <span class="o">|</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="s2">"two"</span><span class="p">}</span>
<span class="p">%{</span><span class="mi">2</span> <span class="o">=&gt;</span> <span class="s2">"two"</span><span class="p">,</span> <span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">%{</span><span class="n">map</span> <span class="o">|</span> <span class="ss">:c</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">}</span>
<span class="o">**</span> <span class="p">(</span><span class="no">KeyError</span><span class="p">)</span> <span class="n">key</span> <span class="ss">:c</span> <span class="ow">not</span> <span class="n">found</span> <span class="ow">in</span><span class="p">:</span> <span class="p">%{</span><span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">}</span>
</code></pre></div></div>

<p>The syntax above requires the given key to exist. It cannot be used to add new keys. For example, using it with the <code class="language-plaintext highlighter-rouge">:c</code> key failed because there is no <code class="language-plaintext highlighter-rouge">:c</code> in the map.</p>

<p>When all the keys in a map are atoms, you can use the keyword syntax for convenience:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="p">%{</span><span class="ss">a:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">b:</span> <span class="mi">2</span><span class="p">}</span>
<span class="p">%{</span><span class="ss">a:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">b:</span> <span class="mi">2</span><span class="p">}</span>
</code></pre></div></div>

<p>Another interesting property of maps is that they provide their own syntax for accessing atom keys:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="p">%{</span><span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:b</span><span class="p">}</span>
<span class="p">%{</span><span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">}</span>

<span class="n">iex</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">.</span><span class="n">a</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">.</span><span class="n">c</span>
<span class="o">**</span> <span class="p">(</span><span class="no">KeyError</span><span class="p">)</span> <span class="n">key</span> <span class="ss">:c</span> <span class="ow">not</span> <span class="n">found</span> <span class="ow">in</span><span class="p">:</span> <span class="p">%{</span><span class="mi">2</span> <span class="o">=&gt;</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">}</span>
</code></pre></div></div>

<p>This syntax has one large benefit in that it raises if the key does not exist in the map. Sometimes the Elixir compiler may even warn too. This makes it useful to get quick feedback and spot bugs and typos early on.</p>

<p>Elixir developers typically prefer to use the <code class="language-plaintext highlighter-rouge">map.field</code> syntax and pattern matching instead of the functions in the <code class="language-plaintext highlighter-rouge">Map</code> module when working with maps because they lead to an assertive style of programming. <a href="https://dashbit.co/blog/writing-assertive-code-with-elixir">This blog post by José Valim</a> provides insight and examples on how you get more concise and faster software by writing assertive code in Elixir.</p>

<h2 id="do-blocks-and-keywords" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper"><code class="language-plaintext highlighter-rouge">do</code>-blocks and keywords</span><a href="#do-blocks-and-keywords" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>As we have seen, keywords are mostly used in the language to pass optional values. In fact, we have used keywords before in this guide. For example, we have seen:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">if</span> <span class="no">true</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="s2">"This will be seen"</span>
<span class="o">...&gt;</span> <span class="k">else</span>
<span class="o">...&gt;</span>   <span class="s2">"This won't"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="s2">"This will be seen"</span>
</code></pre></div></div>

<p>It happens that <code class="language-plaintext highlighter-rouge">do</code> blocks are nothing more than a syntax convenience on top of keywords. We can rewrite the above to:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">if</span> <span class="no">true</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="s2">"This will be seen"</span><span class="p">,</span> <span class="k">else</span><span class="p">:</span> <span class="s2">"This won't"</span>
<span class="s2">"This will be seen"</span>
</code></pre></div></div>

<p>Pay close attention to both syntaxes. In the keyword list format, we separate each key-value pair with commas, and each key is followed by <code class="language-plaintext highlighter-rouge">:</code>. In the <code class="language-plaintext highlighter-rouge">do</code>-blocks, we get rid of the colons, the commas, and separate each keyword by a newline. They are useful exactly because they remove the verbosity when writing blocks of code. Most of the time, you will use the block syntax, but it is good to know they are equivalent.</p>

<p>Note that only a handful of keyword lists can be converted to blocks: <code class="language-plaintext highlighter-rouge">do</code>, <code class="language-plaintext highlighter-rouge">else</code>, <code class="language-plaintext highlighter-rouge">catch</code>, <code class="language-plaintext highlighter-rouge">rescue</code>, and <code class="language-plaintext highlighter-rouge">after</code>. Those are all the keywords used by Elixir control-flow constructs. We have already learned some of them and we will learn others in the future.</p>

<p>With this out of the way, let’s see how we can work with nested data structures.</p>

<h2 id="nested-data-structures" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Nested data structures</span><a href="#nested-data-structures" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Often we will have maps inside maps, or even keywords lists inside maps, and so forth. Elixir provides conveniences for manipulating nested data structures via the <code class="language-plaintext highlighter-rouge">put_in/2</code>, <code class="language-plaintext highlighter-rouge">update_in/2</code> and other macros giving the same conveniences you would find in imperative languages while keeping the immutable properties of the language.</p>

<p>Imagine you have the following structure:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="p">[</span>
  <span class="ss">john:</span> <span class="p">%{</span><span class="ss">name:</span> <span class="s2">"John"</span><span class="p">,</span> <span class="ss">age:</span> <span class="mi">27</span><span class="p">,</span> <span class="ss">languages:</span> <span class="p">[</span><span class="s2">"Erlang"</span><span class="p">,</span> <span class="s2">"Ruby"</span><span class="p">,</span> <span class="s2">"Elixir"</span><span class="p">]},</span>
  <span class="ss">mary:</span> <span class="p">%{</span><span class="ss">name:</span> <span class="s2">"Mary"</span><span class="p">,</span> <span class="ss">age:</span> <span class="mi">29</span><span class="p">,</span> <span class="ss">languages:</span> <span class="p">[</span><span class="s2">"Elixir"</span><span class="p">,</span> <span class="s2">"F#"</span><span class="p">,</span> <span class="s2">"Clojure"</span><span class="p">]}</span>
<span class="p">]</span>
<span class="p">[</span>
  <span class="ss">john:</span> <span class="p">%{</span><span class="ss">age:</span> <span class="mi">27</span><span class="p">,</span> <span class="ss">languages:</span> <span class="p">[</span><span class="s2">"Erlang"</span><span class="p">,</span> <span class="s2">"Ruby"</span><span class="p">,</span> <span class="s2">"Elixir"</span><span class="p">],</span> <span class="ss">name:</span> <span class="s2">"John"</span><span class="p">},</span>
  <span class="ss">mary:</span> <span class="p">%{</span><span class="ss">age:</span> <span class="mi">29</span><span class="p">,</span> <span class="ss">languages:</span> <span class="p">[</span><span class="s2">"Elixir"</span><span class="p">,</span> <span class="s2">"F#"</span><span class="p">,</span> <span class="s2">"Clojure"</span><span class="p">],</span> <span class="ss">name:</span> <span class="s2">"Mary"</span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div>

<p>We have a keyword list of users where each value is a map containing the name, age and a list of programming languages each user likes. If we wanted to access the age for john, we could write:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">users</span><span class="p">[</span><span class="ss">:john</span><span class="p">]</span><span class="o">.</span><span class="n">age</span>
<span class="mi">27</span>
</code></pre></div></div>

<p>It happens we can also use this same syntax for updating the value:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">put_in</span> <span class="n">users</span><span class="p">[</span><span class="ss">:john</span><span class="p">]</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="mi">31</span>
<span class="p">[</span>
  <span class="ss">john:</span> <span class="p">%{</span><span class="ss">age:</span> <span class="mi">31</span><span class="p">,</span> <span class="ss">languages:</span> <span class="p">[</span><span class="s2">"Erlang"</span><span class="p">,</span> <span class="s2">"Ruby"</span><span class="p">,</span> <span class="s2">"Elixir"</span><span class="p">],</span> <span class="ss">name:</span> <span class="s2">"John"</span><span class="p">},</span>
  <span class="ss">mary:</span> <span class="p">%{</span><span class="ss">age:</span> <span class="mi">29</span><span class="p">,</span> <span class="ss">languages:</span> <span class="p">[</span><span class="s2">"Elixir"</span><span class="p">,</span> <span class="s2">"F#"</span><span class="p">,</span> <span class="s2">"Clojure"</span><span class="p">],</span> <span class="ss">name:</span> <span class="s2">"Mary"</span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">update_in/2</code> macro is similar but allows us to pass a function that controls how the value changes. For example, let’s remove “Clojure” from Mary’s list of languages:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">update_in</span> <span class="n">users</span><span class="p">[</span><span class="ss">:mary</span><span class="p">]</span><span class="o">.</span><span class="n">languages</span><span class="p">,</span> <span class="k">fn</span> <span class="n">languages</span> <span class="o">-&gt;</span> <span class="no">List</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">languages</span><span class="p">,</span> <span class="s2">"Clojure"</span><span class="p">)</span> <span class="k">end</span>
<span class="p">[</span>
  <span class="ss">john:</span> <span class="p">%{</span><span class="ss">age:</span> <span class="mi">31</span><span class="p">,</span> <span class="ss">languages:</span> <span class="p">[</span><span class="s2">"Erlang"</span><span class="p">,</span> <span class="s2">"Ruby"</span><span class="p">,</span> <span class="s2">"Elixir"</span><span class="p">],</span> <span class="ss">name:</span> <span class="s2">"John"</span><span class="p">},</span>
  <span class="ss">mary:</span> <span class="p">%{</span><span class="ss">age:</span> <span class="mi">29</span><span class="p">,</span> <span class="ss">languages:</span> <span class="p">[</span><span class="s2">"Elixir"</span><span class="p">,</span> <span class="s2">"F#"</span><span class="p">],</span> <span class="ss">name:</span> <span class="s2">"Mary"</span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div>

<p>There is more to learn about <code class="language-plaintext highlighter-rouge">put_in/2</code> and <code class="language-plaintext highlighter-rouge">update_in/2</code>, including the <code class="language-plaintext highlighter-rouge">get_and_update_in/2</code> that allows us to extract a value and update the data structure at once. There are also <code class="language-plaintext highlighter-rouge">put_in/3</code>, <code class="language-plaintext highlighter-rouge">update_in/3</code> and <code class="language-plaintext highlighter-rouge">get_and_update_in/3</code> which allow dynamic access into the data structure. <a href="https://hexdocs.pm/elixir/Kernel.html">Check their respective documentation in the <code class="language-plaintext highlighter-rouge">Kernel</code> module for more information</a>.</p>

<p>This concludes our introduction to associative data structures in Elixir. You will find out that, given keyword lists and maps, you will always have the right tool to tackle problems that require associative data structures in Elixir.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/binaries-strings-and-char-lists.html" class="previous page-numbers spec" title="Binaries, strings, and charlists">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/modules-and-functions.html" class="previous page-numbers spec" title="Modules and Functions">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/keywords-and-maps.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/modules-and-functions.html" page=":8:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><span title="Modules and Functions">Modules and Functions</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Modules and functions</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#compilation">Compilation</a></li><li><a href="#scripted-mode">Scripted mode</a></li><li><a href="#named-functions">Named functions</a></li><li><a href="#function-capturing">Function capturing</a></li><li><a href="#default-arguments">Default arguments</a></li></ol></div>

    <p>In Elixir we group several functions into modules. We’ve already used many different modules in the previous chapters such as <a href="https://hexdocs.pm/elixir/String.html">the <code class="language-plaintext highlighter-rouge">String</code> module</a>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">length</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span>
<span class="mi">5</span>
</code></pre></div></div>

<p>In order to create our own modules in Elixir, we use the <code class="language-plaintext highlighter-rouge">defmodule</code> macro. The first letter of the module must be in uppercase. We use the <code class="language-plaintext highlighter-rouge">def</code> macro to define functions in that module. The first letter of every function must be in lowercase (or underscore):</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">defmodule</span> <span class="no">Math</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="k">def</span> <span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">do</span>
<span class="o">...&gt;</span>     <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="o">...&gt;</span>   <span class="k">end</span>
<span class="o">...&gt;</span> <span class="k">end</span>

<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Math</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="mi">3</span>
</code></pre></div></div>

<p>In the following sections, our examples are going to get longer in size, and it can be tricky to type them all in the shell. It’s about time for us to learn how to compile Elixir code and also how to run Elixir scripts.</p>

<h2 id="compilation" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Compilation</span><a href="#compilation" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Most of the time it is convenient to write modules into files so they can be compiled and reused. Let’s assume we have a file named <code class="language-plaintext highlighter-rouge">math.ex</code> with the following contents:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Math</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This file can be compiled using <code class="language-plaintext highlighter-rouge">elixirc</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>elixirc math.ex
</code></pre></div></div>

<p>This will generate a file named <code class="language-plaintext highlighter-rouge">Elixir.Math.beam</code> containing the bytecode for the defined module. If we start <code class="language-plaintext highlighter-rouge">iex</code> again, our module definition will be available (provided that <code class="language-plaintext highlighter-rouge">iex</code> is started in the same directory the bytecode file is in):</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Math</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="mi">3</span>
</code></pre></div></div>

<p>Elixir projects are usually organized into three directories:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">_build</code> - contains compilation artifacts</li>
  <li><code class="language-plaintext highlighter-rouge">lib</code> - contains Elixir code (usually <code class="language-plaintext highlighter-rouge">.ex</code> files)</li>
  <li><code class="language-plaintext highlighter-rouge">test</code> - contains tests (usually <code class="language-plaintext highlighter-rouge">.exs</code> files)</li>
</ul>

<p>When working on actual projects, the build tool called <code class="language-plaintext highlighter-rouge">mix</code> will be responsible for compiling and setting up the proper paths for you. For learning and convenience purposes, Elixir also supports a scripted mode which is more flexible and does not generate any compiled artifacts.</p>

<h2 id="scripted-mode" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Scripted mode</span><a href="#scripted-mode" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>In addition to the Elixir file extension <code class="language-plaintext highlighter-rouge">.ex</code>, Elixir also supports <code class="language-plaintext highlighter-rouge">.exs</code> files for scripting. Elixir treats both files exactly the same way, the only difference is in intention. <code class="language-plaintext highlighter-rouge">.ex</code> files are meant to be compiled while <code class="language-plaintext highlighter-rouge">.exs</code> files are used for scripting. This convention is followed by projects like <code class="language-plaintext highlighter-rouge">mix</code>.</p>

<p>For instance, we can create a file called <code class="language-plaintext highlighter-rouge">math.exs</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Math</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="no">Math</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div></div>

<p>And execute it as:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>elixir math.exs
</code></pre></div></div>

<p>Because we used <code class="language-plaintext highlighter-rouge">elixir</code> instead of <code class="language-plaintext highlighter-rouge">elixirc</code>, the module was compiled and loaded into memory, but no <code class="language-plaintext highlighter-rouge">.beam</code> file was written to disk. In the following examples, we recommend you write your code into script files and execute them as shown above.</p>

<h2 id="named-functions" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Named functions</span><a href="#named-functions" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Inside a module, we can define functions with <code class="language-plaintext highlighter-rouge">def/2</code> and private functions with <code class="language-plaintext highlighter-rouge">defp/2</code>. A function defined with <code class="language-plaintext highlighter-rouge">def/2</code> can be invoked from other modules while a private function can only be invoked locally.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Math</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">do_sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">do_sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="no">Math</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>    <span class="c1">#=&gt; 3</span>
<span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="no">Math</span><span class="o">.</span><span class="n">do_sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">#=&gt; ** (UndefinedFunctionError)</span>
</code></pre></div></div>

<p>Function declarations also support guards and multiple clauses. If a function has several clauses, Elixir will try each clause until it finds one that matches. Here is an implementation of a function that checks if the given number is zero or not:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Math</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">zero?</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">true</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">zero?</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">when</span> <span class="n">is_integer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">false</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="no">Math</span><span class="o">.</span><span class="n">zero?</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>         <span class="c1">#=&gt; true</span>
<span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="no">Math</span><span class="o">.</span><span class="n">zero?</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>         <span class="c1">#=&gt; false</span>
<span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="no">Math</span><span class="o">.</span><span class="n">zero?</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="c1">#=&gt; ** (FunctionClauseError)</span>
<span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="no">Math</span><span class="o">.</span><span class="n">zero?</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>       <span class="c1">#=&gt; ** (FunctionClauseError)</span>
</code></pre></div></div>

<p>The trailing question mark in <code class="language-plaintext highlighter-rouge">zero?</code> means that this function returns a boolean. To learn more about the naming conventions for modules, function names, variables and more in Elixir, see <a href="https://hexdocs.pm/elixir/naming-conventions.html">Naming Conventions</a>.</p>

<p>Giving an argument that does not match any of the clauses raises an error.</p>

<p>Similar to constructs like <code class="language-plaintext highlighter-rouge">if</code>, named functions support both <code class="language-plaintext highlighter-rouge">do:</code> and <code class="language-plaintext highlighter-rouge">do</code>-block syntax, as <a href="/getting-started/keywords-and-maps.html#do-blocks-and-keywords">we learned in the previous chapter</a>. For example, we can edit <code class="language-plaintext highlighter-rouge">math.exs</code> to look like this:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Math</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">zero?</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="no">true</span>
  <span class="k">def</span> <span class="n">zero?</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">when</span> <span class="n">is_integer</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="no">false</span>
<span class="k">end</span>
</code></pre></div></div>

<p>And it will provide the same behaviour. You may use <code class="language-plaintext highlighter-rouge">do:</code> for one-liners but always use <code class="language-plaintext highlighter-rouge">do</code>-blocks for functions spanning multiple lines. If you prefer to be consistent, you can use <code class="language-plaintext highlighter-rouge">do</code>-blocks throughout your codebase.</p>

<h2 id="function-capturing" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Function capturing</span><a href="#function-capturing" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Throughout this tutorial, we have been using the notation <code class="language-plaintext highlighter-rouge">name/arity</code> to refer to functions. It happens that this notation can actually be used to retrieve a named function as a function type. Start <code class="language-plaintext highlighter-rouge">iex</code>, running the <code class="language-plaintext highlighter-rouge">math.exs</code> file defined above:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>iex math.exs
</code></pre></div></div>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Math</span><span class="o">.</span><span class="n">zero?</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">fun</span> <span class="o">=</span> <span class="o">&amp;</span><span class="no">Math</span><span class="o">.</span><span class="n">zero?</span><span class="o">/</span><span class="mi">1</span>
<span class="o">&amp;</span><span class="no">Math</span><span class="o">.</span><span class="n">zero?</span><span class="o">/</span><span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_function</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">fun</span><span class="o">.</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="no">true</span>
</code></pre></div></div>

<p>Remember Elixir makes a distinction between anonymous functions and named functions, where the former must be invoked with a dot (<code class="language-plaintext highlighter-rouge">.</code>) between the variable name and parentheses. The capture operator (<code class="language-plaintext highlighter-rouge">&amp;</code>) bridges this gap by allowing named functions to be assigned to variables and passed as arguments in the same way we assign, invoke and pass anonymous functions.</p>

<p>Local or imported functions, like <code class="language-plaintext highlighter-rouge">is_function/1</code>, can be captured without the module:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">is_function</span><span class="o">/</span><span class="mi">1</span>
<span class="o">&amp;</span><span class="ss">:erlang</span><span class="o">.</span><span class="n">is_function</span><span class="o">/</span><span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">is_function</span><span class="o">/</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
<span class="no">true</span>
</code></pre></div></div>

<p>You can also capture operators:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">add</span> <span class="o">=</span> <span class="o">&amp;+/</span><span class="mi">2</span>
<span class="o">&amp;</span><span class="ss">:erlang</span><span class="o">.+/</span><span class="mi">2</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">add</span><span class="o">.</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="mi">3</span>
</code></pre></div></div>

<p>Note the capture syntax can also be used as a shortcut for creating functions:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">fun</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="nv">&amp;1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1">#Function&lt;6.71889879/1 in :erl_eval.expr/5&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">fun</span><span class="o">.</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="mi">2</span>

<span class="n">iex</span><span class="o">&gt;</span> <span class="n">fun2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="s2">"Good </span><span class="si">#{</span><span class="nv">&amp;1</span><span class="si">}</span><span class="s2">"</span>
<span class="c1">#Function&lt;6.127694169/1 in :erl_eval.expr/5&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">fun2</span><span class="o">.</span><span class="p">(</span><span class="s2">"morning"</span><span class="p">)</span>
<span class="s2">"Good morning"</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">&amp;1</code> represents the first argument passed into the function. <code class="language-plaintext highlighter-rouge">&amp;(&amp;1 + 1)</code> above is exactly the same as <code class="language-plaintext highlighter-rouge">fn x -&gt; x + 1 end</code>. The syntax above is useful for short function definitions.</p>

<p>You can read more about the capture operator <code class="language-plaintext highlighter-rouge">&amp;</code> in <a href="https://hexdocs.pm/elixir/Kernel.SpecialForms.html#&amp;/1">the <code class="language-plaintext highlighter-rouge">Kernel.SpecialForms</code> documentation</a>.</p>

<h2 id="default-arguments" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Default arguments</span><a href="#default-arguments" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Named functions in Elixir also support default arguments:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Concat</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">sep</span> <span class="p">\\</span> <span class="s2">" "</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">a</span> <span class="o">&lt;&gt;</span> <span class="n">sep</span> <span class="o">&lt;&gt;</span> <span class="n">b</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="no">Concat</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"Hello"</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">)</span>      <span class="c1">#=&gt; Hello world</span>
<span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="no">Concat</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"Hello"</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)</span> <span class="c1">#=&gt; Hello_world</span>
</code></pre></div></div>

<p>Any expression is allowed to serve as a default value, but it won’t be evaluated during the function definition. Every time the function is invoked and any of its default values have to be used, the expression for that default value will be evaluated:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">DefaultTest</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">dowork</span><span class="p">(</span><span class="n">x</span> <span class="p">\\</span> <span class="s2">"hello"</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">x</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">DefaultTest</span><span class="o">.</span><span class="n">dowork</span>
<span class="s2">"hello"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">DefaultTest</span><span class="o">.</span><span class="n">dowork</span> <span class="mi">123</span>
<span class="mi">123</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">DefaultTest</span><span class="o">.</span><span class="n">dowork</span>
<span class="s2">"hello"</span>
</code></pre></div></div>

<p>If a function with default values has multiple clauses, it is required to create a function head (a function definition without a body) for declaring defaults:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Concat</span> <span class="k">do</span>
  <span class="c1"># A function head declaring defaults</span>
  <span class="k">def</span> <span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">\\</span> <span class="no">nil</span><span class="p">,</span> <span class="n">sep</span> <span class="p">\\</span> <span class="s2">" "</span><span class="p">)</span>

  <span class="k">def</span> <span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">_sep</span><span class="p">)</span> <span class="ow">when</span> <span class="n">is_nil</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">a</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">a</span> <span class="o">&lt;&gt;</span> <span class="n">sep</span> <span class="o">&lt;&gt;</span> <span class="n">b</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="no">Concat</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"Hello"</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">)</span>      <span class="c1">#=&gt; Hello world</span>
<span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="no">Concat</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"Hello"</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)</span> <span class="c1">#=&gt; Hello_world</span>
<span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="no">Concat</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"Hello"</span><span class="p">)</span>               <span class="c1">#=&gt; Hello</span>
</code></pre></div></div>

<p>When a variable is not used by a function or a clause, we add a leading underscore (<code class="language-plaintext highlighter-rouge">_</code>) to its name to signal this intent. This rule is also covered in our <a href="https://hexdocs.pm/elixir/main/naming-conventions.html#underscore-_foo">Naming Conventions</a> document.</p>

<p>When using default values, one must be careful to avoid overlapping function definitions. Consider the following example:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Concat</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="s2">"***First join"</span>
    <span class="n">a</span> <span class="o">&lt;&gt;</span> <span class="n">b</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">sep</span> <span class="p">\\</span> <span class="s2">" "</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="s2">"***Second join"</span>
    <span class="n">a</span> <span class="o">&lt;&gt;</span> <span class="n">sep</span> <span class="o">&lt;&gt;</span> <span class="n">b</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Elixir will emit the following warning:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>concat.ex:7: warning: this clause cannot match because a previous clause at line 2 always matches
</code></pre></div></div>

<p>The compiler is telling us that invoking the <code class="language-plaintext highlighter-rouge">join</code> function with two arguments will always choose the first definition of <code class="language-plaintext highlighter-rouge">join</code> whereas the second one will only be invoked when three arguments are passed:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>iex concat.ex
</code></pre></div></div>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Concat</span><span class="o">.</span><span class="n">join</span> <span class="s2">"Hello"</span><span class="p">,</span> <span class="s2">"world"</span>
<span class="o">***</span><span class="no">First</span> <span class="n">join</span>
<span class="s2">"Helloworld"</span>
</code></pre></div></div>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Concat</span><span class="o">.</span><span class="n">join</span> <span class="s2">"Hello"</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">,</span> <span class="s2">"_"</span>
<span class="o">***</span><span class="no">Second</span> <span class="n">join</span>
<span class="s2">"Hello_world"</span>
</code></pre></div></div>

<p>Removing the default argument in this case will fix the warning.</p>

<p>This finishes our short introduction to modules. In the next chapters, we will learn how to use named functions for recursion, explore Elixir lexical directives that can be used for importing functions from other modules and discuss module attributes.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/keywords-and-maps.html" class="previous page-numbers spec" title="Keyword lists and maps">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/recursion.html" class="previous page-numbers spec" title="Recursion">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/modules-and-functions.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/recursion.html" page=":9:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><span title="Recursion">Recursion</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Recursion</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#loops-through-recursion">Loops through recursion</a></li><li><a href="#reduce-and-map-algorithms">Reduce and map algorithms</a></li></ol></div>

    <h2 id="loops-through-recursion" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Loops through recursion</span><a href="#loops-through-recursion" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Due to immutability, loops in Elixir (as in any functional programming language) are written differently from imperative languages. For example, in an imperative language like C, one would write:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">array</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the example above, we are mutating both the array and the variable <code class="language-plaintext highlighter-rouge">i</code>. However, data structures in Elixir are immutable. For this reason, functional languages rely on recursion: a function is called recursively until a condition is reached that stops the recursive action from continuing. No data is mutated in this process. Consider the example below that prints a string an arbitrary number of times:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Recursion</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">print_multiple_times</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="ow">when</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">do</span>
    <span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">print_multiple_times</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">print_multiple_times</span><span class="p">(</span><span class="n">_msg</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">do</span>
    <span class="ss">:ok</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Recursion</span><span class="o">.</span><span class="n">print_multiple_times</span><span class="p">(</span><span class="s2">"Hello!"</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="c1"># Hello!</span>
<span class="c1"># Hello!</span>
<span class="c1"># Hello!</span>
<span class="ss">:ok</span>
</code></pre></div></div>

<p>Similar to <code class="language-plaintext highlighter-rouge">case</code>, a function may have many clauses. A particular clause is executed when the arguments passed to the function match the clause’s argument patterns and its guards evaluate to <code class="language-plaintext highlighter-rouge">true</code>.</p>

<p>When <code class="language-plaintext highlighter-rouge">print_multiple_times/2</code> is initially called in the example above, the argument <code class="language-plaintext highlighter-rouge">n</code> is equal to <code class="language-plaintext highlighter-rouge">3</code>.</p>

<p>The first clause has a guard which says “use this definition if and only if <code class="language-plaintext highlighter-rouge">n</code> is more than <code class="language-plaintext highlighter-rouge">0</code>”. Since this is the case, it prints the <code class="language-plaintext highlighter-rouge">msg</code> and then calls itself passing <code class="language-plaintext highlighter-rouge">n - 1</code> (<code class="language-plaintext highlighter-rouge">2</code>) as the second argument.</p>

<p>Now we execute the same function again, starting from the first clause. Given the second argument, <code class="language-plaintext highlighter-rouge">n</code>, is still more than 0, we print the message and call ourselves once more, now with the second argument set to <code class="language-plaintext highlighter-rouge">1</code>. Then we print the message one last time and call <code class="language-plaintext highlighter-rouge">print_multiple_times("Hello!", 0)</code>, starting from the top once again.</p>

<p>When the second argument is zero, the guard <code class="language-plaintext highlighter-rouge">n &gt; 0</code> evaluates to false, and the first function clause won’t execute. Elixir then proceeds to try the next function clause, which explicitly matches on the case where <code class="language-plaintext highlighter-rouge">n</code> is <code class="language-plaintext highlighter-rouge">0</code>. This clause, also known as the termination clause, ignores the message argument by assigning it to the <code class="language-plaintext highlighter-rouge">_msg</code> variable and returns the atom <code class="language-plaintext highlighter-rouge">:ok</code>.</p>

<p>Finally, if you pass an argument that does not match any clause, Elixir raises a <code class="language-plaintext highlighter-rouge">FunctionClauseError</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Recursion</span><span class="o">.</span><span class="n">print_multiple_times</span> <span class="s2">"Hello!"</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<span class="o">**</span> <span class="p">(</span><span class="no">FunctionClauseError</span><span class="p">)</span> <span class="n">no</span> <span class="n">function</span> <span class="n">clause</span> <span class="n">matching</span> <span class="ow">in</span> <span class="no">Recursion</span><span class="o">.</span><span class="n">print_multiple_times</span><span class="o">/</span><span class="mi">2</span>

    <span class="no">The</span> <span class="n">following</span> <span class="n">arguments</span> <span class="n">were</span> <span class="n">given</span> <span class="n">to</span> <span class="no">Recursion</span><span class="o">.</span><span class="n">print_multiple_times</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>

        <span class="c1"># 1</span>
        <span class="s2">"Hello!"</span>

        <span class="c1"># 2</span>
        <span class="o">-</span><span class="mi">1</span>

    <span class="ss">iex:</span><span class="mi">1</span><span class="p">:</span> <span class="no">Recursion</span><span class="o">.</span><span class="n">print_multiple_times</span><span class="o">/</span><span class="mi">2</span>
</code></pre></div></div>

<h2 id="reduce-and-map-algorithms" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Reduce and map algorithms</span><a href="#reduce-and-map-algorithms" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Let’s now see how we can use the power of recursion to sum a list of numbers:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Math</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">sum_list</span><span class="p">([</span><span class="n">head</span> <span class="o">|</span> <span class="n">tail</span><span class="p">],</span> <span class="n">accumulator</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">sum_list</span><span class="p">(</span><span class="n">tail</span><span class="p">,</span> <span class="n">head</span> <span class="o">+</span> <span class="n">accumulator</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">sum_list</span><span class="p">([],</span> <span class="n">accumulator</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">accumulator</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="no">Math</span><span class="o">.</span><span class="n">sum_list</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">#=&gt; 6</span>
</code></pre></div></div>

<p>We invoke <code class="language-plaintext highlighter-rouge">sum_list</code> with the list <code class="language-plaintext highlighter-rouge">[1, 2, 3]</code> and the initial value <code class="language-plaintext highlighter-rouge">0</code> as arguments. We will try each clause until we find one that matches according to the pattern matching rules. In this case, the list <code class="language-plaintext highlighter-rouge">[1, 2, 3]</code> matches against <code class="language-plaintext highlighter-rouge">[head | tail]</code> which binds <code class="language-plaintext highlighter-rouge">head</code> to <code class="language-plaintext highlighter-rouge">1</code> and <code class="language-plaintext highlighter-rouge">tail</code> to <code class="language-plaintext highlighter-rouge">[2, 3]</code>; <code class="language-plaintext highlighter-rouge">accumulator</code> is set to <code class="language-plaintext highlighter-rouge">0</code>.</p>

<p>Then, we add the head of the list to the accumulator <code class="language-plaintext highlighter-rouge">head + accumulator</code> and call <code class="language-plaintext highlighter-rouge">sum_list</code> again, recursively, passing the tail of the list as its first argument. The tail will once again match <code class="language-plaintext highlighter-rouge">[head | tail]</code> until the list is empty, as seen below:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sum_list</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">0</span>
<span class="n">sum_list</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">1</span>
<span class="n">sum_list</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">3</span>
<span class="n">sum_list</span> <span class="p">[],</span> <span class="mi">6</span>
</code></pre></div></div>

<p>When the list is empty, it will match the final clause which returns the final result of <code class="language-plaintext highlighter-rouge">6</code>.</p>

<p>The process of taking a list and <em>reducing</em> it down to one value is known as a <em>reduce algorithm</em> and is central to functional programming.</p>

<p>What if we instead want to double all of the values in our list?</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Math</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">double_each</span><span class="p">([</span><span class="n">head</span> <span class="o">|</span> <span class="n">tail</span><span class="p">])</span> <span class="k">do</span>
    <span class="p">[</span><span class="n">head</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">|</span> <span class="n">double_each</span><span class="p">(</span><span class="n">tail</span><span class="p">)]</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">double_each</span><span class="p">([])</span> <span class="k">do</span>
    <span class="p">[]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>iex math.exs
</code></pre></div></div>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Math</span><span class="o">.</span><span class="n">double_each</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="c1">#=&gt; [2, 4, 6]</span>
</code></pre></div></div>

<p>Here we have used recursion to traverse a list, doubling each element and returning a new list. The process of taking a list and <em>mapping</em> over it is known as a <em>map algorithm</em>.</p>

<p>Recursion and <a href="https://en.wikipedia.org/wiki/Tail_call">tail call</a> optimization are an important part of Elixir and are commonly used to create loops. However, when programming in Elixir you will rarely use recursion as above to manipulate lists.</p>

<p>The <a href="https://hexdocs.pm/elixir/Enum.html"><code class="language-plaintext highlighter-rouge">Enum</code> module</a>, which we’re going to see in the next chapter, already provides many conveniences for working with lists. For instance, the examples above could be written as:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="k">fn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">acc</span> <span class="k">end</span><span class="p">)</span>
<span class="mi">6</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">map</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="k">fn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">end</span><span class="p">)</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
</code></pre></div></div>

<p>Or, using the capture syntax:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;+/</span><span class="mi">2</span><span class="p">)</span>
<span class="mi">6</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">map</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="o">&amp;</span><span class="p">(</span><span class="nv">&amp;1</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
</code></pre></div></div>

<p>Let’s take a deeper look at <code class="language-plaintext highlighter-rouge">Enumerable</code> and, while we’re at it, its lazy counterpart, <code class="language-plaintext highlighter-rouge">Stream</code>.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/modules-and-functions.html" class="previous page-numbers spec" title="Modules and Functions">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/enumerables-and-streams.html" class="previous page-numbers spec" title="Enumerables and streams">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/recursion.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/enumerables-and-streams.html" page=":10:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><span title="Enumerables and streams">Enumerables and streams</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Enumerables and Streams</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#enumerables">Enumerables</a></li><li><a href="#eager-vs-lazy">Eager vs Lazy</a></li><li><a href="#the-pipe-operator">The pipe operator</a></li><li><a href="#streams">Streams</a></li></ol></div>

    <h2 id="enumerables" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Enumerables</span><a href="#enumerables" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir provides the concept of enumerables and <a href="https://hexdocs.pm/elixir/Enum.html">the <code class="language-plaintext highlighter-rouge">Enum</code> module</a> to work with them. We have already learned two enumerables: lists and maps.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">map</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="k">fn</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">end</span><span class="p">)</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">map</span><span class="p">(%{</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">},</span> <span class="k">fn</span> <span class="p">{</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="n">k</span> <span class="o">*</span> <span class="n">v</span> <span class="k">end</span><span class="p">)</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">Enum</code> module provides a huge range of functions to transform, sort, group, filter and retrieve items from enumerables. It is one of the modules developers use frequently in their Elixir code.</p>

<p>Elixir also provides ranges:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">,</span> <span class="k">fn</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">end</span><span class="p">)</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;+/</span><span class="mi">2</span><span class="p">)</span>
<span class="mi">6</span>
</code></pre></div></div>

<p>The functions in the Enum module are limited to, as the name says, enumerating values in data structures. For specific operations, like inserting and updating particular elements, you may need to reach for modules specific to the data type. For example, if you want to insert an element at a given position in a list, you should use the <code class="language-plaintext highlighter-rouge">List.insert_at/3</code> function from <a href="https://hexdocs.pm/elixir/List.html">the <code class="language-plaintext highlighter-rouge">List</code> module</a>, as it would make little sense to insert a value into, for example, a range.</p>

<p>We say the functions in the <code class="language-plaintext highlighter-rouge">Enum</code> module are polymorphic because they can work with diverse data types. In particular, the functions in the <code class="language-plaintext highlighter-rouge">Enum</code> module can work with any data type that implements <a href="https://hexdocs.pm/elixir/Enumerable.html">the <code class="language-plaintext highlighter-rouge">Enumerable</code> protocol</a>. We are going to discuss Protocols in a later chapter; for now we are going to move on to a specific kind of enumerable called a stream.</p>

<h2 id="eager-vs-lazy" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Eager vs Lazy</span><a href="#eager-vs-lazy" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>All the functions in the <code class="language-plaintext highlighter-rouge">Enum</code> module are eager. Many functions expect an enumerable and return a list back:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">odd?</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">rem</span><span class="p">(</span><span class="nv">&amp;1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1">#Function&lt;6.80484245/1 in :erl_eval.expr/5&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">,</span> <span class="n">odd?</span><span class="p">)</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre></div></div>

<p>This means that when performing multiple operations with <code class="language-plaintext highlighter-rouge">Enum</code>, each operation is going to generate an intermediate list until we reach the result:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="mi">1</span><span class="o">..</span><span class="mi">100_000</span> <span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="nv">&amp;1</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span> <span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">odd?</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="mi">7500000000</span>
</code></pre></div></div>

<p>The example above has a pipeline of operations. We start with a range and then multiply each element in the range by 3. This first operation will now create and return a list with <code class="language-plaintext highlighter-rouge">100_000</code> items. Then we keep all odd elements from the list, generating a new list, now with <code class="language-plaintext highlighter-rouge">50_000</code> items, and then we sum all entries.</p>

<h2 id="the-pipe-operator" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The pipe operator</span><a href="#the-pipe-operator" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>The <code class="language-plaintext highlighter-rouge">|&gt;</code> symbol used in the snippet above is the <strong>pipe operator</strong>: it takes the output from the expression on its left side and passes it as the first argument to the function call on its right side. It’s similar to the Unix <code class="language-plaintext highlighter-rouge">|</code> operator.  Its purpose is to highlight the data being transformed by a series of functions. To see how it can make the code cleaner, have a look at the example above rewritten without using the <code class="language-plaintext highlighter-rouge">|&gt;</code> operator:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="no">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="no">Enum</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">100_000</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="nv">&amp;1</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)),</span> <span class="n">odd?</span><span class="p">))</span>
<span class="mi">7500000000</span>
</code></pre></div></div>

<p>Find more about the pipe operator <a href="https://hexdocs.pm/elixir/Kernel.html#%7C%3E/2">by reading its documentation</a>.</p>

<h2 id="streams" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Streams</span><a href="#streams" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>As an alternative to <code class="language-plaintext highlighter-rouge">Enum</code>, Elixir provides <a href="https://hexdocs.pm/elixir/Stream.html">the <code class="language-plaintext highlighter-rouge">Stream</code> module</a> which supports lazy operations:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="mi">1</span><span class="o">..</span><span class="mi">100_000</span> <span class="o">|&gt;</span> <span class="no">Stream</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="nv">&amp;1</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span> <span class="o">|&gt;</span> <span class="no">Stream</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">odd?</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">sum</span>
<span class="mi">7500000000</span>
</code></pre></div></div>

<p>Streams are lazy, composable enumerables.</p>

<p>In the example above, <code class="language-plaintext highlighter-rouge">1..100_000 |&gt; Stream.map(&amp;(&amp;1 * 3))</code> returns a data type, an actual stream, that represents the <code class="language-plaintext highlighter-rouge">map</code> computation over the range <code class="language-plaintext highlighter-rouge">1..100_000</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="mi">1</span><span class="o">..</span><span class="mi">100_000</span> <span class="o">|&gt;</span> <span class="no">Stream</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="nv">&amp;1</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span>
<span class="c1">#Stream&lt;[enum: 1..100000, funs: [#Function&lt;34.16982430/1 in Stream.map/2&gt;]]&gt;</span>
</code></pre></div></div>

<p>Furthermore, they are composable because we can pipe many stream operations:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="mi">1</span><span class="o">..</span><span class="mi">100_000</span> <span class="o">|&gt;</span> <span class="no">Stream</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="nv">&amp;1</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span> <span class="o">|&gt;</span> <span class="no">Stream</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">odd?</span><span class="p">)</span>
<span class="c1">#Stream&lt;[enum: 1..100000, funs: [...]]&gt;</span>
</code></pre></div></div>

<p>Instead of generating intermediate lists, streams build a series of computations that are invoked only when we pass the underlying stream to the <code class="language-plaintext highlighter-rouge">Enum</code> module. Streams are useful when working with large, <em>possibly infinite</em>, collections.</p>

<p>Many functions in the <code class="language-plaintext highlighter-rouge">Stream</code> module accept any enumerable as an argument and return a stream as a result. It also provides functions for creating streams. For example, <code class="language-plaintext highlighter-rouge">Stream.cycle/1</code> can be used to create a stream that cycles a given enumerable infinitely. Be careful to not call a function like <code class="language-plaintext highlighter-rouge">Enum.map/2</code> on such streams, as they would cycle forever:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="no">Stream</span><span class="o">.</span><span class="n">cycle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="c1">#Function&lt;15.16982430/2 in Stream.unfold/2&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</code></pre></div></div>

<p>On the other hand, <code class="language-plaintext highlighter-rouge">Stream.unfold/2</code> can be used to generate values from a given initial value:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="no">Stream</span><span class="o">.</span><span class="n">unfold</span><span class="p">(</span><span class="s2">"hełło"</span><span class="p">,</span> <span class="o">&amp;</span><span class="no">String</span><span class="o">.</span><span class="n">next_codepoint</span><span class="o">/</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#Function&lt;39.75994740/2 in Stream.unfold/2&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">[</span><span class="s2">"h"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">,</span> <span class="s2">"ł"</span><span class="p">]</span>
</code></pre></div></div>

<p>Another interesting function is <code class="language-plaintext highlighter-rouge">Stream.resource/3</code> which can be used to wrap around resources, guaranteeing they are opened right before enumeration and closed afterwards, even in the case of failures. For example, <code class="language-plaintext highlighter-rouge">File.stream!/1</code> builds on top of <code class="language-plaintext highlighter-rouge">Stream.resource/3</code> to stream files:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">stream!</span><span class="p">(</span><span class="s2">"path/to/file"</span><span class="p">)</span>
<span class="p">%</span><span class="no">File</span><span class="o">.</span><span class="no">Stream</span><span class="p">{</span>
  <span class="ss">line_or_bytes:</span> <span class="ss">:line</span><span class="p">,</span>
  <span class="ss">modes:</span> <span class="p">[</span><span class="ss">:raw</span><span class="p">,</span> <span class="ss">:read_ahead</span><span class="p">,</span> <span class="ss">:binary</span><span class="p">],</span>
  <span class="ss">path:</span> <span class="s2">"path/to/file"</span><span class="p">,</span>
  <span class="ss">raw:</span> <span class="no">true</span>
<span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<p>The example above will fetch the first 10 lines of the file you have selected. This means streams can be very useful for handling large files or even slow resources like network resources.</p>

<p>The amount of functionality in the <a href="https://hexdocs.pm/elixir/Enum.html"><code class="language-plaintext highlighter-rouge">Enum</code></a> and <a href="https://hexdocs.pm/elixir/Stream.html"><code class="language-plaintext highlighter-rouge">Stream</code></a> modules can be daunting at first, but you will get familiar with them case by case. In particular, focus on the <code class="language-plaintext highlighter-rouge">Enum</code> module first and only move to <code class="language-plaintext highlighter-rouge">Stream</code> for the particular scenarios where laziness is required, to either deal with slow resources or large, possibly infinite, collections.</p>

<p>Next, we’ll look at a feature central to Elixir, Processes, which allows us to write concurrent, parallel and distributed programs in an easy and understandable way.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/recursion.html" class="previous page-numbers spec" title="Recursion">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/processes.html" class="previous page-numbers spec" title="Processes">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/enumerables-and-streams.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/processes.html" page=":11:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><span title="Processes">Processes</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Processes</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#spawn"><code class="language-plaintext highlighter-rouge">spawn</code></a></li><li><a href="#send-and-receive"><code class="language-plaintext highlighter-rouge">send</code> and <code class="language-plaintext highlighter-rouge">receive</code></a></li><li><a href="#links">Links</a></li><li><a href="#tasks">Tasks</a></li><li><a href="#state">State</a></li></ol></div>

    <p>In Elixir, all code runs inside processes. Processes are isolated from each other, run concurrent to one another and communicate via message passing. Processes are not only the basis for concurrency in Elixir, but they also provide the means for building distributed and fault-tolerant programs.</p>

<p>Elixir’s processes should not be confused with operating system processes. Processes in Elixir are extremely lightweight in terms of memory and CPU (even compared to threads as used in many other programming languages). Because of this, it is not uncommon to have tens or even hundreds of thousands of processes running simultaneously.</p>

<p>In this chapter, we will learn about the basic constructs for spawning new processes, as well as sending and receiving messages between processes.</p>

<h2 id="spawn" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper"><code class="language-plaintext highlighter-rouge">spawn</code></span><a href="#spawn" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>The basic mechanism for spawning new processes is the auto-imported <code class="language-plaintext highlighter-rouge">spawn/1</code> function:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">spawn</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="k">end</span><span class="p">)</span>
<span class="c1">#PID&lt;0.43.0&gt;</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">spawn/1</code> takes a function which it will execute in another process.</p>

<p>Notice <code class="language-plaintext highlighter-rouge">spawn/1</code> returns a PID (process identifier). At this point, the process you spawned is very likely dead. The spawned process will execute the given function and exit after the function is done:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">pid</span> <span class="o">=</span> <span class="n">spawn</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="k">end</span><span class="p">)</span>
<span class="c1">#PID&lt;0.44.0&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Process</span><span class="o">.</span><span class="n">alive?</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
<span class="no">false</span>
</code></pre></div></div>

<blockquote>
  <p>Note: you will likely get different process identifiers than the ones we are getting in this guide.</p>
</blockquote>

<p>We can retrieve the PID of the current process by calling <code class="language-plaintext highlighter-rouge">self/0</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">self</span><span class="p">()</span>
<span class="c1">#PID&lt;0.41.0&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Process</span><span class="o">.</span><span class="n">alive?</span><span class="p">(</span><span class="n">self</span><span class="p">())</span>
<span class="no">true</span>
</code></pre></div></div>

<p>Processes get much more interesting when we are able to send and receive messages.</p>

<h2 id="send-and-receive" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper"><code class="language-plaintext highlighter-rouge">send</code> and <code class="language-plaintext highlighter-rouge">receive</code></span><a href="#send-and-receive" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>We can send messages to a process with <code class="language-plaintext highlighter-rouge">send/2</code> and receive them with <code class="language-plaintext highlighter-rouge">receive/1</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">send</span><span class="p">(</span><span class="n">self</span><span class="p">(),</span> <span class="p">{</span><span class="ss">:hello</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">})</span>
<span class="p">{</span><span class="ss">:hello</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="k">receive</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="p">{</span><span class="ss">:hello</span><span class="p">,</span> <span class="n">msg</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="n">msg</span>
<span class="o">...&gt;</span>   <span class="p">{</span><span class="ss">:world</span><span class="p">,</span> <span class="n">_msg</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="s2">"won't match"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="s2">"world"</span>
</code></pre></div></div>

<p>When a message is sent to a process, the message is stored in the process mailbox. The <code class="language-plaintext highlighter-rouge">receive/1</code> block goes through the current process mailbox searching for a message that matches any of the given patterns. <code class="language-plaintext highlighter-rouge">receive/1</code> supports guards and many clauses, such as <code class="language-plaintext highlighter-rouge">case/2</code>.</p>

<p>The process that sends the message does not block on <code class="language-plaintext highlighter-rouge">send/2</code>, it puts the message in the recipient’s mailbox and continues. In particular, a process can send messages to itself.</p>

<p>If there is no message in the mailbox matching any of the patterns, the current process will wait until a matching message arrives. A timeout can also be specified:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">receive</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="p">{</span><span class="ss">:hello</span><span class="p">,</span> <span class="n">msg</span><span class="p">}</span>  <span class="o">-&gt;</span> <span class="n">msg</span>
<span class="o">...&gt;</span> <span class="k">after</span>
<span class="o">...&gt;</span>   <span class="mi">1_000</span> <span class="o">-&gt;</span> <span class="s2">"nothing after 1s"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="s2">"nothing after 1s"</span>
</code></pre></div></div>

<p>A timeout of 0 can be given when you already expect the message to be in the mailbox.</p>

<p>Let’s put it all together and send messages between processes:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">self</span><span class="p">()</span>
<span class="c1">#PID&lt;0.41.0&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">spawn</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span> <span class="n">send</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="p">{</span><span class="ss">:hello</span><span class="p">,</span> <span class="n">self</span><span class="p">()})</span> <span class="k">end</span><span class="p">)</span>
<span class="c1">#PID&lt;0.48.0&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="k">receive</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="p">{</span><span class="ss">:hello</span><span class="p">,</span> <span class="n">pid</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="s2">"Got hello from </span><span class="si">#{</span><span class="n">inspect</span> <span class="n">pid</span><span class="si">}</span><span class="s2">"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="s2">"Got hello from #PID&lt;0.48.0&gt;"</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">inspect/1</code> function is used to convert a data structure’s internal representation into a string, typically for printing. Notice that when the <code class="language-plaintext highlighter-rouge">receive</code> block gets executed the sender process we have spawned may already be dead, as its only instruction was to send a message.</p>

<p>While in the shell, you may find the helper <code class="language-plaintext highlighter-rouge">flush/0</code> quite useful. It flushes and prints all the messages in the mailbox.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">send</span><span class="p">(</span><span class="n">self</span><span class="p">(),</span> <span class="ss">:hello</span><span class="p">)</span>
<span class="ss">:hello</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">flush</span><span class="p">()</span>
<span class="ss">:hello</span>
<span class="ss">:ok</span>
</code></pre></div></div>

<h2 id="links" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Links</span><a href="#links" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>The majority of times we spawn processes in Elixir, we spawn them as linked processes. Before we show an example with <code class="language-plaintext highlighter-rouge">spawn_link/1</code>, let’s see what happens when a process started with <code class="language-plaintext highlighter-rouge">spawn/1</code> fails:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">spawn</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span> <span class="k">raise</span> <span class="s2">"oops"</span> <span class="k">end</span><span class="p">)</span>
<span class="c1">#PID&lt;0.58.0&gt;</span>

<span class="p">[</span><span class="n">error</span><span class="p">]</span> <span class="no">Process</span> <span class="c1">#PID&lt;0.58.00&gt; raised an exception</span>
<span class="o">**</span> <span class="p">(</span><span class="no">RuntimeError</span><span class="p">)</span> <span class="n">oops</span>
    <span class="p">(</span><span class="n">stdlib</span><span class="p">)</span> <span class="n">erl_eval</span><span class="o">.</span><span class="ss">erl:</span><span class="mi">668</span><span class="p">:</span> <span class="ss">:erl_eval</span><span class="o">.</span><span class="n">do_apply</span><span class="o">/</span><span class="mi">6</span>
</code></pre></div></div>

<p>It merely logged an error but the parent process is still running. That’s because processes are isolated. If we want the failure in one process to propagate to another one, we should link them. This can be done with <code class="language-plaintext highlighter-rouge">spawn_link/1</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">self</span><span class="p">()</span>
<span class="c1">#PID&lt;0.41.0&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">spawn_link</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span> <span class="k">raise</span> <span class="s2">"oops"</span> <span class="k">end</span><span class="p">)</span>

<span class="o">**</span> <span class="p">(</span><span class="no">EXIT</span> <span class="n">from</span> <span class="c1">#PID&lt;0.41.0&gt;) evaluator process exited with reason: an exception was raised:</span>
    <span class="o">**</span> <span class="p">(</span><span class="no">RuntimeError</span><span class="p">)</span> <span class="n">oops</span>
        <span class="p">(</span><span class="n">stdlib</span><span class="p">)</span> <span class="n">erl_eval</span><span class="o">.</span><span class="ss">erl:</span><span class="mi">668</span><span class="p">:</span> <span class="ss">:erl_eval</span><span class="o">.</span><span class="n">do_apply</span><span class="o">/</span><span class="mi">6</span>

<span class="p">[</span><span class="n">error</span><span class="p">]</span> <span class="no">Process</span> <span class="c1">#PID&lt;0.289.0&gt; raised an exception</span>
<span class="o">**</span> <span class="p">(</span><span class="no">RuntimeError</span><span class="p">)</span> <span class="n">oops</span>
    <span class="p">(</span><span class="n">stdlib</span><span class="p">)</span> <span class="n">erl_eval</span><span class="o">.</span><span class="ss">erl:</span><span class="mi">668</span><span class="p">:</span> <span class="ss">:erl_eval</span><span class="o">.</span><span class="n">do_apply</span><span class="o">/</span><span class="mi">6</span>
</code></pre></div></div>

<p>Because processes are linked, we now see a message saying the parent process, which is the shell process, has received an EXIT signal from another process causing the shell to terminate. IEx detects this situation and starts a new shell session.</p>

<p>Linking can also be done manually by calling <code class="language-plaintext highlighter-rouge">Process.link/1</code>. We recommend that you take a look at <a href="https://hexdocs.pm/elixir/Process.html">the <code class="language-plaintext highlighter-rouge">Process</code> module</a> for other functionality provided by processes.</p>

<p>Processes and links play an important role when building fault-tolerant systems. Elixir processes are isolated and don’t share anything by default. Therefore, a failure in a process will never crash or corrupt the state of another process. Links, however, allow processes to establish a relationship in case of failure. We often link our processes to supervisors which will detect when a process dies and start a new process in its place.</p>

<p>While other languages would require us to catch/handle exceptions, in Elixir we are actually fine with letting processes fail because we expect supervisors to properly restart our systems. “Failing fast” (sometimes referred as “let it crash”) is a common philosophy when writing Elixir software!</p>

<p><code class="language-plaintext highlighter-rouge">spawn/1</code> and <code class="language-plaintext highlighter-rouge">spawn_link/1</code> are the basic primitives for creating processes in Elixir. Although we have used them exclusively so far, most of the time we are going to use abstractions that build on top of them. Let’s see the most common one, called tasks.</p>

<h2 id="tasks" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Tasks</span><a href="#tasks" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Tasks build on top of the spawn functions to provide better error reports and introspection:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Task</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span> <span class="k">raise</span> <span class="s2">"oops"</span> <span class="k">end</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="c1">#PID&lt;0.55.0&gt;}</span>

<span class="mi">15</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mf">33.046</span> <span class="p">[</span><span class="n">error</span><span class="p">]</span> <span class="no">Task</span> <span class="c1">#PID&lt;0.55.0&gt; started from #PID&lt;0.53.0&gt; terminating</span>
<span class="o">**</span> <span class="p">(</span><span class="no">RuntimeError</span><span class="p">)</span> <span class="n">oops</span>
    <span class="p">(</span><span class="n">stdlib</span><span class="p">)</span> <span class="n">erl_eval</span><span class="o">.</span><span class="ss">erl:</span><span class="mi">668</span><span class="p">:</span> <span class="ss">:erl_eval</span><span class="o">.</span><span class="n">do_apply</span><span class="o">/</span><span class="mi">6</span>
    <span class="p">(</span><span class="n">elixir</span><span class="p">)</span> <span class="n">lib</span><span class="o">/</span><span class="n">task</span><span class="o">/</span><span class="n">supervised</span><span class="o">.</span><span class="ss">ex:</span><span class="mi">85</span><span class="p">:</span> <span class="no">Task</span><span class="o">.</span><span class="no">Supervised</span><span class="o">.</span><span class="n">do_apply</span><span class="o">/</span><span class="mi">2</span>
    <span class="p">(</span><span class="n">stdlib</span><span class="p">)</span> <span class="n">proc_lib</span><span class="o">.</span><span class="ss">erl:</span><span class="mi">247</span><span class="p">:</span> <span class="ss">:proc_lib</span><span class="o">.</span><span class="n">init_p_do_apply</span><span class="o">/</span><span class="mi">3</span>
<span class="ss">Function:</span> <span class="c1">#Function&lt;20.99386804/0 in :erl_eval.expr/5&gt;</span>
    <span class="ss">Args:</span> <span class="p">[]</span>
</code></pre></div></div>

<p>Instead of <code class="language-plaintext highlighter-rouge">spawn/1</code> and <code class="language-plaintext highlighter-rouge">spawn_link/1</code>, we use <code class="language-plaintext highlighter-rouge">Task.start/1</code> and <code class="language-plaintext highlighter-rouge">Task.start_link/1</code> which return <code class="language-plaintext highlighter-rouge">{:ok, pid}</code> rather than just the PID. This is what enables tasks to be used in supervision trees. Furthermore, <code class="language-plaintext highlighter-rouge">Task</code> provides convenience functions, like <code class="language-plaintext highlighter-rouge">Task.async/1</code> and <code class="language-plaintext highlighter-rouge">Task.await/1</code>, and functionality to ease distribution.</p>

<p>We will explore those functionalities in the <strong><em>Mix and OTP guide</em></strong>, for now it is enough to remember to use <code class="language-plaintext highlighter-rouge">Task</code> to get better error reports.</p>

<h2 id="state" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">State</span><a href="#state" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>We haven’t talked about state so far in this guide. If you are building an application that requires state, for example, to keep your application configuration, or you need to parse a file and keep it in memory, where would you store it?</p>

<p>Processes are the most common answer to this question. We can write processes that loop infinitely, maintain state, and send and receive messages. As an example, let’s write a module that starts new processes that work as a key-value store in a file named <code class="language-plaintext highlighter-rouge">kv.exs</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KV</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">start_link</span> <span class="k">do</span>
    <span class="no">Task</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span> <span class="k">loop</span><span class="p">(%{})</span> <span class="k">end</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="k">loop</span><span class="p">(</span><span class="n">map</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">receive</span> <span class="k">do</span>
      <span class="p">{</span><span class="ss">:get</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">caller</span><span class="p">}</span> <span class="o">-&gt;</span>
        <span class="n">send</span> <span class="n">caller</span><span class="p">,</span> <span class="no">Map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">loop</span><span class="p">(</span><span class="n">map</span><span class="p">)</span>
      <span class="p">{</span><span class="ss">:put</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">}</span> <span class="o">-&gt;</span>
        <span class="k">loop</span><span class="p">(</span><span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Note that the <code class="language-plaintext highlighter-rouge">start_link</code> function starts a new process that runs the <code class="language-plaintext highlighter-rouge">loop/1</code> function, starting with an empty map. The <code class="language-plaintext highlighter-rouge">loop/1</code> (private) function then waits for messages and performs the appropriate action for each message. We made <code class="language-plaintext highlighter-rouge">loop/1</code> private by using <code class="language-plaintext highlighter-rouge">defp</code> instead of <code class="language-plaintext highlighter-rouge">def</code>. In the case of a <code class="language-plaintext highlighter-rouge">:get</code> message, it sends a message back to the caller and calls <code class="language-plaintext highlighter-rouge">loop/1</code> again, to wait for a new message. While the <code class="language-plaintext highlighter-rouge">:put</code> message actually invokes <code class="language-plaintext highlighter-rouge">loop/1</code> with a new version of the map, with the given <code class="language-plaintext highlighter-rouge">key</code> and <code class="language-plaintext highlighter-rouge">value</code> stored.</p>

<p>Let’s give it a try by running <code class="language-plaintext highlighter-rouge">iex kv.exs</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">pid</span><span class="p">}</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="n">start_link</span><span class="p">()</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="c1">#PID&lt;0.62.0&gt;}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">send</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="p">{</span><span class="ss">:get</span><span class="p">,</span> <span class="ss">:hello</span><span class="p">,</span> <span class="n">self</span><span class="p">()})</span>
<span class="p">{</span><span class="ss">:get</span><span class="p">,</span> <span class="ss">:hello</span><span class="p">,</span> <span class="c1">#PID&lt;0.41.0&gt;}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">flush</span><span class="p">()</span>
<span class="no">nil</span>
<span class="ss">:ok</span>
</code></pre></div></div>

<p>At first, the process map has no keys, so sending a <code class="language-plaintext highlighter-rouge">:get</code> message and then flushing the current process inbox returns <code class="language-plaintext highlighter-rouge">nil</code>. Let’s send a <code class="language-plaintext highlighter-rouge">:put</code> message and try it again:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">send</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="p">{</span><span class="ss">:put</span><span class="p">,</span> <span class="ss">:hello</span><span class="p">,</span> <span class="ss">:world</span><span class="p">})</span>
<span class="p">{</span><span class="ss">:put</span><span class="p">,</span> <span class="ss">:hello</span><span class="p">,</span> <span class="ss">:world</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">send</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="p">{</span><span class="ss">:get</span><span class="p">,</span> <span class="ss">:hello</span><span class="p">,</span> <span class="n">self</span><span class="p">()})</span>
<span class="p">{</span><span class="ss">:get</span><span class="p">,</span> <span class="ss">:hello</span><span class="p">,</span> <span class="c1">#PID&lt;0.41.0&gt;}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">flush</span><span class="p">()</span>
<span class="ss">:world</span>
<span class="ss">:ok</span>
</code></pre></div></div>

<p>Notice how the process is keeping a state and we can get and update this state by sending the process messages. In fact, any process that knows the <code class="language-plaintext highlighter-rouge">pid</code> above will be able to send it messages and manipulate the state.</p>

<p>It is also possible to register the <code class="language-plaintext highlighter-rouge">pid</code>, giving it a name, and allowing everyone that knows the name to send it messages:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Process</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="ss">:kv</span><span class="p">)</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">send</span><span class="p">(</span><span class="ss">:kv</span><span class="p">,</span> <span class="p">{</span><span class="ss">:get</span><span class="p">,</span> <span class="ss">:hello</span><span class="p">,</span> <span class="n">self</span><span class="p">()})</span>
<span class="p">{</span><span class="ss">:get</span><span class="p">,</span> <span class="ss">:hello</span><span class="p">,</span> <span class="c1">#PID&lt;0.41.0&gt;}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">flush</span><span class="p">()</span>
<span class="ss">:world</span>
<span class="ss">:ok</span>
</code></pre></div></div>

<p>Using processes to maintain state and name registration are very common patterns in Elixir applications. However, most of the time, we won’t implement those patterns manually as above, but by using one of the many abstractions that ship with Elixir. For example, Elixir provides <a href="https://hexdocs.pm/elixir/Agent.html">agents</a>, which are simple abstractions around state:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">pid</span><span class="p">}</span> <span class="o">=</span> <span class="no">Agent</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span> <span class="p">%{}</span> <span class="k">end</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="c1">#PID&lt;0.72.0&gt;}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Agent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="k">fn</span> <span class="n">map</span> <span class="o">-&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="ss">:hello</span><span class="p">,</span> <span class="ss">:world</span><span class="p">)</span> <span class="k">end</span><span class="p">)</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Agent</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="k">fn</span> <span class="n">map</span> <span class="o">-&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="ss">:hello</span><span class="p">)</span> <span class="k">end</span><span class="p">)</span>
<span class="ss">:world</span>
</code></pre></div></div>

<p>A <code class="language-plaintext highlighter-rouge">:name</code> option could also be given to <code class="language-plaintext highlighter-rouge">Agent.start_link/2</code> and it would be automatically registered. Besides agents, Elixir provides an API for building generic servers (called <code class="language-plaintext highlighter-rouge">GenServer</code>), tasks, and more, all powered by processes underneath. Those, along with supervision trees, will be explored with more detail in the <strong><em>Mix and OTP guide</em></strong> which will build a complete Elixir application from start to finish.</p>

<p>For now, let’s move on and explore the world of I/O in Elixir.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/enumerables-and-streams.html" class="previous page-numbers spec" title="Enumerables and streams">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/io-and-the-file-system.html" class="previous page-numbers spec" title="IO and the file system">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/processes.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/io-and-the-file-system.html" page=":12:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><span title="IO and the file system">IO and the file system</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>IO and the file system</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#the-io-module">The <code class="language-plaintext highlighter-rouge">IO</code> module</a></li><li><a href="#the-file-module">The <code class="language-plaintext highlighter-rouge">File</code> module</a></li><li><a href="#the-path-module">The <code class="language-plaintext highlighter-rouge">Path</code> module</a></li><li><a href="#processes">Processes</a></li><li><a href="#iodata-and-chardata"><code class="language-plaintext highlighter-rouge">iodata</code> and <code class="language-plaintext highlighter-rouge">chardata</code></a></li></ol></div>

    <p>This chapter is a quick introduction to input/output mechanisms and file-system-related tasks, as well as to related modules like <a href="https://hexdocs.pm/elixir/IO.html"><code class="language-plaintext highlighter-rouge">IO</code></a>, <a href="https://hexdocs.pm/elixir/File.html"><code class="language-plaintext highlighter-rouge">File</code></a> and <a href="https://hexdocs.pm/elixir/Path.html"><code class="language-plaintext highlighter-rouge">Path</code></a>.</p>

<p>We had originally sketched this chapter to come much earlier in the getting started guide. However, we noticed the IO system provides a great opportunity to shed some light on some philosophies and curiosities of Elixir and the <abbr title="Virtual Machine">VM</abbr>.</p>

<h2 id="the-io-module" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The <code class="language-plaintext highlighter-rouge">IO</code> module</span><a href="#the-io-module" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>The <a href="https://hexdocs.pm/elixir/IO.html"><code class="language-plaintext highlighter-rouge">IO</code></a> module is the main mechanism in Elixir for reading and writing to standard input/output (<code class="language-plaintext highlighter-rouge">:stdio</code>), standard error (<code class="language-plaintext highlighter-rouge">:stderr</code>), files, and other IO devices. Usage of the module is pretty straightforward:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="s2">"hello world"</span><span class="p">)</span>
<span class="n">hello</span> <span class="n">world</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">gets</span><span class="p">(</span><span class="s2">"yes or no? "</span><span class="p">)</span>
<span class="n">yes</span> <span class="ow">or</span> <span class="n">no?</span> <span class="n">yes</span>
<span class="s2">"yes</span><span class="se">\n</span><span class="s2">"</span>
</code></pre></div></div>

<p>By default, functions in the <code class="language-plaintext highlighter-rouge">IO</code> module read from the standard input and write to the standard output. We can change that by passing, for example, <code class="language-plaintext highlighter-rouge">:stderr</code> as an argument (in order to write to the standard error device):</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="ss">:stderr</span><span class="p">,</span> <span class="s2">"hello world"</span><span class="p">)</span>
<span class="n">hello</span> <span class="n">world</span>
<span class="ss">:ok</span>
</code></pre></div></div>

<h2 id="the-file-module" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The <code class="language-plaintext highlighter-rouge">File</code> module</span><a href="#the-file-module" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>The <a href="https://hexdocs.pm/elixir/File.html"><code class="language-plaintext highlighter-rouge">File</code></a> module contains functions that allow us to open files as IO devices. By default, files are opened in binary mode, which requires developers to use the specific <code class="language-plaintext highlighter-rouge">IO.binread/2</code> and <code class="language-plaintext highlighter-rouge">IO.binwrite/2</code> functions from the <code class="language-plaintext highlighter-rouge">IO</code> module:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">file</span><span class="p">}</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">"path/to/file/hello"</span><span class="p">,</span> <span class="p">[</span><span class="ss">:write</span><span class="p">])</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="c1">#PID&lt;0.47.0&gt;}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">binwrite</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">)</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">"path/to/file/hello"</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">}</span>
</code></pre></div></div>

<p>A file can also be opened with <code class="language-plaintext highlighter-rouge">:utf8</code> encoding, which tells the <code class="language-plaintext highlighter-rouge">File</code> module to interpret the bytes read from the file as UTF-8-encoded bytes.</p>

<p>Besides functions for opening, reading and writing files, the <code class="language-plaintext highlighter-rouge">File</code> module has many functions to work with the file system. Those functions are named after their UNIX equivalents. For example, <code class="language-plaintext highlighter-rouge">File.rm/1</code> can be used to remove files, <code class="language-plaintext highlighter-rouge">File.mkdir/1</code> to create directories, <code class="language-plaintext highlighter-rouge">File.mkdir_p/1</code> to create directories and all their parent chain. There are even <code class="language-plaintext highlighter-rouge">File.cp_r/2</code> and <code class="language-plaintext highlighter-rouge">File.rm_rf/1</code> to respectively copy and remove files and directories recursively (i.e., copying and removing the contents of the directories too).</p>

<p>You will also notice that functions in the <code class="language-plaintext highlighter-rouge">File</code> module have two variants: one “regular” variant and another variant with a trailing bang (<code class="language-plaintext highlighter-rouge">!</code>). For example, when we read the <code class="language-plaintext highlighter-rouge">"hello"</code> file in the example above, we use <code class="language-plaintext highlighter-rouge">File.read/1</code>. Alternatively, we can use <code class="language-plaintext highlighter-rouge">File.read!/1</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">"path/to/file/hello"</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">read!</span><span class="p">(</span><span class="s2">"path/to/file/hello"</span><span class="p">)</span>
<span class="s2">"world"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">"path/to/file/unknown"</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="ss">:enoent</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">read!</span><span class="p">(</span><span class="s2">"path/to/file/unknown"</span><span class="p">)</span>
<span class="o">**</span> <span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="no">Error</span><span class="p">)</span> <span class="n">could</span> <span class="ow">not</span> <span class="n">read</span> <span class="n">file</span> <span class="s2">"path/to/file/unknown"</span><span class="p">:</span> <span class="n">no</span> <span class="n">such</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">directory</span>
</code></pre></div></div>

<p>Notice that the version with <code class="language-plaintext highlighter-rouge">!</code> returns the contents of the file instead of a tuple, and if anything goes wrong the function raises an error.</p>

<p>The version without <code class="language-plaintext highlighter-rouge">!</code> is preferred when you want to handle different outcomes using pattern matching:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">"path/to/file/hello"</span><span class="p">)</span> <span class="k">do</span>
  <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">body</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="c1"># do something with the `body`</span>
  <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="n">reason</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="c1"># handle the error caused by `reason`</span>
<span class="k">end</span>
</code></pre></div></div>

<p>However, if you expect the file to be there, the bang variation is more useful as it raises a meaningful error message. Avoid writing:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">body</span><span class="p">}</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">"path/to/file/unknown"</span><span class="p">)</span>
</code></pre></div></div>

<p>as, in case of an error, <code class="language-plaintext highlighter-rouge">File.read/1</code> will return <code class="language-plaintext highlighter-rouge">{:error, reason}</code> and the pattern matching will fail. You will still get the desired result (a raised error), but the message will be about the pattern which doesn’t match (thus being cryptic in respect to what the error actually is about).</p>

<p>Therefore, if you don’t want to handle the error outcomes, prefer to use the functions ending with an exclamation mark, such as <code class="language-plaintext highlighter-rouge">File.read!/1</code>.</p>

<h2 id="the-path-module" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The <code class="language-plaintext highlighter-rouge">Path</code> module</span><a href="#the-path-module" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>The majority of the functions in the <code class="language-plaintext highlighter-rouge">File</code> module expect paths as arguments. Most commonly, those paths will be regular binaries. The <a href="https://hexdocs.pm/elixir/Path.html"><code class="language-plaintext highlighter-rouge">Path</code></a> module provides facilities for working with such paths:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">)</span>
<span class="s2">"foo/bar"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Path</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="s2">"~/hello"</span><span class="p">)</span>
<span class="s2">"/Users/jose/hello"</span>
</code></pre></div></div>

<p>Using functions from the <code class="language-plaintext highlighter-rouge">Path</code> module as opposed to directly manipulating strings is preferred since the <code class="language-plaintext highlighter-rouge">Path</code> module takes care of different operating systems transparently. Finally, keep in mind that Elixir will automatically convert slashes (<code class="language-plaintext highlighter-rouge">/</code>) into backslashes (<code class="language-plaintext highlighter-rouge">\</code>) on Windows when performing file operations.</p>

<p>With this, we have covered the main modules that Elixir provides for dealing with IO and interacting with the file system. In the next section, we will peek a bit under the covers and learn how the IO system is implemented in the <abbr title="Virtual Machine">VM</abbr>.</p>

<h2 id="processes" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Processes</span><a href="#processes" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>You may have noticed that <code class="language-plaintext highlighter-rouge">File.open/2</code> returns a tuple like <code class="language-plaintext highlighter-rouge">{:ok, pid}</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">file</span><span class="p">}</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">,</span> <span class="p">[</span><span class="ss">:write</span><span class="p">])</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="c1">#PID&lt;0.47.0&gt;}</span>
</code></pre></div></div>

<p>This happens because the <code class="language-plaintext highlighter-rouge">IO</code> module actually works with processes (see <a href="/getting-started/processes.html">chapter 11</a>). Given a file is a process, when you write to a file that has been closed, you are actually sending a message to a process which has been terminated:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">"is anybody out there"</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="ss">:terminated</span><span class="p">}</span>
</code></pre></div></div>

<p>Let’s see in more detail what happens when you request <code class="language-plaintext highlighter-rouge">IO.write(pid, binary)</code>. The <code class="language-plaintext highlighter-rouge">IO</code> module sends a message to the process identified by <code class="language-plaintext highlighter-rouge">pid</code> with the desired operation. A small ad-hoc process can help us see it:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">pid</span> <span class="o">=</span> <span class="n">spawn</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>  <span class="k">receive</span> <span class="k">do</span><span class="p">:</span> <span class="p">(</span><span class="n">msg</span> <span class="o">-&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">inspect</span> <span class="n">msg</span><span class="p">)</span>
<span class="o">...&gt;</span> <span class="k">end</span><span class="p">)</span>
<span class="c1">#PID&lt;0.57.0&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="s2">"hello"</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:io_request</span><span class="p">,</span> <span class="c1">#PID&lt;0.41.0&gt;, #Reference&lt;0.0.8.91&gt;,</span>
 <span class="p">{</span><span class="ss">:put_chars</span><span class="p">,</span> <span class="ss">:unicode</span><span class="p">,</span> <span class="s2">"hello"</span><span class="p">}}</span>
<span class="o">**</span> <span class="p">(</span><span class="no">ErlangError</span><span class="p">)</span> <span class="n">erlang</span> <span class="ss">error:</span> <span class="ss">:terminated</span>
</code></pre></div></div>

<p>After <code class="language-plaintext highlighter-rouge">IO.write/2</code>, we can see the request sent by the <code class="language-plaintext highlighter-rouge">IO</code> module printed out (a four-elements tuple). Soon after that, we see that it fails since the <code class="language-plaintext highlighter-rouge">IO</code> module expected some kind of result, which we did not supply.</p>

<p>By modeling IO devices with processes, the Erlang <abbr title="Virtual Machine">VM</abbr> allows IO messages to be routed between different nodes running Distributed Erlang or even exchange files to perform read/write operations across nodes. Neat!</p>

<h2 id="iodata-and-chardata" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper"><code class="language-plaintext highlighter-rouge">iodata</code> and <code class="language-plaintext highlighter-rouge">chardata</code></span><a href="#iodata-and-chardata" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>In all of the examples above, we used binaries when writing to files. However, most of the IO functions in Elixir also accept either “iodata” or “chardata”.</p>

<p>One of the main reasons for using “iodata” and “chardata” is for performance. For example,
imagine you need to greet someone in your application:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">name</span> <span class="o">=</span> <span class="s2">"Mary"</span>
<span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="s2">"Hello "</span> <span class="o">&lt;&gt;</span> <span class="n">name</span> <span class="o">&lt;&gt;</span> <span class="s2">"!"</span><span class="p">)</span>
</code></pre></div></div>

<p>Given strings in Elixir are immutable, as most data structures, the example above will copy the string “Mary” into the new “Hello Mary!” string. While this is unlikely to matter for the short string as above, copying can be quite expensive for large strings! For this reason, the IO functions in Elixir allow you to pass instead a list of strings:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">name</span> <span class="o">=</span> <span class="s2">"Mary"</span>
<span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">([</span><span class="s2">"Hello "</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s2">"!"</span><span class="p">])</span>
</code></pre></div></div>

<p>In the example above, there is no copying. Instead we create a list that contains the original name. We call such lists either “iodata” or “chardata” and we will learn the precise difference between them soon.</p>

<p>Those lists are very useful because it can actually simplify the processing strings in several scenarios. For example, imagine you have a list of values, such as <code class="language-plaintext highlighter-rouge">["apple", "banana", "lemon"]</code> that you want to write to disk separated by commas. How can you achieve this?</p>

<p>One option is to use <code class="language-plaintext highlighter-rouge">Enum.join/2</code> and convert the values to a string:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">"apple"</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="s2">"lemon"</span><span class="p">],</span> <span class="s2">","</span><span class="p">)</span>
<span class="s2">"apple,banana,lemon"</span>
</code></pre></div></div>

<p>The above returns a new string by copying each value into the new string. However, with the knowledge in this section, we know that we can pass a list of strings to the IO/File functions. So instead we can do:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">intersperse</span><span class="p">([</span><span class="s2">"apple"</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="s2">"lemon"</span><span class="p">],</span> <span class="s2">","</span><span class="p">)</span>
<span class="p">[</span><span class="s2">"apple"</span><span class="p">,</span> <span class="s2">","</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="s2">","</span><span class="p">,</span> <span class="s2">"lemon"</span><span class="p">]</span>
</code></pre></div></div>

<p>“iodata” and “chardata” do not only contain strings, but they may contain arbitrary nested lists of strings too:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">([</span><span class="s2">"apple"</span><span class="p">,</span> <span class="p">[</span><span class="s2">","</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="p">[</span><span class="s2">","</span><span class="p">,</span> <span class="s2">"lemon"</span><span class="p">]]])</span>
</code></pre></div></div>

<p>“iodata” and “chardata” may also contain integers. For example, we could print our comma separated list of values by using <code class="language-plaintext highlighter-rouge">?,</code> as separator, which is the integer representing a comma (<code class="language-plaintext highlighter-rouge">44</code>):</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">([</span><span class="s2">"apple"</span><span class="p">,</span> <span class="sx">?,</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="sx">?,</span><span class="p">,</span> <span class="s2">"lemon"</span><span class="p">])</span>
</code></pre></div></div>

<p>The difference between “iodata” and “chardata” is precisely what said integer represents. For iodata, the integers represent bytes. For chardata, the integers represent Unicode codepoints. For ASCII characters, the byte representation is the same as the codepoint representation, so it fits both classifications. However, the default IO device works with chardata, which means we can do:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">([</span><span class="sx">?O</span><span class="p">,</span> <span class="sx">?l</span><span class="p">,</span> <span class="sx">?á</span><span class="p">,</span> <span class="err">?</span><span class="p">\</span><span class="n">s</span><span class="p">,</span> <span class="s2">"Mary"</span><span class="p">,</span> <span class="sx">?!</span><span class="p">])</span>
</code></pre></div></div>

<p>Overall, integers in a list may represent either a bunch of bytes or a bunch of characters and which one to use depends on the encoding of the IO device. If the file is opened without encoding, the file is expected to be in raw mode, and the functions in the <code class="language-plaintext highlighter-rouge">IO</code> module starting with <code class="language-plaintext highlighter-rouge">bin*</code> must be used. Those functions expect an <code class="language-plaintext highlighter-rouge">iodata</code> as an argument, where integers in the list would represent bytes.</p>

<p>On the other hand, the default IO device (<code class="language-plaintext highlighter-rouge">:stdio</code>) and files opened with <code class="language-plaintext highlighter-rouge">:utf8</code> encoding work with the remaining functions in the <code class="language-plaintext highlighter-rouge">IO</code> module. Those functions expect a <code class="language-plaintext highlighter-rouge">chardata</code> as an argument, where integers represent codepoints.</p>

<p>Although this is a subtle difference, you only need to worry about these details if you intend to pass lists containing integers to those functions. If you pass binaries, or list of binaries, then there is no ambiguity.</p>

<p>Finally, there is one last construct called charlist, which is a special case of chardata where we have a list in which all of its values are integers representing Unicode codepoints. They can be created with the <code class="language-plaintext highlighter-rouge">~c</code> sigil:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="sx">~c"hello"</span>
<span class="sx">~c"hello"</span>
</code></pre></div></div>

<blockquote>
  <p>Note: the above is printed as ‘hello’ in Elixir v1.14 and earlier, which is the deprecated syntax for charlists.</p>
</blockquote>

<p>They mostly show up when interfacing with Erlang, as some Erlang APIs use charlist as their representation for strings. For this reason, any list containing printable ASCII codepoints will be printed as a charlist:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="sx">?a</span><span class="p">,</span> <span class="sx">?b</span><span class="p">,</span> <span class="sx">?c</span><span class="p">]</span>
<span class="sx">~c"abc"</span>
</code></pre></div></div>

<p>We packed a lot into this small section, so let’s break it down:</p>

<ul>
  <li>
    <p>iodata and chardata are lists of binaries and integers. Those binaries and integers can be arbitrarily nested inside lists. Their goal is to give flexibility and performance when working with IO devices and files</p>
  </li>
  <li>
    <p>the choice between iodata and chardata depends on the encoding of the IO device. If the file is opened without encoding, the file expects iodata, and the functions in the <code class="language-plaintext highlighter-rouge">IO</code> module starting with <code class="language-plaintext highlighter-rouge">bin*</code> must be used. The default IO device (<code class="language-plaintext highlighter-rouge">:stdio</code>) and files opened with <code class="language-plaintext highlighter-rouge">:utf8</code> encoding expect chardata and work with the remaining functions in the <code class="language-plaintext highlighter-rouge">IO</code> module</p>
  </li>
  <li>
    <p>charlists are a special case of chardata, where it exclusively uses a list of integers Unicode codepoints. They can be created with the <code class="language-plaintext highlighter-rouge">~c</code> sigil. Lists of integers are automatically printed using the <code class="language-plaintext highlighter-rouge">~c</code> sigil if all integers in a list represent printable ASCII codepoints.</p>
  </li>
</ul>

<p>This finishes our tour of IO devices and IO related functionality. We have learned about three Elixir modules - <a href="https://hexdocs.pm/elixir/IO.html"><code class="language-plaintext highlighter-rouge">IO</code></a>, <a href="https://hexdocs.pm/elixir/File.html"><code class="language-plaintext highlighter-rouge">File</code></a>, and <a href="https://hexdocs.pm/elixir/Path.html"><code class="language-plaintext highlighter-rouge">Path</code></a> - as well as how the <abbr title="Virtual Machine">VM</abbr> uses processes for the underlying IO mechanisms and how to use <code class="language-plaintext highlighter-rouge">chardata</code> and <code class="language-plaintext highlighter-rouge">iodata</code> for IO operations.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/processes.html" class="previous page-numbers spec" title="Processes">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/alias-require-and-import.html" class="previous page-numbers spec" title="alias, require, and import">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/io-and-the-file-system.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/alias-require-and-import.html" page=":13:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><span title="alias, require, and import">alias, require, and import</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>alias, require, and import</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#alias">alias</a></li><li><a href="#require">require</a></li><li><a href="#import">import</a></li><li><a href="#use">use</a></li><li><a href="#understanding-aliases">Understanding Aliases</a></li><li><a href="#module-nesting">Module nesting</a></li><li><a href="#multi-aliasimportrequireuse">Multi alias/import/require/use</a></li></ol></div>

    <p>In order to facilitate software reuse, Elixir provides three directives (<code class="language-plaintext highlighter-rouge">alias</code>, <code class="language-plaintext highlighter-rouge">require</code> and <code class="language-plaintext highlighter-rouge">import</code>) plus a macro called <code class="language-plaintext highlighter-rouge">use</code> summarized below:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Alias the module so it can be called as Bar instead of Foo.Bar</span>
<span class="n">alias</span> <span class="no">Foo</span><span class="o">.</span><span class="no">Bar</span><span class="p">,</span> <span class="ss">as:</span> <span class="no">Bar</span>

<span class="c1"># Require the module in order to use its macros</span>
<span class="kn">require</span> <span class="no">Foo</span>

<span class="c1"># Import functions from Foo so they can be called without the `Foo.` prefix</span>
<span class="kn">import</span> <span class="no">Foo</span>

<span class="c1"># Invokes the custom code defined in Foo as an extension point</span>
<span class="kn">use</span> <span class="no">Foo</span>
</code></pre></div></div>

<p>We are going to explore them in detail now. Keep in mind the first three are called directives because they have <strong>lexical scope</strong>, while <code class="language-plaintext highlighter-rouge">use</code> is a common extension point that allows the used module to inject code.</p>

<h2 id="alias" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">alias</span><a href="#alias" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p><code class="language-plaintext highlighter-rouge">alias</code> allows you to set up aliases for any given module name.</p>

<p>Imagine a module uses a specialized list implemented in <code class="language-plaintext highlighter-rouge">Math.List</code>. The <code class="language-plaintext highlighter-rouge">alias</code> directive allows referring to <code class="language-plaintext highlighter-rouge">Math.List</code> just as <code class="language-plaintext highlighter-rouge">List</code> within the module definition:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Stats</span> <span class="k">do</span>
  <span class="n">alias</span> <span class="no">Math</span><span class="o">.</span><span class="no">List</span><span class="p">,</span> <span class="ss">as:</span> <span class="no">List</span>
  <span class="c1"># In the remaining module definition List expands to Math.List.</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The original <code class="language-plaintext highlighter-rouge">List</code> can still be accessed within <code class="language-plaintext highlighter-rouge">Stats</code> by the fully-qualified name <code class="language-plaintext highlighter-rouge">Elixir.List</code>.</p>

<blockquote>
  <p>Note: All modules defined in Elixir are defined inside the main <code class="language-plaintext highlighter-rouge">Elixir</code> namespace, such as <code class="language-plaintext highlighter-rouge">Elixir.String</code>. However, for convenience, you can omit “Elixir.” when referencing them.</p>
</blockquote>

<p>Aliases are frequently used to define shortcuts. In fact, calling <code class="language-plaintext highlighter-rouge">alias</code> without an <code class="language-plaintext highlighter-rouge">:as</code> option sets the alias automatically to the last part of the module name, for example:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">alias</span> <span class="no">Math</span><span class="o">.</span><span class="no">List</span>
</code></pre></div></div>

<p>Is the same as:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">alias</span> <span class="no">Math</span><span class="o">.</span><span class="no">List</span><span class="p">,</span> <span class="ss">as:</span> <span class="no">List</span>
</code></pre></div></div>

<p>Note that <code class="language-plaintext highlighter-rouge">alias</code> is <strong>lexically scoped</strong>, which allows you to set aliases inside specific functions:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Math</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">plus</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">alias</span> <span class="no">Math</span><span class="o">.</span><span class="no">List</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">minus</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>In the example above, since we are invoking <code class="language-plaintext highlighter-rouge">alias</code> inside the function <code class="language-plaintext highlighter-rouge">plus/2</code>, the alias will be valid only inside the function <code class="language-plaintext highlighter-rouge">plus/2</code>. <code class="language-plaintext highlighter-rouge">minus/2</code> won’t be affected at all.</p>

<h2 id="require" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">require</span><a href="#require" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir provides macros as a mechanism for meta-programming (writing code that generates code). Macros are expanded at compile time.</p>

<p>Public functions in modules are globally available, but in order to use macros, you need to opt-in by requiring the module they are defined in.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Integer</span><span class="o">.</span><span class="n">is_odd</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="o">**</span> <span class="p">(</span><span class="no">UndefinedFunctionError</span><span class="p">)</span> <span class="n">function</span> <span class="no">Integer</span><span class="o">.</span><span class="n">is_odd</span><span class="o">/</span><span class="mi">1</span> <span class="n">is</span> <span class="n">undefined</span> <span class="ow">or</span> <span class="n">private</span><span class="o">.</span> <span class="no">However</span><span class="p">,</span> <span class="n">there</span> <span class="n">is</span> <span class="n">a</span> <span class="n">macro</span> <span class="n">with</span> <span class="n">the</span> <span class="n">same</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">arity</span><span class="o">.</span> <span class="no">Be</span> <span class="n">sure</span> <span class="n">to</span> <span class="kn">require</span> <span class="no">Integer</span> <span class="k">if</span> <span class="n">you</span> <span class="n">intend</span> <span class="n">to</span> <span class="n">invoke</span> <span class="n">this</span> <span class="n">macro</span>
    <span class="p">(</span><span class="n">elixir</span><span class="p">)</span> <span class="no">Integer</span><span class="o">.</span><span class="n">is_odd</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="kn">require</span> <span class="no">Integer</span>
<span class="no">Integer</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Integer</span><span class="o">.</span><span class="n">is_odd</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="no">true</span>
</code></pre></div></div>

<p>In Elixir, <code class="language-plaintext highlighter-rouge">Integer.is_odd/1</code> is defined as a macro so that it can be used as a guard. This means that, in order to invoke <code class="language-plaintext highlighter-rouge">Integer.is_odd/1</code>, we need to first require the <code class="language-plaintext highlighter-rouge">Integer</code> module.</p>

<p>Note that like the <code class="language-plaintext highlighter-rouge">alias</code> directive, <code class="language-plaintext highlighter-rouge">require</code> is also lexically scoped. We will talk more about macros in a later chapter.</p>

<h2 id="import" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">import</span><a href="#import" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>We use <code class="language-plaintext highlighter-rouge">import</code> whenever we want to access functions or macros from other modules without using the fully-qualified name. Note we can only import public functions, as private functions are never accessible externally.</p>

<p>For example, if we want to use the <code class="language-plaintext highlighter-rouge">duplicate/2</code> function from the <code class="language-plaintext highlighter-rouge">List</code> module several times, we can import it:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="kn">import</span> <span class="no">List</span><span class="p">,</span> <span class="ss">only:</span> <span class="p">[</span><span class="ss">duplicate:</span> <span class="mi">2</span><span class="p">]</span>
<span class="no">List</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">duplicate</span><span class="p">(</span><span class="ss">:ok</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">[</span><span class="ss">:ok</span><span class="p">,</span> <span class="ss">:ok</span><span class="p">,</span> <span class="ss">:ok</span><span class="p">]</span>
</code></pre></div></div>

<p>We imported only the function <code class="language-plaintext highlighter-rouge">duplicate</code> (with arity 2) from <code class="language-plaintext highlighter-rouge">List</code>. Although <code class="language-plaintext highlighter-rouge">:only</code> is optional, its usage is recommended in order to avoid importing all the functions of a given module inside the current scope. <code class="language-plaintext highlighter-rouge">:except</code> could also be given as an option in order to import everything in a module <em>except</em> a list of functions.</p>

<p>Note that <code class="language-plaintext highlighter-rouge">import</code> is <strong>lexically scoped</strong> too. This means that we can import specific macros or functions inside function definitions:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Math</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">some_function</span> <span class="k">do</span>
    <span class="kn">import</span> <span class="no">List</span><span class="p">,</span> <span class="ss">only:</span> <span class="p">[</span><span class="ss">duplicate:</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">duplicate</span><span class="p">(</span><span class="ss">:ok</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>In the example above, the imported <code class="language-plaintext highlighter-rouge">List.duplicate/2</code> is only visible within that specific function. <code class="language-plaintext highlighter-rouge">duplicate/2</code> won’t be available in any other function in that module (or any other module for that matter). <code class="language-plaintext highlighter-rouge">import</code>ing a module automatically <code class="language-plaintext highlighter-rouge">require</code>s it.</p>

<p>Note that <code class="language-plaintext highlighter-rouge">import</code>s are generally discouraged in the language. When working on your own code, prefer <code class="language-plaintext highlighter-rouge">alias</code> to <code class="language-plaintext highlighter-rouge">import</code>.</p>

<h2 id="use" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">use</span><a href="#use" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>The <code class="language-plaintext highlighter-rouge">use</code> macro is frequently used as an extension point. This means that, when you <code class="language-plaintext highlighter-rouge">use</code> a module <code class="language-plaintext highlighter-rouge">FooBar</code>, you allow that module to inject <em>any</em> code in the current module, such as importing itself or other modules, defining new functions, setting a module state, etc.</p>

<p>For example, in order to write tests using the ExUnit framework, a developer should use the <code class="language-plaintext highlighter-rouge">ExUnit.Case</code> module:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">AssertionTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ExUnit</span><span class="o">.</span><span class="no">Case</span><span class="p">,</span> <span class="ss">async:</span> <span class="no">true</span>

  <span class="n">test</span> <span class="s2">"always pass"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="no">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Behind the scenes, <code class="language-plaintext highlighter-rouge">use</code> requires the given module and then calls the <code class="language-plaintext highlighter-rouge">__using__/1</code> callback on it allowing the module to inject some code into the current context. Some modules (for example, the above <code class="language-plaintext highlighter-rouge">ExUnit.Case</code>, but also <code class="language-plaintext highlighter-rouge">Supervisor</code> and <code class="language-plaintext highlighter-rouge">GenServer</code>) use this mechanism to populate your module with some basic behaviour, which your module is intended to override or complete.</p>

<p>Generally speaking, the following module:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Example</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Feature</span><span class="p">,</span> <span class="ss">option:</span> <span class="ss">:value</span>
<span class="k">end</span>
</code></pre></div></div>

<p>is compiled into</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Example</span> <span class="k">do</span>
  <span class="kn">require</span> <span class="no">Feature</span>
  <span class="no">Feature</span><span class="o">.</span><span class="n">__using__</span><span class="p">(</span><span class="ss">option:</span> <span class="ss">:value</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Since <code class="language-plaintext highlighter-rouge">use</code> allows any code to run, we can’t really know the side-effects of using a module without reading its documentation. Therefore use this function with care and only if strictly required. Don’t use <code class="language-plaintext highlighter-rouge">use</code> where an <code class="language-plaintext highlighter-rouge">import</code> or <code class="language-plaintext highlighter-rouge">alias</code> would do.</p>

<h2 id="understanding-aliases" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Understanding Aliases</span><a href="#understanding-aliases" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>At this point, you may be wondering: what exactly is an Elixir alias and how is it represented?</p>

<p>An alias in Elixir is a capitalized identifier (like <code class="language-plaintext highlighter-rouge">String</code>, <code class="language-plaintext highlighter-rouge">Keyword</code>, etc) which is converted to an atom during compilation. For instance, the <code class="language-plaintext highlighter-rouge">String</code> alias translates by default to the atom <code class="language-plaintext highlighter-rouge">:"Elixir.String"</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_atom</span><span class="p">(</span><span class="no">String</span><span class="p">)</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">to_string</span><span class="p">(</span><span class="no">String</span><span class="p">)</span>
<span class="s2">"Elixir.String"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:"Elixir.String"</span> <span class="o">==</span> <span class="no">String</span>
<span class="no">true</span>
</code></pre></div></div>

<p>By using the <code class="language-plaintext highlighter-rouge">alias/2</code> directive, we are changing the atom the alias expands to.</p>

<p>Aliases expand to atoms because in the Erlang <abbr title="Virtual Machine">VM</abbr> (and consequently Elixir) modules are always represented by atoms:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">List</span><span class="o">.</span><span class="n">flatten</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">3</span><span class="p">])</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:"Elixir.List"</span><span class="o">.</span><span class="n">flatten</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">3</span><span class="p">])</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre></div></div>

<p>That’s the mechanism we use to call Erlang modules:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:lists</span><span class="o">.</span><span class="n">flatten</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">3</span><span class="p">])</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre></div></div>

<h2 id="module-nesting" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Module nesting</span><a href="#module-nesting" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Now that we have talked about aliases, we can talk about nesting and how it works in Elixir. Consider the following example:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Foo</span> <span class="k">do</span>
  <span class="k">defmodule</span> <span class="no">Bar</span> <span class="k">do</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The example above will define two modules: <code class="language-plaintext highlighter-rouge">Foo</code> and <code class="language-plaintext highlighter-rouge">Foo.Bar</code>. The second can be accessed as <code class="language-plaintext highlighter-rouge">Bar</code> inside <code class="language-plaintext highlighter-rouge">Foo</code> as long as they are in the same lexical scope.</p>

<p>If, later, the <code class="language-plaintext highlighter-rouge">Bar</code> module is moved outside the <code class="language-plaintext highlighter-rouge">Foo</code> module definition, it must be referenced by its full name (<code class="language-plaintext highlighter-rouge">Foo.Bar</code>) or an alias must be set using the <code class="language-plaintext highlighter-rouge">alias</code> directive discussed above.</p>

<p><strong>Note</strong>: in Elixir, you don’t have to define the <code class="language-plaintext highlighter-rouge">Foo</code> module before being able to define the <code class="language-plaintext highlighter-rouge">Foo.Bar</code> module, as they are effectively independent. The above could also be written as:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Foo</span><span class="o">.</span><span class="no">Bar</span> <span class="k">do</span>
<span class="k">end</span>

<span class="k">defmodule</span> <span class="no">Foo</span> <span class="k">do</span>
  <span class="n">alias</span> <span class="no">Foo</span><span class="o">.</span><span class="no">Bar</span>
  <span class="c1"># Can still access it as `Bar`</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Aliasing a nested module does not bring parent modules into scope. Consider the following example:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Foo</span> <span class="k">do</span>
  <span class="k">defmodule</span> <span class="no">Bar</span> <span class="k">do</span>
    <span class="k">defmodule</span> <span class="no">Baz</span> <span class="k">do</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">alias</span> <span class="no">Foo</span><span class="o">.</span><span class="no">Bar</span><span class="o">.</span><span class="no">Baz</span>
<span class="c1"># The module `Foo.Bar.Baz` is now available as `Baz`</span>
<span class="c1"># However, the module `Foo.Bar` is *not* available as `Bar`</span>
</code></pre></div></div>

<p>As we will see in later chapters, aliases also play a crucial role in macros, to guarantee they are hygienic.</p>

<h2 id="multi-aliasimportrequireuse" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Multi alias/import/require/use</span><a href="#multi-aliasimportrequireuse" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>It is possible to <code class="language-plaintext highlighter-rouge">alias</code>, <code class="language-plaintext highlighter-rouge">import</code>, <code class="language-plaintext highlighter-rouge">require</code>, or <code class="language-plaintext highlighter-rouge">use</code> multiple modules at once. This is particularly useful once we start nesting modules, which is very common when building Elixir applications. For example, imagine you have an application where all modules are nested under <code class="language-plaintext highlighter-rouge">MyApp</code>, you can alias the modules <code class="language-plaintext highlighter-rouge">MyApp.Foo</code>, <code class="language-plaintext highlighter-rouge">MyApp.Bar</code> and <code class="language-plaintext highlighter-rouge">MyApp.Baz</code> at once as follows:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">alias</span> <span class="no">MyApp</span><span class="o">.</span><span class="p">{</span><span class="no">Foo</span><span class="p">,</span> <span class="no">Bar</span><span class="p">,</span> <span class="no">Baz</span><span class="p">}</span>
</code></pre></div></div>

<p>With this, we have finished our tour of Elixir modules. The last topic to cover is module attributes.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/io-and-the-file-system.html" class="previous page-numbers spec" title="IO and the file system">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/module-attributes.html" class="previous page-numbers spec" title="Module attributes">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/alias-require-and-import.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/module-attributes.html" page=":14:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><span title="Module attributes">Module attributes</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Module attributes</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#as-annotations">As annotations</a></li><li><a href="#as-constants">As “constants”</a><ol><li><a href="#accumulating-attributes">Accumulating attributes</a></li></ol></li><li><a href="#as-temporary-storage">As temporary storage</a></li></ol></div>

    <p>Module attributes in Elixir serve three purposes:</p>

<ol>
  <li>They serve to annotate the module, often with information to be used by the user or the <abbr title="Virtual Machine">VM</abbr>.</li>
  <li>They work as constants.</li>
  <li>They work as a temporary module storage to be used during compilation.</li>
</ol>

<p>Let’s check each case, one by one.</p>

<h2 id="as-annotations" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">As annotations</span><a href="#as-annotations" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir brings the concept of module attributes from Erlang. For example:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">MyServer</span> <span class="k">do</span>
  <span class="nv">@moduledoc</span> <span class="s2">"My server code."</span>
<span class="k">end</span>
</code></pre></div></div>

<p>In the example above, we are defining the module documentation by using the module attribute syntax. Elixir has a handful of reserved attributes. Here are a few of them, the most commonly used ones:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">@moduledoc</code> - provides documentation for the current module.</li>
  <li><code class="language-plaintext highlighter-rouge">@doc</code> - provides documentation for the function or macro that follows the attribute.</li>
  <li><code class="language-plaintext highlighter-rouge">@spec</code> - provides a typespec for the function that follows the attribute.</li>
  <li><code class="language-plaintext highlighter-rouge">@behaviour</code> - (notice the British spelling) used for specifying an <abbr title="Open Telecom Platform">OTP</abbr> or user-defined behaviour.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">@moduledoc</code> and <code class="language-plaintext highlighter-rouge">@doc</code> are by far the most used attributes, and we expect you to use them a lot. Elixir treats documentation as first-class and provides many functions to access documentation. You can read more about <a href="https://hexdocs.pm/elixir/writing-documentation.html">writing documentation in Elixir in our official documentation</a>.</p>

<p>Let’s go back to the <code class="language-plaintext highlighter-rouge">Math</code> module defined in the previous chapters, add some documentation and save it to the <code class="language-plaintext highlighter-rouge">math.ex</code> file:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Math</span> <span class="k">do</span>
  <span class="nv">@moduledoc</span> <span class="sd">"""
  Provides math-related functions.

  ## Examples

      iex&gt; Math.sum(1, 2)
      3

  """</span>

  <span class="nv">@doc</span> <span class="sd">"""
  Calculates the sum of two numbers.
  """</span>
  <span class="k">def</span> <span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Elixir promotes the use of Markdown with heredocs to write readable documentation. Heredocs are multi-line strings, they start and end with triple double-quotes, keeping the formatting of the inner text. We can access the documentation of any compiled module directly from IEx:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>elixirc math.ex
<span class="gp">$</span><span class="w"> </span>iex
</code></pre></div></div>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">h</span> <span class="no">Math</span> <span class="c1"># Access the docs for the module Math</span>
<span class="o">...</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">h</span> <span class="no">Math</span><span class="o">.</span><span class="n">sum</span> <span class="c1"># Access the docs for the sum function</span>
<span class="o">...</span>
</code></pre></div></div>

<p>We also provide a tool called <a href="https://github.com/elixir-lang/ex_doc">ExDoc</a> which is used to generate HTML pages from the documentation.</p>

<p>You can take a look at the docs for <a href="https://hexdocs.pm/elixir/Module.html">Module</a> for a complete list of supported attributes. Elixir also uses attributes to define <a href="/getting-started/typespecs-and-behaviours.html">typespecs</a>.</p>

<p>This section covers built-in attributes. However, attributes can also be used by developers or extended by libraries to support custom behaviour.</p>

<h2 id="as-constants" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">As “constants”</span><a href="#as-constants" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir developers often use module attributes when they wish to make a value more visible or reusable:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">MyServer</span> <span class="k">do</span>
  <span class="nv">@initial_state</span> <span class="p">%{</span><span class="ss">host:</span> <span class="s2">"127.0.0.1"</span><span class="p">,</span> <span class="ss">port:</span> <span class="mi">3456</span><span class="p">}</span>
  <span class="no">IO</span><span class="o">.</span><span class="n">inspect</span> <span class="nv">@initial_state</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Trying to access an attribute that was not defined will print a warning:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">MyServer</span> <span class="k">do</span>
  <span class="nv">@unknown</span>
<span class="k">end</span>
<span class="ss">warning:</span> <span class="n">undefined</span> <span class="n">module</span> <span class="n">attribute</span> <span class="nv">@unknown</span><span class="p">,</span> <span class="n">please</span> <span class="n">remove</span> <span class="n">access</span> <span class="n">to</span> <span class="nv">@unknown</span> <span class="ow">or</span> <span class="n">explicitly</span> <span class="n">set</span> <span class="n">it</span> <span class="n">before</span> <span class="n">access</span>
</code></pre></div></div>

<p>Attributes can also be read inside functions:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">MyServer</span> <span class="k">do</span>
  <span class="nv">@my_data</span> <span class="mi">14</span>
  <span class="k">def</span> <span class="n">first_data</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="nv">@my_data</span>
  <span class="nv">@my_data</span> <span class="mi">13</span>
  <span class="k">def</span> <span class="n">second_data</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="nv">@my_data</span>
<span class="k">end</span>

<span class="no">MyServer</span><span class="o">.</span><span class="n">first_data</span> <span class="c1">#=&gt; 14</span>
<span class="no">MyServer</span><span class="o">.</span><span class="n">second_data</span> <span class="c1">#=&gt; 13</span>
</code></pre></div></div>

<blockquote>
  <p>Note: do not add a newline between the attribute and its value, otherwise Elixir will assume you are reading the value, rather than setting it.</p>
</blockquote>

<p>Functions may be called when defining a module attribute:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">MyApp</span><span class="o">.</span><span class="no">Status</span> <span class="k">do</span>
  <span class="nv">@service</span> <span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">"https://example.com"</span><span class="p">)</span>
  <span class="k">def</span> <span class="n">status</span><span class="p">(</span><span class="n">email</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">SomeHttpClient</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nv">@service</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The function above will be called at compilation time and its <em>return value</em>, not the function call itself, is what will be substituted in for the attribute. So the above will effectively compile to this:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">MyApp</span><span class="o">.</span><span class="no">Status</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">status</span><span class="p">(</span><span class="n">email</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">SomeHttpClient</span><span class="o">.</span><span class="n">get</span><span class="p">(%</span><span class="no">URI</span><span class="p">{</span>
      <span class="ss">authority:</span> <span class="s2">"example.com"</span><span class="p">,</span>
      <span class="ss">host:</span> <span class="s2">"example.com"</span><span class="p">,</span>
      <span class="ss">port:</span> <span class="mi">443</span><span class="p">,</span>
      <span class="ss">scheme:</span> <span class="s2">"https"</span>
    <span class="p">})</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This can be useful for pre-computing constant values, but it can also cause problems if you’re expecting the function to be called at runtime. For example, if you are reading a value from a database or an environment variable inside an attribute, be aware that it will read that value only at compilation time. Be careful, however: <em>functions defined in the same module as the attribute itself cannot be called</em> because they have not yet been compiled when the attribute is being defined.</p>

<p>Every time an attribute is read inside a function, Elixir takes a snapshot of its current value. Therefore if you read the same attribute multiple times inside multiple functions, you may end-up making multiple copies of it. That’s usually not an issue, but if you are using functions to compute large module attributes, that can slow down compilation. The solution is to move the attribute to shared function. For example, instead of this:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">some_function</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">do_something_with</span><span class="p">(</span><span class="nv">@example</span><span class="p">)</span>
<span class="k">def</span> <span class="n">another_function</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">do_something_else_with</span><span class="p">(</span><span class="nv">@example</span><span class="p">)</span>
</code></pre></div></div>

<p>Prefer this:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">some_function</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">do_something_with</span><span class="p">(</span><span class="n">example</span><span class="p">())</span>
<span class="k">def</span> <span class="n">another_function</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">do_something_else_with</span><span class="p">(</span><span class="n">example</span><span class="p">())</span>
<span class="k">defp</span> <span class="n">example</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="nv">@example</span>
</code></pre></div></div>

<p>If <code class="language-plaintext highlighter-rouge">@example</code> is cheap to compute, it may be even better to skip the module attribute altogether, and compute its value inside the function.</p>

<h3 id="accumulating-attributes" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Accumulating attributes</span><a href="#accumulating-attributes" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>Normally, repeating a module attribute will cause its value to be reassigned, but there are circumstances where you may want to <a href="https://hexdocs.pm/elixir/Module.html#register_attribute/3">configure the module attribute</a> so that its values are accumulated:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Foo</span> <span class="k">do</span>
  <span class="no">Module</span><span class="o">.</span><span class="n">register_attribute</span> <span class="bp">__MODULE__</span><span class="p">,</span> <span class="ss">:param</span><span class="p">,</span> <span class="ss">accumulate:</span> <span class="no">true</span>

  <span class="nv">@param</span> <span class="ss">:foo</span>
  <span class="nv">@param</span> <span class="ss">:bar</span>
  <span class="c1"># here @param == [:bar, :foo]</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="as-temporary-storage" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">As temporary storage</span><a href="#as-temporary-storage" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>To see an example of using module attributes as storage, look no further than Elixir’s unit test framework called <a href="https://hexdocs.pm/ex_unit/">ExUnit</a>. ExUnit uses module attributes for multiple different purposes:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">MyTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ExUnit</span><span class="o">.</span><span class="no">Case</span><span class="p">,</span> <span class="ss">async:</span> <span class="no">true</span>

  <span class="nv">@tag</span> <span class="ss">:external</span>
  <span class="nv">@tag</span> <span class="ss">os:</span> <span class="ss">:unix</span>
  <span class="n">test</span> <span class="s2">"contacts external service"</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>In the example above, <code class="language-plaintext highlighter-rouge">ExUnit</code> stores the value of <code class="language-plaintext highlighter-rouge">async: true</code> in a module attribute to change how the module is compiled. Tags are also defined as <code class="language-plaintext highlighter-rouge">accumulate: true</code> attributes, and they store tags that can be used to setup and filter tests. For example, you can avoid running external tests on your machine because they are slow and dependent on other services, while they can still be enabled in your build system.</p>

<p>In order to understand the underlying code, we’d need macros, so we will revisit this pattern in the meta-programming guide and learn how to use module attributes as storage to allow developers to create Domain Specific Languages (DSLs).</p>

<p>In the next chapters, we’ll explore structs and protocols before moving to exception handling and other constructs like sigils and comprehensions.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/alias-require-and-import.html" class="previous page-numbers spec" title="alias, require, and import">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/structs.html" class="previous page-numbers spec" title="Structs">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/module-attributes.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/structs.html" page=":15:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><span title="Structs">Structs</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Structs</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#defining-structs">Defining structs</a></li><li><a href="#accessing-and-updating-structs">Accessing and updating structs</a></li><li><a href="#structs-are-bare-maps-underneath">Structs are bare maps underneath</a></li><li><a href="#default-values-and-required-keys">Default values and required keys</a></li></ol></div>

    <p>In <a href="/getting-started/keywords-and-maps.html">chapter 7</a> we learned about maps:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="p">%{</span><span class="ss">a:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">b:</span> <span class="mi">2</span><span class="p">}</span>
<span class="p">%{</span><span class="ss">a:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">b:</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">map</span><span class="p">[</span><span class="ss">:a</span><span class="p">]</span>
<span class="mi">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">%{</span><span class="n">map</span> <span class="o">|</span> <span class="ss">a:</span> <span class="mi">3</span><span class="p">}</span>
<span class="p">%{</span><span class="ss">a:</span> <span class="mi">3</span><span class="p">,</span> <span class="ss">b:</span> <span class="mi">2</span><span class="p">}</span>
</code></pre></div></div>

<p>Structs are extensions built on top of maps that provide compile-time checks and default values.</p>

<h2 id="defining-structs" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Defining structs</span><a href="#defining-structs" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>To define a struct, the <code class="language-plaintext highlighter-rouge">defstruct</code> construct is used:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">defmodule</span> <span class="no">User</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="k">defstruct</span> <span class="ss">name:</span> <span class="s2">"John"</span><span class="p">,</span> <span class="ss">age:</span> <span class="mi">27</span>
<span class="o">...&gt;</span> <span class="k">end</span>
</code></pre></div></div>

<p>The keyword list used with <code class="language-plaintext highlighter-rouge">defstruct</code> defines what fields the struct will have along with their default values.</p>

<p>Structs take the name of the module they’re defined in. In the example above, we defined a struct named <code class="language-plaintext highlighter-rouge">User</code>.</p>

<p>We can now create <code class="language-plaintext highlighter-rouge">User</code> structs by using a syntax similar to the one used to create maps:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">%</span><span class="no">User</span><span class="p">{}</span>
<span class="p">%</span><span class="no">User</span><span class="p">{</span><span class="ss">age:</span> <span class="mi">27</span><span class="p">,</span> <span class="ss">name:</span> <span class="s2">"John"</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">%</span><span class="no">User</span><span class="p">{</span><span class="ss">name:</span> <span class="s2">"Jane"</span><span class="p">}</span>
<span class="p">%</span><span class="no">User</span><span class="p">{</span><span class="ss">age:</span> <span class="mi">27</span><span class="p">,</span> <span class="ss">name:</span> <span class="s2">"Jane"</span><span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>Note: If you have defined the struct in a separate file, you can compile the file inside IEx before proceeding by running <code class="language-plaintext highlighter-rouge">c "file.exs"</code>. Be aware you may get an error saying <code class="language-plaintext highlighter-rouge">the struct was not yet defined</code> if you try the example above in a file directly due to when definitions are resolved.</p>
</blockquote>

<p>Structs provide <em>compile-time</em> guarantees that only the fields (and <em>all</em> of them) defined through <code class="language-plaintext highlighter-rouge">defstruct</code> will be allowed to exist in a struct:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">%</span><span class="no">User</span><span class="p">{</span><span class="ss">oops:</span> <span class="ss">:field</span><span class="p">}</span>
<span class="o">**</span> <span class="p">(</span><span class="no">KeyError</span><span class="p">)</span> <span class="n">key</span> <span class="ss">:oops</span> <span class="ow">not</span> <span class="n">found</span> <span class="n">expanding</span> <span class="ss">struct:</span> <span class="no">User</span><span class="o">.</span><span class="n">__struct__</span><span class="o">/</span><span class="mi">1</span>
</code></pre></div></div>

<h2 id="accessing-and-updating-structs" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Accessing and updating structs</span><a href="#accessing-and-updating-structs" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>When we discussed maps, we showed how we can access and update the fields of a map. The same techniques (and the same syntax) apply to structs as well:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">john</span> <span class="o">=</span> <span class="p">%</span><span class="no">User</span><span class="p">{}</span>
<span class="p">%</span><span class="no">User</span><span class="p">{</span><span class="ss">age:</span> <span class="mi">27</span><span class="p">,</span> <span class="ss">name:</span> <span class="s2">"John"</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">john</span><span class="o">.</span><span class="n">name</span>
<span class="s2">"John"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">jane</span> <span class="o">=</span> <span class="p">%{</span><span class="n">john</span> <span class="o">|</span> <span class="ss">name:</span> <span class="s2">"Jane"</span><span class="p">}</span>
<span class="p">%</span><span class="no">User</span><span class="p">{</span><span class="ss">age:</span> <span class="mi">27</span><span class="p">,</span> <span class="ss">name:</span> <span class="s2">"Jane"</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">%{</span><span class="n">jane</span> <span class="o">|</span> <span class="ss">oops:</span> <span class="ss">:field</span><span class="p">}</span>
<span class="o">**</span> <span class="p">(</span><span class="no">KeyError</span><span class="p">)</span> <span class="n">key</span> <span class="ss">:oops</span> <span class="ow">not</span> <span class="n">found</span> <span class="ow">in</span><span class="p">:</span> <span class="p">%</span><span class="no">User</span><span class="p">{</span><span class="ss">age:</span> <span class="mi">27</span><span class="p">,</span> <span class="ss">name:</span> <span class="s2">"Jane"</span><span class="p">}</span>
</code></pre></div></div>

<p>When using the update syntax (<code class="language-plaintext highlighter-rouge">|</code>), the <abbr title="Virtual Machine">VM</abbr> is aware that no new keys will be added to the struct, allowing the maps underneath to share their structure in memory. In the example above, both <code class="language-plaintext highlighter-rouge">john</code> and <code class="language-plaintext highlighter-rouge">jane</code> share the same key structure in memory.</p>

<p>Structs can also be used in pattern matching, both for matching on the value of specific keys as well as for ensuring that the matching value is a struct of the same type as the matched value.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">%</span><span class="no">User</span><span class="p">{</span><span class="ss">name:</span> <span class="n">name</span><span class="p">}</span> <span class="o">=</span> <span class="n">john</span>
<span class="p">%</span><span class="no">User</span><span class="p">{</span><span class="ss">age:</span> <span class="mi">27</span><span class="p">,</span> <span class="ss">name:</span> <span class="s2">"John"</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">name</span>
<span class="s2">"John"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">%</span><span class="no">User</span><span class="p">{}</span> <span class="o">=</span> <span class="p">%{}</span>
<span class="o">**</span> <span class="p">(</span><span class="no">MatchError</span><span class="p">)</span> <span class="n">no</span> <span class="n">match</span> <span class="n">of</span> <span class="n">right</span> <span class="n">hand</span> <span class="n">side</span> <span class="ss">value:</span> <span class="p">%{}</span>
</code></pre></div></div>

<h2 id="structs-are-bare-maps-underneath" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Structs are bare maps underneath</span><a href="#structs-are-bare-maps-underneath" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>In the example above, pattern matching works because underneath structs are bare maps with a fixed set of fields. As maps, structs store a “special” field named <code class="language-plaintext highlighter-rouge">__struct__</code> that holds the name of the struct:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">is_map</span><span class="p">(</span><span class="n">john</span><span class="p">)</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">john</span><span class="o">.</span><span class="n">__struct__</span>
<span class="no">User</span>
</code></pre></div></div>

<p>Notice that we referred to structs as <strong>bare</strong> maps because none of the protocols implemented for maps are available for structs. For example, you can neither enumerate nor access a struct:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">john</span> <span class="o">=</span> <span class="p">%</span><span class="no">User</span><span class="p">{}</span>
<span class="p">%</span><span class="no">User</span><span class="p">{</span><span class="ss">age:</span> <span class="mi">27</span><span class="p">,</span> <span class="ss">name:</span> <span class="s2">"John"</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">john</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
<span class="o">**</span> <span class="p">(</span><span class="no">UndefinedFunctionError</span><span class="p">)</span> <span class="n">function</span> <span class="no">User</span><span class="o">.</span><span class="n">fetch</span><span class="o">/</span><span class="mi">2</span> <span class="n">is</span> <span class="n">undefined</span> <span class="p">(</span><span class="no">User</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">implement</span> <span class="n">the</span> <span class="no">Access</span> <span class="n">behaviour</span><span class="p">)</span>
             <span class="no">User</span><span class="o">.</span><span class="n">fetch</span><span class="p">(%</span><span class="no">User</span><span class="p">{</span><span class="ss">age:</span> <span class="mi">27</span><span class="p">,</span> <span class="ss">name:</span> <span class="s2">"John"</span><span class="p">},</span> <span class="ss">:name</span><span class="p">)</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="n">john</span><span class="p">,</span> <span class="k">fn</span> <span class="p">{</span><span class="n">field</span><span class="p">,</span> <span class="n">value</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">end</span><span class="p">)</span>
<span class="o">**</span> <span class="p">(</span><span class="no">Protocol</span><span class="o">.</span><span class="no">UndefinedError</span><span class="p">)</span> <span class="n">protocol</span> <span class="no">Enumerable</span> <span class="ow">not</span> <span class="n">implemented</span> <span class="n">for</span> <span class="p">%</span><span class="no">User</span><span class="p">{</span><span class="ss">age:</span> <span class="mi">27</span><span class="p">,</span> <span class="ss">name:</span> <span class="s2">"John"</span><span class="p">}</span> <span class="n">of</span> <span class="n">type</span> <span class="no">User</span> <span class="p">(</span><span class="n">a</span> <span class="n">struct</span><span class="p">)</span>
</code></pre></div></div>

<p>However, since structs are just maps, they work with the functions from the <code class="language-plaintext highlighter-rouge">Map</code> module:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">jane</span> <span class="o">=</span> <span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(%</span><span class="no">User</span><span class="p">{},</span> <span class="ss">:name</span><span class="p">,</span> <span class="s2">"Jane"</span><span class="p">)</span>
<span class="p">%</span><span class="no">User</span><span class="p">{</span><span class="ss">age:</span> <span class="mi">27</span><span class="p">,</span> <span class="ss">name:</span> <span class="s2">"Jane"</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">jane</span><span class="p">,</span> <span class="p">%</span><span class="no">User</span><span class="p">{</span><span class="ss">name:</span> <span class="s2">"John"</span><span class="p">})</span>
<span class="p">%</span><span class="no">User</span><span class="p">{</span><span class="ss">age:</span> <span class="mi">27</span><span class="p">,</span> <span class="ss">name:</span> <span class="s2">"John"</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">jane</span><span class="p">)</span>
<span class="p">[</span><span class="ss">:__struct__</span><span class="p">,</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">:name</span><span class="p">]</span>
</code></pre></div></div>

<p>Structs alongside protocols provide one of the most important features for Elixir developers: data polymorphism. That’s what we will explore in the next chapter.</p>

<h2 id="default-values-and-required-keys" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Default values and required keys</span><a href="#default-values-and-required-keys" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>If you don’t specify a default key value when defining a struct, <code class="language-plaintext highlighter-rouge">nil</code> will be assumed:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">defmodule</span> <span class="no">Product</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="k">defstruct</span> <span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">%</span><span class="no">Product</span><span class="p">{}</span>
<span class="p">%</span><span class="no">Product</span><span class="p">{</span><span class="ss">name:</span> <span class="no">nil</span><span class="p">}</span>
</code></pre></div></div>

<p>You can define a structure combining both fields with explicit default values, and implicit <code class="language-plaintext highlighter-rouge">nil</code> values. In this case you must first specify the fields which implicitly default to nil:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">defmodule</span> <span class="no">User</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="k">defstruct</span> <span class="p">[</span><span class="ss">:email</span><span class="p">,</span> <span class="ss">name:</span> <span class="s2">"John"</span><span class="p">,</span> <span class="ss">age:</span> <span class="mi">27</span><span class="p">]</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">%</span><span class="no">User</span><span class="p">{}</span>
<span class="p">%</span><span class="no">User</span><span class="p">{</span><span class="ss">age:</span> <span class="mi">27</span><span class="p">,</span> <span class="ss">email:</span> <span class="no">nil</span><span class="p">,</span> <span class="ss">name:</span> <span class="s2">"John"</span><span class="p">}</span>
</code></pre></div></div>

<p>Doing it in reverse order will raise a syntax error:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">defmodule</span> <span class="no">User</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="k">defstruct</span> <span class="p">[</span><span class="ss">name:</span> <span class="s2">"John"</span><span class="p">,</span> <span class="ss">age:</span> <span class="mi">27</span><span class="p">,</span> <span class="ss">:email</span><span class="p">]</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="o">**</span> <span class="p">(</span><span class="no">SyntaxError</span><span class="p">)</span> <span class="ss">iex:</span><span class="mi">107</span><span class="p">:</span> <span class="n">unexpected</span> <span class="n">expression</span> <span class="k">after</span> <span class="n">keyword</span> <span class="n">list</span><span class="o">.</span> <span class="no">Keyword</span> <span class="n">lists</span> <span class="n">must</span> <span class="n">always</span> <span class="n">come</span> <span class="n">last</span> <span class="ow">in</span> <span class="n">lists</span> <span class="ow">and</span> <span class="n">maps</span><span class="o">.</span>
</code></pre></div></div>

<p>You can also enforce that certain keys have to be specified when creating the struct via the <code class="language-plaintext highlighter-rouge">@enforce_keys</code> module attribute:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">defmodule</span> <span class="no">Car</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="nv">@enforce_keys</span> <span class="p">[</span><span class="ss">:make</span><span class="p">]</span>
<span class="o">...&gt;</span>   <span class="k">defstruct</span> <span class="p">[</span><span class="ss">:model</span><span class="p">,</span> <span class="ss">:make</span><span class="p">]</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">%</span><span class="no">Car</span><span class="p">{}</span>
<span class="o">**</span> <span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span> <span class="n">the</span> <span class="n">following</span> <span class="n">keys</span> <span class="n">must</span> <span class="n">also</span> <span class="n">be</span> <span class="n">given</span> <span class="ow">when</span> <span class="n">building</span> <span class="n">struct</span> <span class="ss">Car:</span> <span class="p">[</span><span class="ss">:make</span><span class="p">]</span>
    <span class="n">expanding</span> <span class="ss">struct:</span> <span class="no">Car</span><span class="o">.</span><span class="n">__struct__</span><span class="o">/</span><span class="mi">1</span>
</code></pre></div></div>

<p>Enforcing keys provides a simple compile-time guarantee to aid developers when building structs. It is not enforced on updates and it does not provide any sort of value-validation.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/module-attributes.html" class="previous page-numbers spec" title="Module attributes">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/protocols.html" class="previous page-numbers spec" title="Protocols">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/structs.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/protocols.html" page=":16:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><span title="Protocols">Protocols</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Protocols</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#example">Example</a></li><li><a href="#protocols-and-structs">Protocols and structs</a></li><li><a href="#implementing-any">Implementing <code class="language-plaintext highlighter-rouge">Any</code></a><ol><li><a href="#deriving">Deriving</a></li><li><a href="#fallback-to-any">Fallback to <code class="language-plaintext highlighter-rouge">Any</code></a></li></ol></li><li><a href="#built-in-protocols">Built-in protocols</a></li></ol></div>

    <p>Protocols are a mechanism to achieve polymorphism in Elixir when you want behaviour to vary depending on the data type. We are already familiar with one way of solving this type of problem: via pattern matching and guard clauses. Consider a simple utility module that would tell us the type of input variable:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Utility</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">when</span> <span class="n">is_binary</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="s2">"string"</span>
  <span class="k">def</span> <span class="n">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">when</span> <span class="n">is_integer</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="s2">"integer"</span>
  <span class="c1"># ... other implementations ...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>If the use of this module were confined to your own project, you would be able to keep defining new <code class="language-plaintext highlighter-rouge">type/1</code> functions for each new data type. However, this code could be problematic if it was shared as a dependency by multiple apps because there would be no easy way to extend its functionality.</p>

<p>This is where protocols can help us: protocols allow us to extend the original behaviour for as many data types as we need. That’s because <strong>dispatching on a protocol is available to any data type that has implemented the protocol</strong> and a protocol can be implemented by anyone, at any time.</p>

<p>Here’s how we could write the same <code class="language-plaintext highlighter-rouge">Utility.type/1</code> functionality as a protocol:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defprotocol</span> <span class="no">Utility</span> <span class="k">do</span>
  <span class="nv">@spec</span> <span class="n">type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="p">::</span> <span class="no">String</span><span class="o">.</span><span class="n">t</span><span class="p">()</span>
  <span class="k">def</span> <span class="n">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">defimpl</span> <span class="no">Utility</span><span class="p">,</span> <span class="ss">for:</span> <span class="no">BitString</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">type</span><span class="p">(</span><span class="n">_value</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="s2">"string"</span>
<span class="k">end</span>

<span class="k">defimpl</span> <span class="no">Utility</span><span class="p">,</span> <span class="ss">for:</span> <span class="no">Integer</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">type</span><span class="p">(</span><span class="n">_value</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="s2">"integer"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We define the protocol using <code class="language-plaintext highlighter-rouge">defprotocol</code> - its functions and specs may look similar to interfaces or abstract base classes in other languages. We can add as many implementations as we like using <code class="language-plaintext highlighter-rouge">defimpl</code>. The output is exactly the same as if we had a single module with multiple functions:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Utility</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
<span class="s2">"string"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Utility</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="s2">"integer"</span>
</code></pre></div></div>

<p>With protocols, however, we are no longer stuck having to continuously modify the same module to support more and more data types. For example, we could get the <code class="language-plaintext highlighter-rouge">defimpl</code> calls above and spread them over multiple files and Elixir will dispatch the execution to the appropriate implementation based on the data type. Functions defined in a protocol may have more than one input, but the <strong>dispatching will always be based on the data type of the first input</strong>.</p>

<p>One of the most common protocols you may encounter is the <a href="https://hexdocs.pm/elixir/String.Chars.html"><code class="language-plaintext highlighter-rouge">String.Chars</code></a> protocol: implementing its <code class="language-plaintext highlighter-rouge">to_string/1</code> function for your custom structs will tell the Elixir kernel how to represent them as strings. We will explore all built-in protocols later. For now, let’s implement our own.</p>

<h2 id="example" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Example</span><a href="#example" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Now that you have seen an example of the type of problem protocols help solve and how they solve them, let’s look at a more in-depth example.</p>

<p>In Elixir, we have two idioms for checking how many items there are in a data structure: <code class="language-plaintext highlighter-rouge">length</code> and <code class="language-plaintext highlighter-rouge">size</code>. <code class="language-plaintext highlighter-rouge">length</code> means the information must be computed. For example, <code class="language-plaintext highlighter-rouge">length(list)</code> needs to traverse the whole list to calculate its length. On the other hand, <code class="language-plaintext highlighter-rouge">tuple_size(tuple)</code> and <code class="language-plaintext highlighter-rouge">byte_size(binary)</code> do not depend on the tuple and binary size as the size information is pre-computed in the data structure.</p>

<p>Even if we have type-specific functions for getting the size built into Elixir (such as <code class="language-plaintext highlighter-rouge">tuple_size/1</code>), we could implement a generic <code class="language-plaintext highlighter-rouge">Size</code> protocol that all data structures for which size is pre-computed would implement.</p>

<p>The protocol definition would look like this:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defprotocol</span> <span class="no">Size</span> <span class="k">do</span>
  <span class="nv">@doc</span> <span class="s2">"Calculates the size (and not the length!) of a data structure"</span>
  <span class="k">def</span> <span class="n">size</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">Size</code> protocol expects a function called <code class="language-plaintext highlighter-rouge">size</code> that receives one argument (the data structure we want to know the size of) to be implemented. We can now implement this protocol for the data structures that would have a compliant implementation:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defimpl</span> <span class="no">Size</span><span class="p">,</span> <span class="ss">for:</span> <span class="no">BitString</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">size</span><span class="p">(</span><span class="n">string</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="n">byte_size</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">defimpl</span> <span class="no">Size</span><span class="p">,</span> <span class="ss">for:</span> <span class="no">Map</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">size</span><span class="p">(</span><span class="n">map</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="n">map_size</span><span class="p">(</span><span class="n">map</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">defimpl</span> <span class="no">Size</span><span class="p">,</span> <span class="ss">for:</span> <span class="no">Tuple</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">size</span><span class="p">(</span><span class="n">tuple</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="n">tuple_size</span><span class="p">(</span><span class="n">tuple</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We didn’t implement the <code class="language-plaintext highlighter-rouge">Size</code> protocol for lists as there is no “size” information pre-computed for lists, and the length of a list has to be computed (with <code class="language-plaintext highlighter-rouge">length/1</code>).</p>

<p>Now with the protocol defined and implementations in hand, we can start using it:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Size</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
<span class="mi">3</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Size</span><span class="o">.</span><span class="n">size</span><span class="p">({</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"hello"</span><span class="p">})</span>
<span class="mi">2</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Size</span><span class="o">.</span><span class="n">size</span><span class="p">(%{</span><span class="ss">label:</span> <span class="s2">"some label"</span><span class="p">})</span>
<span class="mi">1</span>
</code></pre></div></div>

<p>Passing a data type that doesn’t implement the protocol raises an error:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Size</span><span class="o">.</span><span class="n">size</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="o">**</span> <span class="p">(</span><span class="no">Protocol</span><span class="o">.</span><span class="no">UndefinedError</span><span class="p">)</span> <span class="n">protocol</span> <span class="no">Size</span> <span class="ow">not</span> <span class="n">implemented</span> <span class="n">for</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="n">of</span> <span class="n">type</span> <span class="no">List</span>
</code></pre></div></div>

<p>It’s possible to implement protocols for all Elixir data types:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Atom</code></li>
  <li><code class="language-plaintext highlighter-rouge">BitString</code></li>
  <li><code class="language-plaintext highlighter-rouge">Float</code></li>
  <li><code class="language-plaintext highlighter-rouge">Function</code></li>
  <li><code class="language-plaintext highlighter-rouge">Integer</code></li>
  <li><code class="language-plaintext highlighter-rouge">List</code></li>
  <li><code class="language-plaintext highlighter-rouge">Map</code></li>
  <li><code class="language-plaintext highlighter-rouge">PID</code></li>
  <li><code class="language-plaintext highlighter-rouge">Port</code></li>
  <li><code class="language-plaintext highlighter-rouge">Reference</code></li>
  <li><code class="language-plaintext highlighter-rouge">Tuple</code></li>
</ul>

<h2 id="protocols-and-structs" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Protocols and structs</span><a href="#protocols-and-structs" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>The power of Elixir’s extensibility comes when protocols and structs are used together.</p>

<p>In the <a href="/getting-started/structs.html">previous chapter</a>, we have learned that although structs are maps, they do not share protocol implementations with maps. For example, <a href="https://hexdocs.pm/elixir/MapSet.html"><code class="language-plaintext highlighter-rouge">MapSet</code></a>s (sets based on maps) are implemented as structs. Let’s try to use the <code class="language-plaintext highlighter-rouge">Size</code> protocol with a <code class="language-plaintext highlighter-rouge">MapSet</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Size</span><span class="o">.</span><span class="n">size</span><span class="p">(%{})</span>
<span class="mi">0</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">set</span> <span class="o">=</span> <span class="p">%</span><span class="no">MapSet</span><span class="p">{}</span> <span class="o">=</span> <span class="no">MapSet</span><span class="o">.</span><span class="n">new</span>
<span class="no">MapSet</span><span class="o">.</span><span class="n">new</span><span class="p">([])</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Size</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">set</span><span class="p">)</span>
<span class="o">**</span> <span class="p">(</span><span class="no">Protocol</span><span class="o">.</span><span class="no">UndefinedError</span><span class="p">)</span> <span class="n">protocol</span> <span class="no">Size</span> <span class="ow">not</span> <span class="n">implemented</span> <span class="n">for</span> <span class="no">MapSet</span><span class="o">.</span><span class="n">new</span><span class="p">([])</span> <span class="n">of</span> <span class="n">type</span> <span class="no">MapSet</span> <span class="p">(</span><span class="n">a</span> <span class="n">struct</span><span class="p">)</span>
</code></pre></div></div>

<p>Instead of sharing protocol implementation with maps, structs require their own protocol implementation. Since a <code class="language-plaintext highlighter-rouge">MapSet</code> has its size precomputed and accessible through <code class="language-plaintext highlighter-rouge">MapSet.size/1</code>, we can define a <code class="language-plaintext highlighter-rouge">Size</code> implementation for it:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defimpl</span> <span class="no">Size</span><span class="p">,</span> <span class="ss">for:</span> <span class="no">MapSet</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">size</span><span class="p">(</span><span class="n">set</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="no">MapSet</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">set</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>If desired, you could come up with your own semantics for the size of your struct. Not only that, you could use structs to build more robust data types, like queues, and implement all relevant protocols, such as <code class="language-plaintext highlighter-rouge">Enumerable</code> and possibly <code class="language-plaintext highlighter-rouge">Size</code>, for this data type.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">User</span> <span class="k">do</span>
  <span class="k">defstruct</span> <span class="p">[</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:age</span><span class="p">]</span>
<span class="k">end</span>

<span class="k">defimpl</span> <span class="no">Size</span><span class="p">,</span> <span class="ss">for:</span> <span class="no">User</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">size</span><span class="p">(</span><span class="n">_user</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="mi">2</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="implementing-any" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Implementing <code class="language-plaintext highlighter-rouge">Any</code></span><a href="#implementing-any" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Manually implementing protocols for all types can quickly become repetitive and tedious. In such cases, Elixir provides two options: we can explicitly derive the protocol implementation for our types or automatically implement the protocol for all types. In both cases, we need to implement the protocol for <code class="language-plaintext highlighter-rouge">Any</code>.</p>

<h3 id="deriving" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Deriving</span><a href="#deriving" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>Elixir allows us to derive a protocol implementation based on the <code class="language-plaintext highlighter-rouge">Any</code> implementation. Let’s first implement <code class="language-plaintext highlighter-rouge">Any</code> as follows:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defimpl</span> <span class="no">Size</span><span class="p">,</span> <span class="ss">for:</span> <span class="no">Any</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">size</span><span class="p">(</span><span class="n">_</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="mi">0</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The implementation above is arguably not a reasonable one. For example, it makes no sense to say that the size of a <code class="language-plaintext highlighter-rouge">PID</code> or an <code class="language-plaintext highlighter-rouge">Integer</code> is <code class="language-plaintext highlighter-rouge">0</code>.</p>

<p>However, we should be fine with the implementation for <code class="language-plaintext highlighter-rouge">Any</code>, in order to use such implementation we would need to tell our struct to explicitly derive the <code class="language-plaintext highlighter-rouge">Size</code> protocol:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">OtherUser</span> <span class="k">do</span>
  <span class="nv">@derive</span> <span class="p">[</span><span class="no">Size</span><span class="p">]</span>
  <span class="k">defstruct</span> <span class="p">[</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:age</span><span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>When deriving, Elixir will implement the <code class="language-plaintext highlighter-rouge">Size</code> protocol for <code class="language-plaintext highlighter-rouge">OtherUser</code> based on the implementation provided for <code class="language-plaintext highlighter-rouge">Any</code>.</p>

<h3 id="fallback-to-any" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Fallback to <code class="language-plaintext highlighter-rouge">Any</code></span><a href="#fallback-to-any" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>Another alternative to <code class="language-plaintext highlighter-rouge">@derive</code> is to explicitly tell the protocol to fallback to <code class="language-plaintext highlighter-rouge">Any</code> when an implementation cannot be found. This can be achieved by setting <code class="language-plaintext highlighter-rouge">@fallback_to_any</code> to <code class="language-plaintext highlighter-rouge">true</code> in the protocol definition:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defprotocol</span> <span class="no">Size</span> <span class="k">do</span>
  <span class="nv">@fallback_to_any</span> <span class="no">true</span>
  <span class="k">def</span> <span class="n">size</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>As we said in the previous section, the implementation of <code class="language-plaintext highlighter-rouge">Size</code> for <code class="language-plaintext highlighter-rouge">Any</code> is not one that can apply to any data type. That’s one of the reasons why <code class="language-plaintext highlighter-rouge">@fallback_to_any</code> is an opt-in behaviour. For the majority of protocols, raising an error when a protocol is not implemented is the proper behaviour. That said, assuming we have implemented <code class="language-plaintext highlighter-rouge">Any</code> as in the previous section:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defimpl</span> <span class="no">Size</span><span class="p">,</span> <span class="ss">for:</span> <span class="no">Any</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">size</span><span class="p">(</span><span class="n">_</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="mi">0</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Now all data types (including structs) that have not implemented the <code class="language-plaintext highlighter-rouge">Size</code> protocol will be considered to have a size of <code class="language-plaintext highlighter-rouge">0</code>.</p>

<p>Which technique is best between deriving and falling back to <code class="language-plaintext highlighter-rouge">Any</code> depends on the use case but, given Elixir developers prefer explicit over implicit, you may see many libraries pushing towards the <code class="language-plaintext highlighter-rouge">@derive</code> approach.</p>

<h2 id="built-in-protocols" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Built-in protocols</span><a href="#built-in-protocols" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir ships with some built-in protocols. In previous chapters, we have discussed the <code class="language-plaintext highlighter-rouge">Enum</code> module which provides many functions that work with any data structure that implements the <code class="language-plaintext highlighter-rouge">Enumerable</code> protocol:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">map</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="k">fn</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">end</span><span class="p">)</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">fn</span> <span class="n">x</span><span class="p">,</span> <span class="n">acc</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">acc</span> <span class="k">end</span><span class="p">)</span>
<span class="mi">6</span>
</code></pre></div></div>

<p>Another useful example is the <code class="language-plaintext highlighter-rouge">String.Chars</code> protocol, which specifies how to convert a data structure to its human representation as a string. It’s exposed via the <code class="language-plaintext highlighter-rouge">to_string</code> function:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">to_string</span> <span class="ss">:hello</span>
<span class="s2">"hello"</span>
</code></pre></div></div>

<p>Notice that string interpolation in Elixir calls the <code class="language-plaintext highlighter-rouge">to_string</code> function:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"age: </span><span class="si">#{</span><span class="mi">25</span><span class="si">}</span><span class="s2">"</span>
<span class="s2">"age: 25"</span>
</code></pre></div></div>

<p>The snippet above only works because numbers implement the <code class="language-plaintext highlighter-rouge">String.Chars</code> protocol. Passing a tuple, for example, will lead to an error:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">tuple</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
<span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"tuple: </span><span class="si">#{</span><span class="n">tuple</span><span class="si">}</span><span class="s2">"</span>
<span class="o">**</span> <span class="p">(</span><span class="no">Protocol</span><span class="o">.</span><span class="no">UndefinedError</span><span class="p">)</span> <span class="n">protocol</span> <span class="no">String</span><span class="o">.</span><span class="no">Chars</span> <span class="ow">not</span> <span class="n">implemented</span> <span class="n">for</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span> <span class="n">of</span> <span class="n">type</span> <span class="no">Tuple</span>
</code></pre></div></div>

<p>When there is a need to “print” a more complex data structure, one can use the <code class="language-plaintext highlighter-rouge">inspect</code> function, based on the <code class="language-plaintext highlighter-rouge">Inspect</code> protocol:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"tuple: </span><span class="si">#{</span><span class="n">inspect</span> <span class="n">tuple</span><span class="si">}</span><span class="s2">"</span>
<span class="s2">"tuple: {1, 2, 3}"</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">Inspect</code> protocol is the protocol used to transform any data structure into a readable textual representation. This is what tools like IEx use to print results:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
<span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">%</span><span class="no">User</span><span class="p">{}</span>
<span class="p">%</span><span class="no">User</span><span class="p">{</span><span class="ss">name:</span> <span class="s2">"john"</span><span class="p">,</span> <span class="ss">age:</span> <span class="mi">27</span><span class="p">}</span>
</code></pre></div></div>

<p>Keep in mind that, by convention, whenever the inspected value starts with <code class="language-plaintext highlighter-rouge">#</code>, it is representing a data structure in non-valid Elixir syntax. This means the inspect protocol is not reversible as information may be lost along the way:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">inspect</span> <span class="o">&amp;</span><span class="p">(</span><span class="nv">&amp;1</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<span class="s2">"#Function&lt;6.71889879/1 in :erl_eval.expr/5&gt;"</span>
</code></pre></div></div>

<p>There are other protocols in Elixir but this covers the most common ones. You can learn more about protocols and implementations in the <a href="https://hexdocs.pm/elixir/Protocol.html"><code class="language-plaintext highlighter-rouge">Protocol</code></a> module.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/structs.html" class="previous page-numbers spec" title="Structs">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/comprehensions.html" class="previous page-numbers spec" title="Comprehensions">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/protocols.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/comprehensions.html" page=":17:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><span title="Comprehensions">Comprehensions</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Comprehensions</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#generators-and-filters">Generators and filters</a></li><li><a href="#bitstring-generators">Bitstring generators</a></li><li><a href="#the-into-option">The <code class="language-plaintext highlighter-rouge">:into</code> option</a></li><li><a href="#other-options">Other options</a></li></ol></div>

    <p>In Elixir, it is common to loop over an Enumerable, often filtering out some results and mapping values into another list. Comprehensions are syntactic sugar for such constructs: they group those common tasks into the <code class="language-plaintext highlighter-rouge">for</code> special form.</p>

<p>For example, we can map a list of integers into their squared values:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">for</span> <span class="n">n</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="k">do</span><span class="p">:</span> <span class="n">n</span> <span class="o">*</span> <span class="n">n</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
</code></pre></div></div>

<p>A comprehension is made of three parts: generators, filters, and collectables.</p>

<h2 id="generators-and-filters" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Generators and filters</span><a href="#generators-and-filters" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>In the expression above, <code class="language-plaintext highlighter-rouge">n &lt;- [1, 2, 3, 4]</code> is the <strong>generator</strong>. It is literally generating values to be used in the comprehension. Any enumerable can be passed on the right-hand side of the generator expression:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">for</span> <span class="n">n</span> <span class="o">&lt;-</span> <span class="mi">1</span><span class="o">..</span><span class="mi">4</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">n</span> <span class="o">*</span> <span class="n">n</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
</code></pre></div></div>

<p>Generator expressions also support pattern matching on their left-hand side; all non-matching patterns are <em>ignored</em>. Imagine that, instead of a range, we have a keyword list where the key is the atom <code class="language-plaintext highlighter-rouge">:good</code> or <code class="language-plaintext highlighter-rouge">:bad</code> and we only want to compute the square of the <code class="language-plaintext highlighter-rouge">:good</code> values:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="ss">good:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">good:</span> <span class="mi">2</span><span class="p">,</span> <span class="ss">bad:</span> <span class="mi">3</span><span class="p">,</span> <span class="ss">good:</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">for</span> <span class="p">{</span><span class="ss">:good</span><span class="p">,</span> <span class="n">n</span><span class="p">}</span> <span class="o">&lt;-</span> <span class="n">values</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">n</span> <span class="o">*</span> <span class="n">n</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
</code></pre></div></div>

<p>Alternatively to pattern matching, filters can be used to select some particular elements. For example, we can select the multiples of 3 and discard all others:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">for</span> <span class="n">n</span> <span class="o">&lt;-</span> <span class="mi">0</span><span class="o">..</span><span class="mi">5</span><span class="p">,</span> <span class="n">rem</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">n</span> <span class="o">*</span> <span class="n">n</span>
<span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
</code></pre></div></div>

<p>Comprehensions discard all elements for which the filter expression returns <code class="language-plaintext highlighter-rouge">false</code> or <code class="language-plaintext highlighter-rouge">nil</code>; all other values are selected.</p>

<p>Comprehensions generally provide a much more concise representation than using the equivalent functions from the <code class="language-plaintext highlighter-rouge">Enum</code> and <code class="language-plaintext highlighter-rouge">Stream</code> modules. Furthermore, comprehensions also allow multiple generators and filters to be given. Here is an example that receives a list of directories and gets the size of each file in those directories:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dirs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'/home/mikey'</span><span class="p">,</span> <span class="s1">'/home/james'</span><span class="p">]</span>

<span class="n">for</span> <span class="n">dir</span> <span class="o">&lt;-</span> <span class="n">dirs</span><span class="p">,</span>
    <span class="n">file</span> <span class="o">&lt;-</span> <span class="no">File</span><span class="o">.</span><span class="n">ls!</span><span class="p">(</span><span class="n">dir</span><span class="p">),</span>
    <span class="n">path</span> <span class="o">=</span> <span class="no">Path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span>
    <span class="no">File</span><span class="o">.</span><span class="n">regular?</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">do</span>
  <span class="no">File</span><span class="o">.</span><span class="n">stat!</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Multiple generators can also be used to calculate the cartesian product of two lists:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">for</span> <span class="n">i</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="ss">:a</span><span class="p">,</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:c</span><span class="p">],</span> <span class="n">j</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="k">do</span><span class="p">:</span>  <span class="p">{</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">}</span>
<span class="p">[</span><span class="ss">a:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">a:</span> <span class="mi">2</span><span class="p">,</span> <span class="ss">b:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">b:</span> <span class="mi">2</span><span class="p">,</span> <span class="ss">c:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">c:</span> <span class="mi">2</span><span class="p">]</span>
</code></pre></div></div>

<p>Finally, keep in mind that variable assignments inside the comprehension, be it in generators, filters or inside the block, are not reflected outside of the comprehension.</p>

<h2 id="bitstring-generators" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Bitstring generators</span><a href="#bitstring-generators" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Bitstring generators are also supported and are very useful when you need to comprehend over bitstring streams. The example below receives a list of pixels from a binary with their respective red, green and blue values and converts them into tuples of three elements each:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">pixels</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="mi">213</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">15</span><span class="o">&gt;&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">for</span> <span class="o">&lt;&lt;</span><span class="n">r</span><span class="p">::</span><span class="mi">8</span><span class="p">,</span> <span class="n">g</span><span class="p">::</span><span class="mi">8</span><span class="p">,</span> <span class="n">b</span><span class="p">::</span><span class="mi">8</span> <span class="o">&lt;-</span> <span class="n">pixels</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="p">{</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">}</span>
<span class="p">[{</span><span class="mi">213</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">132</span><span class="p">},</span> <span class="p">{</span><span class="mi">64</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">32</span><span class="p">},</span> <span class="p">{</span><span class="mi">76</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">234</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">15</span><span class="p">}]</span>
</code></pre></div></div>

<p>A bitstring generator can be mixed with “regular” enumerable generators, and supports filters as well.</p>

<h2 id="the-into-option" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The <code class="language-plaintext highlighter-rouge">:into</code> option</span><a href="#the-into-option" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>In the examples above, all the comprehensions returned lists as their result. However, the result of a comprehension can be inserted into different data structures by passing the <code class="language-plaintext highlighter-rouge">:into</code> option to the comprehension.</p>

<p>For example, a bitstring generator can be used with the <code class="language-plaintext highlighter-rouge">:into</code> option in order to easily remove all spaces in a string:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">for</span> <span class="o">&lt;&lt;</span><span class="n">c</span> <span class="o">&lt;-</span> <span class="s2">" hello world "</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="n">c</span> <span class="o">!=</span> <span class="err">?</span><span class="p">\</span><span class="n">s</span><span class="p">,</span> <span class="ss">into:</span> <span class="s2">""</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="o">&lt;&lt;</span><span class="n">c</span><span class="o">&gt;&gt;</span>
<span class="s2">"helloworld"</span>
</code></pre></div></div>

<p>Sets, maps, and other dictionaries can also be given to the <code class="language-plaintext highlighter-rouge">:into</code> option. In general, <code class="language-plaintext highlighter-rouge">:into</code> accepts any structure that implements the <a href="https://hexdocs.pm/elixir/Collectable.html"><code class="language-plaintext highlighter-rouge">Collectable</code></a> protocol.</p>

<p>A common use case of <code class="language-plaintext highlighter-rouge">:into</code> can be transforming values in a map:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">for</span> <span class="p">{</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">}</span> <span class="o">&lt;-</span> <span class="p">%{</span><span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"b"</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">},</span> <span class="ss">into:</span> <span class="p">%{},</span> <span class="k">do</span><span class="p">:</span> <span class="p">{</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="o">*</span> <span class="n">val</span><span class="p">}</span>
<span class="p">%{</span><span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"b"</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">}</span>
</code></pre></div></div>

<p>Let’s make another example using streams. Since the <code class="language-plaintext highlighter-rouge">IO</code> module provides streams (that are both <code class="language-plaintext highlighter-rouge">Enumerable</code>s and <code class="language-plaintext highlighter-rouge">Collectable</code>s), an echo terminal that echoes back the upcased version of whatever is typed can be implemented using comprehensions:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="no">IO</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="ss">:stdio</span><span class="p">,</span> <span class="ss">:line</span><span class="p">)</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">for</span> <span class="n">line</span> <span class="o">&lt;-</span> <span class="n">stream</span><span class="p">,</span> <span class="ss">into:</span> <span class="n">stream</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="no">String</span><span class="o">.</span><span class="n">upcase</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
</code></pre></div></div>

<p>Now type any string into the terminal and you will see that the same value will be printed in upper-case. Unfortunately, this example also got your IEx shell stuck in the comprehension, so you will need to hit <code class="language-plaintext highlighter-rouge">Ctrl+C</code> twice to get out of it. :)</p>

<h2 id="other-options" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Other options</span><a href="#other-options" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Comprehensions support other options, such as <code class="language-plaintext highlighter-rouge">:reduce</code> and <code class="language-plaintext highlighter-rouge">:uniq</code>. Here are additional resources to learn more about comprehensions:</p>

<ul>
  <li><a href="https://hexdocs.pm/elixir/Kernel.SpecialForms.html#for/1"><code class="language-plaintext highlighter-rouge">for</code> official reference in Elixir documentation</a></li>
  <li><a href="https://www.mitchellhanberg.com/the-comprehensive-guide-to-elixirs-for-comprehension/">Mitchell Hanberg’s comprehensive guide to Elixir’s comprehensions</a></li>
</ul>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/protocols.html" class="previous page-numbers spec" title="Protocols">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/sigils.html" class="previous page-numbers spec" title="Sigils">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/comprehensions.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/sigils.html" page=":18:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><span title="Sigils">Sigils</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Sigils</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#regular-expressions">Regular expressions</a></li><li><a href="#strings-char-lists-and-word-lists-sigils">Strings, char lists, and word lists sigils</a><ol><li><a href="#strings">Strings</a></li><li><a href="#char-lists">Char lists</a></li><li><a href="#word-lists">Word lists</a></li></ol></li><li><a href="#interpolation-and-escaping-in-string-sigils">Interpolation and escaping in string sigils</a></li><li><a href="#calendar-sigils">Calendar sigils</a><ol><li><a href="#date">Date</a></li><li><a href="#time">Time</a></li><li><a href="#naivedatetime">NaiveDateTime</a></li><li><a href="#utc-datetime">UTC DateTime</a></li></ol></li><li><a href="#custom-sigils">Custom sigils</a></li></ol></div>

    <p>We have already learned that Elixir provides double-quoted strings and single-quoted char lists. However, this only covers the surface of structures that have textual representation in the language. Atoms, for example, are mostly created via the <code class="language-plaintext highlighter-rouge">:atom</code> representation.</p>

<p>One of Elixir’s goals is extensibility: developers should be able to extend the language to fit any particular domain. Computer science has become such a wide field that it is impossible for a language to tackle all aspects of it as part of its core. Instead, Elixir aims to make itself extensible so developers, companies, and communities can extend the language to their relevant domains.</p>

<p>In this chapter, we are going to explore sigils, which are one of the mechanisms provided by the language for working with textual representations. Sigils start with the tilde (<code class="language-plaintext highlighter-rouge">~</code>) character which is followed by a letter (which identifies the sigil) and then a delimiter; optionally, modifiers can be added after the final delimiter.</p>

<h2 id="regular-expressions" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Regular expressions</span><a href="#regular-expressions" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>The most common sigil in Elixir is <code class="language-plaintext highlighter-rouge">~r</code>, which is used to create <a href="https://en.wikipedia.org/wiki/Regular_Expressions">regular expressions</a>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># A regular expression that matches strings which contain "foo" or "bar":</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">regex</span> <span class="o">=</span> <span class="sr">~r/foo|bar/</span>
<span class="sr">~r/foo|bar/</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"foo"</span> <span class="o">=~</span> <span class="n">regex</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"bat"</span> <span class="o">=~</span> <span class="n">regex</span>
<span class="no">false</span>
</code></pre></div></div>

<p>Elixir provides Perl-compatible regular expressions (regexes), as implemented by the <a href="http://www.pcre.org/">PCRE</a> library. Regexes also support modifiers. For example, the <code class="language-plaintext highlighter-rouge">i</code> modifier makes a regular expression case insensitive:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"HELLO"</span> <span class="o">=~</span> <span class="sr">~r/hello/</span>
<span class="no">false</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="s2">"HELLO"</span> <span class="o">=~</span> <span class="sr">~r/hello/i</span>
<span class="no">true</span>
</code></pre></div></div>

<p>Check out the <a href="https://hexdocs.pm/elixir/Regex.html"><code class="language-plaintext highlighter-rouge">Regex</code> module</a> for more information on other modifiers and the supported operations with regular expressions.</p>

<p>So far, all examples have used <code class="language-plaintext highlighter-rouge">/</code> to delimit a regular expression. However, sigils support 8 different delimiters:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~r/hello/
~r|hello|
~r"hello"
~r'hello'
~r(hello)
~r[hello]
~r{hello}
~r&lt;hello&gt;
</code></pre></div></div>

<p>The reason behind supporting different delimiters is to provide a way to write literals without escaped delimiters. For example, a regular expression with forward slashes like <code class="language-plaintext highlighter-rouge">~r(^https?://)</code> reads arguably better than <code class="language-plaintext highlighter-rouge">~r/^https?:\/\//</code>. Similarly, if the regular expression has forward slashes and capturing groups (that use <code class="language-plaintext highlighter-rouge">()</code>), you may then choose double quotes instead of parentheses.</p>

<h2 id="strings-char-lists-and-word-lists-sigils" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Strings, char lists, and word lists sigils</span><a href="#strings-char-lists-and-word-lists-sigils" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Besides regular expressions, Elixir ships with three other sigils.</p>

<h3 id="strings" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Strings</span><a href="#strings" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">~s</code> sigil is used to generate strings, like double quotes are. The <code class="language-plaintext highlighter-rouge">~s</code> sigil is useful when a string contains double quotes:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="sx">~s(this is a string with "double" quotes, not 'single' ones)</span>
<span class="s2">"this is a string with </span><span class="se">\"</span><span class="s2">double</span><span class="se">\"</span><span class="s2"> quotes, not 'single' ones"</span>
</code></pre></div></div>

<h3 id="char-lists" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Char lists</span><a href="#char-lists" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">~c</code> sigil is useful for generating char lists that contain single quotes:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="sx">~c(this is a char list containing 'single quotes')</span>
<span class="s1">'this is a char list containing </span><span class="se">\'</span><span class="s1">single quotes</span><span class="se">\'</span><span class="s1">'</span>
</code></pre></div></div>

<h3 id="word-lists" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Word lists</span><a href="#word-lists" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">~w</code> sigil is used to generate lists of words (<em>words</em> are just regular strings). Inside the <code class="language-plaintext highlighter-rouge">~w</code> sigil, words are separated by whitespace.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="sx">~w(foo bar bat)</span>
<span class="p">[</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="s2">"bat"</span><span class="p">]</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">~w</code> sigil also accepts the <code class="language-plaintext highlighter-rouge">c</code>, <code class="language-plaintext highlighter-rouge">s</code> and <code class="language-plaintext highlighter-rouge">a</code> modifiers (for char lists, strings, and atoms, respectively), which specify the data type of the elements of the resulting list:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="sx">~w(foo bar bat)a</span>
<span class="p">[</span><span class="ss">:foo</span><span class="p">,</span> <span class="ss">:bar</span><span class="p">,</span> <span class="ss">:bat</span><span class="p">]</span>
</code></pre></div></div>

<h2 id="interpolation-and-escaping-in-string-sigils" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Interpolation and escaping in string sigils</span><a href="#interpolation-and-escaping-in-string-sigils" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir supports some sigil variants to deal with escaping characters and interpolation. In particular, uppercase letters sigils do not perform interpolation nor escaping. For example, although both <code class="language-plaintext highlighter-rouge">~s</code> and <code class="language-plaintext highlighter-rouge">~S</code> will return strings, the former allows escape codes and interpolation while the latter does not:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="sx">~s(String with escape codes \x26 #{"inter" &lt;&gt; "polation"})</span>
<span class="s2">"String with escape codes &amp; interpolation"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="sx">~S(String without escape codes </span><span class="err">\</span><span class="sx">x26 without </span><span class="si">#{</span><span class="n">interpolation</span><span class="si">}</span><span class="sx">)</span>
<span class="s2">"String without escape codes </span><span class="se">\\</span><span class="s2">x26 without \</span><span class="si">#{</span><span class="n">interpolation</span><span class="si">}</span><span class="s2">"</span>
</code></pre></div></div>

<p>The following escape codes can be used in strings and char lists:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">\\</code> – single backslash</li>
  <li><code class="language-plaintext highlighter-rouge">\a</code> – bell/alert</li>
  <li><code class="language-plaintext highlighter-rouge">\b</code> – backspace</li>
  <li><code class="language-plaintext highlighter-rouge">\d</code> - delete</li>
  <li><code class="language-plaintext highlighter-rouge">\e</code> - escape</li>
  <li><code class="language-plaintext highlighter-rouge">\f</code> - form feed</li>
  <li><code class="language-plaintext highlighter-rouge">\n</code> – newline</li>
  <li><code class="language-plaintext highlighter-rouge">\r</code> – carriage return</li>
  <li><code class="language-plaintext highlighter-rouge">\s</code> – space</li>
  <li><code class="language-plaintext highlighter-rouge">\t</code> – tab</li>
  <li><code class="language-plaintext highlighter-rouge">\v</code> – vertical tab</li>
  <li><code class="language-plaintext highlighter-rouge">\0</code> - null byte</li>
  <li><code class="language-plaintext highlighter-rouge">\xDD</code> - represents a single byte in hexadecimal (such as <code class="language-plaintext highlighter-rouge">\x13</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">\uDDDD</code> and <code class="language-plaintext highlighter-rouge">\u{D...}</code> - represents a Unicode codepoint in hexadecimal (such as <code class="language-plaintext highlighter-rouge">\u{1F600}</code>)</li>
</ul>

<p>In addition to those, a double quote inside a double-quoted string needs to be escaped as <code class="language-plaintext highlighter-rouge">\"</code>, and, analogously, a single quote inside a single-quoted char list needs to be escaped as <code class="language-plaintext highlighter-rouge">\'</code>. Nevertheless, it is better style to change delimiters as seen above than to escape them.</p>

<p>Sigils also support heredocs, that is, three double-quotes or single-quotes as separators:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="sx">~s""</span><span class="s2">"
...&gt; this is
...&gt; a heredoc string
...&gt; """</span>
</code></pre></div></div>

<p>The most common use case for heredoc sigils is when writing documentation. For example, writing escape characters in the documentation would soon become error prone because of the need to double-escape some characters:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">@doc</span> <span class="sd">"""
Converts double-quotes to single-quotes.

## Examples

    iex&gt; convert("\\\"foo\\\"")
    "'foo'"

"""</span>
<span class="k">def</span> <span class="n">convert</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</code></pre></div></div>

<p>By using <code class="language-plaintext highlighter-rouge">~S</code>, this problem can be avoided altogether:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">@doc</span> <span class="sx">~S""</span><span class="s2">"
Converts double-quotes to single-quotes.

## Examples

    iex&gt; convert("</span><span class="p">\</span><span class="s2">"foo</span><span class="se">\"</span><span class="s2">"</span><span class="p">)</span>
    <span class="s2">"'foo'"</span>

<span class="s2">"""
def convert(...)
</span></code></pre></div></div>

<h2 id="calendar-sigils" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Calendar sigils</span><a href="#calendar-sigils" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir offers several sigils to deal with various flavors of times and dates.</p>

<h3 id="date" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Date</span><a href="#date" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>A <a href="https://hexdocs.pm/elixir/Date.html">%Date{}</a> struct contains the fields <code class="language-plaintext highlighter-rouge">year</code>, <code class="language-plaintext highlighter-rouge">month</code>, <code class="language-plaintext highlighter-rouge">day</code>, and <code class="language-plaintext highlighter-rouge">calendar</code>. You can create one using the <code class="language-plaintext highlighter-rouge">~D</code> sigil:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="sx">~D[2019-10-31]</span>
<span class="sx">~D[2019-10-31]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">day</span>
<span class="mi">31</span>
</code></pre></div></div>

<h3 id="time" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Time</span><a href="#time" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>The <a href="https://hexdocs.pm/elixir/Time.html">%Time{}</a> struct contains the fields <code class="language-plaintext highlighter-rouge">hour</code>, <code class="language-plaintext highlighter-rouge">minute</code>, <code class="language-plaintext highlighter-rouge">second</code>, <code class="language-plaintext highlighter-rouge">microsecond</code>, and <code class="language-plaintext highlighter-rouge">calendar</code>. You can create one using the <code class="language-plaintext highlighter-rouge">~T</code> sigil:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">t</span> <span class="o">=</span> <span class="sx">~T[23:00:07.0]</span>
<span class="sx">~T[23:00:07.0]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">second</span>
<span class="mi">7</span>
</code></pre></div></div>

<h3 id="naivedatetime" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">NaiveDateTime</span><a href="#naivedatetime" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>The <a href="https://hexdocs.pm/elixir/NaiveDateTime.html">%NaiveDateTime{}</a> struct contains fields from both <code class="language-plaintext highlighter-rouge">Date</code> and <code class="language-plaintext highlighter-rouge">Time</code>. You can create one using the <code class="language-plaintext highlighter-rouge">~N</code> sigil:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">ndt</span> <span class="o">=</span> <span class="sx">~N[2019-10-31 23:00:07]</span>
<span class="sx">~N[2019-10-31 23:00:07]</span>
</code></pre></div></div>

<p>Why is it called naive? Because it does not contain timezone information. Therefore, the given datetime may not exist at all or it may exist twice in certain timezones - for example, when we move the clock back and forward for daylight saving time.</p>

<h3 id="utc-datetime" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">UTC DateTime</span><a href="#utc-datetime" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>A <a href="https://hexdocs.pm/elixir/DateTime.html">%DateTime{}</a> struct contains the same fields as a <code class="language-plaintext highlighter-rouge">NaiveDateTime</code> with the addition of fields to track timezones. The <code class="language-plaintext highlighter-rouge">~U</code> sigil allows developers to create a DateTime in the UTC timezone:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">dt</span> <span class="o">=</span> <span class="sx">~U[2019-10-31 19:59:03Z]</span>
<span class="sx">~U[2019-10-31 19:59:03Z]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">%</span><span class="no">DateTime</span><span class="p">{</span><span class="ss">minute:</span> <span class="n">minute</span><span class="p">,</span> <span class="ss">time_zone:</span> <span class="n">time_zone</span><span class="p">}</span> <span class="o">=</span> <span class="n">dt</span>
<span class="sx">~U[2019-10-31 19:59:03Z]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">minute</span>
<span class="mi">59</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">time_zone</span>
<span class="s2">"Etc/UTC"</span>
</code></pre></div></div>

<h2 id="custom-sigils" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Custom sigils</span><a href="#custom-sigils" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>As hinted at the beginning of this chapter, sigils in Elixir are extensible. In fact, using the sigil <code class="language-plaintext highlighter-rouge">~r/foo/i</code> is equivalent to calling <code class="language-plaintext highlighter-rouge">sigil_r</code> with a binary and a char list as the argument:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">sigil_r</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="s2">"foo"</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">)</span>
<span class="sr">~r"foo"i</span>
</code></pre></div></div>

<p>We can access the documentation for the <code class="language-plaintext highlighter-rouge">~r</code> sigil via <code class="language-plaintext highlighter-rouge">sigil_r</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">h</span> <span class="n">sigil_r</span>
<span class="o">...</span>
</code></pre></div></div>

<p>We can also provide our own sigils by implementing functions that follow the <code class="language-plaintext highlighter-rouge">sigil_{character}</code> pattern. For example, let’s implement the <code class="language-plaintext highlighter-rouge">~i</code> sigil that returns an integer (with the optional <code class="language-plaintext highlighter-rouge">n</code> modifier to make it negative):</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">defmodule</span> <span class="no">MySigils</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="k">def</span> <span class="n">sigil_i</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="p">[]),</span> <span class="k">do</span><span class="p">:</span> <span class="no">String</span><span class="o">.</span><span class="n">to_integer</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="o">...&gt;</span>   <span class="k">def</span> <span class="n">sigil_i</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="p">[</span><span class="sx">?n</span><span class="p">]),</span> <span class="k">do</span><span class="p">:</span> <span class="o">-</span><span class="no">String</span><span class="o">.</span><span class="n">to_integer</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="kn">import</span> <span class="no">MySigils</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="sx">~i(13)</span>
<span class="mi">13</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="sx">~i(42)</span><span class="n">n</span>
<span class="o">-</span><span class="mi">42</span>
</code></pre></div></div>

<p>Sigils can also be used to do compile-time work with the help of macros. For example, regular expressions in Elixir are compiled into an efficient representation during compilation of the source code, therefore skipping this step at runtime. If you’re interested in the subject, we recommend you learn more about macros and check out how sigils are implemented in the <code class="language-plaintext highlighter-rouge">Kernel</code> module (where the <code class="language-plaintext highlighter-rouge">sigil_*</code> functions are defined).</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/comprehensions.html" class="previous page-numbers spec" title="Comprehensions">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/try-catch-and-rescue.html" class="previous page-numbers spec" title="try, catch, and rescue">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/sigils.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/try-catch-and-rescue.html" page=":19:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><span title="try, catch, and rescue">try, catch, and rescue</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>try, catch, and rescue</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#errors">Errors</a><ol><li><a href="#fail-fast--let-it-crash">Fail fast / Let it crash</a></li><li><a href="#reraise">Reraise</a></li></ol></li><li><a href="#throws">Throws</a></li><li><a href="#exits">Exits</a></li><li><a href="#after">After</a></li><li><a href="#else">Else</a></li><li><a href="#variables-scope">Variables scope</a></li></ol></div>

    <p>Elixir has three error mechanisms: errors, throws, and exits. In this chapter, we will explore each of them and include remarks about when each should be used.</p>

<h2 id="errors" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Errors</span><a href="#errors" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Errors (or <em>exceptions</em>) are used when exceptional things happen in the code. A sample error can be retrieved by trying to add a number to an atom:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:foo</span> <span class="o">+</span> <span class="mi">1</span>
<span class="o">**</span> <span class="p">(</span><span class="no">ArithmeticError</span><span class="p">)</span> <span class="n">bad</span> <span class="n">argument</span> <span class="ow">in</span> <span class="n">arithmetic</span> <span class="n">expression</span>
     <span class="ss">:erlang</span><span class="o">.+</span><span class="p">(</span><span class="ss">:foo</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p>A runtime error can be raised any time by using <code class="language-plaintext highlighter-rouge">raise/1</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">raise</span> <span class="s2">"oops"</span>
<span class="o">**</span> <span class="p">(</span><span class="no">RuntimeError</span><span class="p">)</span> <span class="n">oops</span>
</code></pre></div></div>

<p>Other errors can be raised with <code class="language-plaintext highlighter-rouge">raise/2</code> passing the error name and a list of keyword arguments:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">raise</span> <span class="no">ArgumentError</span><span class="p">,</span> <span class="ss">message:</span> <span class="s2">"invalid argument foo"</span>
<span class="o">**</span> <span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span> <span class="n">invalid</span> <span class="n">argument</span> <span class="n">foo</span>
</code></pre></div></div>

<p>You can also define your own errors by creating a module and using the <code class="language-plaintext highlighter-rouge">defexception</code> construct inside it. This way, you’ll create an error with the same name as the module it’s defined in. The most common case is to define a custom exception with a message field:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">defmodule</span> <span class="no">MyError</span> <span class="k">do</span>
<span class="n">iex</span><span class="o">&gt;</span>   <span class="k">defexception</span> <span class="ss">message:</span> <span class="s2">"default message"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="k">end</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="k">raise</span> <span class="no">MyError</span>
<span class="o">**</span> <span class="p">(</span><span class="no">MyError</span><span class="p">)</span> <span class="n">default</span> <span class="n">message</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="k">raise</span> <span class="no">MyError</span><span class="p">,</span> <span class="ss">message:</span> <span class="s2">"custom message"</span>
<span class="o">**</span> <span class="p">(</span><span class="no">MyError</span><span class="p">)</span> <span class="n">custom</span> <span class="n">message</span>
</code></pre></div></div>

<p>Errors can be <strong>rescued</strong> using the <code class="language-plaintext highlighter-rouge">try/rescue</code> construct:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">try</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="k">raise</span> <span class="s2">"oops"</span>
<span class="o">...&gt;</span> <span class="k">rescue</span>
<span class="o">...&gt;</span>   <span class="n">e</span> <span class="ow">in</span> <span class="no">RuntimeError</span> <span class="o">-&gt;</span> <span class="n">e</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="p">%</span><span class="no">RuntimeError</span><span class="p">{</span><span class="ss">message:</span> <span class="s2">"oops"</span><span class="p">}</span>
</code></pre></div></div>

<p>The example above rescues the runtime error and returns the exception itself, which is then printed in the <code class="language-plaintext highlighter-rouge">iex</code> session.</p>

<p>If you don’t have any use for the exception, you don’t have to pass a variable to <code class="language-plaintext highlighter-rouge">rescue</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">try</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="k">raise</span> <span class="s2">"oops"</span>
<span class="o">...&gt;</span> <span class="k">rescue</span>
<span class="o">...&gt;</span>   <span class="no">RuntimeError</span> <span class="o">-&gt;</span> <span class="s2">"Error!"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="s2">"Error!"</span>
</code></pre></div></div>

<p>In practice, Elixir developers rarely use the <code class="language-plaintext highlighter-rouge">try/rescue</code> construct. For example, many languages would force you to rescue an error when a file cannot be opened successfully. Elixir instead provides a <code class="language-plaintext highlighter-rouge">File.read/1</code> function which returns a tuple containing information about whether the file was opened successfully:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="ss">:enoent</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">)</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"world"</span><span class="p">}</span>
</code></pre></div></div>

<p>There is no <code class="language-plaintext highlighter-rouge">try/rescue</code> here. In case you want to handle multiple outcomes of opening a file, you can use pattern matching using the <code class="language-plaintext highlighter-rouge">case</code> construct:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">case</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">body</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="s2">"Success: </span><span class="si">#{</span><span class="n">body</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="o">...&gt;</span>   <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="n">reason</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="s2">"Error: </span><span class="si">#{</span><span class="n">reason</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="o">...&gt;</span> <span class="k">end</span>
</code></pre></div></div>

<p>For the cases where you do expect a file to exist (and the lack of that file is truly an <em>error</em>) you may use <code class="language-plaintext highlighter-rouge">File.read!/1</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">read!</span><span class="p">(</span><span class="s2">"unknown"</span><span class="p">)</span>
<span class="o">**</span> <span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="no">Error</span><span class="p">)</span> <span class="n">could</span> <span class="ow">not</span> <span class="n">read</span> <span class="n">file</span> <span class="s2">"unknown"</span><span class="p">:</span> <span class="n">no</span> <span class="n">such</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">directory</span>
    <span class="p">(</span><span class="n">elixir</span><span class="p">)</span> <span class="n">lib</span><span class="o">/</span><span class="n">file</span><span class="o">.</span><span class="ss">ex:</span><span class="mi">272</span><span class="p">:</span> <span class="no">File</span><span class="o">.</span><span class="n">read!</span><span class="o">/</span><span class="mi">1</span>
</code></pre></div></div>

<p>At the end of the day, it’s up to your application to decide if an error while opening a file is exceptional or not. That’s why Elixir doesn’t impose exceptions on <code class="language-plaintext highlighter-rouge">File.read/1</code> and many other functions. Instead, it leaves it up to the developer to choose the best way to proceed.</p>

<p>Many functions in the standard library follow the pattern of having a counterpart that raises an exception instead of returning tuples to match against. The convention is to create a function (<code class="language-plaintext highlighter-rouge">foo</code>) which returns <code class="language-plaintext highlighter-rouge">{:ok, result}</code> or <code class="language-plaintext highlighter-rouge">{:error, reason}</code> tuples and another function (<code class="language-plaintext highlighter-rouge">foo!</code>, same name but with a trailing <code class="language-plaintext highlighter-rouge">!</code>) that takes the same arguments as <code class="language-plaintext highlighter-rouge">foo</code> but which raises an exception if there’s an error. <code class="language-plaintext highlighter-rouge">foo!</code> should return the result (not wrapped in a tuple) if everything goes fine. The <a href="https://hexdocs.pm/elixir/File.html"><code class="language-plaintext highlighter-rouge">File</code> module</a> is a good example of this convention.</p>

<h3 id="fail-fast--let-it-crash" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Fail fast / Let it crash</span><a href="#fail-fast--let-it-crash" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>One saying that is common in the Erlang community, as well as Elixir’s, is “fail fast” / “let it crash”. The idea behind let it crash is that, in case something <em>unexpected</em> happens, it is best to let the exception happen, without rescuing it.</p>

<p>It is important to emphasize the word <em>unexpected</em>. For example, imagine you are building a script to process files. Your script receives filenames as inputs. It is expected that users may make mistakes and provide unknown filenames. In this scenario, while you could use <code class="language-plaintext highlighter-rouge">File.read!/1</code> to read files and let it crash in case of invalid filenames, it probably makes more sense to use <code class="language-plaintext highlighter-rouge">File.read/1</code> and provide users of your script with a clear and precise feedback of what went wrong.</p>

<p>Other times, you may fully expect a certain file to exist, and in case it does not, it means something terribly wrong has happened elsewhere. In such cases, <code class="language-plaintext highlighter-rouge">File.read!/1</code> is all you need.</p>

<p>The second approach also works because, as discussed in the <a href="/getting-started/processes.html">Processes</a> chapter, all Elixir code runs inside processes that are isolated and don’t share anything by default. Therefore, an unhandled exception in a process will never crash or corrupt the state of another process. This allows us to define supervisor processes, which are meant to observe when a process terminates unexpectedly, and start a new one in its place.</p>

<p>At the end of the day, “fail fast” / “let it crash” is a way of saying that, when something <em>unexpected</em> happens, it is best to start from scratch within a new process, freshly started by a supervisor, rather than blindly trying to rescue all possible error cases without the full context of when and how they can happen.</p>

<h3 id="reraise" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Reraise</span><a href="#reraise" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>While we generally avoid using <code class="language-plaintext highlighter-rouge">try/rescue</code> in Elixir, one situation where we may want to use such constructs is for observability/monitoring. Imagine you want to log that something went wrong, you could do:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="k">do</span>
  <span class="o">...</span> <span class="n">some</span> <span class="n">code</span> <span class="o">...</span>
<span class="k">rescue</span>
  <span class="n">e</span> <span class="o">-&gt;</span>
    <span class="no">Logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="no">Exception</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="ss">:error</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">__STACKTRACE__</span><span class="p">))</span>
    <span class="n">reraise</span> <span class="n">e</span><span class="p">,</span> <span class="n">__STACKTRACE__</span>
<span class="k">end</span>
</code></pre></div></div>

<p>In the example above, we rescued the exception, logged it, and then re-raised it. We use the <code class="language-plaintext highlighter-rouge">__STACKTRACE__</code> construct both when formatting the exception and when re-raising. This ensures we reraise the exception as is, without changing value or its origin.</p>

<p>Generally speaking, we take errors in Elixir literally: they are reserved for unexpected and/or exceptional situations, never for controlling the flow of our code. In case you actually need flow control constructs, <em>throws</em> should be used. That’s what we are going to see next.</p>

<h2 id="throws" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Throws</span><a href="#throws" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>In Elixir, a value can be thrown and later be caught. <code class="language-plaintext highlighter-rouge">throw</code> and <code class="language-plaintext highlighter-rouge">catch</code> are reserved for situations where it is not possible to retrieve a value unless by using <code class="language-plaintext highlighter-rouge">throw</code> and <code class="language-plaintext highlighter-rouge">catch</code>.</p>

<p>Those situations are quite uncommon in practice except when interfacing with libraries that do not provide a proper API. For example, let’s imagine the <code class="language-plaintext highlighter-rouge">Enum</code> module did not provide any API for finding a value and that we needed to find the first multiple of 13 in a list of numbers:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">try</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="no">Enum</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="o">..</span><span class="mi">50</span><span class="p">,</span> <span class="k">fn</span> <span class="n">x</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="k">if</span> <span class="n">rem</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="k">throw</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="o">...&gt;</span>   <span class="k">end</span><span class="p">)</span>
<span class="o">...&gt;</span>   <span class="s2">"Got nothing"</span>
<span class="o">...&gt;</span> <span class="k">catch</span>
<span class="o">...&gt;</span>   <span class="n">x</span> <span class="o">-&gt;</span> <span class="s2">"Got </span><span class="si">#{</span><span class="n">x</span><span class="si">}</span><span class="s2">"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="s2">"Got -39"</span>
</code></pre></div></div>

<p>Since <code class="language-plaintext highlighter-rouge">Enum</code> <em>does</em> provide a proper API, in practice <code class="language-plaintext highlighter-rouge">Enum.find/2</code> is the way to go:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="o">..</span><span class="mi">50</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">rem</span><span class="p">(</span><span class="nv">&amp;1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
<span class="o">-</span><span class="mi">39</span>
</code></pre></div></div>

<h2 id="exits" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Exits</span><a href="#exits" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>All Elixir code runs inside processes that communicate with each other. When a process dies of “natural causes” (e.g., unhandled exceptions), it sends an <code class="language-plaintext highlighter-rouge">exit</code> signal. A process can also die by explicitly sending an <code class="language-plaintext highlighter-rouge">exit</code> signal:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">spawn_link</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span> <span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">end</span><span class="p">)</span>
<span class="o">**</span> <span class="p">(</span><span class="no">EXIT</span> <span class="n">from</span> <span class="c1">#PID&lt;0.56.0&gt;) shell process exited with reason: 1</span>
</code></pre></div></div>

<p>In the example above, the linked process died by sending an <code class="language-plaintext highlighter-rouge">exit</code> signal with a value of 1. The Elixir shell automatically handles those messages and prints them to the terminal.</p>

<p><code class="language-plaintext highlighter-rouge">exit</code> can also be “caught” using <code class="language-plaintext highlighter-rouge">try/catch</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">try</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="k">exit</span><span class="p">(</span><span class="s2">"I am exiting"</span><span class="p">)</span>
<span class="o">...&gt;</span> <span class="k">catch</span>
<span class="o">...&gt;</span>   <span class="ss">:exit</span><span class="p">,</span> <span class="n">_</span> <span class="o">-&gt;</span> <span class="s2">"not really"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="s2">"not really"</span>
</code></pre></div></div>

<p>Using <code class="language-plaintext highlighter-rouge">try/catch</code> is already uncommon and using it to catch exits is even rarer.</p>

<p><code class="language-plaintext highlighter-rouge">exit</code> signals are an important part of the fault tolerant system provided by the Erlang <abbr title="Virtual Machine">VM</abbr>. Processes usually run under supervision trees which are themselves processes that listen to <code class="language-plaintext highlighter-rouge">exit</code> signals from the supervised processes. Once an <code class="language-plaintext highlighter-rouge">exit</code> signal is received, the supervision strategy kicks in and the supervised process is restarted.</p>

<p>It is exactly this supervision system that makes constructs like <code class="language-plaintext highlighter-rouge">try/catch</code> and <code class="language-plaintext highlighter-rouge">try/rescue</code> so uncommon in Elixir. Instead of rescuing an error, we’d rather “fail fast” since the supervision tree will guarantee our application will go back to a known initial state after the error.</p>

<h2 id="after" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">After</span><a href="#after" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Sometimes it’s necessary to ensure that a resource is cleaned up after some action that could potentially raise an error. The <code class="language-plaintext highlighter-rouge">try/after</code> construct allows you to do that. For example, we can open a file and use an <code class="language-plaintext highlighter-rouge">after</code> clause to close it – even if something goes wrong:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">file</span><span class="p">}</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">"sample"</span><span class="p">,</span> <span class="p">[</span><span class="ss">:utf8</span><span class="p">,</span> <span class="ss">:write</span><span class="p">])</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="k">try</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="no">IO</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">"olá"</span><span class="p">)</span>
<span class="o">...&gt;</span>   <span class="k">raise</span> <span class="s2">"oops, something went wrong"</span>
<span class="o">...&gt;</span> <span class="k">after</span>
<span class="o">...&gt;</span>   <span class="no">File</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="o">**</span> <span class="p">(</span><span class="no">RuntimeError</span><span class="p">)</span> <span class="n">oops</span><span class="p">,</span> <span class="n">something</span> <span class="n">went</span> <span class="n">wrong</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">after</code> clause will be executed regardless of whether or not the tried block succeeds. Note, however, that if a linked process exits,
this process will exit and the <code class="language-plaintext highlighter-rouge">after</code> clause will not get run. Thus <code class="language-plaintext highlighter-rouge">after</code> provides only a soft guarantee. Luckily, files in Elixir are also linked to the current processes and therefore they will always get closed if the current process crashes, independent of the
<code class="language-plaintext highlighter-rouge">after</code> clause. You will find the same to be true for other resources like ETS tables, sockets, ports and more.</p>

<p>Sometimes you may want to wrap the entire body of a function in a <code class="language-plaintext highlighter-rouge">try</code> construct, often to guarantee some code will be executed afterwards. In such cases, Elixir allows you to omit the <code class="language-plaintext highlighter-rouge">try</code> line:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">defmodule</span> <span class="no">RunAfter</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="k">def</span> <span class="n">without_even_trying</span> <span class="k">do</span>
<span class="o">...&gt;</span>     <span class="k">raise</span> <span class="s2">"oops"</span>
<span class="o">...&gt;</span>   <span class="k">after</span>
<span class="o">...&gt;</span>     <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="s2">"cleaning up!"</span>
<span class="o">...&gt;</span>   <span class="k">end</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">RunAfter</span><span class="o">.</span><span class="n">without_even_trying</span>
<span class="n">cleaning</span> <span class="n">up!</span>
<span class="o">**</span> <span class="p">(</span><span class="no">RuntimeError</span><span class="p">)</span> <span class="n">oops</span>
</code></pre></div></div>

<p>Elixir will automatically wrap the function body in a <code class="language-plaintext highlighter-rouge">try</code> whenever one of <code class="language-plaintext highlighter-rouge">after</code>, <code class="language-plaintext highlighter-rouge">rescue</code> or <code class="language-plaintext highlighter-rouge">catch</code> is specified.</p>

<h2 id="else" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Else</span><a href="#else" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>If an <code class="language-plaintext highlighter-rouge">else</code> block is present, it will match on the results of the <code class="language-plaintext highlighter-rouge">try</code> block whenever the <code class="language-plaintext highlighter-rouge">try</code> block finishes without a throw or an error.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="mi">2</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="k">try</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="mi">1</span> <span class="o">/</span> <span class="n">x</span>
<span class="o">...&gt;</span> <span class="k">rescue</span>
<span class="o">...&gt;</span>   <span class="no">ArithmeticError</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="ss">:infinity</span>
<span class="o">...&gt;</span> <span class="k">else</span>
<span class="o">...&gt;</span>   <span class="n">y</span> <span class="ow">when</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="ss">:small</span>
<span class="o">...&gt;</span>   <span class="n">_</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>     <span class="ss">:large</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="ss">:small</span>
</code></pre></div></div>

<p>Exceptions in the <code class="language-plaintext highlighter-rouge">else</code> block are not caught. If no pattern inside the <code class="language-plaintext highlighter-rouge">else</code> block matches, an exception will be raised; this exception is not caught by the current <code class="language-plaintext highlighter-rouge">try/catch/rescue/after</code> block.</p>

<h2 id="variables-scope" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Variables scope</span><a href="#variables-scope" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Similar to <code class="language-plaintext highlighter-rouge">case</code>, <code class="language-plaintext highlighter-rouge">cond</code>, <code class="language-plaintext highlighter-rouge">if</code> and other constructs in Elixir, variables defined inside <code class="language-plaintext highlighter-rouge">try/catch/rescue/after</code> blocks do not leak to the outer context. In other words, this code is invalid:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">try</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="k">raise</span> <span class="s2">"fail"</span>
<span class="o">...&gt;</span>   <span class="n">what_happened</span> <span class="o">=</span> <span class="ss">:did_not_raise</span>
<span class="o">...&gt;</span> <span class="k">rescue</span>
<span class="o">...&gt;</span>   <span class="n">_</span> <span class="o">-&gt;</span> <span class="n">what_happened</span> <span class="o">=</span> <span class="ss">:rescued</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">what_happened</span>
<span class="o">**</span> <span class="p">(</span><span class="no">CompileError</span><span class="p">)</span> <span class="n">undefined</span> <span class="ss">function:</span> <span class="n">what_happened</span><span class="o">/</span><span class="mi">0</span>
</code></pre></div></div>

<p>Instead, you should return the value of the <code class="language-plaintext highlighter-rouge">try</code> expression:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">what_happened</span> <span class="o">=</span>
<span class="o">...&gt;</span>   <span class="k">try</span> <span class="k">do</span>
<span class="o">...&gt;</span>     <span class="k">raise</span> <span class="s2">"fail"</span>
<span class="o">...&gt;</span>     <span class="ss">:did_not_raise</span>
<span class="o">...&gt;</span>   <span class="k">rescue</span>
<span class="o">...&gt;</span>     <span class="n">_</span> <span class="o">-&gt;</span> <span class="ss">:rescued</span>
<span class="o">...&gt;</span>   <span class="k">end</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">what_happened</span>
<span class="ss">:rescued</span>
</code></pre></div></div>

<p>Furthermore, variables defined in the do-block of <code class="language-plaintext highlighter-rouge">try</code> are not available inside <code class="language-plaintext highlighter-rouge">rescue/after/else</code> either. This is because the <code class="language-plaintext highlighter-rouge">try</code> block may fail at any moment and therefore the variables may have never been bound in the first place. So this also isn’t valid:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">try</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="k">raise</span> <span class="s2">"fail"</span>
<span class="o">...&gt;</span>   <span class="n">another_what_happened</span> <span class="o">=</span> <span class="ss">:did_not_raise</span>
<span class="o">...&gt;</span> <span class="k">rescue</span>
<span class="o">...&gt;</span>   <span class="n">_</span> <span class="o">-&gt;</span> <span class="n">another_what_happened</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="o">**</span> <span class="p">(</span><span class="no">CompileError</span><span class="p">)</span> <span class="n">undefined</span> <span class="ss">function:</span> <span class="n">another_what_happened</span><span class="o">/</span><span class="mi">0</span>
</code></pre></div></div>

<p>This finishes our introduction to <code class="language-plaintext highlighter-rouge">try</code>, <code class="language-plaintext highlighter-rouge">catch</code>, and <code class="language-plaintext highlighter-rouge">rescue</code>. You will find they are used less frequently in Elixir than in other languages.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/sigils.html" class="previous page-numbers spec" title="Sigils">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/optional-syntax.html" class="previous page-numbers spec" title="Optional syntax sheet">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/try-catch-and-rescue.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/optional-syntax.html" page=":20:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><span title="Optional syntax sheet">Optional syntax sheet</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Optional syntax sheet</h1>
    </div>

    <div id="toc" class="toc"></div>

    <p>In this guide so far, we learned that the Elixir syntax allows developers to omit delimiters in a few occasions to make code more readable. For example, we learned that parentheses are optional:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">length</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="n">length</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="no">true</span>
</code></pre></div></div>

<p>and that <code class="language-plaintext highlighter-rouge">do</code>-<code class="language-plaintext highlighter-rouge">end</code> blocks are equivalent to keyword lists:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># do-end blocks</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="k">if</span> <span class="no">true</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="ss">:this</span>
<span class="o">...&gt;</span> <span class="k">else</span>
<span class="o">...&gt;</span>   <span class="ss">:that</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="ss">:this</span>

<span class="c1"># keyword lists</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="k">if</span> <span class="no">true</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="ss">:this</span><span class="p">,</span> <span class="k">else</span><span class="p">:</span> <span class="ss">:that</span>
<span class="ss">:this</span>
</code></pre></div></div>

<p>Keyword lists use Elixir’s regular notation for separating arguments, where we separate each key-value pair with commas, and each key is followed by <code class="language-plaintext highlighter-rouge">:</code>. In the <code class="language-plaintext highlighter-rouge">do</code>-blocks, we get rid of the colons, the commas, and separate each keyword by a newline. They are useful exactly because they remove the verbosity when writing blocks of code. Most of the time, we use the block syntax, but it is good to know they are equivalent.</p>

<p>Those conveniences, which we call here “optional syntax”, allow the language syntax core to be small, without sacrificing the readability and expressiveness of your code.  In this brief chapter, we will review the four rules provided by the language, using a short snippet as playground.</p>

<h2 id="walk-through">Walk-through</h2>

<p>Take the following code:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">variable?</span> <span class="k">do</span>
  <span class="no">Call</span><span class="o">.</span><span class="n">this</span><span class="p">()</span>
<span class="k">else</span>
  <span class="no">Call</span><span class="o">.</span><span class="n">that</span><span class="p">()</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Now let’s remove the conveniences one by one:</p>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">do</code>-<code class="language-plaintext highlighter-rouge">end</code> blocks are equivalent to keywords:</p>

    <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">variable?</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="no">Call</span><span class="o">.</span><span class="n">this</span><span class="p">(),</span> <span class="k">else</span><span class="p">:</span> <span class="no">Call</span><span class="o">.</span><span class="n">that</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Keyword lists as last argument do not require square brackets, but let’s add them:</p>

    <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">variable?</span><span class="p">,</span> <span class="p">[</span><span class="k">do</span><span class="p">:</span> <span class="no">Call</span><span class="o">.</span><span class="n">this</span><span class="p">(),</span> <span class="k">else</span><span class="p">:</span> <span class="no">Call</span><span class="o">.</span><span class="n">that</span><span class="p">()]</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Keyword lists are the same as lists of two-element tuples:</p>

    <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">variable?</span><span class="p">,</span> <span class="p">[{</span><span class="ss">:do</span><span class="p">,</span> <span class="no">Call</span><span class="o">.</span><span class="n">this</span><span class="p">()},</span> <span class="p">{</span><span class="ss">:else</span><span class="p">,</span> <span class="no">Call</span><span class="o">.</span><span class="n">that</span><span class="p">()}]</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Finally, parentheses are optional, but let’s add them:</p>

    <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span><span class="n">variable?</span><span class="p">,</span> <span class="p">[{</span><span class="ss">:do</span><span class="p">,</span> <span class="no">Call</span><span class="o">.</span><span class="n">this</span><span class="p">()},</span> <span class="p">{</span><span class="ss">:else</span><span class="p">,</span> <span class="no">Call</span><span class="o">.</span><span class="n">that</span><span class="p">()}])</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>That’s it! Those four rules outline the optional syntax available in Elixir.</p>

<p>To understand why these rules matter, we can briefly compare Elixir with many other programming languages. Most programming languages has several keywords for defining methods, functions, conditionals, loops, and so forth. Each of those keywords have their own syntax rules attached to them.</p>

<p>However, in Elixir, the syntax for defining modules, functions, conditionals, and so on all use the syntax rules above! None of these language features require special “keywords” in the language. At the end, learning Elixir requires knowing less syntax because the language is built on fewer rules. The other benefit is that developers can also extend the language in a way that is consistent with the language itself, since the constructs for designing and extending the language are the same!</p>

<p>At the end of the day, those rules are what enables us to write:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Math</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>instead of:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span><span class="p">(</span><span class="no">Math</span><span class="p">,</span> <span class="p">[</span>
  <span class="p">{</span><span class="ss">:do</span><span class="p">,</span> <span class="k">def</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="p">[{</span><span class="ss">:do</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">}])}</span>
<span class="p">])</span>
</code></pre></div></div>

<p>Whenever you have any questions, this quick walk-through has you covered.</p>

<p>Finally, if you are worried about when to apply those rules, keep in mind that those concerns are handled by the Elixir formatter. In our day to day, Elixir developers use the <a href="https://hexdocs.pm/mix/Mix.Tasks.Format.html"><code class="language-plaintext highlighter-rouge">mix format</code></a> task to format our codebases according to a well-defined set of rules defined by the Elixir team and the community. For instance, <code class="language-plaintext highlighter-rouge">mix format</code> will always add parentheses to function calls unless explicitly configured to not do so. This ensures all codebases in your company and in the community follow the same standards.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/try-catch-and-rescue.html" class="previous page-numbers spec" title="try, catch, and rescue">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/erlang-libraries.html" class="previous page-numbers spec" title="Erlang libraries">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/optional-syntax.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/erlang-libraries.html" page=":21:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><span title="Erlang libraries">Erlang libraries</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Erlang libraries</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#the-binary-module">The binary module</a></li><li><a href="#formatted-text-output">Formatted text output</a></li><li><a href="#the-crypto-module">The crypto module</a></li><li><a href="#the-digraph-module">The digraph module</a></li><li><a href="#erlang-term-storage">Erlang Term Storage</a></li><li><a href="#the-math-module">The math module</a></li><li><a href="#the-queue-module">The queue module</a></li><li><a href="#the-rand-module">The rand module</a></li><li><a href="#the-zip-and-zlib-modules">The zip and zlib modules</a></li></ol></div>

    <p>Elixir provides excellent interoperability with Erlang libraries. In fact,
Elixir discourages simply wrapping Erlang libraries in favor of directly
interfacing with Erlang code. In this section, we will present some of the
most common and useful Erlang functionality that is not found in Elixir.</p>

<p>As you grow more proficient in Elixir, you may want to explore the Erlang
<a href="http://www.erlang.org/doc/apps/stdlib/index.html">STDLIB Reference Manual</a> in more
detail.</p>

<h2 id="the-binary-module" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The binary module</span><a href="#the-binary-module" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>The built-in Elixir String module handles binaries that are UTF-8 encoded.
<a href="http://www.erlang.org/doc/man/binary.html">The binary module</a> is useful when
you are dealing with binary data that is not necessarily UTF-8 encoded.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">to_charlist</span> <span class="s2">"Ø"</span>
<span class="p">[</span><span class="mi">216</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:binary</span><span class="o">.</span><span class="n">bin_to_list</span> <span class="s2">"Ø"</span>
<span class="p">[</span><span class="mi">195</span><span class="p">,</span> <span class="mi">152</span><span class="p">]</span>
</code></pre></div></div>

<p>The above example shows the difference; the <code class="language-plaintext highlighter-rouge">String</code> module returns Unicode
codepoints, while <code class="language-plaintext highlighter-rouge">:binary</code> deals with raw data bytes.</p>

<h2 id="formatted-text-output" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Formatted text output</span><a href="#formatted-text-output" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir does not contain a function similar to <code class="language-plaintext highlighter-rouge">printf</code> found in C and other
languages. Luckily, the Erlang standard library functions <code class="language-plaintext highlighter-rouge">:io.format/2</code> and
<code class="language-plaintext highlighter-rouge">:io_lib.format/2</code> may be used. The first formats to terminal output, while
the second formats to an iolist. The format specifiers differ from <code class="language-plaintext highlighter-rouge">printf</code>,
<a href="http://www.erlang.org/doc/man/io.html#format-1">refer to the Erlang documentation for details</a>.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:io</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"Pi is approximately given by:~10.3f~n"</span><span class="p">,</span> <span class="p">[</span><span class="ss">:math</span><span class="o">.</span><span class="n">pi</span><span class="p">])</span>
<span class="no">Pi</span> <span class="n">is</span> <span class="n">approximately</span> <span class="n">given</span> <span class="ss">by:</span>     <span class="mf">3.142</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">to_string</span> <span class="ss">:io_lib</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"Pi is approximately given by:~10.3f~n"</span><span class="p">,</span> <span class="p">[</span><span class="ss">:math</span><span class="o">.</span><span class="n">pi</span><span class="p">])</span>
<span class="s2">"Pi is approximately given by:     3.142</span><span class="se">\n</span><span class="s2">"</span>
</code></pre></div></div>

<p>Also note that Erlang’s formatting functions require special attention to
Unicode handling.</p>

<h2 id="the-crypto-module" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The crypto module</span><a href="#the-crypto-module" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p><a href="http://www.erlang.org/doc/man/crypto.html">The crypto module</a> contains hashing
functions, digital signatures, encryption and more:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Base</span><span class="o">.</span><span class="n">encode16</span><span class="p">(</span><span class="ss">:crypto</span><span class="o">.</span><span class="n">hash</span><span class="p">(</span><span class="ss">:sha256</span><span class="p">,</span> <span class="s2">"Elixir"</span><span class="p">))</span>
<span class="s2">"3315715A7A3AD57428298676C5AE465DADA38D951BDFAC9348A8A31E9C7401CB"</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">:crypto</code> module is part of the <code class="language-plaintext highlighter-rouge">:crypto</code> application that ships with
Erlang. This means you must list the <code class="language-plaintext highlighter-rouge">:crypto</code> application as an additional
application in your project configuration. To do this, edit your <code class="language-plaintext highlighter-rouge">mix.exs</code>
file to include:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">application</span> <span class="k">do</span>
  <span class="p">[</span><span class="ss">extra_applications:</span> <span class="p">[</span><span class="ss">:crypto</span><span class="p">]]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Any module that is not part of the <code class="language-plaintext highlighter-rouge">:kernel</code> or <code class="language-plaintext highlighter-rouge">:stdlib</code> Erlang applications
must have their application explicitly listed in your <code class="language-plaintext highlighter-rouge">mix.exs</code>. You can find
the application name of any Erlang module in the Erlang documentation, immediately
below the Erlang logo in the sidebar.</p>

<h2 id="the-digraph-module" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The digraph module</span><a href="#the-digraph-module" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p><a href="http://www.erlang.org/doc/man/digraph.html">The digraph module</a> (as well as
<a href="http://www.erlang.org/doc/man/digraph_utils.html">digraph_utils</a>) contains
functions for dealing with directed graphs built of vertices and edges.
After constructing the graph, the algorithms in there will help find,
for instance, the shortest path between two vertices, or loops in the graph.</p>

<p>Given three vertices, find the shortest path from the first to the last.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">digraph</span> <span class="o">=</span> <span class="ss">:digraph</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">coords</span> <span class="o">=</span> <span class="p">[{</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">},</span> <span class="p">{</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">},</span> <span class="p">{</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">}]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">for</span> <span class="n">c</span> <span class="o">&lt;-</span> <span class="n">coords</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="ss">:digraph</span><span class="o">.</span><span class="n">add_vertex</span><span class="p">(</span><span class="n">digraph</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:digraph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">digraph</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:digraph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">digraph</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:digraph</span><span class="o">.</span><span class="n">get_short_path</span><span class="p">(</span><span class="n">digraph</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
<span class="p">[{</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">},</span> <span class="p">{</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">},</span> <span class="p">{</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">}]</span>
</code></pre></div></div>

<p>Note that the functions in <code class="language-plaintext highlighter-rouge">:digraph</code> alter the graph structure in-place, this
is possible because they are implemented as ETS tables, explained next.</p>

<h2 id="erlang-term-storage" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Erlang Term Storage</span><a href="#erlang-term-storage" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>The modules <a href="http://www.erlang.org/doc/man/ets.html"><code class="language-plaintext highlighter-rouge">ets</code></a> and
<a href="http://www.erlang.org/doc/man/dets.html"><code class="language-plaintext highlighter-rouge">dets</code></a> handle storage of large
data structures in memory or on disk respectively.</p>

<p>ETS lets you create a table containing tuples. By default, ETS tables
are protected, which means only the owner process may write to the table
but any other process can read. ETS has some functionality to allow a
table to be used as a simple database, a key-value store or as a cache
mechanism.</p>

<p>The functions in the <code class="language-plaintext highlighter-rouge">ets</code> module will modify the state of the table as a
side-effect.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">table</span> <span class="o">=</span> <span class="ss">:ets</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:ets_test</span><span class="p">,</span> <span class="p">[])</span>
<span class="c1"># Store as tuples with {name, population}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:ets</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="p">{</span><span class="s2">"China"</span><span class="p">,</span> <span class="mi">1_374_000_000</span><span class="p">})</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:ets</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="p">{</span><span class="s2">"India"</span><span class="p">,</span> <span class="mi">1_284_000_000</span><span class="p">})</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:ets</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="p">{</span><span class="s2">"USA"</span><span class="p">,</span> <span class="mi">322_000_000</span><span class="p">})</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:ets</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
<span class="o">&lt;</span><span class="mi">1</span>   <span class="o">&gt;</span> <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s2">"India"</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="mi">1284000000</span><span class="p">}</span>
<span class="o">&lt;</span><span class="mi">2</span>   <span class="o">&gt;</span> <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s2">"USA"</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="mi">322000000</span><span class="p">}</span>
<span class="o">&lt;</span><span class="mi">3</span>   <span class="o">&gt;</span> <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s2">"China"</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="mi">1374000000</span><span class="p">}</span>
</code></pre></div></div>

<h2 id="the-math-module" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The math module</span><a href="#the-math-module" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p><a href="http://www.erlang.org/doc/man/math.html">The <code class="language-plaintext highlighter-rouge">math</code> module</a> contains common
mathematical operations covering trigonometry, exponential, and logarithmic
functions.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">angle_45_deg</span> <span class="o">=</span> <span class="ss">:math</span><span class="o">.</span><span class="n">pi</span><span class="p">()</span> <span class="o">*</span> <span class="mf">45.0</span> <span class="o">/</span> <span class="mf">180.0</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_45_deg</span><span class="p">)</span>
<span class="mf">0.7071067811865475</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">55.0</span><span class="p">)</span>
<span class="mf">7.694785265142018e23</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">7.694785265142018e23</span><span class="p">)</span>
<span class="mf">55.0</span>
</code></pre></div></div>

<h2 id="the-queue-module" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The queue module</span><a href="#the-queue-module" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>The <a href="http://www.erlang.org/doc/man/queue.html"><code class="language-plaintext highlighter-rouge">queue</code> is a data structure</a>
that implements (double-ended) FIFO (first-in first-out) queues efficiently:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">q</span> <span class="o">=</span> <span class="ss">:queue</span><span class="o">.</span><span class="n">new</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">q</span> <span class="o">=</span> <span class="ss">:queue</span><span class="o">.</span><span class="ow">in</span><span class="p">(</span><span class="s2">"A"</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">q</span> <span class="o">=</span> <span class="ss">:queue</span><span class="o">.</span><span class="ow">in</span><span class="p">(</span><span class="s2">"B"</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="n">value</span><span class="p">,</span> <span class="n">q</span><span class="p">}</span> <span class="o">=</span> <span class="ss">:queue</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">value</span>
<span class="p">{</span><span class="ss">:value</span><span class="p">,</span> <span class="s2">"A"</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="n">value</span><span class="p">,</span> <span class="n">q</span><span class="p">}</span> <span class="o">=</span> <span class="ss">:queue</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">value</span>
<span class="p">{</span><span class="ss">:value</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="n">value</span><span class="p">,</span> <span class="n">q</span><span class="p">}</span> <span class="o">=</span> <span class="ss">:queue</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">value</span>
<span class="ss">:empty</span>
</code></pre></div></div>

<h2 id="the-rand-module" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The rand module</span><a href="#the-rand-module" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p><a href="http://www.erlang.org/doc/man/rand.html"><code class="language-plaintext highlighter-rouge">rand</code> has functions</a> for returning
random values and setting the random seed.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:rand</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span>
<span class="mf">0.8175669086010815</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">_</span> <span class="o">=</span> <span class="ss">:rand</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="ss">:exs1024</span><span class="p">,</span> <span class="p">{</span><span class="mi">123</span><span class="p">,</span> <span class="mi">123534</span><span class="p">,</span> <span class="mi">345345</span><span class="p">})</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:rand</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span>
<span class="mf">0.5820506340260994</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:rand</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="mi">6</span>
</code></pre></div></div>

<h2 id="the-zip-and-zlib-modules" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The zip and zlib modules</span><a href="#the-zip-and-zlib-modules" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p><a href="http://www.erlang.org/doc/man/zip.html">The <code class="language-plaintext highlighter-rouge">zip</code> module</a> lets you read and write
ZIP files to and from disk or memory, as well as extracting file information.</p>

<p>This code counts the number of files in a ZIP file:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:zip</span><span class="o">.</span><span class="n">foldl</span><span class="p">(</span><span class="k">fn</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">acc</span> <span class="o">-&gt;</span> <span class="n">acc</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">:binary</span><span class="o">.</span><span class="n">bin_to_list</span><span class="p">(</span><span class="s2">"file.zip"</span><span class="p">))</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="mi">633</span><span class="p">}</span>
</code></pre></div></div>

<p><a href="http://www.erlang.org/doc/man/zlib.html">The <code class="language-plaintext highlighter-rouge">zlib</code> module</a> deals with data compression in zlib format, as found in the
<code class="language-plaintext highlighter-rouge">gzip</code> command.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">song</span> <span class="o">=</span> <span class="s2">"
...&gt; Mary had a little lamb,
...&gt; His fleece was white as snow,
...&gt; And everywhere that Mary went,
...&gt; The lamb was sure to go."</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">compressed</span> <span class="o">=</span> <span class="ss">:zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">byte_size</span> <span class="n">song</span>
<span class="mi">110</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">byte_size</span> <span class="n">compressed</span>
<span class="mi">99</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:zlib</span><span class="o">.</span><span class="n">uncompress</span><span class="p">(</span><span class="n">compressed</span><span class="p">)</span>
<span class="s2">"</span><span class="se">\n</span><span class="s2">Mary had a little lamb,</span><span class="se">\n</span><span class="s2">His fleece was white as snow,</span><span class="se">\n</span><span class="s2">And everywhere that Mary went,</span><span class="se">\n</span><span class="s2">The lamb was sure to go."</span>
</code></pre></div></div>

<p>Now let’s take a look at existing Elixir (and Erlang) libraries you might use while debugging.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/optional-syntax.html" class="previous page-numbers spec" title="Optional syntax sheet">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/debugging.html" class="previous page-numbers spec" title="Debugging">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/erlang-libraries.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/debugging.html" page=":22:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><span title="Debugging">Debugging</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Debugging</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#ioinspect2">IO.inspect/2</a></li><li><a href="#dbg"><code class="language-plaintext highlighter-rouge">dbg</code></a></li><li><a href="#breakpoints">Breakpoints</a></li><li><a href="#debugger">Debugger</a></li><li><a href="#observer">Observer</a></li><li><a href="#other-tools-and-community">Other tools and community</a></li></ol></div>

    <p>There are a number of ways to debug code in Elixir. In this chapter we will cover some of the more common ways of doing so.</p>

<h2 id="ioinspect2" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">IO.inspect/2</span><a href="#ioinspect2" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>What makes <code class="language-plaintext highlighter-rouge">IO.inspect(item, opts \\ [])</code> really useful in debugging is that it returns the <code class="language-plaintext highlighter-rouge">item</code> argument passed to it without affecting the behavior of the original code. Let’s see an example.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span>
<span class="o">|&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">inspect</span>
<span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">fn</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">end</span><span class="p">)</span>
<span class="o">|&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">inspect</span>
<span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">sum</span>
<span class="o">|&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">inspect</span>
</code></pre></div></div>

<p>Prints:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span><span class="o">..</span><span class="mi">10</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<span class="mi">110</span>
</code></pre></div></div>

<p>As you can see <code class="language-plaintext highlighter-rouge">IO.inspect/2</code> makes it possible to “spy” on values almost anywhere in your code without altering the result, making it very helpful inside of a pipeline like in the above case.</p>

<p><code class="language-plaintext highlighter-rouge">IO.inspect/2</code> also provides the ability to decorate the output with a <code class="language-plaintext highlighter-rouge">label</code> option. The label will be printed before the inspected <code class="language-plaintext highlighter-rouge">item</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="o">|&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="ss">label:</span> <span class="s2">"before"</span><span class="p">)</span>
<span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="nv">&amp;1</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
<span class="o">|&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="ss">label:</span> <span class="s2">"after"</span><span class="p">)</span>
<span class="o">|&gt;</span> <span class="no">Enum</span><span class="o">.</span><span class="n">sum</span>
</code></pre></div></div>

<p>Prints:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="ss">before:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="k">after</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
</code></pre></div></div>

<p>It is also very common to use <code class="language-plaintext highlighter-rouge">IO.inspect/2</code> with <a href="https://hexdocs.pm/elixir/Kernel.html#binding/0"><code class="language-plaintext highlighter-rouge">binding()</code></a>, which returns all variable names and their values:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">some_fun</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">do</span>
  <span class="no">IO</span><span class="o">.</span><span class="n">inspect</span> <span class="n">binding</span><span class="p">()</span>
  <span class="o">...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>When <code class="language-plaintext highlighter-rouge">some_fun/3</code> is invoked with <code class="language-plaintext highlighter-rouge">:foo</code>, <code class="language-plaintext highlighter-rouge">"bar"</code>, <code class="language-plaintext highlighter-rouge">:baz</code> it prints:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="ss">a:</span> <span class="ss">:foo</span><span class="p">,</span> <span class="ss">b:</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="ss">c:</span> <span class="ss">:baz</span><span class="p">]</span>
</code></pre></div></div>

<p>Please see <a href="https://hexdocs.pm/elixir/IO.html#inspect/2">IO.inspect/2</a> to read more about other ways in which one could use this function. Also, in order to find a full list of other formatting options that one can use alongside <code class="language-plaintext highlighter-rouge">IO.inspect/2</code>, see <a href="https://hexdocs.pm/elixir/Inspect.Opts.html">Inspect.Opts</a>.</p>

<h2 id="dbg" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper"><code class="language-plaintext highlighter-rouge">dbg</code></span><a href="#dbg" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir v1.14 introduced <code class="language-plaintext highlighter-rouge">dbg/2</code>. <code class="language-plaintext highlighter-rouge">dbg</code> is similar to <code class="language-plaintext highlighter-rouge">IO.inspect/2</code>, but specifically tailored for debugging. It prints the value passed to it and returns it (just like <code class="language-plaintext highlighter-rouge">IO.inspect/2</code>), but it also prints the code and location.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># In my_file.exs</span>
<span class="n">feature</span> <span class="o">=</span> <span class="p">%{</span><span class="ss">name:</span> <span class="ss">:dbg</span><span class="p">,</span> <span class="ss">inspiration:</span> <span class="s2">"Rust"</span><span class="p">}</span>
<span class="n">dbg</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
<span class="n">dbg</span><span class="p">(</span><span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="ss">:in_version</span><span class="p">,</span> <span class="s2">"1.14.0"</span><span class="p">))</span>
</code></pre></div></div>

<p>The code above prints this:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>my_file.exs:2: <span class="o">(</span>file<span class="o">)]</span>
feature <span class="c">#=&gt; %{inspiration: "Rust", name: :dbg}</span>
<span class="o">[</span>my_file.exs:3: <span class="o">(</span>file<span class="o">)]</span>
Map.put<span class="o">(</span>feature, :in_version, <span class="s2">"1.14.0"</span><span class="o">)</span> <span class="c">#=&gt; %{in_version: "1.14.0", inspiration: "Rust", name: :dbg}</span>
</code></pre></div></div>

<p>When talking about <code class="language-plaintext highlighter-rouge">IO.inspect/2</code>, we mentioned its usefulness when placed between steps of <code class="language-plaintext highlighter-rouge">|&gt;</code> pipelines. <code class="language-plaintext highlighter-rouge">dbg</code> does it better: it understands Elixir code, so it will print values at <em>every step of the pipeline</em>.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># In dbg_pipes.exs</span>
<span class="n">__ENV__</span><span class="o">.</span><span class="n">file</span>
<span class="o">|&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="ss">trim:</span> <span class="no">true</span><span class="p">)</span>
<span class="o">|&gt;</span> <span class="no">List</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
<span class="o">|&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">exists?</span><span class="p">()</span>
<span class="o">|&gt;</span> <span class="n">dbg</span><span class="p">()</span>
</code></pre></div></div>

<p>This code prints:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>dbg_pipes.exs:5: <span class="o">(</span>file<span class="o">)]</span>
__ENV__.file <span class="c">#=&gt; "/home/myuser/dbg_pipes.exs"</span>
|&gt; String.split<span class="o">(</span><span class="s2">"/"</span>, trim: <span class="nb">true</span><span class="o">)</span> <span class="c">#=&gt; ["home", "myuser", "dbg_pipes.exs"]</span>
|&gt; List.last<span class="o">()</span> <span class="c">#=&gt; "dbg_pipes.exs"</span>
|&gt; File.exists?<span class="o">()</span> <span class="c">#=&gt; true</span>
</code></pre></div></div>

<p>Note <code class="language-plaintext highlighter-rouge">dbg</code> only supports stepping for pipelines (in other words, it can only step through the code it sees). For general stepping of functions, you will need to set breakpoints using <code class="language-plaintext highlighter-rouge">IEx.break!/4</code>.</p>

<h2 id="breakpoints" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Breakpoints</span><a href="#breakpoints" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>When code calling <code class="language-plaintext highlighter-rouge">dbg</code> is executed via <code class="language-plaintext highlighter-rouge">iex</code>, IEx will ask you to “stop” the code execution where the <code class="language-plaintext highlighter-rouge">dbg</code> call is. If you accept, you’ll be able to access all variables, as well as imports and aliases from the code, directly from IEx. This is called “prying”. While the pry session is running, the code execution stops, until <code class="language-plaintext highlighter-rouge">continue</code> or <code class="language-plaintext highlighter-rouge">next</code> are called. Remember you can always run <code class="language-plaintext highlighter-rouge">iex</code> in the context of a project with <code class="language-plaintext highlighter-rouge">iex -S mix TASK</code>.</p>

<script id="asciicast-509509" src="https://asciinema.org/a/509509.js" async="" data-player="[object HTMLDivElement]"></script><div id="asciicast-container-509509" class="asciicast" style="display: block; float: none; overflow: hidden; padding: 0px; margin: 20px 0px;"><iframe src="https://asciinema.org/a/509509/iframe?" id="asciicast-iframe-509509" name="asciicast-iframe-509509" scrolling="no" allowfullscreen="true" style="overflow: hidden; margin: 0px; border: 0px; display: inline-block; width: 100%; float: none; visibility: visible;"></iframe></div>

<p><code class="language-plaintext highlighter-rouge">dbg</code> calls require us to change the code we intend to debug and has limited stepping functionality. Luckily IEx also provides a <a href="https://hexdocs.pm/iex/IEx.html#break!/2"><code class="language-plaintext highlighter-rouge">break!/2</code></a> function which allows you to set and manage breakpoints on any Elixir code without modifying its source:</p>

<script type="text/javascript" src="https://asciinema.org/a/0h3po0AmTcBAorc5GBNU97nrs.js" id="asciicast-0h3po0AmTcBAorc5GBNU97nrs" async="" data-player="[object HTMLDivElement]"></script><div id="asciicast-container-0h3po0AmTcBAorc5GBNU97nrs" class="asciicast" style="display: block; float: none; overflow: hidden; padding: 0px; margin: 20px 0px;"><iframe src="https://asciinema.org/a/0h3po0AmTcBAorc5GBNU97nrs/iframe?" id="asciicast-iframe-0h3po0AmTcBAorc5GBNU97nrs" name="asciicast-iframe-0h3po0AmTcBAorc5GBNU97nrs" scrolling="no" allowfullscreen="true" style="overflow: hidden; margin: 0px; border: 0px; display: inline-block; width: 100%; float: none; visibility: visible;"></iframe></div>
<noscript><p><a href="https://asciinema.org/a/0h3po0AmTcBAorc5GBNU97nrs">See the example in asciinema</a></p></noscript>

<p>Similar to <code class="language-plaintext highlighter-rouge">dbg</code>, once a breakpoint is reached code execution stops until <code class="language-plaintext highlighter-rouge">continue</code> or <code class="language-plaintext highlighter-rouge">next</code> are invoked. However, <code class="language-plaintext highlighter-rouge">break!/2</code> does not have access to aliases and imports from the debugged code as it works on the compiled artifact rather than on source code.</p>

<h2 id="debugger" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Debugger</span><a href="#debugger" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>For those who enjoy breakpoints but are rather interested in a visual debugger, Erlang/OTP ships with a graphical debugger conveniently named <code class="language-plaintext highlighter-rouge">:debugger</code>. Let’s define a module in a file named <code class="language-plaintext highlighter-rouge">example.ex</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Example</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">double_sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">hard_work</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">hard_work</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">y</span>

    <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Now let’s compile the file and run an IEx session:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>elixirc example.ex
<span class="gp">$</span><span class="w"> </span>iex
</code></pre></div></div>

<p>Then start the debugger:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:debugger</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="c1">#PID&lt;0.87.0&gt;}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:int</span><span class="o">.</span><span class="n">ni</span><span class="p">(</span><span class="no">Example</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:module</span><span class="p">,</span> <span class="no">Example</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:int</span><span class="o">.</span><span class="n">break</span><span class="p">(</span><span class="no">Example</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Example</span><span class="o">.</span><span class="n">double_sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>If the <code class="language-plaintext highlighter-rouge">debugger</code> does not start, here is what may have happened: some package managers default to installing a minimized Erlang without WX bindings for GUI support. In some package managers, you may be able to replace the headless Erlang with a more complete package (look for packages named <code class="language-plaintext highlighter-rouge">erlang</code> vs <code class="language-plaintext highlighter-rouge">erlang-nox</code> on Debian/Ubuntu/Arch). In others managers, you may need to install a separate <code class="language-plaintext highlighter-rouge">erlang-wx</code> (or similarly named) package.</p>
</blockquote>

<p>When you start the debugger, a Graphical User Interface will open on your machine. We call <code class="language-plaintext highlighter-rouge">:int.ni(Example)</code> to prepare our module for debugging and then add a breakpoint to line 3 with <code class="language-plaintext highlighter-rouge">:int.break(Example, 3)</code>. After we call our function, we can see our process with break status in the debugger:</p>

<p><img src="/images/contents/debugger-elixir.gif" width="640" alt="Debugger GUI GIF"></p>

<h2 id="observer" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Observer</span><a href="#observer" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>For debugging complex systems, jumping at the code is not enough. It is necessary to have an understanding of the whole virtual machine, processes, applications, as well as set up tracing mechanisms. Luckily this can be achieved in Erlang with <code class="language-plaintext highlighter-rouge">:observer</code>. In your application:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">iex</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:observer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div></div>

<blockquote>
  <p>Similar to the <code class="language-plaintext highlighter-rouge">debugger</code> note above, your package manager may require a separate installation in order to run Observer.</p>
</blockquote>

<p>The above will open another Graphical User Interface that provides many panes to fully understand and navigate the runtime and your project:</p>

<p><img src="/images/contents/kv-observer.png" width="640" alt="Observer GUI screenshot"></p>

<p>We explore the Observer in the context of an actual project <a href="/getting-started/mix-otp/dynamic-supervisor.html">in the Dynamic Supervisor chapter of the Mix &amp; OTP guide</a>. This is one of the debugging techniques <a href="https://phoenixframework.org/blog/the-road-to-2-million-websocket-connections">the Phoenix framework used to achieve 2 million connections on a single machine</a>.</p>

<p>If you are using the Phoenix web framework, it ships with the <a href="https://github.com/phoenixframework/phoenix_live_dashboard">Phoenix LiveDashboard</a>, a web dashboard for production nodes which provides similar features to Observer.</p>

<p>Finally, remember you can also get a mini-overview of the runtime info by calling <code class="language-plaintext highlighter-rouge">runtime_info/0</code> directly in IEx.</p>

<h2 id="other-tools-and-community" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Other tools and community</span><a href="#other-tools-and-community" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>We have just scratched the surface of what the Erlang VM has to offer, for example:</p>

<ul>
  <li>
    <p>Alongside the observer application, Erlang also includes a <code class="language-plaintext highlighter-rouge">:crashdump_viewer</code> to view crash dumps</p>
  </li>
  <li>
    <p>Integration with OS level tracers, such as <a href="http://www.erlang.org/doc/apps/runtime_tools/LTTng.html">Linux Trace Toolkit,</a> <a href="http://www.erlang.org/doc/apps/runtime_tools/DTRACE.html">DTRACE,</a> and <a href="http://www.erlang.org/doc/apps/runtime_tools/SYSTEMTAP.html">SystemTap</a></p>
  </li>
  <li>
    <p><a href="http://www.erlang.org/doc/man/msacc.html">Microstate accounting</a> measures how much time the runtime spends in several low-level tasks in a short time interval</p>
  </li>
  <li>
    <p>Mix ships with many tasks under the <code class="language-plaintext highlighter-rouge">profile</code> namespace, such as <code class="language-plaintext highlighter-rouge">cprof</code> and <code class="language-plaintext highlighter-rouge">fprof</code></p>
  </li>
  <li>
    <p>For more advanced use cases, we recommend the excellent <a href="https://www.erlang-in-anger.com/">Erlang in Anger</a>, which is available as a free ebook</p>
  </li>
</ul>

<p>Happy debugging!</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/erlang-libraries.html" class="previous page-numbers spec" title="Erlang libraries">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/typespecs-and-behaviours.html" class="previous page-numbers spec" title="Typespecs and behaviours">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/debugging.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/typespecs-and-behaviours.html" page=":23:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><span title="Typespecs and behaviours">Typespecs and behaviours</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Typespecs and behaviours</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#types-and-specs">Types and specs</a><ol><li><a href="#function-specifications">Function specifications</a></li><li><a href="#defining-custom-types">Defining custom types</a></li><li><a href="#static-code-analysis">Static code analysis</a></li></ol></li><li><a href="#behaviours">Behaviours</a><ol><li><a href="#defining-behaviours">Defining behaviours</a></li><li><a href="#adopting-behaviours">Adopting behaviours</a></li><li><a href="#dynamic-dispatch">Dynamic dispatch</a></li></ol></li></ol></div>

    <h2 id="types-and-specs" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Types and specs</span><a href="#types-and-specs" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir is a dynamically typed language, so all types in Elixir are checked at runtime. Nonetheless, Elixir comes with <strong>typespecs</strong>, which are a notation used for:</p>

<ol>
  <li>declaring typed function signatures (also called specifications);</li>
  <li>declaring custom types.</li>
</ol>

<p>Typespecs are useful for code clarity and static code analysis (for example, Erlang’s <a href="http://www.erlang.org/doc/man/dialyzer.html">Dialyzer</a> tool).</p>

<h3 id="function-specifications" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Function specifications</span><a href="#function-specifications" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>Elixir provides many <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">built-in types</a>, such as <code class="language-plaintext highlighter-rouge">integer</code> or <code class="language-plaintext highlighter-rouge">pid</code>, that can be used to document function signatures.  For example, the <code class="language-plaintext highlighter-rouge">round/1</code> function, which rounds a number to its nearest integer. As you can see <a href="https://hexdocs.pm/elixir/Kernel.html#round/1">in its documentation</a>, <code class="language-plaintext highlighter-rouge">round/1</code>’s typed signature is written as:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">round</span><span class="p">(</span><span class="n">number</span><span class="p">())</span> <span class="p">::</span> <span class="n">integer</span><span class="p">()</span>
</code></pre></div></div>

<p>The syntax is to put the function and its input on the left side of the <code class="language-plaintext highlighter-rouge">::</code> and the return value’s type on the right side. Be aware that types <em>may</em> omit parentheses.</p>

<p>In code, function specs are written with the <code class="language-plaintext highlighter-rouge">@spec</code> attribute, typically placed immediately before the function definition. Specs can describe both public and private functions. The function name and the number of arguments used in the <code class="language-plaintext highlighter-rouge">@spec</code> attribute must match the function it describes.</p>

<p>Elixir supports compound types as well. For example, a list of integers has type <code class="language-plaintext highlighter-rouge">[integer]</code>, or maps that define keys and types (see the example below).</p>

<p>You can see all the built-in types provided by Elixir <a href="https://hexdocs.pm/elixir/typespecs.html">in the typespecs docs</a>.</p>

<h3 id="defining-custom-types" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Defining custom types</span><a href="#defining-custom-types" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>Defining custom types can help communicate the intention of your code and increase its readability. Custom types can be defined within modules via the <code class="language-plaintext highlighter-rouge">@type</code> attribute.</p>

<p>A simple example of a custom type implementation is to provide a more descriptive alias of an existing type. For example, defining <code class="language-plaintext highlighter-rouge">year</code> as a type makes your function specs more descriptive than if they had simply used <code class="language-plaintext highlighter-rouge">integer</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Person</span> <span class="k">do</span>
   <span class="nv">@typedoc</span> <span class="sd">"""
   A 4 digit year, e.g. 1984
   """</span>
   <span class="nv">@type</span> <span class="n">year</span> <span class="p">::</span> <span class="n">integer</span>

   <span class="nv">@spec</span> <span class="n">current_age</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="p">::</span> <span class="n">integer</span>
   <span class="k">def</span> <span class="n">current_age</span><span class="p">(</span><span class="n">year_of_birth</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="c1"># implementation</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">@typedoc</code> attribute, similar to the <code class="language-plaintext highlighter-rouge">@doc</code> and <code class="language-plaintext highlighter-rouge">@moduledoc</code> attributes, is used to document custom types.</p>

<p>You may define compound custom types, e.g. maps:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">@type</span> <span class="n">error_map</span> <span class="p">::</span> <span class="p">%{</span>
   <span class="ss">message:</span> <span class="no">String</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
   <span class="ss">line_number:</span> <span class="n">integer</span>
<span class="p">}</span>
</code></pre></div></div>

<p><a href="https://elixir-lang.org/getting-started/structs.html">Structs</a> offer similar functionality.</p>

<p>Let’s look at another example to understand how to define more complex types. Say we have a <code class="language-plaintext highlighter-rouge">LousyCalculator</code> module, which performs the usual arithmetic operations (sum, product, and so on) but, instead of returning numbers, it returns tuples with the result of an operation as the first element and a random remark as the second element.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">LousyCalculator</span> <span class="k">do</span>
  <span class="nv">@spec</span> <span class="n">add</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span> <span class="p">::</span> <span class="p">{</span><span class="n">number</span><span class="p">,</span> <span class="no">String</span><span class="o">.</span><span class="n">t</span><span class="p">}</span>
  <span class="k">def</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="p">{</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="s2">"You need a calculator to do that?!"</span><span class="p">}</span>

  <span class="nv">@spec</span> <span class="n">multiply</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span> <span class="p">::</span> <span class="p">{</span><span class="n">number</span><span class="p">,</span> <span class="no">String</span><span class="o">.</span><span class="n">t</span><span class="p">}</span>
  <span class="k">def</span> <span class="n">multiply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="p">{</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="s2">"Jeez, come on!"</span><span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Tuples are a compound type and each tuple is identified by the types inside it (in this case, a number and a string). To understand why <code class="language-plaintext highlighter-rouge">String.t</code> is not written as <code class="language-plaintext highlighter-rouge">string</code>, have another look at the <a href="https://hexdocs.pm/elixir/typespecs.html#the-string-type">typespecs docs</a>.</p>

<p>Defining function specs this way works, but we end up repeating the type <code class="language-plaintext highlighter-rouge">{number, String.t}</code> over and over. We can use the <code class="language-plaintext highlighter-rouge">@type</code> attribute to declare our own custom type and cut down on the repetition.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">LousyCalculator</span> <span class="k">do</span>
  <span class="nv">@typedoc</span> <span class="sd">"""
  Just a number followed by a string.
  """</span>
  <span class="nv">@type</span> <span class="n">number_with_remark</span> <span class="p">::</span> <span class="p">{</span><span class="n">number</span><span class="p">,</span> <span class="no">String</span><span class="o">.</span><span class="n">t</span><span class="p">}</span>

  <span class="nv">@spec</span> <span class="n">add</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span> <span class="p">::</span> <span class="n">number_with_remark</span>
  <span class="k">def</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="p">{</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="s2">"You need a calculator to do that?"</span><span class="p">}</span>

  <span class="nv">@spec</span> <span class="n">multiply</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span> <span class="p">::</span> <span class="n">number_with_remark</span>
  <span class="k">def</span> <span class="n">multiply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="p">{</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="s2">"It is like addition on steroids."</span><span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Custom types defined through <code class="language-plaintext highlighter-rouge">@type</code> are exported and are available outside the module they’re defined in:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">QuietCalculator</span> <span class="k">do</span>
  <span class="nv">@spec</span> <span class="n">add</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span> <span class="p">::</span> <span class="n">number</span>
  <span class="k">def</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="n">make_quiet</span><span class="p">(</span><span class="no">LousyCalculator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

  <span class="nv">@spec</span> <span class="n">make_quiet</span><span class="p">(</span><span class="no">LousyCalculator</span><span class="o">.</span><span class="n">number_with_remark</span><span class="p">)</span> <span class="p">::</span> <span class="n">number</span>
  <span class="k">defp</span> <span class="n">make_quiet</span><span class="p">({</span><span class="n">num</span><span class="p">,</span> <span class="n">_remark</span><span class="p">}),</span> <span class="k">do</span><span class="p">:</span> <span class="n">num</span>
<span class="k">end</span>
</code></pre></div></div>

<p>If you want to keep a custom type private, you can use the <code class="language-plaintext highlighter-rouge">@typep</code> attribute instead of <code class="language-plaintext highlighter-rouge">@type</code>. The visibility also affects whether or not documentation will be generated by tools like <a href="https://hexdocs.pm/ex_doc/readme.html">ExDoc</a>, Elixir’s documentation generator.</p>

<h3 id="static-code-analysis" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Static code analysis</span><a href="#static-code-analysis" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>Typespecs are not only useful to developers as additional documentation. The Erlang tool <a href="http://www.erlang.org/doc/man/dialyzer.html">Dialyzer</a>, for example, uses typespecs in order to perform static analysis of code. That’s why, in the <code class="language-plaintext highlighter-rouge">QuietCalculator</code> example, we wrote a spec for the <code class="language-plaintext highlighter-rouge">make_quiet/1</code> function even though it was defined as a private function.</p>

<h2 id="behaviours" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Behaviours</span><a href="#behaviours" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Many modules share the same public API. Take a look at <a href="https://github.com/elixir-lang/plug">Plug</a>, which, as its description states, is a <strong>specification</strong> for composable modules in web applications. Each <em>plug</em> is a module which <strong>has to</strong> implement at least two public functions: <code class="language-plaintext highlighter-rouge">init/1</code> and <code class="language-plaintext highlighter-rouge">call/2</code>.</p>

<p>Behaviours provide a way to:</p>

<ul>
  <li>define a set of functions that have to be implemented by a module;</li>
  <li>ensure that a module implements all the functions in that set.</li>
</ul>

<p>If you have to, you can think of behaviours like interfaces in object oriented languages like Java: a set of function signatures that a module has to implement. Unlike Protocols, behaviours are independent of the type/data.</p>

<h3 id="defining-behaviours" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Defining behaviours</span><a href="#defining-behaviours" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>Say we want to implement a bunch of parsers, each parsing structured data: for example, a JSON parser and a MessagePack parser. Each of these two parsers will <em>behave</em> the same way: both will provide a <code class="language-plaintext highlighter-rouge">parse/1</code> function and an <code class="language-plaintext highlighter-rouge">extensions/0</code> function. The <code class="language-plaintext highlighter-rouge">parse/1</code> function will return an Elixir representation of the structured data, while the <code class="language-plaintext highlighter-rouge">extensions/0</code> function will return a list of file extensions that can be used for each type of data (e.g., <code class="language-plaintext highlighter-rouge">.json</code> for JSON files).</p>

<p>We can create a <code class="language-plaintext highlighter-rouge">Parser</code> behaviour:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Parser</span> <span class="k">do</span>
  <span class="nv">@doc</span> <span class="sd">"""
  Parses a string.
  """</span>
  <span class="nv">@callback</span> <span class="n">parse</span><span class="p">(</span><span class="no">String</span><span class="o">.</span><span class="n">t</span><span class="p">)</span> <span class="p">::</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">term</span><span class="p">}</span> <span class="o">|</span> <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="no">String</span><span class="o">.</span><span class="n">t</span><span class="p">}</span>

  <span class="nv">@doc</span> <span class="sd">"""
  Lists all supported file extensions.
  """</span>
  <span class="nv">@callback</span> <span class="n">extensions</span><span class="p">()</span> <span class="p">::</span> <span class="p">[</span><span class="no">String</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Modules adopting the <code class="language-plaintext highlighter-rouge">Parser</code> behaviour will have to implement all the functions defined with the <code class="language-plaintext highlighter-rouge">@callback</code> attribute. As you can see, <code class="language-plaintext highlighter-rouge">@callback</code> expects a function name but also a function specification like the ones used with the <code class="language-plaintext highlighter-rouge">@spec</code> attribute we saw above. Also note that the <code class="language-plaintext highlighter-rouge">term</code> type is used to represent the parsed value. In Elixir, the <code class="language-plaintext highlighter-rouge">term</code> type is a shortcut to represent any type.</p>

<h3 id="adopting-behaviours" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Adopting behaviours</span><a href="#adopting-behaviours" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>Adopting a behaviour is straightforward:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">JSONParser</span> <span class="k">do</span>
  <span class="nv">@behaviour</span> <span class="no">Parser</span>

  <span class="nv">@impl</span> <span class="no">Parser</span>
  <span class="k">def</span> <span class="n">parse</span><span class="p">(</span><span class="n">str</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"some json "</span> <span class="o">&lt;&gt;</span> <span class="n">str</span><span class="p">}</span> <span class="c1"># ... parse JSON</span>

  <span class="nv">@impl</span> <span class="no">Parser</span>
  <span class="k">def</span> <span class="n">extensions</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="p">[</span><span class="s2">"json"</span><span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">YAMLParser</span> <span class="k">do</span>
  <span class="nv">@behaviour</span> <span class="no">Parser</span>

  <span class="nv">@impl</span> <span class="no">Parser</span>
  <span class="k">def</span> <span class="n">parse</span><span class="p">(</span><span class="n">str</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"some yaml "</span> <span class="o">&lt;&gt;</span> <span class="n">str</span><span class="p">}</span> <span class="c1"># ... parse YAML</span>

  <span class="nv">@impl</span> <span class="no">Parser</span>
  <span class="k">def</span> <span class="n">extensions</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="p">[</span><span class="s2">"yml"</span><span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>If a module adopting a given behaviour doesn’t implement one of the callbacks required by that behaviour, a compile-time warning will be generated.</p>

<p>Furthermore, with <code class="language-plaintext highlighter-rouge">@impl</code> you can also make sure that you are implementing the <strong>correct</strong> callbacks from the given behaviour in an explicit manner. For example, the following parser implements both <code class="language-plaintext highlighter-rouge">parse</code> and <code class="language-plaintext highlighter-rouge">extensions</code>; however, thanks to a typo, <code class="language-plaintext highlighter-rouge">BADParser</code> is implementing <code class="language-plaintext highlighter-rouge">parse/0</code> instead of <code class="language-plaintext highlighter-rouge">parse/1</code>.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">BADParser</span> <span class="k">do</span>
  <span class="nv">@behaviour</span> <span class="no">Parser</span>

  <span class="nv">@impl</span> <span class="no">Parser</span>
  <span class="k">def</span> <span class="n">parse</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"something bad"</span><span class="p">}</span>

  <span class="nv">@impl</span> <span class="no">Parser</span>
  <span class="k">def</span> <span class="n">extensions</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="p">[</span><span class="s2">"bad"</span><span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This code generates a warning letting you know that you are mistakenly implementing <code class="language-plaintext highlighter-rouge">parse/0</code> instead of <code class="language-plaintext highlighter-rouge">parse/1</code>.
You can read more about <code class="language-plaintext highlighter-rouge">@impl</code> in the <a href="https://hexdocs.pm/elixir/main/Module.html#module-impl">module documentation</a>.</p>

<h3 id="dynamic-dispatch" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Dynamic dispatch</span><a href="#dynamic-dispatch" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>Behaviours are frequently used with dynamic dispatching. For example, we could add a <code class="language-plaintext highlighter-rouge">parse!</code> function to the <code class="language-plaintext highlighter-rouge">Parser</code> module that dispatches to the given implementation and returns the <code class="language-plaintext highlighter-rouge">:ok</code> result or raises in cases of <code class="language-plaintext highlighter-rouge">:error</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Parser</span> <span class="k">do</span>
  <span class="nv">@callback</span> <span class="n">parse</span><span class="p">(</span><span class="no">String</span><span class="o">.</span><span class="n">t</span><span class="p">)</span> <span class="p">::</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">term</span><span class="p">}</span> <span class="o">|</span> <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="no">String</span><span class="o">.</span><span class="n">t</span><span class="p">}</span>
  <span class="nv">@callback</span> <span class="n">extensions</span><span class="p">()</span> <span class="p">::</span> <span class="p">[</span><span class="no">String</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>

  <span class="k">def</span> <span class="n">parse!</span><span class="p">(</span><span class="n">implementation</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">case</span> <span class="n">implementation</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="k">do</span>
      <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">data</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="n">data</span>
      <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="n">error</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="k">raise</span> <span class="no">ArgumentError</span><span class="p">,</span> <span class="s2">"parsing error: </span><span class="si">#{</span><span class="n">error</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Note you don’t need to define a behaviour in order to dynamically dispatch on a module, but those features often go hand in hand.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/debugging.html" class="previous page-numbers spec" title="Debugging">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/where-to-go-next.html" class="previous page-numbers spec" title="Where to go next">Next →</a>
            
          </div>
        
        
      
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/typespecs-and-behaviours.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/where-to-go-next.html" page=":24:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><span title="Where to go next">Where to go next</span></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Getting Started</small>
      <h1>Where to go next</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#build-your-first-elixir-project">Build your first Elixir project</a></li><li><a href="#meta-programming">Meta-programming</a></li><li><a href="#community-and-other-resources">Community and other resources</a></li><li><a href="#a-byte-of-erlang">A byte of Erlang</a></li></ol></div>

    <p>Eager to learn more? Keep reading!</p>

<h2 id="build-your-first-elixir-project" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Build your first Elixir project</span><a href="#build-your-first-elixir-project" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>In order to get your first project started, Elixir ships with a build tool called Mix. You can get your new project started by running:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>mix new path/to/new/project
</code></pre></div></div>

<p>We have written a guide that covers how to build an Elixir application, with its own supervision tree, configuration, tests, and more. The application works as a distributed key-value store where we organize key-value pairs into buckets and distribute those buckets across multiple nodes:</p>

<ul>
  <li><a href="/getting-started/mix-otp/introduction-to-mix.html">Mix and OTP</a></li>
</ul>

<p>If you are planning to write your first library for other developers to use, don’t forget to read our <a href="https://hexdocs.pm/elixir/library-guidelines.html">Library Guidelines</a>.</p>

<h2 id="meta-programming" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Meta-programming</span><a href="#meta-programming" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir is an extensible and very customizable programming language thanks to its meta-programming support. Most meta-programming in Elixir is done through macros, which are very useful in several situations, especially for writing DSLs. We have written a short guide that explains the basic mechanisms behind macros, shows how to write macros, and how to use macros to create DSLs:</p>

<ul>
  <li><a href="/getting-started/meta/quote-and-unquote.html">Meta-programming in Elixir</a></li>
</ul>

<h2 id="community-and-other-resources" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Community and other resources</span><a href="#community-and-other-resources" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>We have a <a href="/learning.html">Learning</a> section that suggests books, screencasts, and other resources for learning Elixir and exploring the ecosystem. There are also plenty of Elixir resources out there, like conference talks, open source projects, and other learning material produced by the community.</p>

<p>Don’t forget that you can also check the <a href="https://github.com/elixir-lang/elixir">source code of Elixir itself</a>, which is mostly written in Elixir (mainly the <code class="language-plaintext highlighter-rouge">lib</code> directory), or <a href="/docs.html">explore Elixir’s documentation</a>.</p>

<h2 id="a-byte-of-erlang" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">A byte of Erlang</span><a href="#a-byte-of-erlang" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir runs on the Erlang Virtual Machine and, sooner or later, an Elixir developer will want to interface with existing Erlang libraries. Here’s a list of online resources that cover Erlang’s fundamentals and its more advanced features:</p>

<ul>
  <li>
    <p>This <a href="/crash-course.html">Erlang Syntax: A Crash Course</a> provides a concise intro to Erlang’s syntax. Each code snippet is accompanied by equivalent code in Elixir. This is an opportunity for you to not only get some exposure to Erlang’s syntax but also review some of the things you have learned in this guide.</p>
  </li>
  <li>
    <p>Erlang’s official website has a short <a href="https://www.erlang.org/course">tutorial</a>. There is a chapter with pictures briefly describing Erlang’s primitives for <a href="https://www.erlang.org/course/concurrent_programming.html">concurrent programming</a>.</p>
  </li>
  <li>
    <p><a href="http://learnyousomeerlang.com/">Learn You Some Erlang for Great Good!</a> is an excellent introduction to Erlang, its design principles, standard library, best practices, and much more. Once you have read through the crash course mentioned above, you’ll be able to safely skip the first couple of chapters in the book that mostly deal with the syntax. When you reach <a href="http://learnyousomeerlang.com/the-hitchhikers-guide-to-concurrency">The Hitchhiker’s Guide to Concurrency</a> chapter, that’s where the real fun starts.</p>
  </li>
</ul>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/typespecs-and-behaviours.html" class="previous page-numbers spec" title="Typespecs and behaviours">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
          </div>
        
        
      
    
  
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/where-to-go-next.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><br></div><div page=":MIX_AND_OTP:"><div class="wrap" path="/getting-started/mix-otp/introduction-to-mix.html" page=":1:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><span title="Introduction to Mix">Introduction to Mix</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Mix and OTP</small>
      <h1>Introduction to Mix</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#our-first-project">Our first project</a></li><li><a href="#project-compilation">Project compilation</a></li><li><a href="#running-tests">Running tests</a></li><li><a href="#automatic-code-formatting">Automatic code formatting</a></li><li><a href="#environments">Environments</a></li><li><a href="#exploring">Exploring</a></li></ol></div>

    <p>In this guide, we will learn how to build a complete Elixir application, with its own supervision tree, configuration, tests and more.</p>

<p>The requirements for this guide are (see <code class="language-plaintext highlighter-rouge">elixir -v</code>):</p>

<ul>
  <li>Elixir 1.11.0 onwards</li>
  <li>Erlang/OTP 22 onwards</li>
</ul>

<p>The application works as a distributed key-value store. We are going to organize key-value pairs into buckets and distribute those buckets across multiple nodes. We will also build a simple client that allows us to connect to any of those nodes and send requests such as:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE shopping
OK

PUT shopping milk 1
OK

PUT shopping eggs 3
OK

GET shopping milk
1
OK

DELETE shopping eggs
OK
</code></pre></div></div>

<p>In order to build our key-value application, we are going to use three main tools:</p>

<ul>
  <li>
    <p><strong><em>OTP</em></strong> <em>(Open Telecom Platform)</em> is a set of libraries that ships with Erlang. Erlang developers use OTP to build robust, fault-tolerant applications. In this chapter we will explore how many aspects from OTP integrate with Elixir, including supervision trees, event managers and more;</p>
  </li>
  <li>
    <p><strong><em><a href="https://hexdocs.pm/mix/">Mix</a></em></strong> is a build tool that ships with Elixir that provides tasks for creating, compiling, testing your application, managing its dependencies and much more;</p>
  </li>
  <li>
    <p><strong><em><a href="https://hexdocs.pm/ex_unit/">ExUnit</a></em></strong> is a test-unit based framework that ships with Elixir;</p>
  </li>
</ul>

<p>In this chapter, we will create our first project using Mix and explore different features in  <abbr title="Open Telecom Platform">OTP</abbr>, Mix and ExUnit as we go.</p>

<blockquote>
  <p>If you have any questions or improvements to the guide, please reach discussion channels such as the <a href="https://elixirforum.com">Elixir Forum</a> or the <a href="https://github.com/elixir-lang/elixir-lang.github.com/issues">issues tracker</a>. Your input is really important to help us guarantee the guides are accessible and up to date!</p>

  <p>The final code for the application built in this guide is in <a href="https://github.com/josevalim/kv_umbrella">this repository</a> and can be used as a reference.</p>
</blockquote>

<blockquote>
  <p>The Elixir guides are also available in EPUB format:</p>

  <ul>
    <li><a href="https://repo.hex.pm/guides/elixir/elixir-getting-started-guide.epub">Getting started guide</a></li>
    <li><a href="https://repo.hex.pm/guides/elixir/mix-and-otp.epub">Mix and OTP guide</a></li>
    <li><a href="https://repo.hex.pm/guides/elixir/meta-programming-in-elixir.epub">Meta-programming guide</a></li>
  </ul>
</blockquote>

<h2 id="our-first-project" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Our first project</span><a href="#our-first-project" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>When you install Elixir, besides getting the <code class="language-plaintext highlighter-rouge">elixir</code>, <code class="language-plaintext highlighter-rouge">elixirc</code> and <code class="language-plaintext highlighter-rouge">iex</code> executables, you also get an executable Elixir script named <code class="language-plaintext highlighter-rouge">mix</code>.</p>

<p>Let’s create our first project by invoking <code class="language-plaintext highlighter-rouge">mix new</code> from the command line. We’ll pass the project path as the argument (<code class="language-plaintext highlighter-rouge">kv</code>, in this case). By default the application name and module name will be retrieved from the path. So we tell Mix that our main module should be the all-uppercase <code class="language-plaintext highlighter-rouge">KV</code>, instead of the default, which would have been <code class="language-plaintext highlighter-rouge">Kv</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>mix new kv <span class="nt">--module</span> KV
</code></pre></div></div>

<p>Mix will create a directory named <code class="language-plaintext highlighter-rouge">kv</code> with a few files in it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* creating README.md
* creating .formatter.exs
* creating .gitignore
* creating mix.exs
* creating lib
* creating lib/kv.ex
* creating test
* creating test/test_helper.exs
* creating test/kv_test.exs
</code></pre></div></div>

<p>Let’s take a brief look at those generated files.</p>

<blockquote>
  <p>Note: Mix is an Elixir executable. This means that in order to run <code class="language-plaintext highlighter-rouge">mix</code>, you need to have both <code class="language-plaintext highlighter-rouge">mix</code> and <code class="language-plaintext highlighter-rouge">elixir</code> executables in your PATH. That’s what happens when you install Elixir.</p>
</blockquote>

<h2 id="project-compilation" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Project compilation</span><a href="#project-compilation" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>A file named <code class="language-plaintext highlighter-rouge">mix.exs</code> was generated inside our new project folder (<code class="language-plaintext highlighter-rouge">kv</code>) and its main responsibility is to configure our project. Let’s take a look at it:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KV</span><span class="o">.</span><span class="no">MixProject</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Mix</span><span class="o">.</span><span class="no">Project</span>

  <span class="k">def</span> <span class="n">project</span> <span class="k">do</span>
    <span class="p">[</span>
      <span class="ss">app:</span> <span class="ss">:kv</span><span class="p">,</span>
      <span class="ss">version:</span> <span class="s2">"0.1.0"</span><span class="p">,</span>
      <span class="ss">elixir:</span> <span class="s2">"~&gt; 1.11"</span><span class="p">,</span>
      <span class="ss">start_permanent:</span> <span class="no">Mix</span><span class="o">.</span><span class="n">env</span><span class="p">()</span> <span class="o">==</span> <span class="ss">:prod</span><span class="p">,</span>
      <span class="ss">deps:</span> <span class="n">deps</span><span class="p">()</span>
    <span class="p">]</span>
  <span class="k">end</span>

  <span class="c1"># Run "mix help compile.app" to learn about applications</span>
  <span class="k">def</span> <span class="n">application</span> <span class="k">do</span>
    <span class="p">[</span>
      <span class="ss">extra_applications:</span> <span class="p">[</span><span class="ss">:logger</span><span class="p">]</span>
    <span class="p">]</span>
  <span class="k">end</span>

  <span class="c1"># Run "mix help deps" to learn about dependencies</span>
  <span class="k">defp</span> <span class="n">deps</span> <span class="k">do</span>
    <span class="p">[</span>
      <span class="c1"># {:dep_from_hexpm, "~&gt; 0.3.0"},</span>
      <span class="c1"># {:dep_from_git, git: "https://github.com/elixir-lang/my_dep.git", tag: "0.1.0"},</span>
    <span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Our <code class="language-plaintext highlighter-rouge">mix.exs</code> defines two public functions: <code class="language-plaintext highlighter-rouge">project</code>, which returns project configuration like the project name and version, and <code class="language-plaintext highlighter-rouge">application</code>, which is used to generate an application file.</p>

<p>There is also a private function named <code class="language-plaintext highlighter-rouge">deps</code>, which is invoked from the <code class="language-plaintext highlighter-rouge">project</code> function, that defines our project dependencies. Defining <code class="language-plaintext highlighter-rouge">deps</code> as a separate function is not required, but it helps keep the project configuration tidy.</p>

<p>Mix also generates a file at <code class="language-plaintext highlighter-rouge">lib/kv.ex</code> with a module containing exactly one function, called <code class="language-plaintext highlighter-rouge">hello</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KV</span> <span class="k">do</span>
  <span class="nv">@moduledoc</span> <span class="sd">"""
  Documentation for KV.
  """</span>

  <span class="nv">@doc</span> <span class="sd">"""
  Hello world.

  ## Examples

      iex&gt; KV.hello()
      :world

  """</span>
  <span class="k">def</span> <span class="n">hello</span> <span class="k">do</span>
    <span class="ss">:world</span>
  <span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>

<p>This structure is enough to compile our project:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>kv
<span class="gp">$</span><span class="w"> </span>mix compile
</code></pre></div></div>

<p>Will output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Compiling 1 file (.ex)
Generated kv app
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">lib/kv.ex</code> file was compiled, an application manifest named <code class="language-plaintext highlighter-rouge">kv.app</code> was generated. All compilation artifacts are placed inside the <code class="language-plaintext highlighter-rouge">_build</code> directory using the options defined in the <code class="language-plaintext highlighter-rouge">mix.exs</code> file.</p>

<p>Once the project is compiled, you can start an <code class="language-plaintext highlighter-rouge">iex</code> session inside the project by running the command below. The <code class="language-plaintext highlighter-rouge">-S mix</code> is necessary to load the project in the interactive shell:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>iex <span class="nt">-S</span> mix
</code></pre></div></div>

<p>We are going to work on this <code class="language-plaintext highlighter-rouge">kv</code> project, making modifications and trying out the latest changes from an <code class="language-plaintext highlighter-rouge">iex</code> session. While you may start a new session whenever there are changes to the project source code, you can also recompile the project from within <code class="language-plaintext highlighter-rouge">iex</code> with the <code class="language-plaintext highlighter-rouge">recompile</code> helper, like this:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">recompile</span><span class="p">()</span>
<span class="no">Compiling</span> <span class="mi">1</span> <span class="n">file</span> <span class="p">(</span><span class="o">.</span><span class="n">ex</span><span class="p">)</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">recompile</span><span class="p">()</span>
<span class="ss">:noop</span>
</code></pre></div></div>

<p>If anything had to be compiled, you see some informative text, and get the <code class="language-plaintext highlighter-rouge">:ok</code> atom back, otherwise the function is silent, and returns <code class="language-plaintext highlighter-rouge">:noop</code>.</p>

<h2 id="running-tests" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Running tests</span><a href="#running-tests" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Mix also generated the appropriate structure for running our project tests. Mix projects usually follow the convention of having a <code class="language-plaintext highlighter-rouge">&lt;filename&gt;_test.exs</code> file in the <code class="language-plaintext highlighter-rouge">test</code> directory for each file in the <code class="language-plaintext highlighter-rouge">lib</code> directory. For this reason, we can already find a <code class="language-plaintext highlighter-rouge">test/kv_test.exs</code> corresponding to our <code class="language-plaintext highlighter-rouge">lib/kv.ex</code> file. It doesn’t do much at this point:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KVTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ExUnit</span><span class="o">.</span><span class="no">Case</span>
  <span class="n">doctest</span> <span class="no">KV</span>

  <span class="n">test</span> <span class="s2">"greets the world"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="no">KV</span><span class="o">.</span><span class="n">hello</span><span class="p">()</span> <span class="o">==</span> <span class="ss">:world</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>It is important to note a couple of things:</p>

<ol>
  <li>
    <p>the test file is an Elixir script file (<code class="language-plaintext highlighter-rouge">.exs</code>). This is convenient because we don’t need to compile test files before running them;</p>
  </li>
  <li>
    <p>we define a test module named <code class="language-plaintext highlighter-rouge">KVTest</code>, in which we <a href="https://hexdocs.pm/ex_unit/ExUnit.Case.html"><code class="language-plaintext highlighter-rouge">use ExUnit.Case</code></a> to inject the testing API;</p>
  </li>
  <li>
    <p>we use one of the imported macros, <a href="https://hexdocs.pm/ex_unit/ExUnit.DocTest.html#doctest/1"><code class="language-plaintext highlighter-rouge">doctest/1</code></a>, to indicate that the <code class="language-plaintext highlighter-rouge">KV</code> module contains doctests (we will discuss those in a later chapter);</p>
  </li>
  <li>
    <p>we use the <a href="https://hexdocs.pm/ex_unit/ExUnit.Case.html#test/2"><code class="language-plaintext highlighter-rouge">test/2</code></a> macro to define a simple test;</p>
  </li>
</ol>

<p>Mix also generated a file named <code class="language-plaintext highlighter-rouge">test/test_helper.exs</code> which is responsible for setting up the test framework:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">ExUnit</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div></div>

<p>This file will be required by Mix every time before we run our tests. We can run tests with:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>mix <span class="nb">test</span>
<span class="go">Compiled lib/kv.ex
Generated kv app
</span><span class="c">..
</span><span class="go">
Finished in 0.04 seconds
1 doctest, 1 test, 0 failures

Randomized with seed 540224
</span></code></pre></div></div>

<p>Notice that by running <code class="language-plaintext highlighter-rouge">mix test</code>, Mix has compiled the source files and generated the application manifest once again. This happens because Mix supports multiple environments, which we will discuss later in this chapter.</p>

<p>Furthermore, you can see that ExUnit prints a dot for each successful test and automatically randomizes tests too. Let’s make the test fail on purpose and see what happens.</p>

<p>Change the assertion in <code class="language-plaintext highlighter-rouge">test/kv_test.exs</code> to the following:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">assert</span> <span class="no">KV</span><span class="o">.</span><span class="n">hello</span><span class="p">()</span> <span class="o">==</span> <span class="ss">:oops</span>
</code></pre></div></div>

<p>Now run <code class="language-plaintext highlighter-rouge">mix test</code> again (notice this time there will be no compilation):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  1) test greets the world (KVTest)
     test/kv_test.exs:5
     Assertion with == failed
     code:  assert KV.hello() == :oops
     left:  :world
     right: :oops
     stacktrace:
       test/kv_test.exs:6: (test)

.

Finished in 0.05 seconds
1 doctest, 1 test, 1 failure
</code></pre></div></div>

<p>For each failure, ExUnit prints a detailed report, containing the test name with the test case, the code that failed and the values for the left side and right side (rhs) of the <code class="language-plaintext highlighter-rouge">==</code> operator.</p>

<p>In the second line of the failure, right below the test name, there is the location where the test was defined. If you copy the test location in full, including the file and line number, and append it to <code class="language-plaintext highlighter-rouge">mix test</code>, Mix will load and run just that particular test:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>mix <span class="nb">test test</span>/kv_test.exs:5
</code></pre></div></div>

<p>This shortcut will be extremely useful as we build our project, allowing us to quickly iterate by running a single test.</p>

<p>Finally, the stacktrace relates to the failure itself, giving information about the test and often the place the failure was generated from within the source files.</p>

<h2 id="automatic-code-formatting" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Automatic code formatting</span><a href="#automatic-code-formatting" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>One of the files generated by <code class="language-plaintext highlighter-rouge">mix new</code> is the <code class="language-plaintext highlighter-rouge">.formatter.exs</code>. Elixir ships with a code formatter that is capable of automatically formatting our codebase according to a consistent style. The formatter is triggered with the <code class="language-plaintext highlighter-rouge">mix format</code> task. The generated <code class="language-plaintext highlighter-rouge">.formatter.exs</code> file configures which files should be formatted when <code class="language-plaintext highlighter-rouge">mix format</code> runs.</p>

<p>To give the formatter a try, change a file in the <code class="language-plaintext highlighter-rouge">lib</code> or <code class="language-plaintext highlighter-rouge">test</code> directories to include extra spaces or extra newlines, such as <code class="language-plaintext highlighter-rouge">def  hello  do</code>, and then run <code class="language-plaintext highlighter-rouge">mix format</code>.</p>

<p>Most editors provide built-in integration with the formatter, allowing a file to be formatted on save or via a chosen keybinding. If you are learning Elixir, editor integration gives you useful and quick feedback when learning the Elixir syntax.</p>

<p>For companies and teams, we recommend developers to run <code class="language-plaintext highlighter-rouge">mix format --check-formatted</code> on their continuous integration servers, ensuring all current and future code follows the standard.</p>

<p>You can learn more about the code formatter by checking <a href="https://hexdocs.pm/mix/Mix.Tasks.Format.html">the format task documentation</a> or by reading <a href="https://elixir-lang.org/blog/2018/01/17/elixir-v1-6-0-released/">the release announcement for Elixir v1.6</a>, the first version to include the formatter.</p>

<h2 id="environments" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Environments</span><a href="#environments" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Mix provides the concept of “environments”. They allow a developer to customize compilation and other options for specific scenarios. By default, Mix understands three environments:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">:dev</code> - the one in which Mix tasks (like <code class="language-plaintext highlighter-rouge">compile</code>) run by default</li>
  <li><code class="language-plaintext highlighter-rouge">:test</code> - used by <code class="language-plaintext highlighter-rouge">mix test</code></li>
  <li><code class="language-plaintext highlighter-rouge">:prod</code> - the one you will use to run your project in production</li>
</ul>

<p>The environment applies only to the current project. As we will see in future chapters, any dependency you add to your project will by default run in the <code class="language-plaintext highlighter-rouge">:prod</code> environment.</p>

<p>Customization per environment can be done by accessing <a href="https://hexdocs.pm/mix/Mix.html#env/0">the <code class="language-plaintext highlighter-rouge">Mix.env</code> function</a> in your <code class="language-plaintext highlighter-rouge">mix.exs</code> file, which returns the current environment as an atom. That’s what we have used in the <code class="language-plaintext highlighter-rouge">:start_permanent</code> options:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">project</span> <span class="k">do</span>
  <span class="p">[</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="ss">start_permanent:</span> <span class="no">Mix</span><span class="o">.</span><span class="n">env</span><span class="p">()</span> <span class="o">==</span> <span class="ss">:prod</span><span class="p">,</span>
    <span class="o">...</span>
  <span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>When true, the <code class="language-plaintext highlighter-rouge">:start_permanent</code> option starts your application in permanent mode, which means the Erlang VM will crash if your application’s supervision tree shuts down. Notice we don’t want this behaviour in dev and test because it is useful to keep the VM instance running in those environments for troubleshooting purposes.</p>

<p>Mix will default to the <code class="language-plaintext highlighter-rouge">:dev</code> environment, except for the <code class="language-plaintext highlighter-rouge">test</code> task that will default to the <code class="language-plaintext highlighter-rouge">:test</code> environment. The environment can be changed via the <code class="language-plaintext highlighter-rouge">MIX_ENV</code> environment variable:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nv">MIX_ENV</span><span class="o">=</span>prod mix compile
</code></pre></div></div>

<p>Or on Windows:</p>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="kd">set</span> <span class="s2">"MIX_ENV=prod"</span> <span class="o">&amp;&amp;</span> <span class="kd">mix</span> <span class="kd">compile</span>
</code></pre></div></div>

<blockquote>
  <p>Mix is a build tool and, as such, it is not expected to be available in production. Therefore, it is recommended to access <code class="language-plaintext highlighter-rouge">Mix.env</code> only in configuration files and inside <code class="language-plaintext highlighter-rouge">mix.exs</code>, never in your application code (<code class="language-plaintext highlighter-rouge">lib</code>).</p>
</blockquote>

<h2 id="exploring" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Exploring</span><a href="#exploring" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>There is much more to Mix, and we will continue to explore it as we build our project. A <a href="https://hexdocs.pm/mix/">general overview is available on the Mix documentation</a>. Read <a href="https://github.com/elixir-lang/elixir/tree/main/lib/mix">the Mix source code here</a>.</p>

<p>Keep in mind that you can always invoke the help task to list all available tasks:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>mix <span class="nb">help</span>
</code></pre></div></div>

<p>You can get further information about a particular task by invoking <code class="language-plaintext highlighter-rouge">mix help TASK</code>.</p>

<p>Let’s write some code!</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
  
    
      
        
          <div class="pagination loop-pagination">
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/mix-otp/agent.html" class="previous page-numbers spec" title="Agent">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/mix-otp/introduction-to-mix.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/mix-otp/agent.html" page=":2:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><span title="Agent">Agent</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Mix and OTP</small>
      <h1>Agent</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#the-trouble-with-state">The trouble with state</a></li><li><a href="#agents">Agents</a></li><li><a href="#test-setup-with-exunit-callbacks">Test setup with ExUnit callbacks</a></li><li><a href="#other-agent-actions">Other agent actions</a></li><li><a href="#clientserver-in-agents">Client/Server in agents</a></li></ol></div>

    <blockquote>
  <p>This chapter is part of the <i>Mix and OTP guide</i> and it depends on previous chapters in this guide.
For more information, <a href="/getting-started/mix-otp/introduction-to-mix.html">read the introduction guide</a> or check out the chapter index in the sidebar.</p>
</blockquote>

<p>In this chapter, we will learn how to keep and share state between multiple entities. If you have previous programming experience, you may think of globally shared variables, but the model we will learn here is quite different. The next chapters will generalize the concepts introduced here.</p>

<p>If you have skipped the Getting Started guide or read it long ago, be sure to re-read the <a href="/getting-started/processes.html">Processes</a> chapter. We will use it as a starting point.</p>

<h2 id="the-trouble-with-state" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The trouble with state</span><a href="#the-trouble-with-state" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir is an immutable language where nothing is shared by default. If we want to share information, which can be read and modified from multiple places, we have two main options in Elixir:</p>

<ul>
  <li>Using Processes and message passing</li>
  <li><a href="http://www.erlang.org/doc/man/ets.html">ETS (Erlang Term Storage)</a></li>
</ul>

<p>We covered processes in the Getting Started guide. <abbr title="Erlang Term Storage">ETS</abbr> is a new topic that we will explore in later chapters. When it comes to processes though, we rarely hand-roll our own, instead we use the abstractions available in Elixir and  <abbr title="Open Telecom Platform">OTP</abbr>:</p>

<ul>
  <li><a href="https://hexdocs.pm/elixir/Agent.html">Agent</a> - Simple wrappers around state.</li>
  <li><a href="https://hexdocs.pm/elixir/GenServer.html">GenServer</a> - “Generic servers” (processes) that encapsulate state, provide sync and async calls, support code reloading, and more.</li>
  <li><a href="https://hexdocs.pm/elixir/Task.html">Task</a> - Asynchronous units of computation that allow spawning a process and potentially retrieving its result at a later time.</li>
</ul>

<p>We will explore most of these abstractions in this guide. Keep in mind that they are all implemented on top of processes using the basic features provided by the <abbr title="Virtual Machine">VM</abbr>, like <code class="language-plaintext highlighter-rouge">send</code>, <code class="language-plaintext highlighter-rouge">receive</code>, <code class="language-plaintext highlighter-rouge">spawn</code> and <code class="language-plaintext highlighter-rouge">link</code>.</p>

<p>Here we will use Agents, and create a module named <code class="language-plaintext highlighter-rouge">KV.Bucket</code>, responsible for storing our key-value entries in a way that allows them to be read and modified by other processes.</p>

<h2 id="agents" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Agents</span><a href="#agents" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p><a href="https://hexdocs.pm/elixir/Agent.html">Agents</a> are simple wrappers around state. If all you want from a process is to keep state, agents are a great fit. Let’s start an <code class="language-plaintext highlighter-rouge">iex</code> session inside the project with:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>iex <span class="nt">-S</span> mix
</code></pre></div></div>

<p>And play a bit with agents:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">agent</span><span class="p">}</span> <span class="o">=</span> <span class="no">Agent</span><span class="o">.</span><span class="n">start_link</span> <span class="k">fn</span> <span class="o">-&gt;</span> <span class="p">[]</span> <span class="k">end</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="c1">#PID&lt;0.57.0&gt;}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Agent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="k">fn</span> <span class="n">list</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="s2">"eggs"</span> <span class="o">|</span> <span class="n">list</span><span class="p">]</span> <span class="k">end</span><span class="p">)</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Agent</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="k">fn</span> <span class="n">list</span> <span class="o">-&gt;</span> <span class="n">list</span> <span class="k">end</span><span class="p">)</span>
<span class="p">[</span><span class="s2">"eggs"</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Agent</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
<span class="ss">:ok</span>
</code></pre></div></div>

<p>We started an agent with an initial state of an empty list. We updated the agent’s state, adding our new item to the head of the list. The second argument of <a href="https://hexdocs.pm/elixir/Agent.html#update/3"><code class="language-plaintext highlighter-rouge">Agent.update/3</code></a> is a function that takes the agent’s current state as input and returns its desired new state. Finally, we retrieved the whole list. The second argument of <a href="https://hexdocs.pm/elixir/Agent.html#get/3"><code class="language-plaintext highlighter-rouge">Agent.get/3</code></a> is a function that takes the state as input and returns the value that <a href="https://hexdocs.pm/elixir/Agent.html#get/3"><code class="language-plaintext highlighter-rouge">Agent.get/3</code></a> itself will return. Once we are done with the agent, we can call <a href="https://hexdocs.pm/elixir/Agent.html#stop/3"><code class="language-plaintext highlighter-rouge">Agent.stop/3</code></a> to terminate the agent process.</p>

<p>The <code class="language-plaintext highlighter-rouge">Agent.update/3</code> function accepts as a second argument any function that receives one argument and returns a value:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">agent</span><span class="p">}</span> <span class="o">=</span> <span class="no">Agent</span><span class="o">.</span><span class="n">start_link</span> <span class="k">fn</span> <span class="o">-&gt;</span> <span class="p">[]</span> <span class="k">end</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="c1">#PID&lt;0.338.0&gt;}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Agent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="k">fn</span> <span class="n">_list</span> <span class="o">-&gt;</span> <span class="mi">123</span> <span class="k">end</span><span class="p">)</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Agent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="k">fn</span> <span class="n">content</span> <span class="o">-&gt;</span> <span class="p">%{</span><span class="ss">a:</span> <span class="n">content</span><span class="p">}</span> <span class="k">end</span><span class="p">)</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Agent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="k">fn</span> <span class="n">content</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="mi">12</span> <span class="o">|</span> <span class="p">[</span><span class="n">content</span><span class="p">]]</span> <span class="k">end</span><span class="p">)</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Agent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="k">fn</span> <span class="n">list</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="ss">:nop</span> <span class="o">|</span> <span class="n">list</span><span class="p">]</span> <span class="k">end</span><span class="p">)</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Agent</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="k">fn</span> <span class="n">content</span> <span class="o">-&gt;</span> <span class="n">content</span> <span class="k">end</span><span class="p">)</span>
<span class="p">[</span><span class="ss">:nop</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="p">%{</span><span class="ss">a:</span> <span class="mi">123</span><span class="p">}]</span>
</code></pre></div></div>

<p>As you can see, we can modify the agent state in any way we want. Therefore, we most likely don’t want to access the Agent API throughout many different places in our code. Instead, we want to encapsulate all Agent-related functionality in a single module, which we will call <code class="language-plaintext highlighter-rouge">KV.Bucket</code>. Before we implement it, let’s write some tests which will outline the API exposed by our module.</p>

<p>Create a file at <code class="language-plaintext highlighter-rouge">test/kv/bucket_test.exs</code> (remember the <code class="language-plaintext highlighter-rouge">.exs</code> extension) with the following:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KV</span><span class="o">.</span><span class="no">BucketTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ExUnit</span><span class="o">.</span><span class="no">Case</span><span class="p">,</span> <span class="ss">async:</span> <span class="no">true</span>

  <span class="n">test</span> <span class="s2">"stores values by key"</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">bucket</span><span class="p">}</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">start_link</span><span class="p">([])</span>
    <span class="n">assert</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s2">"milk"</span><span class="p">)</span> <span class="o">==</span> <span class="no">nil</span>

    <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s2">"milk"</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">assert</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s2">"milk"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">use ExUnit.Case</code> is responsible for setting up our module for testing and imports many test-related functionality, such as the <code class="language-plaintext highlighter-rouge">test/2</code> macro.</p>

<p>Our first test starts a new <code class="language-plaintext highlighter-rouge">KV.Bucket</code> by calling the <code class="language-plaintext highlighter-rouge">start_link/1</code> and passing an empty list of options. Then we perform some <code class="language-plaintext highlighter-rouge">get/2</code> and <code class="language-plaintext highlighter-rouge">put/3</code> operations on it, asserting the result.</p>

<p>Also note the <code class="language-plaintext highlighter-rouge">async: true</code> option passed to <code class="language-plaintext highlighter-rouge">ExUnit.Case</code>. This option makes the test case run in parallel with other <code class="language-plaintext highlighter-rouge">:async</code> test cases by using multiple cores in our machine. This is extremely useful to speed up our test suite. However, <code class="language-plaintext highlighter-rouge">:async</code> must <em>only</em> be set if the test case does not rely on or change any global values. For example, if the test requires writing to the filesystem or access a database, keep it synchronous (omit the <code class="language-plaintext highlighter-rouge">:async</code> option) to avoid race conditions between tests.</p>

<p>Async or not, our new test should obviously fail, as none of the functionality is implemented in the module being tested:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>** (UndefinedFunctionError) function KV.Bucket.start_link/1 is undefined (module KV.Bucket is not available)
</code></pre></div></div>

<p>In order to fix the failing test, let’s create a file at <code class="language-plaintext highlighter-rouge">lib/kv/bucket.ex</code> with the contents below. Feel free to give a try at implementing the <code class="language-plaintext highlighter-rouge">KV.Bucket</code> module yourself using agents before peeking at the implementation below.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Agent</span>

  <span class="nv">@doc</span> <span class="sd">"""
  Starts a new bucket.
  """</span>
  <span class="k">def</span> <span class="n">start_link</span><span class="p">(</span><span class="n">_opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Agent</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span> <span class="p">%{}</span> <span class="k">end</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="nv">@doc</span> <span class="sd">"""
  Gets a value from the `bucket` by `key`.
  """</span>
  <span class="k">def</span> <span class="n">get</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Agent</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="o">&amp;</span><span class="no">Map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nv">&amp;1</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
  <span class="k">end</span>

  <span class="nv">@doc</span> <span class="sd">"""
  Puts the `value` for the given `key` in the `bucket`.
  """</span>
  <span class="k">def</span> <span class="n">put</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Agent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="o">&amp;</span><span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="nv">&amp;1</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The first step in our implementation is to call <code class="language-plaintext highlighter-rouge">use Agent</code>. Most of the functionality we will learn in this guide, such as <code class="language-plaintext highlighter-rouge">GenServer</code> and <code class="language-plaintext highlighter-rouge">Supervisor</code>, follow this pattern. For all of them, calling <code class="language-plaintext highlighter-rouge">use</code> generates a <code class="language-plaintext highlighter-rouge">child_spec</code> function with default configuration, which will be handy when we start supervising processes in chapter 4.</p>

<p>Then we define a <code class="language-plaintext highlighter-rouge">start_link/1</code> function, which will effectively start the agent. It is a convention to define a <code class="language-plaintext highlighter-rouge">start_link/1</code> function that always accepts a list of options. We don’t plan on using any options right now, but we might later on. We then proceed to call <code class="language-plaintext highlighter-rouge">Agent.start_link/1</code>, which receives an anonymous function that returns the Agent’s initial state.</p>

<p>We are keeping a map inside the agent to store our keys and values. Getting and putting values on the map is done with the Agent API  and the capture operator <code class="language-plaintext highlighter-rouge">&amp;</code>, introduced in <a href="/getting-started/modules-and-functions.html#function-capturing">the Getting Started guide</a>. The agent passes its state to the anonymous function via the <code class="language-plaintext highlighter-rouge">&amp;1</code> argument when <code class="language-plaintext highlighter-rouge">Agent.get/2</code> and <code class="language-plaintext highlighter-rouge">Agent.update/2</code> are called.</p>

<p>Now that the <code class="language-plaintext highlighter-rouge">KV.Bucket</code> module has been defined, our test should pass! You can try it yourself by running: <code class="language-plaintext highlighter-rouge">mix test</code>.</p>

<h2 id="test-setup-with-exunit-callbacks" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Test setup with ExUnit callbacks</span><a href="#test-setup-with-exunit-callbacks" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Before moving on and adding more features to <code class="language-plaintext highlighter-rouge">KV.Bucket</code>, let’s talk about ExUnit callbacks. As you may expect, all <code class="language-plaintext highlighter-rouge">KV.Bucket</code> tests will require a bucket agent to be up and running. Luckily, ExUnit supports callbacks that allow us to skip such repetitive tasks.</p>

<p>Let’s rewrite the test case to use callbacks:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KV</span><span class="o">.</span><span class="no">BucketTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ExUnit</span><span class="o">.</span><span class="no">Case</span><span class="p">,</span> <span class="ss">async:</span> <span class="no">true</span>

  <span class="n">setup</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">bucket</span><span class="p">}</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">start_link</span><span class="p">([])</span>
    <span class="p">%{</span><span class="ss">bucket:</span> <span class="n">bucket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="n">test</span> <span class="s2">"stores values by key"</span><span class="p">,</span> <span class="p">%{</span><span class="ss">bucket:</span> <span class="n">bucket</span><span class="p">}</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s2">"milk"</span><span class="p">)</span> <span class="o">==</span> <span class="no">nil</span>

    <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s2">"milk"</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">assert</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s2">"milk"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We have first defined a setup callback with the help of the <code class="language-plaintext highlighter-rouge">setup/1</code> macro. The <code class="language-plaintext highlighter-rouge">setup/1</code> macro defines a callback that is run before every test, in the same process as the test itself.</p>

<p>Note that we need a mechanism to pass the <code class="language-plaintext highlighter-rouge">bucket</code> pid from the callback to the test. We do so by using the <em>test context</em>. When we return <code class="language-plaintext highlighter-rouge">%{bucket: bucket}</code> from the callback, ExUnit will merge this map into the test context. Since the test context is a map itself, we can pattern match the bucket out of it, providing access to the bucket inside the test:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test</span> <span class="s2">"stores values by key"</span><span class="p">,</span> <span class="p">%{</span><span class="ss">bucket:</span> <span class="n">bucket</span><span class="p">}</span> <span class="k">do</span>
  <span class="c1"># `bucket` is now the bucket from the setup block</span>
<span class="k">end</span>
</code></pre></div></div>

<p>You can read more about ExUnit cases in the <a href="https://hexdocs.pm/ex_unit/ExUnit.Case.html"><code class="language-plaintext highlighter-rouge">ExUnit.Case</code> module documentation</a> and more about callbacks in <a href="https://hexdocs.pm/ex_unit/ExUnit.Callbacks.html"><code class="language-plaintext highlighter-rouge">ExUnit.Callbacks</code> docs</a>.</p>

<h2 id="other-agent-actions" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Other agent actions</span><a href="#other-agent-actions" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Besides getting a value and updating the agent state, agents allow us to get a value and update the agent state in one function call via <code class="language-plaintext highlighter-rouge">Agent.get_and_update/2</code>. Let’s implement a <code class="language-plaintext highlighter-rouge">KV.Bucket.delete/2</code> function that deletes a key from the bucket, returning its current value:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">@doc</span> <span class="sd">"""
Deletes `key` from `bucket`.

Returns the current value of `key`, if `key` exists.
"""</span>
<span class="k">def</span> <span class="n">delete</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">do</span>
  <span class="no">Agent</span><span class="o">.</span><span class="n">get_and_update</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="o">&amp;</span><span class="no">Map</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nv">&amp;1</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Now it is your turn to write a test for the functionality above! Also, be sure to explore <a href="https://hexdocs.pm/elixir/Agent.html">the documentation for the <code class="language-plaintext highlighter-rouge">Agent</code> module</a> to learn more about them.</p>

<h2 id="clientserver-in-agents" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Client/Server in agents</span><a href="#clientserver-in-agents" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Before we move on to the next chapter, let’s discuss the client/server dichotomy in agents. Let’s expand the <code class="language-plaintext highlighter-rouge">delete/2</code> function we have just implemented:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">delete</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">do</span>
  <span class="no">Agent</span><span class="o">.</span><span class="n">get_and_update</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="k">fn</span> <span class="n">dict</span> <span class="o">-&gt;</span>
    <span class="no">Map</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">dict</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
  <span class="k">end</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Everything that is inside the function we passed to the agent happens in the agent process. In this case, since the agent process is the one receiving and responding to our messages, we say the agent process is the server. Everything outside the function is happening in the client.</p>

<p>This distinction is important. If there are expensive actions to be done, you must consider if it will be better to perform these actions on the client or on the server. For example:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">delete</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">do</span>
  <span class="no">Process</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="c1"># puts client to sleep</span>
  <span class="no">Agent</span><span class="o">.</span><span class="n">get_and_update</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="k">fn</span> <span class="n">dict</span> <span class="o">-&gt;</span>
    <span class="no">Process</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="c1"># puts server to sleep</span>
    <span class="no">Map</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">dict</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
  <span class="k">end</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>When a long action is performed on the server, all other requests to that particular server will wait until the action is done, which may cause some clients to timeout.</p>

<p>In the next chapter, we will explore GenServers, where the segregation between clients and servers is made more apparent.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
  
    
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/mix-otp/introduction-to-mix.html" class="previous page-numbers spec" title="Introduction to Mix">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/mix-otp/genserver.html" class="previous page-numbers spec" title="GenServer">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/mix-otp/agent.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/mix-otp/genserver.html" page=":3:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><span title="GenServer">GenServer</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Mix and OTP</small>
      <h1>GenServer</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#genserver-callbacks">GenServer callbacks</a></li><li><a href="#the-client-api">The Client API</a></li><li><a href="#testing-a-genserver">Testing a GenServer</a></li><li><a href="#the-need-for-monitoring">The need for monitoring</a></li><li><a href="#call-cast-or-info"><code class="language-plaintext highlighter-rouge">call</code>, <code class="language-plaintext highlighter-rouge">cast</code> or <code class="language-plaintext highlighter-rouge">info</code>?</a></li><li><a href="#monitors-or-links">Monitors or links?</a></li></ol></div>

    <blockquote>
  <p>This chapter is part of the <i>Mix and OTP guide</i> and it depends on previous chapters in this guide.
For more information, <a href="/getting-started/mix-otp/introduction-to-mix.html">read the introduction guide</a> or check out the chapter index in the sidebar.</p>
</blockquote>

<p>In the <a href="/getting-started/mix-otp/agent.html">previous chapter</a>, we used agents to represent our buckets. In the <a href="/getting-started/mix-otp/introduction-to-mix.html">introduction to mix</a>, we specified we would like to name each bucket so we can do the following:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">CREATE</span> <span class="n">shopping</span>
<span class="no">OK</span>

<span class="no">PUT</span> <span class="n">shopping</span> <span class="n">milk</span> <span class="mi">1</span>
<span class="no">OK</span>

<span class="no">GET</span> <span class="n">shopping</span> <span class="n">milk</span>
<span class="mi">1</span>
<span class="no">OK</span>
</code></pre></div></div>

<p>In the session above we interacted with the “shopping” bucket.</p>

<p>Since agents are processes, each bucket has a process identifier (pid), but buckets do not have a name. Back <a href="/getting-started/processes.html">in the Process chapter</a>, we have learned that we can register processes in Elixir by giving them atom names:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Agent</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span> <span class="p">%{}</span> <span class="k">end</span><span class="p">,</span> <span class="ss">name:</span> <span class="ss">:shopping</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="c1">#PID&lt;0.43.0&gt;}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="ss">:shopping</span><span class="p">,</span> <span class="s2">"milk"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="ss">:shopping</span><span class="p">,</span> <span class="s2">"milk"</span><span class="p">)</span>
<span class="mi">1</span>
</code></pre></div></div>

<p>However, naming dynamic processes with atoms is a terrible idea! If we use atoms, we would need to convert the bucket name (often received from an external client) to atoms, and <strong>we should never convert user input to atoms</strong>. This is because atoms are not garbage collected. Once an atom is created, it is never reclaimed. Generating atoms from user input would mean the user can inject enough different names to exhaust our system memory!</p>

<p>In practice, it is more likely you will reach the Erlang <abbr title="Virtual Machine">VM</abbr> limit for the maximum number of atoms before you run out of memory, which will bring your system down regardless.</p>

<p>Instead of abusing the built-in name facility, we will create our own <em>process registry</em> that associates the bucket name to the bucket process.</p>

<p>The registry needs to guarantee that it is always up to date. For example, if one of the bucket processes crashes due to a bug, the registry must notice this change and avoid serving stale entries. In Elixir, we say the registry needs to <em>monitor</em> each bucket. Because our <em>registry</em> needs to be able to receive and handle ad-hoc messages from the system, the <code class="language-plaintext highlighter-rouge">Agent</code> API is not enough.</p>

<p>We will use a <a href="https://hexdocs.pm/elixir/GenServer.html">GenServer</a> to create a registry process that can monitor the bucket processes. GenServer provides industrial strength functionality for building servers in both Elixir and  <abbr title="Open Telecom Platform">OTP</abbr>.</p>

<p>Please read <a href="https://hexdocs.pm/elixir/GenServer.html">the GenServer module documentation</a> for an overview if you haven’t yet. Once you do so, we are ready to proceed.</p>

<h2 id="genserver-callbacks" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">GenServer callbacks</span><a href="#genserver-callbacks" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>A GenServer is a process that invokes a limited set of functions under specific conditions. When we used an <code class="language-plaintext highlighter-rouge">Agent</code>, we would keep both the client code and the server code side by side, like this:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">put</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">do</span>
  <span class="no">Agent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="o">&amp;</span><span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="nv">&amp;1</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Let’s break that code apart a bit:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">put</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># Here is the client code</span>
  <span class="no">Agent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="k">fn</span> <span class="n">state</span> <span class="o">-&gt;</span>
    <span class="c1"># Here is the server code</span>
    <span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
  <span class="k">end</span><span class="p">)</span>
  <span class="c1"># Back to the client code</span>
<span class="k">end</span>
</code></pre></div></div>

<p>In the code above, we have a process, which we call “the client” sending a request to an agent, “the server”. The request contains an anonymous function, which must be executed by the server.</p>

<p>In a GenServer, the code above would be two separate functions, roughly like this:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">put</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># Send the server a :put "instruction"</span>
  <span class="no">GenServer</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="p">{</span><span class="ss">:put</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">})</span>
<span class="k">end</span>

<span class="c1"># Server callback</span>

<span class="k">def</span> <span class="n">handle_call</span><span class="p">({</span><span class="ss">:put</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">},</span> <span class="n">_from</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">do</span>
  <span class="p">{</span><span class="ss">:reply</span><span class="p">,</span> <span class="ss">:ok</span><span class="p">,</span> <span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>There is quite a bit more ceremony in the GenServer code but, as we will see, it brings some benefits too.</p>

<p>For now, we will write only the server callbacks for our bucket registering logic, without providing a proper API, which we will do later.</p>

<p>Create a new file at <code class="language-plaintext highlighter-rouge">lib/kv/registry.ex</code> with the following contents:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">GenServer</span>

  <span class="c1">## Missing Client API - will add this later</span>

  <span class="c1">## Defining GenServer Callbacks</span>

  <span class="nv">@impl</span> <span class="no">true</span>
  <span class="k">def</span> <span class="n">init</span><span class="p">(</span><span class="ss">:ok</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="p">%{}}</span>
  <span class="k">end</span>

  <span class="nv">@impl</span> <span class="no">true</span>
  <span class="k">def</span> <span class="n">handle_call</span><span class="p">({</span><span class="ss">:lookup</span><span class="p">,</span> <span class="n">name</span><span class="p">},</span> <span class="n">_from</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:reply</span><span class="p">,</span> <span class="no">Map</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">names</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="nv">@impl</span> <span class="no">true</span>
  <span class="k">def</span> <span class="n">handle_cast</span><span class="p">({</span><span class="ss">:create</span><span class="p">,</span> <span class="n">name</span><span class="p">},</span> <span class="n">names</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">if</span> <span class="no">Map</span><span class="o">.</span><span class="n">has_key?</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">do</span>
      <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">names</span><span class="p">}</span>
    <span class="k">else</span>
      <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">bucket</span><span class="p">}</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">start_link</span><span class="p">([])</span>
      <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bucket</span><span class="p">)}</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>There are two types of requests you can send to a GenServer: calls and casts. Calls are synchronous and the server <strong>must</strong> send a response back to such requests. While the server computes the response, the client is <strong>waiting</strong>. Casts are asynchronous: the server won’t send a response back and therefore the client won’t wait for one. Both requests are messages sent to the server, and will be handled in sequence. In the above implementation, we pattern-match on the <code class="language-plaintext highlighter-rouge">:create</code> messages, to be handled as cast, and on the <code class="language-plaintext highlighter-rouge">:lookup</code> messages, to be handled as call.</p>

<p>In order to invoke the callbacks above, we need to go through the corresponding <code class="language-plaintext highlighter-rouge">GenServer</code> functions. Let’s start a registry, create a named bucket, and then look it up:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">registry</span><span class="p">}</span> <span class="o">=</span> <span class="no">GenServer</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="ss">:ok</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="c1">#PID&lt;0.136.0&gt;}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">GenServer</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="p">{</span><span class="ss">:create</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">})</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">bk</span><span class="p">}</span> <span class="o">=</span> <span class="no">GenServer</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="p">{</span><span class="ss">:lookup</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">})</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="c1">#PID&lt;0.174.0&gt;}</span>
</code></pre></div></div>

<p>Our <code class="language-plaintext highlighter-rouge">KV.Registry</code> process received a cast with <code class="language-plaintext highlighter-rouge">{:create, "shopping"}</code> and a call with <code class="language-plaintext highlighter-rouge">{:lookup, "shopping"}</code>, in this sequence. <code class="language-plaintext highlighter-rouge">GenServer.cast</code> will immediately return, as soon as the message is sent to the <code class="language-plaintext highlighter-rouge">registry</code>. The <code class="language-plaintext highlighter-rouge">GenServer.call</code> on the other hand, is where we would be waiting for an answer, provided by the above <code class="language-plaintext highlighter-rouge">KV.Registry.handle_call</code> callback.</p>

<p>You may also have noticed that we have added <code class="language-plaintext highlighter-rouge">@impl true</code> before each callback. The <code class="language-plaintext highlighter-rouge">@impl true</code> informs the compiler that our intention for the subsequent function definition is to define a callback. If by any chance we make a mistake in the function name or in the number of arguments, like we define a <code class="language-plaintext highlighter-rouge">handle_call/2</code>, the compiler would warn us there isn’t any <code class="language-plaintext highlighter-rouge">handle_call/2</code> to define, and would give us the complete list of known callbacks for the <code class="language-plaintext highlighter-rouge">GenServer</code> module.</p>

<p>This is all good and well, but we still want to offer our users an API that allows us to hide our implementation details.</p>

<h2 id="the-client-api" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The Client API</span><a href="#the-client-api" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>A GenServer is implemented in two parts: the client API and the server callbacks. You can either combine both parts into a single module or you can separate them into a client module and a server module. The client is any process that invokes the client function. The server is always the process identifier or process name that we will explicitly pass as argument to the client API. Here we’ll use a single module for both the server callbacks and the client API.</p>

<p>Edit the file at <code class="language-plaintext highlighter-rouge">lib/kv/registry.ex</code>, filling in the blanks for the client API:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">## Client API</span>

  <span class="nv">@doc</span> <span class="sd">"""
  Starts the registry.
  """</span>
  <span class="k">def</span> <span class="n">start_link</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">GenServer</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="bp">__MODULE__</span><span class="p">,</span> <span class="ss">:ok</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="nv">@doc</span> <span class="sd">"""
  Looks up the bucket pid for `name` stored in `server`.

  Returns `{:ok, pid}` if the bucket exists, `:error` otherwise.
  """</span>
  <span class="k">def</span> <span class="n">lookup</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">GenServer</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="p">{</span><span class="ss">:lookup</span><span class="p">,</span> <span class="n">name</span><span class="p">})</span>
  <span class="k">end</span>

  <span class="nv">@doc</span> <span class="sd">"""
  Ensures there is a bucket associated with the given `name` in `server`.
  """</span>
  <span class="k">def</span> <span class="n">create</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">GenServer</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="p">{</span><span class="ss">:create</span><span class="p">,</span> <span class="n">name</span><span class="p">})</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>The first function is <code class="language-plaintext highlighter-rouge">start_link/1</code>, which starts a new GenServer passing a list of options. <code class="language-plaintext highlighter-rouge">start_link/1</code> calls out to <code class="language-plaintext highlighter-rouge">GenServer.start_link/3</code>, which takes three arguments:</p>

<ol>
  <li>
    <p>The module where the server callbacks are implemented, in this case <code class="language-plaintext highlighter-rouge">__MODULE__</code> (meaning the current module)</p>
  </li>
  <li>
    <p>The initialization arguments, in this case the atom <code class="language-plaintext highlighter-rouge">:ok</code></p>
  </li>
  <li>
    <p>A list of options which can be used to specify things like the name of the server. For now, we forward the list of options that we receive on <code class="language-plaintext highlighter-rouge">start_link/1</code> to <code class="language-plaintext highlighter-rouge">GenServer.start_link/3</code></p>
  </li>
</ol>

<p>The next two functions, <code class="language-plaintext highlighter-rouge">lookup/2</code> and <code class="language-plaintext highlighter-rouge">create/2</code>, are responsible for sending these requests to the server.  In this case, we have used <code class="language-plaintext highlighter-rouge">{:lookup, name}</code> and <code class="language-plaintext highlighter-rouge">{:create, name}</code> respectively.  Requests are often specified as tuples, like this, in order to provide more than one “argument” in that first argument slot. It’s common to specify the action being requested as the first element of a tuple, and arguments for that action in the remaining elements. Note that the requests must match the first argument to <code class="language-plaintext highlighter-rouge">handle_call/3</code> or <code class="language-plaintext highlighter-rouge">handle_cast/2</code>.</p>

<p>That’s it for the client API. On the server side, we can implement a variety of callbacks to guarantee the server initialization, termination, and handling of requests. Those callbacks are optional and for now, we have only implemented the ones we care about. Let’s recap.</p>

<p>The first is the <code class="language-plaintext highlighter-rouge">init/1</code> callback, that receives the second argument given to <code class="language-plaintext highlighter-rouge">GenServer.start_link/3</code> and returns <code class="language-plaintext highlighter-rouge">{:ok, state}</code>, where state is a new map. We can already notice how the <code class="language-plaintext highlighter-rouge">GenServer</code> API makes the client/server segregation more apparent. <code class="language-plaintext highlighter-rouge">start_link/3</code> happens in the client, while <code class="language-plaintext highlighter-rouge">init/1</code> is the respective callback that runs on the server.</p>

<p>For <code class="language-plaintext highlighter-rouge">call/2</code> requests, we  implement a <code class="language-plaintext highlighter-rouge">handle_call/3</code> callback that receives the <code class="language-plaintext highlighter-rouge">request</code>, the process from which we received the request (<code class="language-plaintext highlighter-rouge">_from</code>), and the current server state (<code class="language-plaintext highlighter-rouge">names</code>). The <code class="language-plaintext highlighter-rouge">handle_call/3</code> callback returns a tuple in the format <code class="language-plaintext highlighter-rouge">{:reply, reply, new_state}</code>. The first element of the tuple, <code class="language-plaintext highlighter-rouge">:reply</code>,  indicates that the server should send a reply back to the client. The second element, <code class="language-plaintext highlighter-rouge">reply</code>, is what will be sent to the client while the third, <code class="language-plaintext highlighter-rouge">new_state</code> is the new server state.</p>

<p>For <code class="language-plaintext highlighter-rouge">cast/2</code> requests, we implement a <code class="language-plaintext highlighter-rouge">handle_cast/2</code> callback that receives the <code class="language-plaintext highlighter-rouge">request</code> and the current server state (<code class="language-plaintext highlighter-rouge">names</code>). The <code class="language-plaintext highlighter-rouge">handle_cast/2</code> callback returns a tuple in the format <code class="language-plaintext highlighter-rouge">{:noreply, new_state}</code>. Note that in a real application we would have probably implemented the callback for <code class="language-plaintext highlighter-rouge">:create</code> with a synchronous call instead of an asynchronous cast. We are doing it this way to illustrate how to implement a cast callback.</p>

<p>There are other tuple formats both <code class="language-plaintext highlighter-rouge">handle_call/3</code> and <code class="language-plaintext highlighter-rouge">handle_cast/2</code> callbacks may return. There are also other callbacks like <code class="language-plaintext highlighter-rouge">terminate/2</code> and <code class="language-plaintext highlighter-rouge">code_change/3</code> that we could implement. You are welcome to explore the <a href="https://hexdocs.pm/elixir/GenServer.html">full GenServer documentation</a> to learn more about those.</p>

<p>For now, let’s write some tests to guarantee our GenServer works as expected.</p>

<h2 id="testing-a-genserver" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Testing a GenServer</span><a href="#testing-a-genserver" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Testing a GenServer is not much different from testing an agent. We will spawn the server on a setup callback and use it throughout our tests. Create a file at <code class="language-plaintext highlighter-rouge">test/kv/registry_test.exs</code> with the following:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KV</span><span class="o">.</span><span class="no">RegistryTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ExUnit</span><span class="o">.</span><span class="no">Case</span><span class="p">,</span> <span class="ss">async:</span> <span class="no">true</span>

  <span class="n">setup</span> <span class="k">do</span>
    <span class="n">registry</span> <span class="o">=</span> <span class="n">start_supervised!</span><span class="p">(</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">)</span>
    <span class="p">%{</span><span class="ss">registry:</span> <span class="n">registry</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="n">test</span> <span class="s2">"spawns buckets"</span><span class="p">,</span> <span class="p">%{</span><span class="ss">registry:</span> <span class="n">registry</span><span class="p">}</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span> <span class="o">==</span> <span class="ss">:error</span>

    <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>
    <span class="n">assert</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">bucket</span><span class="p">}</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>

    <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s2">"milk"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">assert</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s2">"milk"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Our test case first asserts there’s no buckets in our registry, creates a named bucket, looks it up, and asserts it behaves as a bucket.</p>

<p>There is one important difference between the <code class="language-plaintext highlighter-rouge">setup</code> block we wrote for <code class="language-plaintext highlighter-rouge">KV.Registry</code> and the one we wrote for <code class="language-plaintext highlighter-rouge">KV.Bucket</code>. Instead of starting the registry by hand by calling <code class="language-plaintext highlighter-rouge">KV.Registry.start_link/1</code>, we instead called <a href="https://hexdocs.pm/ex_unit/ExUnit.Callbacks.html#start_supervised/2">the <code class="language-plaintext highlighter-rouge">start_supervised!/2</code> function</a>, passing the <code class="language-plaintext highlighter-rouge">KV.Registry</code> module.</p>

<p>The <code class="language-plaintext highlighter-rouge">start_supervised!</code> function was injected into our test module by <code class="language-plaintext highlighter-rouge">use ExUnit.Case</code>. It does the job of starting the <code class="language-plaintext highlighter-rouge">KV.Registry</code> process, by calling its <code class="language-plaintext highlighter-rouge">start_link/1</code> function. The advantage of using <code class="language-plaintext highlighter-rouge">start_supervised!</code> is that ExUnit will guarantee that the registry process will be shutdown <strong>before</strong> the next test starts. In other words, it helps guarantee that the state of one test is not going to interfere with the next one in case they depend on shared resources.</p>

<p>When starting processes during your tests, we should always prefer to use <code class="language-plaintext highlighter-rouge">start_supervised!</code>. We recommend you to change the <code class="language-plaintext highlighter-rouge">setup</code> block in <code class="language-plaintext highlighter-rouge">bucket_test.exs</code> to use <code class="language-plaintext highlighter-rouge">start_supervised!</code> too.</p>

<p>Run the tests and they should all pass!</p>

<h2 id="the-need-for-monitoring" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The need for monitoring</span><a href="#the-need-for-monitoring" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Everything we have done so far could have been implemented with an <code class="language-plaintext highlighter-rouge">Agent</code>. In this section, we will see one of many things that we can achieve with a GenServer that is not possible with an Agent.</p>

<p>Let’s start with a test that describes how we want the registry to behave if a bucket stops or crashes:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test</span> <span class="s2">"removes buckets on exit"</span><span class="p">,</span> <span class="p">%{</span><span class="ss">registry:</span> <span class="n">registry</span><span class="p">}</span> <span class="k">do</span>
  <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>
  <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">bucket</span><span class="p">}</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>
  <span class="no">Agent</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
  <span class="n">assert</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span> <span class="o">==</span> <span class="ss">:error</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The test above will fail on the last assertion as the bucket name remains in the registry even after we stop the bucket process.</p>

<p>In order to fix this bug, we need the registry to monitor every bucket it spawns. Once we set up a monitor, the registry will receive a notification every time a bucket process exits, allowing us to clean the registry up.</p>

<p>Let’s first play with monitors by starting a new console with <code class="language-plaintext highlighter-rouge">iex -S mix</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">pid</span><span class="p">}</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">start_link</span><span class="p">([])</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="c1">#PID&lt;0.66.0&gt;}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Process</span><span class="o">.</span><span class="n">monitor</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
<span class="c1">#Reference&lt;0.0.0.551&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Agent</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">flush</span><span class="p">()</span>
<span class="p">{</span><span class="ss">:DOWN</span><span class="p">,</span> <span class="c1">#Reference&lt;0.0.0.551&gt;, :process, #PID&lt;0.66.0&gt;, :normal}</span>
</code></pre></div></div>

<p>Note <code class="language-plaintext highlighter-rouge">Process.monitor(pid)</code> returns a unique reference that allows us to match upcoming messages to that monitoring reference. After we stop the agent, we can <code class="language-plaintext highlighter-rouge">flush/0</code> all messages and notice a <code class="language-plaintext highlighter-rouge">:DOWN</code> message arrived, with the exact reference returned by <code class="language-plaintext highlighter-rouge">monitor</code>, notifying that the bucket process exited with reason <code class="language-plaintext highlighter-rouge">:normal</code>.</p>

<p>Let’s reimplement the server callbacks to fix the bug and make the test pass. First, we will modify the GenServer state to two dictionaries: one that contains <code class="language-plaintext highlighter-rouge">name -&gt; pid</code> and another that holds <code class="language-plaintext highlighter-rouge">ref -&gt; name</code>. Then we need to monitor the buckets on <code class="language-plaintext highlighter-rouge">handle_cast/2</code> as well as implement a <code class="language-plaintext highlighter-rouge">handle_info/2</code> callback to handle the monitoring messages. The full server callbacks implementation is shown below:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Server callbacks</span>

<span class="nv">@impl</span> <span class="no">true</span>
<span class="k">def</span> <span class="n">init</span><span class="p">(</span><span class="ss">:ok</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">names</span> <span class="o">=</span> <span class="p">%{}</span>
  <span class="n">refs</span> <span class="o">=</span> <span class="p">%{}</span>
  <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="p">{</span><span class="n">names</span><span class="p">,</span> <span class="n">refs</span><span class="p">}}</span>
<span class="k">end</span>

<span class="nv">@impl</span> <span class="no">true</span>
<span class="k">def</span> <span class="n">handle_call</span><span class="p">({</span><span class="ss">:lookup</span><span class="p">,</span> <span class="n">name</span><span class="p">},</span> <span class="n">_from</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">do</span>
  <span class="p">{</span><span class="n">names</span><span class="p">,</span> <span class="n">_</span><span class="p">}</span> <span class="o">=</span> <span class="n">state</span>
  <span class="p">{</span><span class="ss">:reply</span><span class="p">,</span> <span class="no">Map</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">state</span><span class="p">}</span>
<span class="k">end</span>

<span class="nv">@impl</span> <span class="no">true</span>
<span class="k">def</span> <span class="n">handle_cast</span><span class="p">({</span><span class="ss">:create</span><span class="p">,</span> <span class="n">name</span><span class="p">},</span> <span class="p">{</span><span class="n">names</span><span class="p">,</span> <span class="n">refs</span><span class="p">})</span> <span class="k">do</span>
  <span class="k">if</span> <span class="no">Map</span><span class="o">.</span><span class="n">has_key?</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="p">{</span><span class="n">names</span><span class="p">,</span> <span class="n">refs</span><span class="p">}}</span>
  <span class="k">else</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">bucket</span><span class="p">}</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">start_link</span><span class="p">([])</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="no">Process</span><span class="o">.</span><span class="n">monitor</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
    <span class="n">refs</span> <span class="o">=</span> <span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">refs</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bucket</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="p">{</span><span class="n">names</span><span class="p">,</span> <span class="n">refs</span><span class="p">}}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="nv">@impl</span> <span class="no">true</span>
<span class="k">def</span> <span class="n">handle_info</span><span class="p">({</span><span class="ss">:DOWN</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="ss">:process</span><span class="p">,</span> <span class="n">_pid</span><span class="p">,</span> <span class="n">_reason</span><span class="p">},</span> <span class="p">{</span><span class="n">names</span><span class="p">,</span> <span class="n">refs</span><span class="p">})</span> <span class="k">do</span>
  <span class="p">{</span><span class="n">name</span><span class="p">,</span> <span class="n">refs</span><span class="p">}</span> <span class="o">=</span> <span class="no">Map</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">refs</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
  <span class="n">names</span> <span class="o">=</span> <span class="no">Map</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="p">{</span><span class="n">names</span><span class="p">,</span> <span class="n">refs</span><span class="p">}}</span>
<span class="k">end</span>

<span class="nv">@impl</span> <span class="no">true</span>
<span class="k">def</span> <span class="n">handle_info</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">do</span>
  <span class="kn">require</span> <span class="no">Logger</span>
  <span class="no">Logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Unexpected message in KV.Registry: </span><span class="si">#{</span><span class="n">inspect</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
  <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">state</span><span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Observe that we were able to considerably change the server implementation without changing any of the client API. That’s one of the benefits of explicitly segregating the server and the client.</p>

<p>Finally, different from the other callbacks, we have defined a “catch-all” clause for <code class="language-plaintext highlighter-rouge">handle_info/2</code> that discards and logs any unknown message. To understand why, let’s move on to the next section.</p>

<h2 id="call-cast-or-info" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper"><code class="language-plaintext highlighter-rouge">call</code>, <code class="language-plaintext highlighter-rouge">cast</code> or <code class="language-plaintext highlighter-rouge">info</code>?</span><a href="#call-cast-or-info" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>So far we have used three callbacks: <code class="language-plaintext highlighter-rouge">handle_call/3</code>, <code class="language-plaintext highlighter-rouge">handle_cast/2</code> and <code class="language-plaintext highlighter-rouge">handle_info/2</code>. Here is what we should consider when deciding when to use each:</p>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">handle_call/3</code> must be used for synchronous requests. This should be the default choice as waiting for the server reply is a useful backpressure mechanism.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">handle_cast/2</code> must be used for asynchronous requests, when you don’t care about a reply. A cast does not guarantee the server has received the message and, for this reason, should be used sparingly. For example, the <code class="language-plaintext highlighter-rouge">create/2</code> function we have defined in this chapter should have used <code class="language-plaintext highlighter-rouge">call/2</code>. We have used <code class="language-plaintext highlighter-rouge">cast/2</code> for didactic purposes.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">handle_info/2</code> must be used for all other messages a server may receive that are not sent via <code class="language-plaintext highlighter-rouge">GenServer.call/2</code> or <code class="language-plaintext highlighter-rouge">GenServer.cast/2</code>, including regular messages sent with <code class="language-plaintext highlighter-rouge">send/2</code>. The monitoring <code class="language-plaintext highlighter-rouge">:DOWN</code> messages are an example of this.</p>
  </li>
</ol>

<p>Since any message, including the ones sent via <code class="language-plaintext highlighter-rouge">send/2</code>, go to <code class="language-plaintext highlighter-rouge">handle_info/2</code>, there is a chance unexpected messages will arrive to the server. Therefore, if we don’t define the catch-all clause, those messages could cause our registry to crash, because no clause would match. We don’t need to worry about such cases for <code class="language-plaintext highlighter-rouge">handle_call/3</code> and <code class="language-plaintext highlighter-rouge">handle_cast/2</code> though. Calls and casts are only done via the <code class="language-plaintext highlighter-rouge">GenServer</code> API, so an unknown message is quite likely a developer mistake.</p>

<p>To help developers remember the differences between call, cast and info, the supported return values and more, we have a tiny <a href="/downloads/cheatsheets/gen-server.pdf">GenServer cheat sheet</a>.</p>

<h2 id="monitors-or-links" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Monitors or links?</span><a href="#monitors-or-links" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>We have previously learned about links in the <a href="/getting-started/processes.html">Process chapter</a>. Now, with the registry complete, you may be wondering: when should we use monitors and when should we use links?</p>

<p>Links are bi-directional. If you link two processes and one of them crashes, the other side will crash too (unless it is trapping exits). A monitor is uni-directional: only the monitoring process will receive notifications about the monitored one. In other words: use links when you want linked crashes, and monitors when you just want to be informed of crashes, exits, and so on.</p>

<p>Returning to our <code class="language-plaintext highlighter-rouge">handle_cast/2</code> implementation, you can see the registry is both linking and monitoring the buckets:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">bucket</span><span class="p">}</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">start_link</span><span class="p">([])</span>
<span class="n">ref</span> <span class="o">=</span> <span class="no">Process</span><span class="o">.</span><span class="n">monitor</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
</code></pre></div></div>

<p>This is a bad idea, as we don’t want the registry to crash when a bucket crashes. The proper fix is to actually not link the bucket to the registry. Instead, we will link each bucket to a special type of process called Supervisors, which are explicitly designed to handle failures and crashes. We will learn more about them in the next chapter.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
  
    
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/mix-otp/agent.html" class="previous page-numbers spec" title="Agent">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/mix-otp/supervisor-and-application.html" class="previous page-numbers spec" title="Supervisor and Application">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/mix-otp/genserver.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/mix-otp/supervisor-and-application.html" page=":4:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><span title="Supervisor and Application">Supervisor and Application</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Mix and OTP</small>
      <h1>Supervisor and Application</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#our-first-supervisor">Our first supervisor</a></li><li><a href="#naming-processes">Naming processes</a></li><li><a href="#understanding-applications">Understanding applications</a><ol><li><a href="#starting-applications">Starting applications</a></li></ol></li><li><a href="#the-application-callback">The application callback</a></li><li><a href="#projects-or-applications">Projects or applications?</a></li><li><a href="#next-steps">Next steps</a></li></ol></div>

    <blockquote>
  <p>This chapter is part of the <i>Mix and OTP guide</i> and it depends on previous chapters in this guide.
For more information, <a href="/getting-started/mix-otp/introduction-to-mix.html">read the introduction guide</a> or check out the chapter index in the sidebar.</p>
</blockquote>

<p>In the previous chapter about <code class="language-plaintext highlighter-rouge">GenServer</code>, we implemented <code class="language-plaintext highlighter-rouge">KV.Registry</code> to manage buckets. At some point, we started monitoring buckets so we were able to take action whenever a <code class="language-plaintext highlighter-rouge">KV.Bucket</code> crashed. Although the change was relatively small, it introduced a question which is frequently asked by Elixir developers: what happens when something fails?</p>

<p>Before we added monitoring, if a bucket crashed, the registry would forever point to a bucket that no longer exists. If a user tried to read or write to the crashed bucket, it would fail. Any attempt at creating a new bucket with the same name would just return the PID of the crashed bucket. In other words, that registry entry for that bucket would forever be in a bad state. Once we added monitoring, the registry automatically removes the entry for the crashed bucket. Trying to lookup the crashed bucket now (correctly) says the bucket does not exist and a user of the system can successfully create a new one if desired.</p>

<p>In practice, we are not expecting the processes working as buckets to fail. But, if it does happen, for whatever reason, we can rest assured that our system will continue to work as intended.</p>

<p>If you have prior programming experience, you may be wondering: “could we just guarantee the bucket does not crash in the first place?”. As we will see, Elixir developers tend to refer to those practices as “defensive programming”. That’s because a live production system has dozens of different reasons why something can go wrong. The disk can fail, memory can be corrupted, bugs, the network may stop working for a second, etc. If we were to write software that attempted to protect or circumvent all of those errors, we would spend more time handling failures than writing our own software!</p>

<p>Therefore, an Elixir developer prefers to “let it crash” or “fail fast”. And one of the most common ways we can recover from a failure is by restarting whatever part of the system crashed.</p>

<p>For example, imagine your computer, router, printer, or whatever device is not working properly. How often do you fix it by restarting it? Once we restart the device, we reset the device back to its initial state, which is well-tested and guaranteed to work. In Elixir, we apply this same approach to software: whenever a process crashes, we start a new process to perform the same job as the crashed process.</p>

<p>In Elixir, this is done by a Supervisor. A Supervisor is a process that supervises other processes and restarts them whenever they crash. To do so, Supervisors manage the whole life-cycle of any supervised processes, including startup and shutdown.</p>

<p>In this chapter, we will learn how to put those concepts into practice by supervising the <code class="language-plaintext highlighter-rouge">KV.Registry</code> process. After all, if something goes wrong with the registry, the whole registry is lost and no bucket could ever be found! To address this, we will define a <code class="language-plaintext highlighter-rouge">KV.Supervisor</code> module that guarantees that our <code class="language-plaintext highlighter-rouge">KV.Registry</code> is up and running at any given moment.</p>

<p>At the end of the chapter, we will also talk about Applications. As we will see, Mix has been packaging all of our code into an application, and we will learn how to customize our application to guarantee that our Supervisor and the Registry are up and running whenever our system starts.</p>

<h2 id="our-first-supervisor" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Our first supervisor</span><a href="#our-first-supervisor" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>A supervisor is a process which supervises other processes, which we refer to as child processes. The act of supervising a process includes three distinct responsibilities. The first one is to start child processes. Once a child process is running, the supervisor may restart a child process, either because it terminated abnormally or because a certain condition was reached. For example, a supervisor may restart all children if any child dies. Finally, a supervisor is also responsible for shutting down the child processes when the system is shutting down. Please see the <a href="https://hexdocs.pm/elixir/Supervisor.html">Supervisor</a> module for a more in-depth discussion.</p>

<p>Creating a supervisor is not much different from creating a GenServer. We are going to define a module named <code class="language-plaintext highlighter-rouge">KV.Supervisor</code>, which will use the Supervisor behaviour, inside the <code class="language-plaintext highlighter-rouge">lib/kv/supervisor.ex</code> file:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KV</span><span class="o">.</span><span class="no">Supervisor</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Supervisor</span>

  <span class="k">def</span> <span class="n">start_link</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Supervisor</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="bp">__MODULE__</span><span class="p">,</span> <span class="ss">:ok</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="nv">@impl</span> <span class="no">true</span>
  <span class="k">def</span> <span class="n">init</span><span class="p">(</span><span class="ss">:ok</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
      <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span>
    <span class="p">]</span>

    <span class="no">Supervisor</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="ss">strategy:</span> <span class="ss">:one_for_one</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Our supervisor has a single child so far: <code class="language-plaintext highlighter-rouge">KV.Registry</code>. After we define a list of children, we call <code class="language-plaintext highlighter-rouge">Supervisor.init/2</code>, passing the children and the supervision strategy.</p>

<p>The supervision strategy dictates what happens when one of the children crashes. <code class="language-plaintext highlighter-rouge">:one_for_one</code> means that if a child dies, it will be the only one restarted. Since we have only one child now, that’s all we need. The <code class="language-plaintext highlighter-rouge">Supervisor</code> behaviour supports many different strategies and we will discuss them in this chapter.</p>

<p>Once the supervisor starts, it will traverse the list of children and it will invoke the <code class="language-plaintext highlighter-rouge">child_spec/1</code> function on each module.</p>

<p>The <code class="language-plaintext highlighter-rouge">child_spec/1</code> function returns the child specification which describes how to start the process, if the process is a worker or a supervisor, if the process is temporary, transient or permanent and so on. The <code class="language-plaintext highlighter-rouge">child_spec/1</code> function is automatically defined when we <code class="language-plaintext highlighter-rouge">use Agent</code>, <code class="language-plaintext highlighter-rouge">use GenServer</code>, <code class="language-plaintext highlighter-rouge">use Supervisor</code>, etc. Let’s give it a try in the terminal with <code class="language-plaintext highlighter-rouge">iex -S mix</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">child_spec</span><span class="p">([])</span>
<span class="p">%{</span><span class="ss">id:</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="ss">start:</span> <span class="p">{</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="ss">:start_link</span><span class="p">,</span> <span class="p">[[]]}}</span>
</code></pre></div></div>

<p>We will learn those details as we move forward on this guide. If you would rather peek ahead, check the <a href="https://hexdocs.pm/elixir/Supervisor.html">Supervisor</a> docs.</p>

<p>After the supervisor retrieves all child specifications, it proceeds to start its children one by one, in the order they were defined, using the information in the <code class="language-plaintext highlighter-rouge">:start</code> key in the child specification. For our current specification, it will call <code class="language-plaintext highlighter-rouge">KV.Registry.start_link([])</code>.</p>

<p>Let’s take the supervisor for a spin:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">sup</span><span class="p">}</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="no">Supervisor</span><span class="o">.</span><span class="n">start_link</span><span class="p">([])</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="c1">#PID&lt;0.148.0&gt;}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Supervisor</span><span class="o">.</span><span class="n">which_children</span><span class="p">(</span><span class="n">sup</span><span class="p">)</span>
<span class="p">[{</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="c1">#PID&lt;0.150.0&gt;, :worker, [KV.Registry]}]</span>
</code></pre></div></div>

<p>So far we have started the supervisor and listed its children. Once the supervisor started, it also started all of its children.</p>

<p>What happens if we intentionally crash the registry started by the supervisor? Let’s do so by sending it a bad input on <code class="language-plaintext highlighter-rouge">call</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">[{</span><span class="n">_</span><span class="p">,</span> <span class="n">registry</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">}]</span> <span class="o">=</span> <span class="no">Supervisor</span><span class="o">.</span><span class="n">which_children</span><span class="p">(</span><span class="n">sup</span><span class="p">)</span>
<span class="p">[{</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="c1">#PID&lt;0.150.0&gt;, :worker, [KV.Registry]}]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">GenServer</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="ss">:bad_input</span><span class="p">)</span>
<span class="mi">08</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mf">57.311</span> <span class="p">[</span><span class="n">error</span><span class="p">]</span> <span class="no">GenServer</span> <span class="c1">#PID&lt;0.150.0&gt; terminating</span>
<span class="o">**</span> <span class="p">(</span><span class="no">FunctionClauseError</span><span class="p">)</span> <span class="n">no</span> <span class="n">function</span> <span class="n">clause</span> <span class="n">matching</span> <span class="ow">in</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">handle_call</span><span class="o">/</span><span class="mi">3</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Supervisor</span><span class="o">.</span><span class="n">which_children</span><span class="p">(</span><span class="n">sup</span><span class="p">)</span>
<span class="p">[{</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="c1">#PID&lt;0.157.0&gt;, :worker, [KV.Registry]}]</span>
</code></pre></div></div>

<p>Notice how the supervisor automatically started a new registry, with a new PID, in place of the first one once we caused it to crash due to a bad input.</p>

<p>In the previous chapters, we have always started processes directly. For example, we would call <code class="language-plaintext highlighter-rouge">KV.Registry.start_link([])</code>, which would return <code class="language-plaintext highlighter-rouge">{:ok, pid}</code>, and that would allow us to interact with the registry via its <code class="language-plaintext highlighter-rouge">pid</code>. Now that processes are started by the supervisor, we have to directly ask the supervisor who its children are, and fetch the pid from the returned list of children. In practice, doing so every time would be very expensive. To address this, we often give names to processes, allowing them to be uniquely identified in a single machine from anywhere in our code.</p>

<p>Let’s learn how to do that.</p>

<h2 id="naming-processes" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Naming processes</span><a href="#naming-processes" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>While our application will have many buckets, it will only have a single registry. Therefore, whenever we start the registry, we want to give it a unique name so we can reach out to it from anywhere. We do so by passing a <code class="language-plaintext highlighter-rouge">:name</code> option to <code class="language-plaintext highlighter-rouge">KV.Registry.start_link/1</code>.</p>

<p>Let’s slightly change our children definition (in <code class="language-plaintext highlighter-rouge">KV.Supervisor.init/1</code>) to be a list of tuples instead of a list of atoms:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">def</span> <span class="n">init</span><span class="p">(</span><span class="ss">:ok</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="ss">name:</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">}</span>
    <span class="p">]</span>
</code></pre></div></div>

<p>With this in place, the supervisor will now start <code class="language-plaintext highlighter-rouge">KV.Registry</code> by calling <code class="language-plaintext highlighter-rouge">KV.Registry.start_link(name: KV.Registry)</code>.</p>

<p>If you revisit the <code class="language-plaintext highlighter-rouge">KV.Registry.start_link/1</code> implementation, you will remember it simply passes the options to GenServer:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">def</span> <span class="n">start_link</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">GenServer</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="bp">__MODULE__</span><span class="p">,</span> <span class="ss">:ok</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>which in turn will register the process with the given name. The <code class="language-plaintext highlighter-rouge">:name</code> option expects an atom for locally named processes (locally named means it is available to this machine - there are other options, which we won’t discuss here). Since module identifiers are atoms (try <code class="language-plaintext highlighter-rouge">i(KV.Registry)</code> in IEx), we can name a process after the module that implements it, provided there is only one process for that name. This helps when debugging and introspecting the system.</p>

<p>Let’s give the updated supervisor a try inside <code class="language-plaintext highlighter-rouge">iex -S mix</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">KV</span><span class="o">.</span><span class="no">Supervisor</span><span class="o">.</span><span class="n">start_link</span><span class="p">([])</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="c1">#PID&lt;0.66.0&gt;}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="c1">#PID&lt;0.70.0&gt;}</span>
</code></pre></div></div>

<p>This time the supervisor started a named registry, allowing us to create buckets without having to explicitly fetch the PID from the supervisor. You should also know how to make the registry crash again, without looking up its PID: give it a try.</p>

<blockquote>
  <p>At this point, you may be wondering: should you also locally name bucket processes? Remember buckets are started dynamically based on user input. Since local names MUST be atoms, we would have to dynamically create atoms, which is a bad idea since once an atom is defined, it is never erased nor garbage collected. This means that, if we create atoms dynamically based on user input, we will eventually run out of memory (or to be more precise, the VM will crash because it imposes a hard limit on the number of atoms). This limitation is precisely why we created our own registry (or why one would use Elixir’s built-in <a href="https://hexdocs.pm/elixir/Registry.html"><code class="language-plaintext highlighter-rouge">Registry</code></a> module).</p>
</blockquote>

<p>We are getting closer and closer to a fully working system. The supervisor automatically starts the registry. But how can we automatically start the supervisor whenever our system starts? To answer this question, let’s talk about applications.</p>

<h2 id="understanding-applications" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Understanding applications</span><a href="#understanding-applications" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>We have been working inside an application this entire time. Every time we changed a file and ran <code class="language-plaintext highlighter-rouge">mix compile</code>, we could see a <code class="language-plaintext highlighter-rouge">Generated kv app</code> message in the compilation output.</p>

<p>We can find the generated <code class="language-plaintext highlighter-rouge">.app</code> file at <code class="language-plaintext highlighter-rouge">_build/dev/lib/kv/ebin/kv.app</code>. Let’s have a look at its contents:</p>

<div class="language-erlang highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="n">application</span><span class="p">,</span><span class="n">kv</span><span class="p">,</span>
             <span class="p">[{</span><span class="n">applications</span><span class="p">,[</span><span class="n">kernel</span><span class="p">,</span><span class="n">stdlib</span><span class="p">,</span><span class="n">elixir</span><span class="p">,</span><span class="n">logger</span><span class="p">]},</span>
              <span class="p">{</span><span class="n">description</span><span class="p">,</span><span class="s">"kv"</span><span class="p">},</span>
              <span class="p">{</span><span class="n">modules</span><span class="p">,[</span><span class="n">'Elixir.KV'</span><span class="p">,</span><span class="n">'Elixir.KV.Bucket'</span><span class="p">,</span><span class="n">'Elixir.KV.Registry'</span><span class="p">,</span>
                        <span class="n">'Elixir.KV.Supervisor'</span><span class="p">]},</span>
              <span class="p">{</span><span class="n">registered</span><span class="p">,[]},</span>
              <span class="p">{</span><span class="n">vsn</span><span class="p">,</span><span class="s">"0.1.0"</span><span class="p">}]}.</span>
</code></pre></div></div>

<p>This file contains Erlang terms (written using Erlang syntax). Even though we are not familiar with Erlang, it is easy to guess this file holds our application definition. It contains our application <code class="language-plaintext highlighter-rouge">version</code>, all the modules defined by it, as well as a list of applications we depend on, like Erlang’s <code class="language-plaintext highlighter-rouge">kernel</code>, <code class="language-plaintext highlighter-rouge">elixir</code> itself, and <code class="language-plaintext highlighter-rouge">logger</code>.</p>

<blockquote>
  <p>The <code class="language-plaintext highlighter-rouge">logger</code> application ships as part of Elixir. We stated that our application needs it by specifying it in the <code class="language-plaintext highlighter-rouge">:extra_applications</code> list in <code class="language-plaintext highlighter-rouge">mix.exs</code>. See the <a href="https://hexdocs.pm/logger">official docs</a> for more information.</p>
</blockquote>

<p>In a nutshell, an application consists of all of the modules defined in the <code class="language-plaintext highlighter-rouge">.app</code> file, including the <code class="language-plaintext highlighter-rouge">.app</code> file itself. An application has generally only two directories: <code class="language-plaintext highlighter-rouge">ebin</code>, for Elixir artefacts, such as <code class="language-plaintext highlighter-rouge">.beam</code> and <code class="language-plaintext highlighter-rouge">.app</code> files, and <code class="language-plaintext highlighter-rouge">priv</code>, with any other artefact or asset you may need in your application.</p>

<p>Although Mix generates and maintains the <code class="language-plaintext highlighter-rouge">.app</code> file for us, we can customize its contents by adding new entries to the <code class="language-plaintext highlighter-rouge">application/0</code> function inside the <code class="language-plaintext highlighter-rouge">mix.exs</code> project file. We are going to do our first customization soon.</p>

<h3 id="starting-applications" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Starting applications</span><a href="#starting-applications" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>Each application in our system can be started and stopped. The rules for starting and stopping an application are also defined in the <code class="language-plaintext highlighter-rouge">.app</code> file. When we invoke <code class="language-plaintext highlighter-rouge">iex -S mix</code>, Mix compiles our application and then starts it.</p>

<p>Let’s see this in practice. Start a console with <code class="language-plaintext highlighter-rouge">iex -S mix</code> and try:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Application</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="ss">:kv</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="p">{</span><span class="ss">:already_started</span><span class="p">,</span> <span class="ss">:kv</span><span class="p">}}</span>
</code></pre></div></div>

<p>Oops, it’s already started. Mix starts the current application and all of its dependencies automatically. This is also true for <code class="language-plaintext highlighter-rouge">mix test</code> and many other Mix commands.</p>

<p>You can change this behaviour by giving the <code class="language-plaintext highlighter-rouge">--no-start</code> flag to Mix. It is rarely used in practice but it allows us to understand the underlying mechanisms better. Let’s give it a try.</p>

<p>Invoking <code class="language-plaintext highlighter-rouge">mix</code> is the same as <code class="language-plaintext highlighter-rouge">mix run</code>. Therefore, if you want to pass a flag to <code class="language-plaintext highlighter-rouge">mix</code> or <code class="language-plaintext highlighter-rouge">iex -S mix</code>, we just need to add the task name and the desired flags. For example, run <code class="language-plaintext highlighter-rouge">iex -S mix run --no-start</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Application</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="ss">:kv</span><span class="p">)</span>
<span class="ss">:ok</span>
</code></pre></div></div>

<p>We can stop our <code class="language-plaintext highlighter-rouge">:kv</code> application as well as the <code class="language-plaintext highlighter-rouge">:logger</code> application, which is started by default with Elixir:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Application</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="ss">:kv</span><span class="p">)</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Application</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="ss">:logger</span><span class="p">)</span>
<span class="ss">:ok</span>
</code></pre></div></div>

<p>And let’s try to start our application again:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Application</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="ss">:kv</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="p">{</span><span class="ss">:not_started</span><span class="p">,</span> <span class="ss">:logger</span><span class="p">}}</span>
</code></pre></div></div>

<p>Now we get an error because an application that <code class="language-plaintext highlighter-rouge">:kv</code> depends on (<code class="language-plaintext highlighter-rouge">:logger</code> in this case) isn’t started. We need to either start each application manually in the correct order or call <code class="language-plaintext highlighter-rouge">Application.ensure_all_started</code> as follows:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Application</span><span class="o">.</span><span class="n">ensure_all_started</span><span class="p">(</span><span class="ss">:kv</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="p">[</span><span class="ss">:logger</span><span class="p">,</span> <span class="ss">:kv</span><span class="p">]}</span>
</code></pre></div></div>

<p>In practice, our tools always start our applications for us, but there is an API available if you need fine-grained control.</p>

<h2 id="the-application-callback" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The application callback</span><a href="#the-application-callback" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Whenever we invoke <code class="language-plaintext highlighter-rouge">iex -S mix</code>, Mix automatically starts our application by calling <code class="language-plaintext highlighter-rouge">Application.start(:kv)</code>. But can we customize what happens when our application starts? As a matter of fact, we can! To do so, we define an application callback.</p>

<p>The first step is to tell our application definition (i.e. our <code class="language-plaintext highlighter-rouge">.app</code> file) which module is going to implement the application callback. Let’s do so by opening  <code class="language-plaintext highlighter-rouge">mix.exs</code> and changing <code class="language-plaintext highlighter-rouge">def application</code> to the following:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">def</span> <span class="n">application</span> <span class="k">do</span>
    <span class="p">[</span>
      <span class="ss">extra_applications:</span> <span class="p">[</span><span class="ss">:logger</span><span class="p">],</span>
      <span class="ss">mod:</span> <span class="p">{</span><span class="no">KV</span><span class="p">,</span> <span class="p">[]}</span>
    <span class="p">]</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">:mod</code> option specifies the “application callback module”, followed by the arguments to be passed on application start. The application callback module can be any module that implements the <a href="https://hexdocs.pm/elixir/Application.html">Application</a> behaviour.</p>

<p>To implement the <code class="language-plaintext highlighter-rouge">Application</code> behaviour, we have to <code class="language-plaintext highlighter-rouge">use Application</code> and define a <code class="language-plaintext highlighter-rouge">start/2</code> function. The goal of <code class="language-plaintext highlighter-rouge">start/2</code> is to start a supervisor, which will then start any child services or execute any other code our application may need. Let’s use this opportunity to start the <code class="language-plaintext highlighter-rouge">KV.Supervisor</code> we have implemented earlier in this chapter.</p>

<p>Since we have specified <code class="language-plaintext highlighter-rouge">KV</code> as the module callback, let’s change the <code class="language-plaintext highlighter-rouge">KV</code> module defined in <code class="language-plaintext highlighter-rouge">lib/kv.ex</code> to implement a <code class="language-plaintext highlighter-rouge">start/2</code> function:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KV</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Application</span>

  <span class="nv">@impl</span> <span class="no">true</span>
  <span class="k">def</span> <span class="n">start</span><span class="p">(</span><span class="n">_type</span><span class="p">,</span> <span class="n">_args</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># Although we don't use the supervisor name below directly,</span>
    <span class="c1"># it can be useful when debugging or introspecting the system.</span>
    <span class="no">KV</span><span class="o">.</span><span class="no">Supervisor</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="ss">name:</span> <span class="no">KV</span><span class="o">.</span><span class="no">Supervisor</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>Please note that by doing this, we are breaking the boilerplate test case which tested the <code class="language-plaintext highlighter-rouge">hello</code> function in <code class="language-plaintext highlighter-rouge">KV</code>. You can simply remove that test case.</p>
</blockquote>

<p>When we <code class="language-plaintext highlighter-rouge">use Application</code>, we may define a couple of functions, similar to when we used <code class="language-plaintext highlighter-rouge">Supervisor</code> or <code class="language-plaintext highlighter-rouge">GenServer</code>. This time we only had to define a <code class="language-plaintext highlighter-rouge">start/2</code> function. The <code class="language-plaintext highlighter-rouge">Application</code> behaviour also has a <code class="language-plaintext highlighter-rouge">stop/1</code> callback, but it is rarely used in practice. You can check the documentation for more information.</p>

<p>Now that you have defined an application callback which starts our supervisor, we expect the <code class="language-plaintext highlighter-rouge">KV.Registry</code> process to be up and running as soon as we start <code class="language-plaintext highlighter-rouge">iex -S mix</code>. Let’s give it another try:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="c1">#PID&lt;0.88.0&gt;}</span>
</code></pre></div></div>

<p>Let’s recap what is happening. Whenever we invoke <code class="language-plaintext highlighter-rouge">iex -S mix</code>, it automatically starts our application by calling <code class="language-plaintext highlighter-rouge">Application.start(:kv)</code>, which then invokes the application callback. The application callback’s job is to start a <strong>supervision tree</strong>. Right now, our supervisor has a single child named <code class="language-plaintext highlighter-rouge">KV.Registry</code>, started with name <code class="language-plaintext highlighter-rouge">KV.Registry</code>. Our supervisor could have other children, and some of these children could be their own supervisors with their own children, leading to the so-called supervision trees.</p>

<h2 id="projects-or-applications" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Projects or applications?</span><a href="#projects-or-applications" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Mix makes a distinction between projects and applications. Based on the contents of our <code class="language-plaintext highlighter-rouge">mix.exs</code> file, we would say we have a Mix project that defines the <code class="language-plaintext highlighter-rouge">:kv</code> application. As we will see in later chapters, there are projects that don’t define any application.</p>

<p>When we say “project” you should think about Mix. Mix is the tool that manages your project. It knows how to compile your project, test your project and more. It also knows how to compile and start the application relevant to your project.</p>

<p>When we talk about applications, we talk about <abbr title="Open Telecom Platform">OTP</abbr>. Applications are the entities that are started and stopped as a whole by the runtime. You can learn more about applications and how they relate to booting and shutting down of your system as a whole in the <a href="https://hexdocs.pm/elixir/Application.html">docs for the Application module</a>.</p>

<h2 id="next-steps" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Next steps</span><a href="#next-steps" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Although this chapter was the first time we implemented a supervisor, it was not the first time we used one! In the previous chapter, when we used <code class="language-plaintext highlighter-rouge">start_supervised!</code> to start the registry during our tests, <code class="language-plaintext highlighter-rouge">ExUnit</code> started the registry under a supervisor managed by the ExUnit framework itself. By defining our own supervisor, we provide more structure on how we initialize, shutdown and supervise processes in our applications, aligning our production code and tests with best practices.</p>

<p>But we are not done yet. So far we are supervising the registry but our application is also starting buckets. Since buckets are started dynamically, we can use a special type of supervisor called <code class="language-plaintext highlighter-rouge">DynamicSupervisor</code>, which is optimized to handle such scenarios. Let’s explore it next.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
  
    
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/mix-otp/genserver.html" class="previous page-numbers spec" title="GenServer">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/mix-otp/dynamic-supervisor.html" class="previous page-numbers spec" title="Dynamic supervisors">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/mix-otp/supervisor-and-application.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/mix-otp/dynamic-supervisor.html" page=":5:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><span title="Dynamic supervisors">Dynamic supervisors</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Mix and OTP</small>
      <h1>Dynamic supervisors</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#the-bucket-supervisor">The bucket supervisor</a></li><li><a href="#supervision-trees">Supervision trees</a></li><li><a href="#shared-state-in-tests">Shared state in tests</a></li><li><a href="#observer">Observer</a></li></ol></div>

    <blockquote>
  <p>This chapter is part of the <i>Mix and OTP guide</i> and it depends on previous chapters in this guide.
For more information, <a href="/getting-started/mix-otp/introduction-to-mix.html">read the introduction guide</a> or check out the chapter index in the sidebar.</p>
</blockquote>

<p>We have now successfully defined our supervisor which is automatically started (and stopped) as part of our application lifecycle.</p>

<p>Remember, however, that our <code class="language-plaintext highlighter-rouge">KV.Registry</code> is both linking (via <code class="language-plaintext highlighter-rouge">start_link</code>) and monitoring (via <code class="language-plaintext highlighter-rouge">monitor</code>) bucket processes in the <code class="language-plaintext highlighter-rouge">handle_cast/2</code> callback:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">bucket</span><span class="p">}</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">start_link</span><span class="p">([])</span>
<span class="n">ref</span> <span class="o">=</span> <span class="no">Process</span><span class="o">.</span><span class="n">monitor</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
</code></pre></div></div>

<p>Links are bidirectional, which implies that a crash in a bucket will crash the registry. Although we now have the supervisor, which guarantees the registry will be back up and running, crashing the registry still means we lose all data associating bucket names to their respective processes.</p>

<p>In other words, we want the registry to keep on running even if a bucket crashes. Let’s write a new registry test:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test</span> <span class="s2">"removes bucket on crash"</span><span class="p">,</span> <span class="p">%{</span><span class="ss">registry:</span> <span class="n">registry</span><span class="p">}</span> <span class="k">do</span>
  <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>
  <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">bucket</span><span class="p">}</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>

  <span class="c1"># Stop the bucket with non-normal reason</span>
  <span class="no">Agent</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="ss">:shutdown</span><span class="p">)</span>
  <span class="n">assert</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span> <span class="o">==</span> <span class="ss">:error</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The test is similar to “removes bucket on exit” except that we are being a bit more harsh by sending <code class="language-plaintext highlighter-rouge">:shutdown</code> as the exit reason instead of <code class="language-plaintext highlighter-rouge">:normal</code>. If a process terminates with a reason different than <code class="language-plaintext highlighter-rouge">:normal</code>, all linked processes receive an EXIT signal, causing the linked process to also terminate unless it is trapping exits.</p>

<p>Since the bucket terminated, the registry also stopped, and our test fails when trying to <code class="language-plaintext highlighter-rouge">GenServer.call/3</code> it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  1) test removes bucket on crash (KV.RegistryTest)
     test/kv/registry_test.exs:26
     ** (exit) exited in: GenServer.call(#PID&lt;0.148.0&gt;, {:lookup, "shopping"}, 5000)
         ** (EXIT) no process: the process is not alive or there's no process currently associated with the given name, possibly because its application isn't started
     code: assert KV.Registry.lookup(registry, "shopping") == :error
     stacktrace:
       (elixir) lib/gen_server.ex:770: GenServer.call/3
       test/kv/registry_test.exs:33: (test)
</code></pre></div></div>

<p>We are going to solve this issue by defining a new supervisor that will spawn and supervise all buckets. Opposite to the previous Supervisor we defined, the children are not known upfront, but they are rather started dynamically. For those situations, we use a supervisor optimized to such use cases called <code class="language-plaintext highlighter-rouge">DynamicSupervisor</code>. The <code class="language-plaintext highlighter-rouge">DynamicSupervisor</code> does not expect a list of children during initialization; instead each child is started manually via <code class="language-plaintext highlighter-rouge">DynamicSupervisor.start_child/2</code>.</p>

<h2 id="the-bucket-supervisor" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The bucket supervisor</span><a href="#the-bucket-supervisor" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Since a <code class="language-plaintext highlighter-rouge">DynamicSupervisor</code> does not define any children during initialization, the <code class="language-plaintext highlighter-rouge">DynamicSupervisor</code> also allows us to skip the work of defining a whole separate module with the usual <code class="language-plaintext highlighter-rouge">start_link</code> function and the <code class="language-plaintext highlighter-rouge">init</code> callback. Instead, we can define a <code class="language-plaintext highlighter-rouge">DynamicSupervisor</code> directly in the supervision tree, by giving it a name and a strategy.</p>

<p>Open up <code class="language-plaintext highlighter-rouge">lib/kv/supervisor.ex</code> and add the dynamic supervisor as a child as follows:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">def</span> <span class="n">init</span><span class="p">(</span><span class="ss">:ok</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="ss">name:</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">},</span>
      <span class="p">{</span><span class="no">DynamicSupervisor</span><span class="p">,</span> <span class="ss">name:</span> <span class="no">KV</span><span class="o">.</span><span class="no">BucketSupervisor</span><span class="p">,</span> <span class="ss">strategy:</span> <span class="ss">:one_for_one</span><span class="p">}</span>
    <span class="p">]</span>

    <span class="no">Supervisor</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="ss">strategy:</span> <span class="ss">:one_for_one</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>Remember that the name of a process can be any atom. So far, we have named processes with the same name as the modules that define their implementation. For example, the process defined by <code class="language-plaintext highlighter-rouge">KV.Registry</code> was given a process name of <code class="language-plaintext highlighter-rouge">KV.Registry</code>. This is simply a convention: If later there is an error in your system that says, “process named KV.Registry crashed with reason”, we know exactly where to investigate.</p>

<p>In this case, there is no module, so we picked the name <code class="language-plaintext highlighter-rouge">KV.BucketSupervisor</code>. It could have been any other name. We also chose the <code class="language-plaintext highlighter-rouge">:one_for_one</code> strategy, which is currently the only available strategy for dynamic supervisors.</p>

<p>Run <code class="language-plaintext highlighter-rouge">iex -S mix</code> so we can give our dynamic supervisor a try:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">bucket</span><span class="p">}</span> <span class="o">=</span> <span class="no">DynamicSupervisor</span><span class="o">.</span><span class="n">start_child</span><span class="p">(</span><span class="no">KV</span><span class="o">.</span><span class="no">BucketSupervisor</span><span class="p">,</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="c1">#PID&lt;0.72.0&gt;}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s2">"eggs"</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="ss">:ok</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s2">"eggs"</span><span class="p">)</span>
<span class="mi">3</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">DynamicSupervisor.start_child/2</code> expects the name of the supervisor and the child specification of the child to be started.</p>

<p>The last step is to change the registry to use the dynamic supervisor:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">def</span> <span class="n">handle_cast</span><span class="p">({</span><span class="ss">:create</span><span class="p">,</span> <span class="n">name</span><span class="p">},</span> <span class="p">{</span><span class="n">names</span><span class="p">,</span> <span class="n">refs</span><span class="p">})</span> <span class="k">do</span>
    <span class="k">if</span> <span class="no">Map</span><span class="o">.</span><span class="n">has_key?</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">do</span>
      <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="p">{</span><span class="n">names</span><span class="p">,</span> <span class="n">refs</span><span class="p">}}</span>
    <span class="k">else</span>
      <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">pid</span><span class="p">}</span> <span class="o">=</span> <span class="no">DynamicSupervisor</span><span class="o">.</span><span class="n">start_child</span><span class="p">(</span><span class="no">KV</span><span class="o">.</span><span class="no">BucketSupervisor</span><span class="p">,</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="p">)</span>
      <span class="n">ref</span> <span class="o">=</span> <span class="no">Process</span><span class="o">.</span><span class="n">monitor</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
      <span class="n">refs</span> <span class="o">=</span> <span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">refs</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
      <span class="n">names</span> <span class="o">=</span> <span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">pid</span><span class="p">)</span>
      <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="p">{</span><span class="n">names</span><span class="p">,</span> <span class="n">refs</span><span class="p">}}</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>That’s enough for our tests to pass but there is a resource leakage in our application. When a bucket terminates, the supervisor will start a new bucket in its place. After all, that’s the role of the supervisor!</p>

<p>However, when the supervisor restarts the new bucket, the registry does not know about it. So we will have an empty bucket in the supervisor that nobody can access! To solve this, we want to say that buckets are actually temporary. If they crash, regardless of the reason, they should not be restarted.</p>

<p>We can do this by passing the <code class="language-plaintext highlighter-rouge">restart: :temporary</code> option to <code class="language-plaintext highlighter-rouge">use Agent</code> in <code class="language-plaintext highlighter-rouge">KV.Bucket</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Agent</span><span class="p">,</span> <span class="ss">restart:</span> <span class="ss">:temporary</span>
</code></pre></div></div>

<p>Let’s also add a test to <code class="language-plaintext highlighter-rouge">test/kv/bucket_test.exs</code> that guarantees the bucket is temporary:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">test</span> <span class="s2">"are temporary workers"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="no">Supervisor</span><span class="o">.</span><span class="n">child_spec</span><span class="p">(</span><span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">restart</span> <span class="o">==</span> <span class="ss">:temporary</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>Our test uses the <code class="language-plaintext highlighter-rouge">Supervisor.child_spec/2</code> function to retrieve the child specification out of a module and then assert its restart value is <code class="language-plaintext highlighter-rouge">:temporary</code>. At this point, you may be wondering why use a supervisor if it never restarts its children. It happens that supervisors provide more than restarts, they are also responsible for guaranteeing proper startup and shutdown, especially in case of crashes in a supervision tree.</p>

<h2 id="supervision-trees" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Supervision trees</span><a href="#supervision-trees" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>When we added <code class="language-plaintext highlighter-rouge">KV.BucketSupervisor</code> as a child of <code class="language-plaintext highlighter-rouge">KV.Supervisor</code>, we began to have supervisors that supervise other supervisors, forming so-called “supervision trees”.</p>

<p>Every time you add a new child to a supervisor, it is important to evaluate if the supervisor strategy is correct as well as the order of child processes. In this case, we are using <code class="language-plaintext highlighter-rouge">:one_for_one</code> and the <code class="language-plaintext highlighter-rouge">KV.Registry</code> is started before <code class="language-plaintext highlighter-rouge">KV.BucketSupervisor</code>.</p>

<p>One flaw that shows up right away is the ordering issue. Since <code class="language-plaintext highlighter-rouge">KV.Registry</code> invokes <code class="language-plaintext highlighter-rouge">KV.BucketSupervisor</code>, then the <code class="language-plaintext highlighter-rouge">KV.BucketSupervisor</code> must be started before <code class="language-plaintext highlighter-rouge">KV.Registry</code>. Otherwise, it may happen that the registry attempts to reach the bucket supervisor before it has started.</p>

<p>The second flaw is related to the supervision strategy. If <code class="language-plaintext highlighter-rouge">KV.Registry</code> dies, all information linking <code class="language-plaintext highlighter-rouge">KV.Bucket</code> names to bucket processes is lost. Therefore the <code class="language-plaintext highlighter-rouge">KV.BucketSupervisor</code> and all children must terminate too - otherwise we will have orphan processes.</p>

<p>In light of this observation, we should consider moving to another supervision strategy. The two other candidates are <code class="language-plaintext highlighter-rouge">:one_for_all</code> and <code class="language-plaintext highlighter-rouge">:rest_for_one</code>. A supervisor using the <code class="language-plaintext highlighter-rouge">:rest_for_one</code> strategy will kill and restart child processes which were started <em>after</em> the crashed child. In this case, we would want <code class="language-plaintext highlighter-rouge">KV.BucketSupervisor</code> to terminate if <code class="language-plaintext highlighter-rouge">KV.Registry</code> terminates. This would require the bucket supervisor to be placed after the registry which violates the ordering constraints we have established two paragraphs above.</p>

<p>So our last option is to go all in and pick the <code class="language-plaintext highlighter-rouge">:one_for_all</code> strategy: the supervisor will kill and restart all of its children processes whenever any one of them dies. This is a completely reasonable approach for our application, since the registry can’t work without the bucket supervisor, and the bucket supervisor should terminate without the registry. Let’s reimplement <code class="language-plaintext highlighter-rouge">init/1</code> in <code class="language-plaintext highlighter-rouge">KV.Supervisor</code> to encode those properties:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">def</span> <span class="n">init</span><span class="p">(</span><span class="ss">:ok</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span><span class="no">DynamicSupervisor</span><span class="p">,</span> <span class="ss">name:</span> <span class="no">KV</span><span class="o">.</span><span class="no">BucketSupervisor</span><span class="p">,</span> <span class="ss">strategy:</span> <span class="ss">:one_for_one</span><span class="p">},</span>
      <span class="p">{</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="ss">name:</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">}</span>
    <span class="p">]</span>

    <span class="no">Supervisor</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="ss">strategy:</span> <span class="ss">:one_for_all</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>There are two topics left before we move on to the next chapter.</p>

<h2 id="shared-state-in-tests" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Shared state in tests</span><a href="#shared-state-in-tests" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>So far we have been starting one registry per test to ensure they are isolated:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">setup</span> <span class="k">do</span>
  <span class="n">registry</span> <span class="o">=</span> <span class="n">start_supervised!</span><span class="p">(</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">)</span>
  <span class="p">%{</span><span class="ss">registry:</span> <span class="n">registry</span><span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Since we have changed our registry to use <code class="language-plaintext highlighter-rouge">KV.BucketSupervisor</code>, our tests are now relying on this shared supervisor even though each test has its own registry. The question is: should we?</p>

<p>It depends. It is ok to rely on shared state as long as we depend only on a non-shared partition of this state. Although multiple registries may start buckets on the shared bucket supervisor, those buckets and registries are isolated from each other. We would only run into concurrency issues if we used a function like <code class="language-plaintext highlighter-rouge">DynamicSupervisor.count_children(KV.BucketSupervisor)</code> which would count all buckets from all registries, potentially giving different results when tests run concurrently.</p>

<p>Since we have relied only on a non-shared partition of the bucket supervisor so far, we don’t need to worry about concurrency issues in our test suite. In case it ever becomes a problem, we can start a supervisor per test and pass it as an argument to the registry <code class="language-plaintext highlighter-rouge">start_link</code> function.</p>

<h2 id="observer" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Observer</span><a href="#observer" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Now that we have defined our supervision tree, it is a great opportunity to introduce the Observer tool that ships with Erlang. Start your application with <code class="language-plaintext highlighter-rouge">iex -S mix</code> and key this in:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:observer</span><span class="o">.</span><span class="n">start</span>
</code></pre></div></div>

<p>A GUI should pop-up containing all sorts of information about our system, from general statistics to load charts as well as a list of all running processes and applications.</p>

<blockquote>
  <p>Note: If <code class="language-plaintext highlighter-rouge">observer</code> does not start, here is what may have happened: some package managers default to installing a minimized Erlang without WX bindings for GUI support. In some package managers, you may be able to replace the headless Erlang with a more complete package (look for packages named <code class="language-plaintext highlighter-rouge">erlang</code> vs <code class="language-plaintext highlighter-rouge">erlang-nox</code> on Debian/Ubuntu/Arch). In others managers, you may need to install a separate <code class="language-plaintext highlighter-rouge">erlang-wx</code> (or similarly named) package. Alternatively, you can skip this section and continue the guide.</p>
</blockquote>

<p>In the Applications tab, you will see all applications currently running in your system alongside their supervision tree. You can select the <code class="language-plaintext highlighter-rouge">kv</code> application to explore it further:</p>

<p><img src="/images/contents/kv-observer.png" width="640" alt="Observer GUI screenshot"></p>

<p>Not only that, as you create new buckets on the terminal, you should see new processes spawned in the supervision tree shown in Observer:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>
<span class="ss">:ok</span>
</code></pre></div></div>

<p>We will leave it up to you to further explore what Observer provides. Note you can double click any process in the supervision tree to retrieve more information about it, as well as right-click a process to send “a kill signal”, a perfect way to emulate failures and see if your supervisor reacts as expected.</p>

<p>At the end of the day, tools like Observer are one of the reasons you want to always start processes inside supervision trees, even if they are temporary, to ensure they are always reachable and introspectable.</p>

<p>Now that our buckets are properly linked and supervised, let’s see how we can speed things up.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/mix-otp/supervisor-and-application.html" class="previous page-numbers spec" title="Supervisor and Application">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/mix-otp/ets.html" class="previous page-numbers spec" title="ETS">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/mix-otp/dynamic-supervisor.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/mix-otp/ets.html" page=":6:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><span title="ETS">ETS</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Mix and OTP</small>
      <h1>ETS</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#ets-as-a-cache">ETS as a cache</a></li><li><a href="#race-conditions">Race conditions?</a></li></ol></div>

    <blockquote>
  <p>This chapter is part of the <i>Mix and OTP guide</i> and it depends on previous chapters in this guide.
For more information, <a href="/getting-started/mix-otp/introduction-to-mix.html">read the introduction guide</a> or check out the chapter index in the sidebar.</p>
</blockquote>

<p>Every time we need to look up a bucket, we need to send a message to the registry. In case our registry is being accessed concurrently by multiple processes, the registry may become a bottleneck!</p>

<p>In this chapter, we will learn about ETS (Erlang Term Storage) and how to use it as a cache mechanism.</p>

<blockquote>
  <p>Warning! Don’t use ETS as a cache prematurely! Log and analyze your application performance and identify which parts are bottlenecks, so you know <em>whether</em> you should cache, and <em>what</em> you should cache. This chapter is merely an example of how ETS can be used, once you’ve determined the need.</p>
</blockquote>

<h2 id="ets-as-a-cache" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">ETS as a cache</span><a href="#ets-as-a-cache" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>ETS allows us to store any Elixir term in an in-memory table. Working with ETS tables is done via <a href="http://www.erlang.org/doc/man/ets.html">Erlang’s <code class="language-plaintext highlighter-rouge">:ets</code> module</a>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">table</span> <span class="o">=</span> <span class="ss">:ets</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:buckets_registry</span><span class="p">,</span> <span class="p">[</span><span class="ss">:set</span><span class="p">,</span> <span class="ss">:protected</span><span class="p">])</span>
<span class="c1">#Reference&lt;0.1885502827.460455937.234656&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:ets</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="p">{</span><span class="s2">"foo"</span><span class="p">,</span> <span class="n">self</span><span class="p">()})</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:ets</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="s2">"foo"</span><span class="p">)</span>
<span class="p">[{</span><span class="s2">"foo"</span><span class="p">,</span> <span class="c1">#PID&lt;0.41.0&gt;}]</span>
</code></pre></div></div>

<p>When creating an ETS table, two arguments are required: the table name and a set of options. From the available options, we passed the table type and its access rules. We have chosen the <code class="language-plaintext highlighter-rouge">:set</code> type, which means that keys cannot be duplicated. We’ve also set the table’s access to <code class="language-plaintext highlighter-rouge">:protected</code>, meaning only the process that created the table can write to it, but all processes can read from it. The possible access controls:</p>

<p><code class="language-plaintext highlighter-rouge">:public</code> — Read/Write available to all processes.</p>

<p><code class="language-plaintext highlighter-rouge">:protected</code> — Read available to all processes. Only writable by owner process. This is the default.</p>

<p><code class="language-plaintext highlighter-rouge">:private</code> — Read/Write limited to owner process.</p>

<p>Be aware that if your Read/Write call violates the access control, the operation will raise <code class="language-plaintext highlighter-rouge">ArgumentError</code>. Finally, since <code class="language-plaintext highlighter-rouge">:set</code> and <code class="language-plaintext highlighter-rouge">:protected</code> are the default values, we will skip them from now on.</p>

<p>ETS tables can also be named, allowing us to access them by a given name:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:ets</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:buckets_registry</span><span class="p">,</span> <span class="p">[</span><span class="ss">:named_table</span><span class="p">])</span>
<span class="ss">:buckets_registry</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:ets</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="ss">:buckets_registry</span><span class="p">,</span> <span class="p">{</span><span class="s2">"foo"</span><span class="p">,</span> <span class="n">self</span><span class="p">()})</span>
<span class="no">true</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:ets</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="ss">:buckets_registry</span><span class="p">,</span> <span class="s2">"foo"</span><span class="p">)</span>
<span class="p">[{</span><span class="s2">"foo"</span><span class="p">,</span> <span class="c1">#PID&lt;0.41.0&gt;}]</span>
</code></pre></div></div>

<p>Let’s change the <code class="language-plaintext highlighter-rouge">KV.Registry</code> to use ETS tables. The first change is to modify our registry to require a name argument, we will use it to name the ETS table and the registry process itself. ETS names and process names are stored in different locations, so there is no chance of conflicts.</p>

<p>Open up <code class="language-plaintext highlighter-rouge">lib/kv/registry.ex</code>, and let’s change its implementation. We’ve added comments to the source code to highlight the changes we’ve made:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">GenServer</span>

  <span class="c1">## Client API</span>

  <span class="nv">@doc</span> <span class="sd">"""
  Starts the registry with the given options.

  `:name` is always required.
  """</span>
  <span class="k">def</span> <span class="n">start_link</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># 1. Pass the name to GenServer's init</span>
    <span class="n">server</span> <span class="o">=</span> <span class="no">Keyword</span><span class="o">.</span><span class="n">fetch!</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="ss">:name</span><span class="p">)</span>
    <span class="no">GenServer</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="bp">__MODULE__</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="nv">@doc</span> <span class="sd">"""
  Looks up the bucket pid for `name` stored in `server`.

  Returns `{:ok, pid}` if the bucket exists, `:error` otherwise.
  """</span>
  <span class="k">def</span> <span class="n">lookup</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># 2. Lookup is now done directly in ETS, without accessing the server</span>
    <span class="k">case</span> <span class="ss">:ets</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">do</span>
      <span class="p">[{</span><span class="o">^</span><span class="n">name</span><span class="p">,</span> <span class="n">pid</span><span class="p">}]</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">pid</span><span class="p">}</span>
      <span class="p">[]</span> <span class="o">-&gt;</span> <span class="ss">:error</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="nv">@doc</span> <span class="sd">"""
  Ensures there is a bucket associated with the given `name` in `server`.
  """</span>
  <span class="k">def</span> <span class="n">create</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">GenServer</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="p">{</span><span class="ss">:create</span><span class="p">,</span> <span class="n">name</span><span class="p">})</span>
  <span class="k">end</span>

  <span class="c1">## Server callbacks</span>

  <span class="nv">@impl</span> <span class="no">true</span>
  <span class="k">def</span> <span class="n">init</span><span class="p">(</span><span class="n">table</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># 3. We have replaced the names map by the ETS table</span>
    <span class="n">names</span> <span class="o">=</span> <span class="ss">:ets</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="p">[</span><span class="ss">:named_table</span><span class="p">,</span> <span class="ss">read_concurrency:</span> <span class="no">true</span><span class="p">])</span>
    <span class="n">refs</span>  <span class="o">=</span> <span class="p">%{}</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="p">{</span><span class="n">names</span><span class="p">,</span> <span class="n">refs</span><span class="p">}}</span>
  <span class="k">end</span>

  <span class="c1"># 4. The previous handle_call callback for lookup was removed</span>

  <span class="nv">@impl</span> <span class="no">true</span>
  <span class="k">def</span> <span class="n">handle_cast</span><span class="p">({</span><span class="ss">:create</span><span class="p">,</span> <span class="n">name</span><span class="p">},</span> <span class="p">{</span><span class="n">names</span><span class="p">,</span> <span class="n">refs</span><span class="p">})</span> <span class="k">do</span>
    <span class="c1"># 5. Read and write to the ETS table instead of the map</span>
    <span class="k">case</span> <span class="n">lookup</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">do</span>
      <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">_pid</span><span class="p">}</span> <span class="o">-&gt;</span>
        <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="p">{</span><span class="n">names</span><span class="p">,</span> <span class="n">refs</span><span class="p">}}</span>
      <span class="ss">:error</span> <span class="o">-&gt;</span>
        <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">pid</span><span class="p">}</span> <span class="o">=</span> <span class="no">DynamicSupervisor</span><span class="o">.</span><span class="n">start_child</span><span class="p">(</span><span class="no">KV</span><span class="o">.</span><span class="no">BucketSupervisor</span><span class="p">,</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="no">Process</span><span class="o">.</span><span class="n">monitor</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        <span class="n">refs</span> <span class="o">=</span> <span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">refs</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="ss">:ets</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="p">{</span><span class="n">name</span><span class="p">,</span> <span class="n">pid</span><span class="p">})</span>
        <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="p">{</span><span class="n">names</span><span class="p">,</span> <span class="n">refs</span><span class="p">}}</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="nv">@impl</span> <span class="no">true</span>
  <span class="k">def</span> <span class="n">handle_info</span><span class="p">({</span><span class="ss">:DOWN</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="ss">:process</span><span class="p">,</span> <span class="n">_pid</span><span class="p">,</span> <span class="n">_reason</span><span class="p">},</span> <span class="p">{</span><span class="n">names</span><span class="p">,</span> <span class="n">refs</span><span class="p">})</span> <span class="k">do</span>
    <span class="c1"># 6. Delete from the ETS table instead of the map</span>
    <span class="p">{</span><span class="n">name</span><span class="p">,</span> <span class="n">refs</span><span class="p">}</span> <span class="o">=</span> <span class="no">Map</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">refs</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
    <span class="ss">:ets</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="p">{</span><span class="n">names</span><span class="p">,</span> <span class="n">refs</span><span class="p">}}</span>
  <span class="k">end</span>

  <span class="nv">@impl</span> <span class="no">true</span>
  <span class="k">def</span> <span class="n">handle_info</span><span class="p">(</span><span class="n">_msg</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">state</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Notice that before our changes <code class="language-plaintext highlighter-rouge">KV.Registry.lookup/2</code> sent requests to the server, but now it reads directly from the ETS table, which is shared across all processes. That’s the main idea behind the cache mechanism we are implementing.</p>

<p>In order for the cache mechanism to work, the created ETS table needs to have access <code class="language-plaintext highlighter-rouge">:protected</code> (the default), so all clients can read from it, while only the <code class="language-plaintext highlighter-rouge">KV.Registry</code> process writes to it. We have also set <code class="language-plaintext highlighter-rouge">read_concurrency: true</code> when starting the table, optimizing the table for the common scenario of concurrent read operations.</p>

<p>The changes we have performed above have broken our tests because the registry requires the <code class="language-plaintext highlighter-rouge">:name</code> option when starting up. Furthermore, some registry operations such as <code class="language-plaintext highlighter-rouge">lookup/2</code> require the name to be given as an argument, instead of a PID, so we can do the ETS table lookup. Let’s change the setup function in <code class="language-plaintext highlighter-rouge">test/kv/registry_test.exs</code> to fix both issues:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">setup</span> <span class="n">context</span> <span class="k">do</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">start_supervised!</span><span class="p">({</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="ss">name:</span> <span class="n">context</span><span class="o">.</span><span class="n">test</span><span class="p">})</span>
    <span class="p">%{</span><span class="ss">registry:</span> <span class="n">context</span><span class="o">.</span><span class="n">test</span><span class="p">}</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>Since each test has a unique name, we use the test name to name our registries. This way, we no longer need to pass the registry PID around, instead we identify it by the test name. Also note we assigned the result of <code class="language-plaintext highlighter-rouge">start_supervised!</code> to underscore (<code class="language-plaintext highlighter-rouge">_</code>). This idiom is often used to signal that we are not interested in the result of <code class="language-plaintext highlighter-rouge">start_supervised!</code>.</p>

<p>Once we change <code class="language-plaintext highlighter-rouge">setup</code>, some tests will continue to fail. You may even notice tests pass and fail inconsistently between runs. For example, the “spawns buckets” test:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test</span> <span class="s2">"spawns buckets"</span><span class="p">,</span> <span class="p">%{</span><span class="ss">registry:</span> <span class="n">registry</span><span class="p">}</span> <span class="k">do</span>
  <span class="n">assert</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span> <span class="o">==</span> <span class="ss">:error</span>

  <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>
  <span class="n">assert</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">bucket</span><span class="p">}</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>

  <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s2">"milk"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="n">assert</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s2">"milk"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="k">end</span>
</code></pre></div></div>

<p>may be failing on this line:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">bucket</span><span class="p">}</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>
</code></pre></div></div>

<p>How can this line fail if we just created the bucket in the previous line?</p>

<p>The reason those failures are happening is because, for didactic purposes, we have made two mistakes:</p>

<ol>
  <li>We are prematurely optimizing (by adding this cache layer)</li>
  <li>We are using <code class="language-plaintext highlighter-rouge">cast/2</code> (while we should be using <code class="language-plaintext highlighter-rouge">call/2</code>)</li>
</ol>

<h2 id="race-conditions" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Race conditions?</span><a href="#race-conditions" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Developing in Elixir does not make your code free of race conditions. However, Elixir’s abstractions where nothing is shared by default make it easier to spot a race condition’s root cause.</p>

<p>What is happening in our tests is that there is a delay in between an operation and the time we can observe this change in the ETS table. Here is what we were expecting to happen:</p>

<ol>
  <li>We invoke <code class="language-plaintext highlighter-rouge">KV.Registry.create(registry, "shopping")</code></li>
  <li>The registry creates the bucket and updates the cache table</li>
  <li>We access the information from the table with <code class="language-plaintext highlighter-rouge">KV.Registry.lookup(registry, "shopping")</code></li>
  <li>The command above returns <code class="language-plaintext highlighter-rouge">{:ok, bucket}</code></li>
</ol>

<p>However, since <code class="language-plaintext highlighter-rouge">KV.Registry.create/2</code> is a cast operation, the command will return before we actually write to the table! In other words, this is happening:</p>

<ol>
  <li>We invoke <code class="language-plaintext highlighter-rouge">KV.Registry.create(registry, "shopping")</code></li>
  <li>We access the information from the table with <code class="language-plaintext highlighter-rouge">KV.Registry.lookup(registry, "shopping")</code></li>
  <li>The command above returns <code class="language-plaintext highlighter-rouge">:error</code></li>
  <li>The registry creates the bucket and updates the cache table</li>
</ol>

<p>To fix the failure we need to make <code class="language-plaintext highlighter-rouge">KV.Registry.create/2</code> synchronous by using <code class="language-plaintext highlighter-rouge">call/2</code> rather than <code class="language-plaintext highlighter-rouge">cast/2</code>. This will guarantee that the client will only continue after changes have been made to the table. Let’s back to <code class="language-plaintext highlighter-rouge">lib/kv/registry.ex</code> and change the function and its callback as follows:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">create</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">do</span>
  <span class="no">GenServer</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="p">{</span><span class="ss">:create</span><span class="p">,</span> <span class="n">name</span><span class="p">})</span>
<span class="k">end</span>
</code></pre></div></div>
<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">@impl</span> <span class="no">true</span>
<span class="k">def</span> <span class="n">handle_call</span><span class="p">({</span><span class="ss">:create</span><span class="p">,</span> <span class="n">name</span><span class="p">},</span> <span class="n">_from</span><span class="p">,</span> <span class="p">{</span><span class="n">names</span><span class="p">,</span> <span class="n">refs</span><span class="p">})</span> <span class="k">do</span>
  <span class="k">case</span> <span class="n">lookup</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">pid</span><span class="p">}</span> <span class="o">-&gt;</span>
      <span class="p">{</span><span class="ss">:reply</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="p">{</span><span class="n">names</span><span class="p">,</span> <span class="n">refs</span><span class="p">}}</span>
    <span class="ss">:error</span> <span class="o">-&gt;</span>
      <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">pid</span><span class="p">}</span> <span class="o">=</span> <span class="no">DynamicSupervisor</span><span class="o">.</span><span class="n">start_child</span><span class="p">(</span><span class="no">KV</span><span class="o">.</span><span class="no">BucketSupervisor</span><span class="p">,</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="p">)</span>
      <span class="n">ref</span> <span class="o">=</span> <span class="no">Process</span><span class="o">.</span><span class="n">monitor</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
      <span class="n">refs</span> <span class="o">=</span> <span class="no">Map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">refs</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
      <span class="ss">:ets</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="p">{</span><span class="n">name</span><span class="p">,</span> <span class="n">pid</span><span class="p">})</span>
      <span class="p">{</span><span class="ss">:reply</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="p">{</span><span class="n">names</span><span class="p">,</span> <span class="n">refs</span><span class="p">}}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We changed the callback from <code class="language-plaintext highlighter-rouge">handle_cast/2</code> to <code class="language-plaintext highlighter-rouge">handle_call/3</code> and changed it to reply with the pid of the created bucket. Generally speaking, Elixir developers prefer to use <code class="language-plaintext highlighter-rouge">call/2</code> instead of <code class="language-plaintext highlighter-rouge">cast/2</code> as it also provides back-pressure - you block until you get a reply. Using <code class="language-plaintext highlighter-rouge">cast/2</code> when not necessary can also be considered a premature optimization.</p>

<p>Let’s run the tests once again. This time though, we will pass the <code class="language-plaintext highlighter-rouge">--trace</code> option:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>mix <span class="nb">test</span> <span class="nt">--trace</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">--trace</code> option is useful when your tests are deadlocking or there are race conditions, as it runs all tests synchronously (<code class="language-plaintext highlighter-rouge">async: true</code> has no effect) and shows detailed information about each test. If you run the tests multiple times you may see this intermittent failure:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  1) test removes buckets on exit (KV.RegistryTest)
     test/kv/registry_test.exs:19
     Assertion with == failed
     code:  assert KV.Registry.lookup(registry, "shopping") == :error
     left:  {:ok, #PID&lt;0.109.0&gt;}
     right: :error
     stacktrace:
       test/kv/registry_test.exs:23
</code></pre></div></div>

<p>According to the failure message, we are expecting that the bucket no longer exists on the table, but it still does! This problem is the opposite of the one we have just solved: while previously there was a delay between the command to create a bucket and updating the table, now there is a delay between the bucket process dying and its entry being removed from the table. Since this is a race condition, you may not be able to reproduce it on your machine, but it is there.</p>

<p>Last time we fixed the race condition by replacing the asynchronous operation, a <code class="language-plaintext highlighter-rouge">cast</code>, by a <code class="language-plaintext highlighter-rouge">call</code>, which is synchronous. Unfortunately, the <code class="language-plaintext highlighter-rouge">handle_info/2</code> callback we are using to receive the <code class="language-plaintext highlighter-rouge">:DOWN</code> message and delete the entry from the ETS table does not have a synchronous equivalent. This time, we need to find a way to guarantee the registry has processed the <code class="language-plaintext highlighter-rouge">:DOWN</code> notification sent when the bucket process terminated.</p>

<p>An easy way to do so is by sending a synchronous request to the registry before we do the bucket lookup. The <code class="language-plaintext highlighter-rouge">Agent.stop/2</code> operation is synchronous and only returns after the bucket process terminates and all <code class="language-plaintext highlighter-rouge">:DOWN</code> messages are delivered. Therefore, once <code class="language-plaintext highlighter-rouge">Agent.stop/2</code> returns, the registry has already received the <code class="language-plaintext highlighter-rouge">:DOWN</code> message but it may not have processed it yet. In order to guarantee the processing of the <code class="language-plaintext highlighter-rouge">:DOWN</code> message, we can do a synchronous request. Since messages are processed in order, once the registry replies to the synchronous request, then the <code class="language-plaintext highlighter-rouge">:DOWN</code> message will definitely have been processed.</p>

<p>Let’s do so by creating a “bogus” bucket, which is a synchronous request, after <code class="language-plaintext highlighter-rouge">Agent.stop/2</code> in both “remove” tests at <code class="language-plaintext highlighter-rouge">test/kv/registry_test.exs</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">test</span> <span class="s2">"removes buckets on exit"</span><span class="p">,</span> <span class="p">%{</span><span class="ss">registry:</span> <span class="n">registry</span><span class="p">}</span> <span class="k">do</span>
    <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">bucket</span><span class="p">}</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>
    <span class="no">Agent</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>

    <span class="c1"># Do a call to ensure the registry processed the DOWN message</span>
    <span class="n">_</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"bogus"</span><span class="p">)</span>
    <span class="n">assert</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span> <span class="o">==</span> <span class="ss">:error</span>
  <span class="k">end</span>

  <span class="n">test</span> <span class="s2">"removes bucket on crash"</span><span class="p">,</span> <span class="p">%{</span><span class="ss">registry:</span> <span class="n">registry</span><span class="p">}</span> <span class="k">do</span>
    <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">bucket</span><span class="p">}</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>

    <span class="c1"># Stop the bucket with non-normal reason</span>
    <span class="no">Agent</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="ss">:shutdown</span><span class="p">)</span>

    <span class="c1"># Do a call to ensure the registry processed the DOWN message</span>
    <span class="n">_</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"bogus"</span><span class="p">)</span>
    <span class="n">assert</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span> <span class="o">==</span> <span class="ss">:error</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>Our tests should now (always) pass!</p>

<p>Note that the purpose of the test is to check whether the registry processes the bucket’s shutdown message correctly. The fact that the <code class="language-plaintext highlighter-rouge">KV.Registry.lookup/2</code> sends us a valid bucket does not mean that the bucket is still alive by the time you call it. For example, it might have crashed for some reason. The following test depicts this situation:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">test</span> <span class="s2">"bucket can crash at any time"</span><span class="p">,</span> <span class="p">%{</span><span class="ss">registry:</span> <span class="n">registry</span><span class="p">}</span> <span class="k">do</span>
    <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">bucket</span><span class="p">}</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="s2">"shopping"</span><span class="p">)</span>

    <span class="c1"># Simulate a bucket crash by explicitly and synchronously shutting it down</span>
    <span class="no">Agent</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="ss">:shutdown</span><span class="p">)</span>

    <span class="c1"># Now trying to call the dead process causes a :noproc exit</span>
    <span class="n">catch_exit</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="s2">"milk"</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>This concludes our optimization chapter. We have used ETS as a cache mechanism where reads can happen from any processes but writes are still serialized through a single process. More importantly, we have also learned that once data can be read asynchronously, we need to be aware of the race conditions it might introduce.</p>

<p>In practice, if you find yourself in a position where you need a process registry for dynamic processes, you should use <a href="https://hexdocs.pm/elixir/Registry.html">the <code class="language-plaintext highlighter-rouge">Registry</code> module</a> provided as part of Elixir. It provides functionality similar to the one we have built using a GenServer + <code class="language-plaintext highlighter-rouge">:ets</code> while also being able to perform both writes and reads concurrently. <a href="https://elixir-lang.org/blog/2017/01/05/elixir-v1-4-0-released/">It has been benchmarked to scale across all cores even on machines with 40 cores</a>.</p>

<p>Next, let’s discuss external and internal dependencies and how Mix helps us manage large codebases.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/mix-otp/dynamic-supervisor.html" class="previous page-numbers spec" title="Dynamic supervisors">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" class="previous page-numbers spec" title="Dependencies and umbrella projects">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/mix-otp/ets.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" page=":7:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><span title="Dependencies and umbrella projects">Dependencies and umbrella projects</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Mix and OTP</small>
      <h1>Dependencies and umbrella projects</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#external-dependencies">External dependencies</a></li><li><a href="#internal-dependencies">Internal dependencies</a></li><li><a href="#umbrella-projects">Umbrella projects</a></li><li><a href="#dependencies-within-an-umbrella-project">Dependencies within an umbrella project</a></li><li><a href="#dont-drink-the-kool-aid">Don’t drink the kool aid</a></li><li><a href="#summing-up">Summing up</a></li></ol></div>

    <blockquote>
  <p>This chapter is part of the <i>Mix and OTP guide</i> and it depends on previous chapters in this guide.
For more information, <a href="/getting-started/mix-otp/introduction-to-mix.html">read the introduction guide</a> or check out the chapter index in the sidebar.</p>
</blockquote>

<p>In this chapter, we will discuss how to manage dependencies in Mix.</p>

<p>Our <code class="language-plaintext highlighter-rouge">kv</code> application is complete, so it’s time to implement the server that will handle the requests we defined in the first chapter:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE shopping
OK

PUT shopping milk 1
OK

PUT shopping eggs 3
OK

GET shopping milk
1
OK

DELETE shopping eggs
OK
</code></pre></div></div>

<p>However, instead of adding more code to the <code class="language-plaintext highlighter-rouge">kv</code> application, we are going to build the TCP server as another application that is a client of the <code class="language-plaintext highlighter-rouge">kv</code> application. Since the whole runtime and Elixir ecosystem are geared towards applications, it makes sense to break our projects into smaller applications that work together rather than building a big, monolithic app.</p>

<p>Before creating our new application, we must discuss how Mix handles dependencies. In practice, there are two kinds of dependencies we usually work with: internal and external dependencies. Mix supports mechanisms to work with both of them.</p>

<h2 id="external-dependencies" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">External dependencies</span><a href="#external-dependencies" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>External dependencies are the ones not tied to your business domain. For example, if you need an HTTP API for your distributed KV application, you can use the <a href="https://github.com/elixir-lang/plug">Plug</a> project as an external dependency.</p>

<p>Installing external dependencies is simple. Most commonly, we use the <a href="https://hex.pm">Hex Package Manager</a>, by listing the dependency inside the deps function in our <code class="language-plaintext highlighter-rouge">mix.exs</code> file:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">deps</span> <span class="k">do</span>
  <span class="p">[{</span><span class="ss">:plug</span><span class="p">,</span> <span class="s2">"~&gt; 1.0"</span><span class="p">}]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This dependency refers to the latest version of Plug in the 1.x.x version series that has been pushed to Hex. This is indicated by the <code class="language-plaintext highlighter-rouge">~&gt;</code> preceding the version number. For more information on specifying version requirements, see the <a href="https://hexdocs.pm/elixir/Version.html">documentation for the Version module</a>.</p>

<p>Typically, stable releases are pushed to Hex. If you want to depend on an external dependency still in development, Mix is able to manage Git dependencies too:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">deps</span> <span class="k">do</span>
  <span class="p">[{</span><span class="ss">:plug</span><span class="p">,</span> <span class="ss">git:</span> <span class="s2">"https://github.com/elixir-lang/plug.git"</span><span class="p">}]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>You will notice that when you add a dependency to your project, Mix generates a <code class="language-plaintext highlighter-rouge">mix.lock</code> file that guarantees <em>repeatable builds</em>. The lock file must be checked in to your version control system, to guarantee that everyone who uses the project will use the same dependency versions as you.</p>

<p>Mix provides many tasks for working with dependencies, which can be seen in <code class="language-plaintext highlighter-rouge">mix help</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>mix <span class="nb">help</span>
<span class="gp">mix deps              #</span><span class="w"> </span>Lists dependencies and their status
<span class="gp">mix deps.clean        #</span><span class="w"> </span>Deletes the given dependencies<span class="s1">' files
</span><span class="gp">mix deps.compile      #</span><span class="w"> </span><span class="s1">Compiles dependencies
</span><span class="gp">mix deps.get          #</span><span class="w"> </span><span class="s1">Gets all out of date dependencies
</span><span class="gp">mix deps.tree         #</span><span class="w"> </span><span class="s1">Prints the dependency tree
</span><span class="gp">mix deps.unlock       #</span><span class="w"> </span><span class="s1">Unlocks the given dependencies
</span><span class="gp">mix deps.update       #</span><span class="w"> </span><span class="s1">Updates the given dependencies
</span></code></pre></div></div>

<p>The most common tasks are <code class="language-plaintext highlighter-rouge">mix deps.get</code> and <code class="language-plaintext highlighter-rouge">mix deps.update</code>. Once fetched, dependencies are automatically compiled for you. You can read more about deps by typing <code class="language-plaintext highlighter-rouge">mix help deps</code>, and in the <a href="https://hexdocs.pm/mix/Mix.Tasks.Deps.html">documentation for the Mix.Tasks.Deps module</a>.</p>

<h2 id="internal-dependencies" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Internal dependencies</span><a href="#internal-dependencies" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Internal dependencies are the ones that are specific to your project. They usually don’t make sense outside the scope of your project/company/organization. Most of the time, you want to keep them private, whether due to technical, economic or business reasons.</p>

<p>If you have an internal dependency, Mix supports two methods to work with them: Git repositories or umbrella projects.</p>

<p>For example, if you push the <code class="language-plaintext highlighter-rouge">kv</code> project to a Git repository, you’ll need to list it in your deps code in order to use it:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">deps</span> <span class="k">do</span>
  <span class="p">[{</span><span class="ss">:kv</span><span class="p">,</span> <span class="ss">git:</span> <span class="s2">"https://github.com/YOUR_ACCOUNT/kv.git"</span><span class="p">}]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>If the repository is private though, you may need to specify the private URL <code class="language-plaintext highlighter-rouge">git@github.com:YOUR_ACCOUNT/kv.git</code>. In any case, Mix will be able to fetch it for you as long as you have the proper credentials.</p>

<p>Using Git repositories for internal dependencies is somewhat discouraged in Elixir. Remember that the runtime and the Elixir ecosystem already provide the concept of applications. As such, we expect you to frequently break your code into applications that can be organized logically, even within a single project.</p>

<p>However, if you push every application as a separate project to a Git repository, your projects may become very hard to maintain as you will spend a lot of time managing those Git repositories rather than writing your code.</p>

<p>For this reason, Mix supports “umbrella projects”. Umbrella projects are used to build applications that run together in a single repository. That is exactly the style we are going to explore in the next sections.</p>

<p>Let’s create a new Mix project. We are going to creatively name it <code class="language-plaintext highlighter-rouge">kv_umbrella</code>, and this new project will have both the existing <code class="language-plaintext highlighter-rouge">kv</code> application and the new <code class="language-plaintext highlighter-rouge">kv_server</code> application inside. The directory structure will look like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+ kv_umbrella
  + apps
    + kv
    + kv_server
</code></pre></div></div>

<p>The interesting thing about this approach is that Mix has many conveniences for working with such projects, such as the ability to compile and test all applications inside <code class="language-plaintext highlighter-rouge">apps</code> with a single command. However, even though they are all listed together inside <code class="language-plaintext highlighter-rouge">apps</code>, they are still decoupled from each other, so you can build, test and deploy each application in isolation if you want to.</p>

<p>So let’s get started!</p>

<h2 id="umbrella-projects" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Umbrella projects</span><a href="#umbrella-projects" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Let’s start a new project using <code class="language-plaintext highlighter-rouge">mix new</code>. This new project will be named <code class="language-plaintext highlighter-rouge">kv_umbrella</code> and we need to pass the <code class="language-plaintext highlighter-rouge">--umbrella</code> option when creating it. Do not create this new project inside the existing <code class="language-plaintext highlighter-rouge">kv</code> project!</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>mix new kv_umbrella <span class="nt">--umbrella</span>
<span class="go">* creating README.md
* creating .formatter.exs
* creating .gitignore
* creating mix.exs
* creating apps
* creating config
* creating config/config.exs
</span></code></pre></div></div>

<p>From the printed information, we can see far fewer files are generated. The generated <code class="language-plaintext highlighter-rouge">mix.exs</code> file is different too. Let’s take a look (comments have been removed):</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KvUmbrella</span><span class="o">.</span><span class="no">MixProject</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Mix</span><span class="o">.</span><span class="no">Project</span>

  <span class="k">def</span> <span class="n">project</span> <span class="k">do</span>
    <span class="p">[</span>
      <span class="ss">apps_path:</span> <span class="s2">"apps"</span><span class="p">,</span>
      <span class="ss">start_permanent:</span> <span class="no">Mix</span><span class="o">.</span><span class="n">env</span><span class="p">()</span> <span class="o">==</span> <span class="ss">:prod</span><span class="p">,</span>
      <span class="ss">deps:</span> <span class="n">deps</span><span class="p">()</span>
    <span class="p">]</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">deps</span> <span class="k">do</span>
    <span class="p">[]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>What makes this project different from the previous one is the <code class="language-plaintext highlighter-rouge">apps_path: "apps"</code> entry in the project definition. This means this project will act as an umbrella. Such projects do not have source files nor tests, although they can have their own dependencies. Each child application must be defined inside the <code class="language-plaintext highlighter-rouge">apps</code> directory.</p>

<p>Let’s move inside the apps directory and start building <code class="language-plaintext highlighter-rouge">kv_server</code>. This time, we are going to pass the <code class="language-plaintext highlighter-rouge">--sup</code> flag, which will tell Mix to generate a supervision tree automatically for us, instead of building one manually as we did in previous chapters:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>kv_umbrella/apps
<span class="gp">$</span><span class="w"> </span>mix new kv_server <span class="nt">--module</span> KVServer <span class="nt">--sup</span>
</code></pre></div></div>

<p>The generated files are similar to the ones we first generated for <code class="language-plaintext highlighter-rouge">kv</code>, with a few differences. Let’s open up <code class="language-plaintext highlighter-rouge">mix.exs</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KVServer</span><span class="o">.</span><span class="no">MixProject</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Mix</span><span class="o">.</span><span class="no">Project</span>

  <span class="k">def</span> <span class="n">project</span> <span class="k">do</span>
    <span class="p">[</span>
      <span class="ss">app:</span> <span class="ss">:kv_server</span><span class="p">,</span>
      <span class="ss">version:</span> <span class="s2">"0.1.0"</span><span class="p">,</span>
      <span class="ss">build_path:</span> <span class="s2">"../../_build"</span><span class="p">,</span>
      <span class="ss">config_path:</span> <span class="s2">"../../config/config.exs"</span><span class="p">,</span>
      <span class="ss">deps_path:</span> <span class="s2">"../../deps"</span><span class="p">,</span>
      <span class="ss">lockfile:</span> <span class="s2">"../../mix.lock"</span><span class="p">,</span>
      <span class="ss">elixir:</span> <span class="s2">"~&gt; 1.14"</span><span class="p">,</span>
      <span class="ss">start_permanent:</span> <span class="no">Mix</span><span class="o">.</span><span class="n">env</span><span class="p">()</span> <span class="o">==</span> <span class="ss">:prod</span><span class="p">,</span>
      <span class="ss">deps:</span> <span class="n">deps</span><span class="p">()</span>
    <span class="p">]</span>
  <span class="k">end</span>

  <span class="c1"># Run "mix help compile.app" to learn about applications</span>
  <span class="k">def</span> <span class="n">application</span> <span class="k">do</span>
    <span class="p">[</span>
      <span class="ss">extra_applications:</span> <span class="p">[</span><span class="ss">:logger</span><span class="p">],</span>
      <span class="ss">mod:</span> <span class="p">{</span><span class="no">KVServer</span><span class="o">.</span><span class="no">Application</span><span class="p">,</span> <span class="p">[]}</span>
    <span class="p">]</span>
  <span class="k">end</span>

  <span class="c1"># Run "mix help deps" to learn about dependencies</span>
  <span class="k">defp</span> <span class="n">deps</span> <span class="k">do</span>
    <span class="p">[</span>
      <span class="c1"># {:dep_from_hexpm, "~&gt; 0.3.0"},</span>
      <span class="c1"># {:dep_from_git, git: "https://github.com/elixir-lang/my_dep.git", tag: "0.1.0"},</span>
      <span class="c1"># {:sibling_app_in_umbrella, in_umbrella: true},</span>
    <span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>First of all, since we generated this project inside <code class="language-plaintext highlighter-rouge">kv_umbrella/apps</code>, Mix automatically detected the umbrella structure and added four lines to the project definition:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="ss">build_path:</span> <span class="s2">"../../_build"</span><span class="p">,</span>
<span class="ss">config_path:</span> <span class="s2">"../../config/config.exs"</span><span class="p">,</span>
<span class="ss">deps_path:</span> <span class="s2">"../../deps"</span><span class="p">,</span>
<span class="ss">lockfile:</span> <span class="s2">"../../mix.lock"</span><span class="p">,</span>
</code></pre></div></div>

<p>Those options mean all dependencies will be checked out to <code class="language-plaintext highlighter-rouge">kv_umbrella/deps</code>, and they will share the same build, config and lock files. We haven’t talked about configuration yet, but from here we can build the intuition that all configuration and dependencies are shared across all projects in an umbrella, and it is not per application.</p>

<p>The second change is in the <code class="language-plaintext highlighter-rouge">application</code> function inside <code class="language-plaintext highlighter-rouge">mix.exs</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">application</span> <span class="k">do</span>
  <span class="p">[</span>
    <span class="ss">extra_applications:</span> <span class="p">[</span><span class="ss">:logger</span><span class="p">],</span>
    <span class="ss">mod:</span> <span class="p">{</span><span class="no">KVServer</span><span class="o">.</span><span class="no">Application</span><span class="p">,</span> <span class="p">[]}</span>
  <span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Because we passed the <code class="language-plaintext highlighter-rouge">--sup</code> flag, Mix automatically added <code class="language-plaintext highlighter-rouge">mod: {KVServer.Application, []}</code>, specifying that <code class="language-plaintext highlighter-rouge">KVServer.Application</code> is our application callback module. <code class="language-plaintext highlighter-rouge">KVServer.Application</code> will start our application supervision tree.</p>

<p>In fact, let’s open up <code class="language-plaintext highlighter-rouge">lib/kv_server/application.ex</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KVServer</span><span class="o">.</span><span class="no">Application</span> <span class="k">do</span>
  <span class="c1"># See https://hexdocs.pm/elixir/Application.html</span>
  <span class="c1"># for more information on OTP Applications</span>
  <span class="nv">@moduledoc</span> <span class="no">false</span>

  <span class="kn">use</span> <span class="no">Application</span>

  <span class="nv">@impl</span> <span class="no">true</span>
  <span class="k">def</span> <span class="n">start</span><span class="p">(</span><span class="n">_type</span><span class="p">,</span> <span class="n">_args</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># List all child processes to be supervised</span>
    <span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
      <span class="c1"># Starts a worker by calling: KVServer.Worker.start_link(arg)</span>
      <span class="c1"># {KVServer.Worker, arg},</span>
    <span class="p">]</span>

    <span class="c1"># See https://hexdocs.pm/elixir/Supervisor.html</span>
    <span class="c1"># for other strategies and supported options</span>
    <span class="n">opts</span> <span class="o">=</span> <span class="p">[</span><span class="ss">strategy:</span> <span class="ss">:one_for_one</span><span class="p">,</span> <span class="ss">name:</span> <span class="no">KVServer</span><span class="o">.</span><span class="no">Supervisor</span><span class="p">]</span>
    <span class="no">Supervisor</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Notice that it defines the application callback function, <code class="language-plaintext highlighter-rouge">start/2</code>, and instead of defining a supervisor named <code class="language-plaintext highlighter-rouge">KVServer.Supervisor</code> that uses the <code class="language-plaintext highlighter-rouge">Supervisor</code> module, it conveniently defined the supervisor inline! You can read more about such supervisors by reading <a href="https://hexdocs.pm/elixir/Supervisor.html">the Supervisor module documentation</a>.</p>

<p>We can already try out our first umbrella child. We could run tests inside the <code class="language-plaintext highlighter-rouge">apps/kv_server</code> directory, but that wouldn’t be much fun. Instead, go to the root of the umbrella project and run <code class="language-plaintext highlighter-rouge">mix test</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>mix <span class="nb">test</span>
</code></pre></div></div>

<p>And it works!</p>

<p>Since we want <code class="language-plaintext highlighter-rouge">kv_server</code> to eventually use the functionality we defined in <code class="language-plaintext highlighter-rouge">kv</code>, we need to add <code class="language-plaintext highlighter-rouge">kv</code> as a dependency to our application.</p>

<h2 id="dependencies-within-an-umbrella-project" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Dependencies within an umbrella project</span><a href="#dependencies-within-an-umbrella-project" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Dependencies between applications in an umbrella project must still be explicitly defined and Mix makes it easy to do so. Open up <code class="language-plaintext highlighter-rouge">apps/kv_server/mix.exs</code> and change the <code class="language-plaintext highlighter-rouge">deps/0</code> function to the following:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defp</span> <span class="n">deps</span> <span class="k">do</span>
  <span class="p">[{</span><span class="ss">:kv</span><span class="p">,</span> <span class="ss">in_umbrella:</span> <span class="no">true</span><span class="p">}]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The line above makes <code class="language-plaintext highlighter-rouge">:kv</code> available as a dependency inside <code class="language-plaintext highlighter-rouge">:kv_server</code> and automatically starts the <code class="language-plaintext highlighter-rouge">:kv</code> application before the server starts.</p>

<p>Finally, copy the <code class="language-plaintext highlighter-rouge">kv</code> application we have built so far to the <code class="language-plaintext highlighter-rouge">apps</code> directory in our new umbrella project. The final directory structure should match the structure we mentioned earlier:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+ kv_umbrella
  + apps
    + kv
    + kv_server
</code></pre></div></div>

<p>We now need to modify <code class="language-plaintext highlighter-rouge">apps/kv/mix.exs</code> to contain the umbrella entries we have seen in <code class="language-plaintext highlighter-rouge">apps/kv_server/mix.exs</code>. Open up <code class="language-plaintext highlighter-rouge">apps/kv/mix.exs</code> and add to the <code class="language-plaintext highlighter-rouge">project/0</code> function:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="ss">build_path:</span> <span class="s2">"../../_build"</span><span class="p">,</span>
<span class="ss">config_path:</span> <span class="s2">"../../config/config.exs"</span><span class="p">,</span>
<span class="ss">deps_path:</span> <span class="s2">"../../deps"</span><span class="p">,</span>
<span class="ss">lockfile:</span> <span class="s2">"../../mix.lock"</span><span class="p">,</span>
</code></pre></div></div>

<p>Now you can run tests for both projects from the umbrella root with <code class="language-plaintext highlighter-rouge">mix test</code>. Sweet!</p>

<h2 id="dont-drink-the-kool-aid" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Don’t drink the kool aid</span><a href="#dont-drink-the-kool-aid" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Umbrella projects are a convenience to help you organize and manage multiple applications. While it provides a degree of separation between applications, those applications are not fully decoupled, as they share the same configuration and the same dependencies.</p>

<p>The pattern of keeping multiple applications in the same repository is known as “mono-repo”. Umbrella projects maximize this pattern by providing conveniences to compile, test and run multiple applications at once.</p>

<p>If you find yourself in a position where you want to use different configurations in each application for the same dependency or use different dependency versions, then it is likely your codebase has grown beyond what umbrellas can provide.</p>

<p>The good news is that breaking an umbrella apart is quite straightforward, as you simply need to move applications outside of the umbrella project’s <code class="language-plaintext highlighter-rouge">apps/</code> directory and update the project’s mix.exs file to no longer set the <code class="language-plaintext highlighter-rouge">build_path</code>, <code class="language-plaintext highlighter-rouge">config_path</code>, <code class="language-plaintext highlighter-rouge">deps_path</code>, and <code class="language-plaintext highlighter-rouge">lockfile</code> configuration. You can depend on private projects outside of the umbrella in multiple ways:</p>

<ol>
  <li>Move it to a separate folder within the same repository and point to it using a path dependency (the mono-repo pattern)</li>
  <li>Move the repository to a separate Git repository and depend on it</li>
  <li>Publish the project to a private <a href="https://hex.pm/">Hex.pm</a> organization</li>
</ol>

<h2 id="summing-up" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Summing up</span><a href="#summing-up" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>In this chapter, we have learned more about Mix dependencies and umbrella projects. While we may run <code class="language-plaintext highlighter-rouge">kv</code> without a server, our <code class="language-plaintext highlighter-rouge">kv_server</code> depends directly on <code class="language-plaintext highlighter-rouge">kv</code>. By breaking them into separate applications, we gain more control in how they are developed and tested.</p>

<p>When using umbrella applications, it is important to have a clear boundary between them. Our upcoming <code class="language-plaintext highlighter-rouge">kv_server</code> must only access public APIs defined in <code class="language-plaintext highlighter-rouge">kv</code>. Think of your umbrella apps as any other dependency or even Elixir itself: you can only access what is public and documented. Reaching into private functionality in your dependencies is a poor practice that will eventually cause your code to break when a new version is up.</p>

<p>Umbrella applications can also be used as a stepping stone for eventually extracting an application from your codebase. For example, imagine a web application that has to send “push notifications” to its users. The whole “push notifications system” can be developed as a separate application in the umbrella, with its own supervision tree and APIs. If you ever run into a situation where another project needs the push notifications system, the system can be moved to a private repository or a Hex package.</p>

<p>Developers may also use umbrella projects to break large business domains apart. The caution here is to make sure the domains don’t depend on each other (also known as cyclic dependencies). If you run into such situations, it means those applications are not as isolated from each other as you originally thought, and you have architectural and design issues to solve.</p>

<p>Finally, keep in mind that applications in an umbrella project all share the same configurations and dependencies. If two applications in your umbrella need to configure the same dependency in drastically different ways or even use different versions, you have probably outgrown the benefits brought by umbrellas. Remember you can break the umbrella and still leverage the benefits behind “mono-repos”.</p>

<p>With our umbrella project up and running, it is time to start writing our server.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/mix-otp/ets.html" class="previous page-numbers spec" title="ETS">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/mix-otp/task-and-gen-tcp.html" class="previous page-numbers spec" title="Task and gen_tcp">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/mix-otp/dependencies-and-umbrella-projects.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/mix-otp/task-and-gen-tcp.html" page=":8:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><span title="Task and gen_tcp">Task and gen_tcp</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Mix and OTP</small>
      <h1>Task and gen_tcp</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#echo-server">Echo server</a></li><li><a href="#tasks">Tasks</a></li><li><a href="#task-supervisor">Task supervisor</a></li></ol></div>

    <blockquote>
  <p>This chapter is part of the <i>Mix and OTP guide</i> and it depends on previous chapters in this guide.
For more information, <a href="/getting-started/mix-otp/introduction-to-mix.html">read the introduction guide</a> or check out the chapter index in the sidebar.</p>
</blockquote>

<p>In this chapter, we are going to learn how to use <a href="http://www.erlang.org/doc/man/gen_tcp.html">Erlang’s <code class="language-plaintext highlighter-rouge">:gen_tcp</code> module</a> to serve requests. This provides a great opportunity to explore Elixir’s <code class="language-plaintext highlighter-rouge">Task</code> module. In future chapters, we will expand our server so it can actually serve the commands.</p>

<h2 id="echo-server" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Echo server</span><a href="#echo-server" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>We will start our TCP server by first implementing an echo server. It will send a response with the text it received in the request. We will slowly improve our server until it is supervised and ready to handle multiple connections.</p>

<p>A TCP server, in broad strokes, performs the following steps:</p>

<ol>
  <li>Listens to a port until the port is available and it gets hold of the socket</li>
  <li>Waits for a client connection on that port and accepts it</li>
  <li>Reads the client request and writes a response back</li>
</ol>

<p>Let’s implement those steps. Move to the <code class="language-plaintext highlighter-rouge">apps/kv_server</code> application, open up <code class="language-plaintext highlighter-rouge">lib/kv_server.ex</code>, and add the following functions:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KVServer</span> <span class="k">do</span>
  <span class="kn">require</span> <span class="no">Logger</span>

  <span class="k">def</span> <span class="n">accept</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># The options below mean:</span>
    <span class="c1">#</span>
    <span class="c1"># 1. `:binary` - receives data as binaries (instead of lists)</span>
    <span class="c1"># 2. `packet: :line` - receives data line by line</span>
    <span class="c1"># 3. `active: false` - blocks on `:gen_tcp.recv/2` until data is available</span>
    <span class="c1"># 4. `reuseaddr: true` - allows us to reuse the address if the listener crashes</span>
    <span class="c1">#</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span> <span class="o">=</span>
      <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="p">[</span><span class="ss">:binary</span><span class="p">,</span> <span class="ss">packet:</span> <span class="ss">:line</span><span class="p">,</span> <span class="ss">active:</span> <span class="no">false</span><span class="p">,</span> <span class="ss">reuseaddr:</span> <span class="no">true</span><span class="p">])</span>
    <span class="no">Logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Accepting connections on port </span><span class="si">#{</span><span class="n">port</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">loop_acceptor</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">loop_acceptor</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">client</span><span class="p">}</span> <span class="o">=</span> <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
    <span class="n">serve</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
    <span class="n">loop_acceptor</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">serve</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">socket</span>
    <span class="o">|&gt;</span> <span class="n">read_line</span><span class="p">()</span>
    <span class="o">|&gt;</span> <span class="n">write_line</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>

    <span class="n">serve</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">read_line</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">data</span><span class="p">}</span> <span class="o">=</span> <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">data</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">write_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We are going to start our server by calling <code class="language-plaintext highlighter-rouge">KVServer.accept(4040)</code>, where 4040 is the port. The first step in <code class="language-plaintext highlighter-rouge">accept/1</code> is to listen to the port until the socket becomes available and then call <code class="language-plaintext highlighter-rouge">loop_acceptor/1</code>. <code class="language-plaintext highlighter-rouge">loop_acceptor/1</code> is a loop accepting client connections. For each accepted connection, we call <code class="language-plaintext highlighter-rouge">serve/1</code>.</p>

<p><code class="language-plaintext highlighter-rouge">serve/1</code> is another loop that reads a line from the socket and writes those lines back to the socket. Note that the <code class="language-plaintext highlighter-rouge">serve/1</code> function uses <a href="https://hexdocs.pm/elixir/Kernel.html#%7C%3E/2">the pipe operator <code class="language-plaintext highlighter-rouge">|&gt;</code></a> to express this flow of operations. The pipe operator evaluates the left side and passes its result as the first argument to the function on the right side. The example above:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">socket</span> <span class="o">|&gt;</span> <span class="n">read_line</span><span class="p">()</span> <span class="o">|&gt;</span> <span class="n">write_line</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
</code></pre></div></div>

<p>is equivalent to:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">write_line</span><span class="p">(</span><span class="n">read_line</span><span class="p">(</span><span class="n">socket</span><span class="p">),</span> <span class="n">socket</span><span class="p">)</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">read_line/1</code> implementation receives data from the socket using <code class="language-plaintext highlighter-rouge">:gen_tcp.recv/2</code> and <code class="language-plaintext highlighter-rouge">write_line/2</code> writes to the socket using <code class="language-plaintext highlighter-rouge">:gen_tcp.send/2</code>.</p>

<p>Note that <code class="language-plaintext highlighter-rouge">serve/1</code> is an infinite loop called sequentially inside <code class="language-plaintext highlighter-rouge">loop_acceptor/1</code>, so the tail call to <code class="language-plaintext highlighter-rouge">loop_acceptor/1</code> is never reached and could be avoided. However, as we shall see, we will need to execute <code class="language-plaintext highlighter-rouge">serve/1</code> in a separate process, so we will need that tail call soon.</p>

<p>This is pretty much all we need to implement our echo server. Let’s give it a try!</p>

<p>Start an IEx session inside the <code class="language-plaintext highlighter-rouge">kv_server</code> application with <code class="language-plaintext highlighter-rouge">iex -S mix</code>. Inside IEx, run:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">KVServer</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="mi">4040</span><span class="p">)</span>
</code></pre></div></div>

<p>The server is now running, and you will even notice the console is blocked. Let’s use <a href="https://en.wikipedia.org/wiki/Telnet">a <code class="language-plaintext highlighter-rouge">telnet</code> client</a> to access our server. There are clients available on most operating systems, and their command lines are generally similar:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>telnet 127.0.0.1 4040
<span class="go">Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
hello
hello
is it me
is it me
you are looking for?
you are looking for?
</span></code></pre></div></div>

<p>Type “hello”, press enter, and you will get “hello” back. Excellent!</p>

<p>My particular telnet client can be exited by typing <code class="language-plaintext highlighter-rouge">ctrl + ]</code>, typing <code class="language-plaintext highlighter-rouge">quit</code>, and pressing <code class="language-plaintext highlighter-rouge">&lt;Enter&gt;</code>, but your client may require different steps.</p>

<p>Once you exit the telnet client, you will likely see an error in the IEx session:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>** (MatchError) no match of right hand side value: {:error, :closed}
    (kv_server) lib/kv_server.ex:45: KVServer.read_line/1
    (kv_server) lib/kv_server.ex:37: KVServer.serve/1
    (kv_server) lib/kv_server.ex:30: KVServer.loop_acceptor/1
</code></pre></div></div>

<p>That’s because we were expecting data from <code class="language-plaintext highlighter-rouge">:gen_tcp.recv/2</code> but the client closed the connection. We need to handle such cases better in future revisions of our server.</p>

<p>For now, there is a more important bug we need to fix: what happens if our TCP acceptor crashes? Since there is no supervision, the server dies and we won’t be able to serve more requests, because it won’t be restarted. That’s why we must move our server to a supervision tree.</p>

<h2 id="tasks" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Tasks</span><a href="#tasks" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>We have learned about agents, generic servers, and supervisors. They are all meant to work with multiple messages or manage state. But what do we use when we only need to execute some task and that is it?</p>

<p><a href="https://hexdocs.pm/elixir/Task.html">The Task module</a> provides this functionality exactly. For example, it has a <code class="language-plaintext highlighter-rouge">start_link/1</code> function that receives an anonymous function and executes it inside a new process that will be part of a supervision tree.</p>

<p>Let’s give it a try. Open up <code class="language-plaintext highlighter-rouge">lib/kv_server/application.ex</code>, and let’s change the supervisor in the <code class="language-plaintext highlighter-rouge">start/2</code> function to the following:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">def</span> <span class="n">start</span><span class="p">(</span><span class="n">_type</span><span class="p">,</span> <span class="n">_args</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span><span class="no">Task</span><span class="p">,</span> <span class="k">fn</span> <span class="o">-&gt;</span> <span class="no">KVServer</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="mi">4040</span><span class="p">)</span> <span class="k">end</span><span class="p">}</span>
    <span class="p">]</span>

    <span class="n">opts</span> <span class="o">=</span> <span class="p">[</span><span class="ss">strategy:</span> <span class="ss">:one_for_one</span><span class="p">,</span> <span class="ss">name:</span> <span class="no">KVServer</span><span class="o">.</span><span class="no">Supervisor</span><span class="p">]</span>
    <span class="no">Supervisor</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>As usual, we’ve passed a two-element tuple as a child specification, which in turn will invoke <code class="language-plaintext highlighter-rouge">Task.start_link/1</code>.</p>

<p>With this change, we are saying that we want to run <code class="language-plaintext highlighter-rouge">KVServer.accept(4040)</code> as a task. We are hardcoding the port for now but this could be changed in a few ways, for example, by reading the port out of the system environment when starting the application:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">port</span> <span class="o">=</span> <span class="no">String</span><span class="o">.</span><span class="n">to_integer</span><span class="p">(</span><span class="no">System</span><span class="o">.</span><span class="n">get_env</span><span class="p">(</span><span class="s2">"PORT"</span><span class="p">)</span> <span class="o">||</span> <span class="s2">"4040"</span><span class="p">)</span>
<span class="c1"># ...</span>
<span class="p">{</span><span class="no">Task</span><span class="p">,</span> <span class="k">fn</span> <span class="o">-&gt;</span> <span class="no">KVServer</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="k">end</span><span class="p">}</span>
</code></pre></div></div>

<p>Insert these changes in your code and now you may start your application using the following command <code class="language-plaintext highlighter-rouge">PORT=4321 mix run --no-halt</code>, notice how we are passing the port as a variable, but still defaults to 4040 if none is given.</p>

<p>Now that the server is part of the supervision tree, it should start automatically when we run the application. Start your server, now passing the port, and once again use the <code class="language-plaintext highlighter-rouge">telnet</code> client to make sure that everything still works:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>telnet 127.0.0.1 4321
<span class="go">Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
say you
say you
say me
say me
</span></code></pre></div></div>

<p>Yes, it works! However, does it <em>scale</em>?</p>

<p>Try to connect two telnet clients at the same time. When you do so, you will notice that the second client doesn’t echo:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>telnet 127.0.0.1 4321
<span class="go">Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
hello
hello?
HELLOOOOOO?
</span></code></pre></div></div>

<p>It doesn’t seem to work at all. That’s because we are serving requests in the same process that are accepting connections. When one client is connected, we can’t accept another client.</p>

<h2 id="task-supervisor" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Task supervisor</span><a href="#task-supervisor" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>In order to make our server handle simultaneous connections, we need to have one process working as an acceptor that spawns other processes to serve requests. One solution would be to change:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defp</span> <span class="n">loop_acceptor</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
  <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">client</span><span class="p">}</span> <span class="o">=</span> <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
  <span class="n">serve</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
  <span class="n">loop_acceptor</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>to also use <code class="language-plaintext highlighter-rouge">Task.start_link/1</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defp</span> <span class="n">loop_acceptor</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
  <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">client</span><span class="p">}</span> <span class="o">=</span> <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
  <span class="no">Task</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span> <span class="n">serve</span><span class="p">(</span><span class="n">client</span><span class="p">)</span> <span class="k">end</span><span class="p">)</span>
  <span class="n">loop_acceptor</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We are starting a linked Task directly from the acceptor process. But we’ve already made this mistake once. Do you remember?</p>

<p>This is similar to the mistake we made when we called <code class="language-plaintext highlighter-rouge">KV.Bucket.start_link/1</code> straight from the registry. That meant a failure in any bucket would bring the whole registry down.</p>

<p>The code above would have the same flaw: if we link the <code class="language-plaintext highlighter-rouge">serve(client)</code> task to the acceptor, a crash when serving a request would bring the acceptor, and consequently all other connections, down.</p>

<p>We fixed the issue for the registry by using a simple one for one supervisor. We are going to use the same tactic here, except that this pattern is so common with tasks that <code class="language-plaintext highlighter-rouge">Task</code> already comes with a solution: a simple one for one supervisor that starts temporary tasks as part of our supervision tree.</p>

<p>Let’s change <code class="language-plaintext highlighter-rouge">start/2</code> once again, to add a supervisor to our tree:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">def</span> <span class="n">start</span><span class="p">(</span><span class="n">_type</span><span class="p">,</span> <span class="n">_args</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">port</span> <span class="o">=</span> <span class="no">String</span><span class="o">.</span><span class="n">to_integer</span><span class="p">(</span><span class="no">System</span><span class="o">.</span><span class="n">get_env</span><span class="p">(</span><span class="s2">"PORT"</span><span class="p">)</span> <span class="o">||</span> <span class="s2">"4040"</span><span class="p">)</span>

    <span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span><span class="no">Task</span><span class="o">.</span><span class="no">Supervisor</span><span class="p">,</span> <span class="ss">name:</span> <span class="no">KVServer</span><span class="o">.</span><span class="no">TaskSupervisor</span><span class="p">},</span>
      <span class="p">{</span><span class="no">Task</span><span class="p">,</span> <span class="k">fn</span> <span class="o">-&gt;</span> <span class="no">KVServer</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="k">end</span><span class="p">}</span>
    <span class="p">]</span>

    <span class="n">opts</span> <span class="o">=</span> <span class="p">[</span><span class="ss">strategy:</span> <span class="ss">:one_for_one</span><span class="p">,</span> <span class="ss">name:</span> <span class="no">KVServer</span><span class="o">.</span><span class="no">Supervisor</span><span class="p">]</span>
    <span class="no">Supervisor</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>We’ll now start a <a href="https://hexdocs.pm/elixir/Task.Supervisor.html"><code class="language-plaintext highlighter-rouge">Task.Supervisor</code></a> process with name <code class="language-plaintext highlighter-rouge">KVServer.TaskSupervisor</code>. Remember, since the acceptor task depends on this supervisor, the supervisor must be started first.</p>

<p>Now we need to change <code class="language-plaintext highlighter-rouge">loop_acceptor/1</code> to use <code class="language-plaintext highlighter-rouge">Task.Supervisor</code> to serve each request:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defp</span> <span class="n">loop_acceptor</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
  <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">client</span><span class="p">}</span> <span class="o">=</span> <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
  <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">pid</span><span class="p">}</span> <span class="o">=</span> <span class="no">Task</span><span class="o">.</span><span class="no">Supervisor</span><span class="o">.</span><span class="n">start_child</span><span class="p">(</span><span class="no">KVServer</span><span class="o">.</span><span class="no">TaskSupervisor</span><span class="p">,</span> <span class="k">fn</span> <span class="o">-&gt;</span> <span class="n">serve</span><span class="p">(</span><span class="n">client</span><span class="p">)</span> <span class="k">end</span><span class="p">)</span>
  <span class="ss">:ok</span> <span class="o">=</span> <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">controlling_process</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">pid</span><span class="p">)</span>
  <span class="n">loop_acceptor</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>You might notice that we added a line, <code class="language-plaintext highlighter-rouge">:ok = :gen_tcp.controlling_process(client, pid)</code>. This makes the child process the “controlling process” of the <code class="language-plaintext highlighter-rouge">client</code> socket. If we didn’t do this, the acceptor would bring down all the clients if it crashed because sockets would be tied to the process that accepted them (which is the default behaviour).</p>

<p>Start a new server with <code class="language-plaintext highlighter-rouge">PORT=4040 mix run --no-halt</code> and we can now open up many concurrent telnet clients. You will also notice that quitting a client does not bring the acceptor down. Excellent!</p>

<p>Here is the full echo server implementation:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KVServer</span> <span class="k">do</span>
  <span class="kn">require</span> <span class="no">Logger</span>

  <span class="nv">@doc</span> <span class="sd">"""
  Starts accepting connections on the given `port`.
  """</span>
  <span class="k">def</span> <span class="n">accept</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span> <span class="o">=</span> <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">port</span><span class="p">,</span>
                      <span class="p">[</span><span class="ss">:binary</span><span class="p">,</span> <span class="ss">packet:</span> <span class="ss">:line</span><span class="p">,</span> <span class="ss">active:</span> <span class="no">false</span><span class="p">,</span> <span class="ss">reuseaddr:</span> <span class="no">true</span><span class="p">])</span>
    <span class="no">Logger</span><span class="o">.</span><span class="n">info</span> <span class="s2">"Accepting connections on port </span><span class="si">#{</span><span class="n">port</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">loop_acceptor</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">loop_acceptor</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">client</span><span class="p">}</span> <span class="o">=</span> <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">pid</span><span class="p">}</span> <span class="o">=</span> <span class="no">Task</span><span class="o">.</span><span class="no">Supervisor</span><span class="o">.</span><span class="n">start_child</span><span class="p">(</span><span class="no">KVServer</span><span class="o">.</span><span class="no">TaskSupervisor</span><span class="p">,</span> <span class="k">fn</span> <span class="o">-&gt;</span> <span class="n">serve</span><span class="p">(</span><span class="n">client</span><span class="p">)</span> <span class="k">end</span><span class="p">)</span>
    <span class="ss">:ok</span> <span class="o">=</span> <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">controlling_process</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">pid</span><span class="p">)</span>
    <span class="n">loop_acceptor</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">serve</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">socket</span>
    <span class="o">|&gt;</span> <span class="n">read_line</span><span class="p">()</span>
    <span class="o">|&gt;</span> <span class="n">write_line</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>

    <span class="n">serve</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">read_line</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">data</span><span class="p">}</span> <span class="o">=</span> <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">data</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">write_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Since we have changed the supervisor specification, we need to ask: is our supervision strategy still correct?</p>

<p>In this case, the answer is yes: if the acceptor crashes, there is no need to crash the existing connections. On the other hand, if the task supervisor crashes, there is no need to crash the acceptor too.</p>

<p>However, there is still one concern left, which are the restart strategies. Tasks, by default, have the <code class="language-plaintext highlighter-rouge">:restart</code> value set to <code class="language-plaintext highlighter-rouge">:temporary</code>, which means they are not restarted. This is an excellent default for the connections started via the <code class="language-plaintext highlighter-rouge">Task.Supervisor</code>, as it makes no sense to restart a failed connection, but it is a bad choice for the acceptor. If the acceptor crashes, we want to bring the acceptor up and running again.</p>

<p>We could fix this by defining our own module that calls <code class="language-plaintext highlighter-rouge">use Task, restart: :permanent</code> and invokes a <code class="language-plaintext highlighter-rouge">start_link</code> function responsible for restarting the task, quite similar to <code class="language-plaintext highlighter-rouge">Agent</code> and <code class="language-plaintext highlighter-rouge">GenServer</code>. However, let’s take a different approach here. When integrating with someone else’s library, we won’t be able to change how their agents, tasks, and servers are defined. Instead, we need to be able to customize their child specification dynamically. This can be done by using <code class="language-plaintext highlighter-rouge">Supervisor.child_spec/2</code>, a function that we happen to know from previous chapters. Let’s rewrite <code class="language-plaintext highlighter-rouge">start/2</code> in <code class="language-plaintext highlighter-rouge">KVServer.Application</code> once more:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">def</span> <span class="n">start</span><span class="p">(</span><span class="n">_type</span><span class="p">,</span> <span class="n">_args</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">port</span> <span class="o">=</span> <span class="no">String</span><span class="o">.</span><span class="n">to_integer</span><span class="p">(</span><span class="no">System</span><span class="o">.</span><span class="n">get_env</span><span class="p">(</span><span class="s2">"PORT"</span><span class="p">)</span> <span class="o">||</span> <span class="s2">"4040"</span><span class="p">)</span>

    <span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span><span class="no">Task</span><span class="o">.</span><span class="no">Supervisor</span><span class="p">,</span> <span class="ss">name:</span> <span class="no">KVServer</span><span class="o">.</span><span class="no">TaskSupervisor</span><span class="p">},</span>
      <span class="no">Supervisor</span><span class="o">.</span><span class="n">child_spec</span><span class="p">({</span><span class="no">Task</span><span class="p">,</span> <span class="k">fn</span> <span class="o">-&gt;</span> <span class="no">KVServer</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="k">end</span><span class="p">},</span> <span class="ss">restart:</span> <span class="ss">:permanent</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">opts</span> <span class="o">=</span> <span class="p">[</span><span class="ss">strategy:</span> <span class="ss">:one_for_one</span><span class="p">,</span> <span class="ss">name:</span> <span class="no">KVServer</span><span class="o">.</span><span class="no">Supervisor</span><span class="p">]</span>
    <span class="no">Supervisor</span><span class="o">.</span><span class="n">start_link</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Supervisor.child_spec/2</code> is capable of building a child specification from a given module and/or tuple, and it also accepts values that override the underlying child specification. Now we have an always running acceptor that starts temporary task processes under an always running task supervisor.</p>

<p>In the next chapter, we will start parsing the client requests and sending responses, finishing our server.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" class="previous page-numbers spec" title="Dependencies and umbrella projects">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/mix-otp/docs-tests-and-with.html" class="previous page-numbers spec" title="Doctests, patterns and with">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
        
        
      
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/mix-otp/task-and-gen-tcp.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/mix-otp/docs-tests-and-with.html" page=":9:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><span title="Doctests, patterns and with">Doctests, patterns and with</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Mix and OTP</small>
      <h1>Doctests, patterns and with</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#doctests">Doctests</a></li><li><a href="#with">with</a></li><li><a href="#running-commands">Running commands</a></li></ol></div>

    <blockquote>
  <p>This chapter is part of the <i>Mix and OTP guide</i> and it depends on previous chapters in this guide.
For more information, <a href="/getting-started/mix-otp/introduction-to-mix.html">read the introduction guide</a> or check out the chapter index in the sidebar.</p>
</blockquote>

<p>In this chapter, we will implement the code that parses the commands we described in the first chapter:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE shopping
OK

PUT shopping milk 1
OK

PUT shopping eggs 3
OK

GET shopping milk
1
OK

DELETE shopping eggs
OK
</code></pre></div></div>

<p>After the parsing is done, we will update our server to dispatch the parsed commands to the <code class="language-plaintext highlighter-rouge">:kv</code> application we built previously.</p>

<h2 id="doctests" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Doctests</span><a href="#doctests" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>On the language homepage, we mention that Elixir makes documentation a first-class citizen in the language. We have explored this concept many times throughout this guide, be it via <code class="language-plaintext highlighter-rouge">mix help</code> or by typing <code class="language-plaintext highlighter-rouge">h Enum</code> or another module in an IEx console.</p>

<p>In this section, we will implement the parsing functionality, document it and make sure our documentation is up to date with doctests. This helps us provide documentation with accurate code samples.</p>

<p>We need two steps to achieve this: first we write the documentation and then we instruct ExUnit to extract and run the examples in it by calling <a href="https://hexdocs.pm/ex_unit/ExUnit.DocTest.html#doctest/1"><code class="language-plaintext highlighter-rouge">ExUnit.DocTest.doctest/1</code></a>.</p>

<p>Let’s start by creating an empty definition of the parsing function with documentation at <code class="language-plaintext highlighter-rouge">lib/kv_server/command.ex</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KVServer</span><span class="o">.</span><span class="no">Command</span> <span class="k">do</span>
  <span class="nv">@doc</span> <span class="sx">~S""</span><span class="s2">"
  Parses the given `line` into a command.

  ## Examples

      iex&gt; KVServer.Command.parse("</span><span class="no">CREATE</span> <span class="n">shopping</span><span class="p">\</span><span class="n">r</span><span class="p">\</span><span class="n">n</span><span class="s2">")
      {:ok, {:create, "</span><span class="n">shopping</span><span class="s2">"}}

  """</span>
  <span class="k">def</span> <span class="n">parse</span><span class="p">(</span><span class="n">_line</span><span class="p">)</span> <span class="k">do</span>
    <span class="ss">:not_implemented</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Doctests are specified by an indentation of four spaces followed by the <code class="language-plaintext highlighter-rouge">iex&gt;</code> prompt in a documentation string. If a command spans multiple lines, you can use <code class="language-plaintext highlighter-rouge">...&gt;</code>, as in IEx. The expected result should start at the next line after <code class="language-plaintext highlighter-rouge">iex&gt;</code> or <code class="language-plaintext highlighter-rouge">...&gt;</code> line(s) and is terminated either by a newline or a new <code class="language-plaintext highlighter-rouge">iex&gt;</code> prefix.</p>

<p>Also, note that we started the documentation string using <code class="language-plaintext highlighter-rouge">@doc ~S"""</code>. The <code class="language-plaintext highlighter-rouge">~S</code> prevents the <code class="language-plaintext highlighter-rouge">\r\n</code> characters from being converted to a carriage return and line feed until they are evaluated in the test.</p>

<p>To run our doctests, we’ll create a file at <code class="language-plaintext highlighter-rouge">test/kv_server/command_test.exs</code> and call <code class="language-plaintext highlighter-rouge">doctest KVServer.Command</code> in the test case:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KVServer</span><span class="o">.</span><span class="no">CommandTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ExUnit</span><span class="o">.</span><span class="no">Case</span><span class="p">,</span> <span class="ss">async:</span> <span class="no">true</span>
  <span class="n">doctest</span> <span class="no">KVServer</span><span class="o">.</span><span class="no">Command</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Run the test suite and the doctest should fail:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  1) doctest KVServer.Command.parse/1 (1) (KVServer.CommandTest)
     test/kv_server/command_test.exs:3
     Doctest failed
     doctest:
       iex&gt; KVServer.Command.parse("CREATE shopping\r\n")
       {:ok, {:create, "shopping"}}
     code: KVServer.Command.parse "CREATE shopping\r\n" === {:ok, {:create, "shopping"}}
     left:  :not_implemented
     right: {:ok, {:create, "shopping"}}
     stacktrace:
       lib/kv_server/command.ex:7: KVServer.Command (module)
</code></pre></div></div>

<p>Excellent!</p>

<p>Now let’s make the doctest pass. Let’s implement the <code class="language-plaintext highlighter-rouge">parse/1</code> function:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">parse</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">do</span>
  <span class="k">case</span> <span class="no">String</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">[</span><span class="s2">"CREATE"</span><span class="p">,</span> <span class="n">bucket</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="p">{</span><span class="ss">:create</span><span class="p">,</span> <span class="n">bucket</span><span class="p">}}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Our implementation splits the line on whitespace and then matches the command against a list. Using <code class="language-plaintext highlighter-rouge">String.split/1</code> means our commands will be whitespace-insensitive. Leading and trailing whitespace won’t matter, nor will consecutive spaces between words. Let’s add some new doctests to test this behaviour along with the other commands:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">@doc</span> <span class="sx">~S""</span><span class="s2">"
Parses the given `line` into a command.

## Examples

    iex&gt; KVServer.Command.parse "</span><span class="no">CREATE</span> <span class="n">shopping</span><span class="p">\</span><span class="n">r</span><span class="p">\</span><span class="n">n</span><span class="s2">"
    {:ok, {:create, "</span><span class="n">shopping</span><span class="s2">"}}

    iex&gt; KVServer.Command.parse "</span><span class="no">CREATE</span>  <span class="n">shopping</span>  <span class="p">\</span><span class="n">r</span><span class="p">\</span><span class="n">n</span><span class="s2">"
    {:ok, {:create, "</span><span class="n">shopping</span><span class="s2">"}}

    iex&gt; KVServer.Command.parse "</span><span class="no">PUT</span> <span class="n">shopping</span> <span class="n">milk</span> <span class="mi">1</span><span class="p">\</span><span class="n">r</span><span class="p">\</span><span class="n">n</span><span class="s2">"
    {:ok, {:put, "</span><span class="n">shopping</span><span class="s2">", "</span><span class="n">milk</span><span class="s2">", "</span><span class="mi">1</span><span class="s2">"}}

    iex&gt; KVServer.Command.parse "</span><span class="no">GET</span> <span class="n">shopping</span> <span class="n">milk</span><span class="p">\</span><span class="n">r</span><span class="p">\</span><span class="n">n</span><span class="s2">"
    {:ok, {:get, "</span><span class="n">shopping</span><span class="s2">", "</span><span class="n">milk</span><span class="s2">"}}

    iex&gt; KVServer.Command.parse "</span><span class="no">DELETE</span> <span class="n">shopping</span> <span class="n">eggs</span><span class="p">\</span><span class="n">r</span><span class="p">\</span><span class="n">n</span><span class="s2">"
    {:ok, {:delete, "</span><span class="n">shopping</span><span class="s2">", "</span><span class="n">eggs</span><span class="s2">"}}

Unknown commands or commands with the wrong number of
arguments return an error:

    iex&gt; KVServer.Command.parse "</span><span class="no">UNKNOWN</span> <span class="n">shopping</span> <span class="n">eggs</span><span class="p">\</span><span class="n">r</span><span class="p">\</span><span class="n">n</span><span class="s2">"
    {:error, :unknown_command}

    iex&gt; KVServer.Command.parse "</span><span class="no">GET</span> <span class="n">shopping</span><span class="p">\</span><span class="n">r</span><span class="p">\</span><span class="n">n</span><span class="s2">"
    {:error, :unknown_command}

"""</span>
</code></pre></div></div>

<p>With doctests at hand, it is your turn to make tests pass! Once you’re ready, you can compare your work with our solution below:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">parse</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">do</span>
  <span class="k">case</span> <span class="no">String</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">[</span><span class="s2">"CREATE"</span><span class="p">,</span> <span class="n">bucket</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="p">{</span><span class="ss">:create</span><span class="p">,</span> <span class="n">bucket</span><span class="p">}}</span>
    <span class="p">[</span><span class="s2">"GET"</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="p">{</span><span class="ss">:get</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">}}</span>
    <span class="p">[</span><span class="s2">"PUT"</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="p">{</span><span class="ss">:put</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">}}</span>
    <span class="p">[</span><span class="s2">"DELETE"</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="p">{</span><span class="ss">:delete</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">}}</span>
    <span class="n">_</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="ss">:unknown_command</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Notice how we were able to elegantly parse the commands without adding a bunch of <code class="language-plaintext highlighter-rouge">if/else</code> clauses that check the command name and number of arguments!</p>

<p>Finally, you may have observed that each doctest corresponds to a different test in our suite, which now reports a total of 7 doctests. That is because ExUnit considers the following to define two different doctests:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">KVServer</span><span class="o">.</span><span class="no">Command</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">"UNKNOWN shopping eggs</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="ss">:unknown_command</span><span class="p">}</span>

<span class="n">iex</span><span class="o">&gt;</span> <span class="no">KVServer</span><span class="o">.</span><span class="no">Command</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">"GET shopping</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="ss">:unknown_command</span><span class="p">}</span>
</code></pre></div></div>

<p>Without new lines, as seen below, ExUnit compiles it into a single doctest:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">KVServer</span><span class="o">.</span><span class="no">Command</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">"UNKNOWN shopping eggs</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="ss">:unknown_command</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">KVServer</span><span class="o">.</span><span class="no">Command</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">"GET shopping</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="ss">:unknown_command</span><span class="p">}</span>
</code></pre></div></div>

<p>As the name says, doctest is documentation first and a test later. Their goal is not to replace tests but to provide up to date documentation. You can read more about doctests in <a href="https://hexdocs.pm/ex_unit/ExUnit.DocTest.html">the <code class="language-plaintext highlighter-rouge">ExUnit.DocTest</code> docs</a>.</p>

<h2 id="with" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">with</span><a href="#with" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>As we are now able to parse commands, we can finally start implementing the logic that runs the commands. Let’s add a stub definition for this function for now:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KVServer</span><span class="o">.</span><span class="no">Command</span> <span class="k">do</span>
  <span class="nv">@doc</span> <span class="sd">"""
  Runs the given command.
  """</span>
  <span class="k">def</span> <span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"OK</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Before we implement this function, let’s change our server to start using our new <code class="language-plaintext highlighter-rouge">parse/1</code> and <code class="language-plaintext highlighter-rouge">run/1</code> functions. Remember, our <code class="language-plaintext highlighter-rouge">read_line/1</code> function was also crashing when the client closed the socket, so let’s take the opportunity to fix it, too. Open up <code class="language-plaintext highlighter-rouge">lib/kv_server.ex</code> and replace the existing server definition:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defp</span> <span class="n">serve</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">socket</span>
  <span class="o">|&gt;</span> <span class="n">read_line</span><span class="p">()</span>
  <span class="o">|&gt;</span> <span class="n">write_line</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>

  <span class="n">serve</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">defp</span> <span class="n">read_line</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
  <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">data</span><span class="p">}</span> <span class="o">=</span> <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  <span class="n">data</span>
<span class="k">end</span>

<span class="k">defp</span> <span class="n">write_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
  <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>by the following:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defp</span> <span class="n">serve</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">msg</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">read_line</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
      <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">data</span><span class="p">}</span> <span class="o">-&gt;</span>
        <span class="k">case</span> <span class="no">KVServer</span><span class="o">.</span><span class="no">Command</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">do</span>
          <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">command</span><span class="p">}</span> <span class="o">-&gt;</span>
            <span class="no">KVServer</span><span class="o">.</span><span class="no">Command</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
          <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="n">_</span><span class="p">}</span> <span class="o">=</span> <span class="n">err</span> <span class="o">-&gt;</span>
            <span class="n">err</span>
        <span class="k">end</span>
      <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="n">_</span><span class="p">}</span> <span class="o">=</span> <span class="n">err</span> <span class="o">-&gt;</span>
        <span class="n">err</span>
    <span class="k">end</span>

  <span class="n">write_line</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
  <span class="n">serve</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">defp</span> <span class="n">read_line</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
  <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">defp</span> <span class="n">write_line</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">text</span><span class="p">})</span> <span class="k">do</span>
  <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">defp</span> <span class="n">write_line</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="ss">:unknown_command</span><span class="p">})</span> <span class="k">do</span>
  <span class="c1"># Known error; write to the client</span>
  <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="s2">"UNKNOWN COMMAND</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">defp</span> <span class="n">write_line</span><span class="p">(</span><span class="n">_socket</span><span class="p">,</span> <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="ss">:closed</span><span class="p">})</span> <span class="k">do</span>
  <span class="c1"># The connection was closed, exit politely</span>
  <span class="k">exit</span><span class="p">(</span><span class="ss">:shutdown</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">defp</span> <span class="n">write_line</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="n">error</span><span class="p">})</span> <span class="k">do</span>
  <span class="c1"># Unknown error; write to the client and exit</span>
  <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="s2">"ERROR</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">)</span>
  <span class="k">exit</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>If we start our server, we can now send commands to it. For now, we will get two different responses: “OK” when the command is known and “UNKNOWN COMMAND” otherwise:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>telnet 127.0.0.1 4040
<span class="go">Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
CREATE shopping
OK
HELLO
UNKNOWN COMMAND
</span></code></pre></div></div>

<p>This means our implementation is going in the correct direction, but it doesn’t look very elegant, does it?</p>

<p>The previous implementation used pipelines which made the logic straightforward to follow. However, now that we need to handle different error codes along the way, our server logic is nested inside many <code class="language-plaintext highlighter-rouge">case</code> calls.</p>

<p>Thankfully, Elixir v1.2 introduced the <code class="language-plaintext highlighter-rouge">with</code> construct, which allows you to simplify code like the above, replacing nested <code class="language-plaintext highlighter-rouge">case</code> calls with a chain of matching clauses. Let’s rewrite the <code class="language-plaintext highlighter-rouge">serve/1</code> function to use <code class="language-plaintext highlighter-rouge">with</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defp</span> <span class="n">serve</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">msg</span> <span class="o">=</span>
    <span class="n">with</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">data</span><span class="p">}</span> <span class="o">&lt;-</span> <span class="n">read_line</span><span class="p">(</span><span class="n">socket</span><span class="p">),</span>
         <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">command</span><span class="p">}</span> <span class="o">&lt;-</span> <span class="no">KVServer</span><span class="o">.</span><span class="no">Command</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
         <span class="k">do</span><span class="p">:</span> <span class="no">KVServer</span><span class="o">.</span><span class="no">Command</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

  <span class="n">write_line</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
  <span class="n">serve</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Much better! <code class="language-plaintext highlighter-rouge">with</code> will retrieve the value returned by the right-side of <code class="language-plaintext highlighter-rouge">&lt;-</code> and match it against the pattern on the left side. If the value matches the pattern, <code class="language-plaintext highlighter-rouge">with</code> moves on to the next expression. In case there is no match, the non-matching value is returned.</p>

<p>In other words, we converted each expression given to <code class="language-plaintext highlighter-rouge">case/2</code> as a step in <code class="language-plaintext highlighter-rouge">with</code>. As soon as any of the steps return something that does not match <code class="language-plaintext highlighter-rouge">{:ok, x}</code>, <code class="language-plaintext highlighter-rouge">with</code> aborts, and returns the non-matching value.</p>

<p>You can read more about <a href="https://hexdocs.pm/elixir/Kernel.SpecialForms.html#with/1"><code class="language-plaintext highlighter-rouge">with</code> in our documentation</a>.</p>

<h2 id="running-commands" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Running commands</span><a href="#running-commands" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>The last step is to implement <code class="language-plaintext highlighter-rouge">KVServer.Command.run/1</code>, to run the parsed commands against the <code class="language-plaintext highlighter-rouge">:kv</code> application. Its implementation is shown below:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">@doc</span> <span class="sd">"""
Runs the given command.
"""</span>
<span class="k">def</span> <span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

<span class="k">def</span> <span class="n">run</span><span class="p">({</span><span class="ss">:create</span><span class="p">,</span> <span class="n">bucket</span><span class="p">})</span> <span class="k">do</span>
  <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="n">bucket</span><span class="p">)</span>
  <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"OK</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">}</span>
<span class="k">end</span>

<span class="k">def</span> <span class="n">run</span><span class="p">({</span><span class="ss">:get</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">})</span> <span class="k">do</span>
  <span class="n">lookup</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="k">fn</span> <span class="n">pid</span> <span class="o">-&gt;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"</span><span class="si">#{</span><span class="n">value</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">OK</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">}</span>
  <span class="k">end</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="n">run</span><span class="p">({</span><span class="ss">:put</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">})</span> <span class="k">do</span>
  <span class="n">lookup</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="k">fn</span> <span class="n">pid</span> <span class="o">-&gt;</span>
    <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"OK</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">}</span>
  <span class="k">end</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="n">run</span><span class="p">({</span><span class="ss">:delete</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">})</span> <span class="k">do</span>
  <span class="n">lookup</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="k">fn</span> <span class="n">pid</span> <span class="o">-&gt;</span>
    <span class="no">KV</span><span class="o">.</span><span class="no">Bucket</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"OK</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">}</span>
  <span class="k">end</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">defp</span> <span class="n">lookup</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span> <span class="k">do</span>
  <span class="k">case</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="n">bucket</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">pid</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="n">callback</span><span class="o">.</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    <span class="ss">:error</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="ss">:not_found</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Every function clause dispatches the appropriate command to the <code class="language-plaintext highlighter-rouge">KV.Registry</code> server that we registered during the <code class="language-plaintext highlighter-rouge">:kv</code> application startup. Since our <code class="language-plaintext highlighter-rouge">:kv_server</code> depends on the <code class="language-plaintext highlighter-rouge">:kv</code> application, it is completely fine to depend on the services it provides.</p>

<p>You might have noticed we have a function head, <code class="language-plaintext highlighter-rouge">def run(command)</code>, without a body. In the <a href="/getting-started/modules-and-functions#default-arguments">Modules and Functions</a> chapter, we learned that a bodiless function can be used to declare default arguments for a multi-clause function. Here is another use case where we use a function without a body to document what the arguments are.</p>

<p>Note that we have also defined a private function named <code class="language-plaintext highlighter-rouge">lookup/2</code> to help with the common functionality of looking up a bucket and returning its <code class="language-plaintext highlighter-rouge">pid</code> if it exists, <code class="language-plaintext highlighter-rouge">{:error, :not_found}</code> otherwise.</p>

<p>By the way, since we are now returning <code class="language-plaintext highlighter-rouge">{:error, :not_found}</code>, we should amend the <code class="language-plaintext highlighter-rouge">write_line/2</code> function in <code class="language-plaintext highlighter-rouge">KVServer</code> to print such error as well:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defp</span> <span class="n">write_line</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="ss">:not_found</span><span class="p">})</span> <span class="k">do</span>
  <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="s2">"NOT FOUND</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Our server functionality is almost complete. Only tests are missing. This time, we have left tests for last because there are some important considerations to be made.</p>

<p><code class="language-plaintext highlighter-rouge">KVServer.Command.run/1</code>’s implementation is sending commands directly to the server named <code class="language-plaintext highlighter-rouge">KV.Registry</code>, which is registered by the <code class="language-plaintext highlighter-rouge">:kv</code> application. This means this server is global and if we have two tests sending messages to it at the same time, our tests will conflict with each other (and likely fail). We need to decide between having unit tests that are isolated and can run asynchronously, or writing integration tests that work on top of the global state, but exercise our application’s full stack as it is meant to be exercised in production.</p>

<p>So far we have only written unit tests, typically testing a single module directly. However, in order to make <code class="language-plaintext highlighter-rouge">KVServer.Command.run/1</code> testable as a unit we would need to change its implementation to not send commands directly to the <code class="language-plaintext highlighter-rouge">KV.Registry</code> process but instead pass a server as an argument. For example, we would need to change <code class="language-plaintext highlighter-rouge">run</code>’s signature to <code class="language-plaintext highlighter-rouge">def run(command, pid)</code> and then change all clauses accordingly:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">run</span><span class="p">({</span><span class="ss">:create</span><span class="p">,</span> <span class="n">bucket</span><span class="p">},</span> <span class="n">pid</span><span class="p">)</span> <span class="k">do</span>
  <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">bucket</span><span class="p">)</span>
  <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"OK</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">}</span>
<span class="k">end</span>

<span class="c1"># ... other run clauses ...</span>
</code></pre></div></div>

<p>Feel free to go ahead and do the changes above and write some unit tests. The idea is that your tests will start an instance of the <code class="language-plaintext highlighter-rouge">KV.Registry</code> and pass it as an argument to <code class="language-plaintext highlighter-rouge">run/2</code> instead of relying on the global <code class="language-plaintext highlighter-rouge">KV.Registry</code>. This has the advantage of keeping our tests asynchronous as there is no shared state.</p>

<p>But let’s also try something different. Let’s write integration tests that rely on the global server names to exercise the whole stack from the TCP server to the bucket. Our integration tests will rely on global state and must be synchronous. With integration tests, we get coverage on how the components in our application work together at the cost of test performance. They are typically used to test the main flows in your application. For example, we should avoid using integration tests to test an edge case in our command parsing implementation.</p>

<p>Our integration test will use a TCP client that sends commands to our server and assert we are getting the desired responses.</p>

<p>Let’s implement the integration test in <code class="language-plaintext highlighter-rouge">test/kv_server_test.exs</code> as shown below:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KVServerTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ExUnit</span><span class="o">.</span><span class="no">Case</span>

  <span class="n">setup</span> <span class="k">do</span>
    <span class="no">Application</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="ss">:kv</span><span class="p">)</span>
    <span class="ss">:ok</span> <span class="o">=</span> <span class="no">Application</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="ss">:kv</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">setup</span> <span class="k">do</span>
    <span class="n">opts</span> <span class="o">=</span> <span class="p">[</span><span class="ss">:binary</span><span class="p">,</span> <span class="ss">packet:</span> <span class="ss">:line</span><span class="p">,</span> <span class="ss">active:</span> <span class="no">false</span><span class="p">]</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span> <span class="o">=</span> <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="mi">4040</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
    <span class="p">%{</span><span class="ss">socket:</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="n">test</span> <span class="s2">"server interaction"</span><span class="p">,</span> <span class="p">%{</span><span class="ss">socket:</span> <span class="n">socket</span><span class="p">}</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="n">send_and_recv</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="s2">"UNKNOWN shopping</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">)</span> <span class="o">==</span>
           <span class="s2">"UNKNOWN COMMAND</span><span class="se">\r\n</span><span class="s2">"</span>

    <span class="n">assert</span> <span class="n">send_and_recv</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="s2">"GET shopping eggs</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">)</span> <span class="o">==</span>
           <span class="s2">"NOT FOUND</span><span class="se">\r\n</span><span class="s2">"</span>

    <span class="n">assert</span> <span class="n">send_and_recv</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="s2">"CREATE shopping</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">)</span> <span class="o">==</span>
           <span class="s2">"OK</span><span class="se">\r\n</span><span class="s2">"</span>

    <span class="n">assert</span> <span class="n">send_and_recv</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="s2">"PUT shopping eggs 3</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">)</span> <span class="o">==</span>
           <span class="s2">"OK</span><span class="se">\r\n</span><span class="s2">"</span>

    <span class="c1"># GET returns two lines</span>
    <span class="n">assert</span> <span class="n">send_and_recv</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="s2">"GET shopping eggs</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"3</span><span class="se">\r\n</span><span class="s2">"</span>
    <span class="n">assert</span> <span class="n">send_and_recv</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"OK</span><span class="se">\r\n</span><span class="s2">"</span>

    <span class="n">assert</span> <span class="n">send_and_recv</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="s2">"DELETE shopping eggs</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">)</span> <span class="o">==</span>
           <span class="s2">"OK</span><span class="se">\r\n</span><span class="s2">"</span>

    <span class="c1"># GET returns two lines</span>
    <span class="n">assert</span> <span class="n">send_and_recv</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="s2">"GET shopping eggs</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"</span><span class="se">\r\n</span><span class="s2">"</span>
    <span class="n">assert</span> <span class="n">send_and_recv</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"OK</span><span class="se">\r\n</span><span class="s2">"</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">send_and_recv</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span> <span class="k">do</span>
    <span class="ss">:ok</span> <span class="o">=</span> <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">data</span><span class="p">}</span> <span class="o">=</span> <span class="ss">:gen_tcp</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">data</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Our integration test checks all server interaction, including unknown commands and not found errors. It is worth noting that, as with <abbr title="Erlang Term Storage">ETS</abbr> tables and linked processes, there is no need to close the socket. Once the test process exits, the socket is automatically closed.</p>

<p>This time, since our test relies on global data, we have not given <code class="language-plaintext highlighter-rouge">async: true</code> to <code class="language-plaintext highlighter-rouge">use ExUnit.Case</code>. Furthermore, in order to guarantee our test is always in a clean state, we stop and start the <code class="language-plaintext highlighter-rouge">:kv</code> application before each test. In fact, stopping the <code class="language-plaintext highlighter-rouge">:kv</code> application even prints a warning on the terminal:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>18:12:10.698 [info] Application kv exited: :stopped
</code></pre></div></div>

<p>To avoid printing log messages during tests, ExUnit provides a neat feature called <code class="language-plaintext highlighter-rouge">:capture_log</code>. By setting <code class="language-plaintext highlighter-rouge">@tag :capture_log</code> before each test or <code class="language-plaintext highlighter-rouge">@moduletag :capture_log</code> for the whole test module, ExUnit will automatically capture anything that is logged while the test runs. In case our test fails, the captured logs will be printed alongside the ExUnit report.</p>

<p>Between <code class="language-plaintext highlighter-rouge">use ExUnit.Case</code> and setup, add the following call:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">@moduletag</span> <span class="ss">:capture_log</span>
</code></pre></div></div>

<p>In case the test crashes, you will see a report as follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  1) test server interaction (KVServerTest)
     test/kv_server_test.exs:17
     ** (RuntimeError) oops
     stacktrace:
       test/kv_server_test.exs:29

     The following output was logged:

     13:44:10.035 [notice] Application kv exited: :stopped
</code></pre></div></div>

<p>With this simple integration test, we start to see why integration tests may be slow. Not only can this test not run asynchronously, but it also requires the expensive setup of stopping and starting the <code class="language-plaintext highlighter-rouge">:kv</code> application. In fact, your test suite may even fail and run into timeouts. If that’s the case, you can tweak the <code class="language-plaintext highlighter-rouge">:gen_tcp.recv(socket, 0)</code> call to pass a third argument, which is the timeout in milliseconds. In the next chapter we will learn about application configuration, which we could use to make the timeout configurable, if desired.</p>

<p>At the end of the day, it is up to you and your team to figure out the best testing strategy for your applications. You need to balance code quality, confidence, and test suite runtime. For example, we may start with testing the server only with integration tests, but if the server continues to grow in future releases, or it becomes a part of the application with frequent bugs, it is important to consider breaking it apart and writing more intensive unit tests that don’t have the weight of an integration test.</p>

<p>Let’s move to the next chapter. We will finally make our system distributed by adding a bucket routing mechanism. We will use this opportunity to also improve our testing chops.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/mix-otp/task-and-gen-tcp.html" class="previous page-numbers spec" title="Task and gen_tcp">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/mix-otp/distributed-tasks.html" class="previous page-numbers spec" title="Distributed tasks and tags">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/mix-otp/docs-tests-and-with.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/mix-otp/distributed-tasks.html" page=":10:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><span title="Distributed tasks and tags">Distributed tasks and tags</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Mix and OTP</small>
      <h1>Distributed tasks and tags</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#our-first-distributed-code">Our first distributed code</a></li><li><a href="#asyncawait">async/await</a></li><li><a href="#distributed-tasks">Distributed tasks</a></li><li><a href="#routing-layer">Routing layer</a></li><li><a href="#test-filters-and-tags">Test filters and tags</a></li><li><a href="#wiring-it-all-up">Wiring it all up</a></li><li><a href="#summing-up">Summing up</a></li></ol></div>

    <blockquote>
  <p>This chapter is part of the <i>Mix and OTP guide</i> and it depends on previous chapters in this guide.
For more information, <a href="/getting-started/mix-otp/introduction-to-mix.html">read the introduction guide</a> or check out the chapter index in the sidebar.</p>
</blockquote>

<p>In this chapter, we will go back to the <code class="language-plaintext highlighter-rouge">:kv</code> application and add a routing layer that will allow us to distribute requests between nodes based on the bucket name.</p>

<p>The routing layer will receive a routing table of the following format:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span>
  <span class="p">{</span><span class="sx">?a</span><span class="o">..</span><span class="sx">?m</span><span class="p">,</span> <span class="ss">:"foo@computer-name"</span><span class="p">},</span>
  <span class="p">{</span><span class="sx">?n</span><span class="o">..</span><span class="sx">?z</span><span class="p">,</span> <span class="ss">:"bar@computer-name"</span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div>

<p>The router will check the first byte of the bucket name against the table and dispatch to the appropriate node based on that. For example, a bucket starting with the letter “a” (<code class="language-plaintext highlighter-rouge">?a</code> represents the Unicode codepoint of the letter “a”) will be dispatched to node <code class="language-plaintext highlighter-rouge">foo@computer-name</code>.</p>

<p>If the matching entry points to the node evaluating the request, then we’ve finished routing, and this node will perform the requested operation. If the matching entry points to a different node, we’ll pass the request to said node, which will look at its own routing table (which may be different from the one in the first node) and act accordingly. If no entry matches, an error will be raised.</p>

<blockquote>
  <p>Note: we will be using two nodes in the same machine throughout this chapter. You are free to use two (or more) different machines on the same network but you need to do some prep work. First of all, you need to ensure all machines have a <code class="language-plaintext highlighter-rouge">~/.erlang.cookie</code> file with exactly the same value. Then you need to guarantee <a href="http://www.erlang.org/doc/man/epmd.html">epmd</a> is running on a port that is not blocked (you can run <code class="language-plaintext highlighter-rouge">epmd -d</code> for debug info).</p>
</blockquote>

<h2 id="our-first-distributed-code" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Our first distributed code</span><a href="#our-first-distributed-code" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir ships with facilities to connect nodes and exchange information between them. In fact, we use the same concepts of processes, message passing and receiving messages when working in a distributed environment because Elixir processes are <em>location transparent</em>. This means that when sending a message, it doesn’t matter if the recipient process is on the same node or on another node, the <abbr title="Virtual Machine">VM</abbr> will be able to deliver the message in both cases.</p>

<p>In order to run distributed code, we need to start the <abbr title="Virtual Machine">VM</abbr> with a name. The name can be short (when in the same network) or long (requires the full computer address). Let’s start a new IEx session:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>iex <span class="nt">--sname</span> foo
</code></pre></div></div>

<p>You can see now the prompt is slightly different and shows the node name followed by the computer name:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Interactive Elixir - press Ctrl+C to exit (type h() ENTER for help)
iex(foo@jv)1&gt;
</code></pre></div></div>

<p>My computer is named <code class="language-plaintext highlighter-rouge">jv</code>, so I see <code class="language-plaintext highlighter-rouge">foo@jv</code> in the example above, but you will get a different result. We will use <code class="language-plaintext highlighter-rouge">foo@computer-name</code> in the following examples and you should update them accordingly when trying out the code.</p>

<p>Let’s define a module named <code class="language-plaintext highlighter-rouge">Hello</code> in this shell:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">defmodule</span> <span class="no">Hello</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="k">def</span> <span class="n">world</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="s2">"hello world"</span>
<span class="o">...&gt;</span> <span class="k">end</span>
</code></pre></div></div>

<p>If you have another computer on the same network with both Erlang and Elixir installed, you can start another shell on it. If you don’t, you can start another IEx session in another terminal. In either case, give it the short name of <code class="language-plaintext highlighter-rouge">bar</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>iex <span class="nt">--sname</span> bar
</code></pre></div></div>

<p>Note that inside this new IEx session, we cannot access <code class="language-plaintext highlighter-rouge">Hello.world/0</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Hello</span><span class="o">.</span><span class="n">world</span>
<span class="o">**</span> <span class="p">(</span><span class="no">UndefinedFunctionError</span><span class="p">)</span> <span class="n">function</span> <span class="no">Hello</span><span class="o">.</span><span class="n">world</span><span class="o">/</span><span class="mi">0</span> <span class="n">is</span> <span class="n">undefined</span> <span class="p">(</span><span class="n">module</span> <span class="no">Hello</span> <span class="n">is</span> <span class="ow">not</span> <span class="n">available</span><span class="p">)</span>
    <span class="no">Hello</span><span class="o">.</span><span class="n">world</span><span class="p">()</span>
</code></pre></div></div>

<p>However, we can spawn a new process on <code class="language-plaintext highlighter-rouge">foo@computer-name</code> from <code class="language-plaintext highlighter-rouge">bar@computer-name</code>! Let’s give it a try (where <code class="language-plaintext highlighter-rouge">@computer-name</code> is the one you see locally):</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Node</span><span class="o">.</span><span class="n">spawn_link</span><span class="p">(</span><span class="ss">:"foo@computer-name"</span><span class="p">,</span> <span class="k">fn</span> <span class="o">-&gt;</span> <span class="no">Hello</span><span class="o">.</span><span class="n">world</span><span class="p">()</span> <span class="k">end</span><span class="p">)</span>
<span class="c1">#PID&lt;9014.59.0&gt;</span>
<span class="n">hello</span> <span class="n">world</span>
</code></pre></div></div>

<p>Elixir spawned a process on another node and returned its pid. The code then executed on the other node where the <code class="language-plaintext highlighter-rouge">Hello.world/0</code> function exists and invoked that function. Note that the result of “hello world” was printed on the current node <code class="language-plaintext highlighter-rouge">bar</code> and not on <code class="language-plaintext highlighter-rouge">foo</code>. In other words, the message to be printed was sent back from <code class="language-plaintext highlighter-rouge">foo</code> to <code class="language-plaintext highlighter-rouge">bar</code>. This happens because the process spawned on the other node (<code class="language-plaintext highlighter-rouge">foo</code>) knows all of the output should be sent back to the original node!</p>

<p>We can send and receive messages from the pid returned by <code class="language-plaintext highlighter-rouge">Node.spawn_link/2</code> as usual. Let’s try a quick ping-pong example:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">pid</span> <span class="o">=</span> <span class="no">Node</span><span class="o">.</span><span class="n">spawn_link</span><span class="p">(</span><span class="ss">:"foo@computer-name"</span><span class="p">,</span> <span class="k">fn</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>   <span class="k">receive</span> <span class="k">do</span>
<span class="o">...&gt;</span>     <span class="p">{</span><span class="ss">:ping</span><span class="p">,</span> <span class="n">client</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="n">send</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="ss">:pong</span><span class="p">)</span>
<span class="o">...&gt;</span>   <span class="k">end</span>
<span class="o">...&gt;</span> <span class="k">end</span><span class="p">)</span>
<span class="c1">#PID&lt;9014.59.0&gt;</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">send</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="p">{</span><span class="ss">:ping</span><span class="p">,</span> <span class="n">self</span><span class="p">()})</span>
<span class="p">{</span><span class="ss">:ping</span><span class="p">,</span> <span class="c1">#PID&lt;0.73.0&gt;}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">flush</span><span class="p">()</span>
<span class="ss">:pong</span>
<span class="ss">:ok</span>
</code></pre></div></div>

<p>From our quick exploration, we could conclude that we should use <code class="language-plaintext highlighter-rouge">Node.spawn_link/2</code> to spawn processes on a remote node every time we need to do a distributed computation. However, we have learned throughout this guide that spawning processes outside of supervision trees should be avoided if possible, so we need to look for other options.</p>

<p>There are three better alternatives to <code class="language-plaintext highlighter-rouge">Node.spawn_link/2</code> that we could use in our implementation:</p>

<ol>
  <li>
    <p>We could use Erlang’s <a href="http://www.erlang.org/doc/man/erpc.html">:erpc</a> module to execute functions on a remote node. Inside the <code class="language-plaintext highlighter-rouge">bar@computer-name</code> shell above, you can call <code class="language-plaintext highlighter-rouge">:erpc.call(:"foo@computer-name", Hello, :world, [])</code> and it will print “hello world”</p>
  </li>
  <li>
    <p>We could have a server running on the other node and send requests to that node via the <a href="https://hexdocs.pm/elixir/GenServer.html">GenServer</a> API. For example, you can call a server on a remote node by using <code class="language-plaintext highlighter-rouge">GenServer.call({name, node}, arg)</code> or passing the remote process PID as the first argument</p>
  </li>
  <li>
    <p>We could use <a href="https://hexdocs.pm/elixir/Task.html">tasks</a>, which we have learned about in <a href="/getting-started/mix-otp/task-and-gen-tcp.html">a previous chapter</a>, as they can be spawned on both local and remote nodes</p>
  </li>
</ol>

<p>The options above have different properties. The GenServer would serialize your requests on a single server, while tasks are effectively running asynchronously on the remote node, with the only serialization point being the spawning done by the supervisor.</p>

<p>For our routing layer, we are going to use tasks, but feel free to explore the other alternatives too.</p>

<h2 id="asyncawait" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">async/await</span><a href="#asyncawait" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>So far we have explored tasks that are started and run in isolation, without regard to their return value. However, sometimes it is useful to run a task to compute a value and read its result later on. For this, tasks also provide the <code class="language-plaintext highlighter-rouge">async/await</code> pattern:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">task</span> <span class="o">=</span> <span class="no">Task</span><span class="o">.</span><span class="n">async</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span> <span class="n">compute_something_expensive</span><span class="p">()</span> <span class="k">end</span><span class="p">)</span>
<span class="n">res</span>  <span class="o">=</span> <span class="n">compute_something_else</span><span class="p">()</span>
<span class="n">res</span> <span class="o">+</span> <span class="no">Task</span><span class="o">.</span><span class="n">await</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">async/await</code> provides a very simple mechanism to compute values concurrently. Not only that, <code class="language-plaintext highlighter-rouge">async/await</code> can also be used with the same <a href="https://hexdocs.pm/elixir/Task.Supervisor.html"><code class="language-plaintext highlighter-rouge">Task.Supervisor</code></a> we have used in previous chapters. We just need to call <code class="language-plaintext highlighter-rouge">Task.Supervisor.async/2</code> instead of <code class="language-plaintext highlighter-rouge">Task.Supervisor.start_child/2</code> and use <code class="language-plaintext highlighter-rouge">Task.await/2</code> to read the result later on.</p>

<h2 id="distributed-tasks" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Distributed tasks</span><a href="#distributed-tasks" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Distributed tasks are exactly the same as supervised tasks. The only difference is that we pass the node name when spawning the task on the supervisor. Open up <code class="language-plaintext highlighter-rouge">lib/kv/supervisor.ex</code> from the <code class="language-plaintext highlighter-rouge">:kv</code> application. Let’s add a task supervisor as the last child of the tree:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="no">Task</span><span class="o">.</span><span class="no">Supervisor</span><span class="p">,</span> <span class="ss">name:</span> <span class="no">KV</span><span class="o">.</span><span class="no">RouterTasks</span><span class="p">},</span>
</code></pre></div></div>

<p>Now, let’s start two named nodes again, but inside the <code class="language-plaintext highlighter-rouge">:kv</code> application:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>iex <span class="nt">--sname</span> foo <span class="nt">-S</span> mix
<span class="gp">$</span><span class="w"> </span>iex <span class="nt">--sname</span> bar <span class="nt">-S</span> mix
</code></pre></div></div>

<p>From inside <code class="language-plaintext highlighter-rouge">bar@computer-name</code>, we can now spawn a task directly on the other node via the supervisor:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">task</span> <span class="o">=</span> <span class="no">Task</span><span class="o">.</span><span class="no">Supervisor</span><span class="o">.</span><span class="n">async</span><span class="p">({</span><span class="no">KV</span><span class="o">.</span><span class="no">RouterTasks</span><span class="p">,</span> <span class="ss">:"foo@computer-name"</span><span class="p">},</span> <span class="k">fn</span> <span class="o">-&gt;</span>
<span class="o">...&gt;</span>   <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">node</span><span class="p">()}</span>
<span class="o">...&gt;</span> <span class="k">end</span><span class="p">)</span>
<span class="p">%</span><span class="no">Task</span><span class="p">{</span>
  <span class="ss">mfa:</span> <span class="p">{</span><span class="ss">:erlang</span><span class="p">,</span> <span class="ss">:apply</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span>
  <span class="ss">owner:</span> <span class="c1">#PID&lt;0.122.0&gt;,</span>
  <span class="ss">pid:</span> <span class="c1">#PID&lt;12467.88.0&gt;,</span>
  <span class="ss">ref:</span> <span class="c1">#Reference&lt;0.0.0.400&gt;</span>
<span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Task</span><span class="o">.</span><span class="n">await</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="ss">:"foo@computer-name"</span><span class="p">}</span>
</code></pre></div></div>

<p>Our first distributed task retrieves the name of the node the task is running on. Notice we have given an anonymous function to <code class="language-plaintext highlighter-rouge">Task.Supervisor.async/2</code> but, in distributed cases, it is preferable to give the module, function, and arguments explicitly:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">task</span> <span class="o">=</span> <span class="no">Task</span><span class="o">.</span><span class="no">Supervisor</span><span class="o">.</span><span class="n">async</span><span class="p">({</span><span class="no">KV</span><span class="o">.</span><span class="no">RouterTasks</span><span class="p">,</span> <span class="ss">:"foo@computer-name"</span><span class="p">},</span> <span class="no">Kernel</span><span class="p">,</span> <span class="ss">:node</span><span class="p">,</span> <span class="p">[])</span>
<span class="p">%</span><span class="no">Task</span><span class="p">{</span>
  <span class="ss">mfa:</span> <span class="p">{</span><span class="no">Kernel</span><span class="p">,</span> <span class="ss">:node</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
  <span class="ss">owner:</span> <span class="c1">#PID&lt;0.122.0&gt;,</span>
  <span class="ss">pid:</span> <span class="c1">#PID&lt;12467.89.0&gt;,</span>
  <span class="ss">ref:</span> <span class="c1">#Reference&lt;0.0.0.404&gt;</span>
<span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Task</span><span class="o">.</span><span class="n">await</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
<span class="ss">:"foo@computer-name"</span>
</code></pre></div></div>

<p>The difference is that anonymous functions require the target node to have exactly the same code version as the caller. Using module, function, and arguments is more robust because you only need to find a function with matching arity in the given module.</p>

<p>With this knowledge in hand, let’s finally write the routing code.</p>

<h2 id="routing-layer" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Routing layer</span><a href="#routing-layer" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Create a file at <code class="language-plaintext highlighter-rouge">lib/kv/router.ex</code> with the following contents:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KV</span><span class="o">.</span><span class="no">Router</span> <span class="k">do</span>
  <span class="nv">@doc</span> <span class="sd">"""
  Dispatch the given `mod`, `fun`, `args` request
  to the appropriate node based on the `bucket`.
  """</span>
  <span class="k">def</span> <span class="n">route</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">mod</span><span class="p">,</span> <span class="n">fun</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># Get the first byte of the binary</span>
    <span class="n">first</span> <span class="o">=</span> <span class="ss">:binary</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>

    <span class="c1"># Try to find an entry in the table() or raise</span>
    <span class="n">entry</span> <span class="o">=</span>
      <span class="no">Enum</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">table</span><span class="p">(),</span> <span class="k">fn</span> <span class="p">{</span><span class="n">enum</span><span class="p">,</span> <span class="n">_node</span><span class="p">}</span> <span class="o">-&gt;</span>
        <span class="n">first</span> <span class="ow">in</span> <span class="n">enum</span>
      <span class="k">end</span><span class="p">)</span> <span class="o">||</span> <span class="n">no_entry_error</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>

    <span class="c1"># If the entry node is the current node</span>
    <span class="k">if</span> <span class="n">elem</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">node</span><span class="p">()</span> <span class="k">do</span>
      <span class="n">apply</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">fun</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="p">{</span><span class="no">KV</span><span class="o">.</span><span class="no">RouterTasks</span><span class="p">,</span> <span class="n">elem</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="mi">1</span><span class="p">)}</span>
      <span class="o">|&gt;</span> <span class="no">Task</span><span class="o">.</span><span class="no">Supervisor</span><span class="o">.</span><span class="n">async</span><span class="p">(</span><span class="no">KV</span><span class="o">.</span><span class="no">Router</span><span class="p">,</span> <span class="ss">:route</span><span class="p">,</span> <span class="p">[</span><span class="n">bucket</span><span class="p">,</span> <span class="n">mod</span><span class="p">,</span> <span class="n">fun</span><span class="p">,</span> <span class="n">args</span><span class="p">])</span>
      <span class="o">|&gt;</span> <span class="no">Task</span><span class="o">.</span><span class="n">await</span><span class="p">()</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">no_entry_error</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">raise</span> <span class="s2">"could not find entry for </span><span class="si">#{</span><span class="n">inspect</span> <span class="n">bucket</span><span class="si">}</span><span class="s2"> in table </span><span class="si">#{</span><span class="n">inspect</span> <span class="n">table</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>

  <span class="nv">@doc</span> <span class="sd">"""
  The routing table.
  """</span>
  <span class="k">def</span> <span class="n">table</span> <span class="k">do</span>
    <span class="c1"># Replace computer-name with your local machine name</span>
    <span class="p">[{</span><span class="sx">?a</span><span class="o">..</span><span class="sx">?m</span><span class="p">,</span> <span class="ss">:"foo@computer-name"</span><span class="p">},</span> <span class="p">{</span><span class="sx">?n</span><span class="o">..</span><span class="sx">?z</span><span class="p">,</span> <span class="ss">:"bar@computer-name"</span><span class="p">}]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Let’s write a test to verify our router works. Create a file named <code class="language-plaintext highlighter-rouge">test/kv/router_test.exs</code> containing:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KV</span><span class="o">.</span><span class="no">RouterTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ExUnit</span><span class="o">.</span><span class="no">Case</span><span class="p">,</span> <span class="ss">async:</span> <span class="no">true</span>

  <span class="n">test</span> <span class="s2">"route requests across nodes"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="no">KV</span><span class="o">.</span><span class="no">Router</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">,</span> <span class="no">Kernel</span><span class="p">,</span> <span class="ss">:node</span><span class="p">,</span> <span class="p">[])</span> <span class="o">==</span>
             <span class="ss">:"foo@computer-name"</span>
    <span class="n">assert</span> <span class="no">KV</span><span class="o">.</span><span class="no">Router</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">"world"</span><span class="p">,</span> <span class="no">Kernel</span><span class="p">,</span> <span class="ss">:node</span><span class="p">,</span> <span class="p">[])</span> <span class="o">==</span>
             <span class="ss">:"bar@computer-name"</span>
  <span class="k">end</span>

  <span class="n">test</span> <span class="s2">"raises on unknown entries"</span> <span class="k">do</span>
    <span class="n">assert_raise</span> <span class="no">RuntimeError</span><span class="p">,</span> <span class="sr">~r/could not find entry/</span><span class="p">,</span> <span class="k">fn</span> <span class="o">-&gt;</span>
      <span class="no">KV</span><span class="o">.</span><span class="no">Router</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="mi">0</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="no">Kernel</span><span class="p">,</span> <span class="ss">:node</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The first test invokes <code class="language-plaintext highlighter-rouge">Kernel.node/0</code>, which returns the name of the current node, based on the bucket names “hello” and “world”. According to our routing table so far, we should get <code class="language-plaintext highlighter-rouge">foo@computer-name</code> and <code class="language-plaintext highlighter-rouge">bar@computer-name</code> as responses, respectively.</p>

<p>The second test checks that the code raises for unknown entries.</p>

<p>In order to run the first test, we need to have two nodes running. Move into <code class="language-plaintext highlighter-rouge">apps/kv</code> and let’s restart the node named <code class="language-plaintext highlighter-rouge">bar</code> which is going to be used by tests.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>iex <span class="nt">--sname</span> bar <span class="nt">-S</span> mix
</code></pre></div></div>

<p>And now run tests with:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>elixir <span class="nt">--sname</span> foo <span class="nt">-S</span> mix <span class="nb">test</span>
</code></pre></div></div>

<p>The test should pass.</p>

<h2 id="test-filters-and-tags" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Test filters and tags</span><a href="#test-filters-and-tags" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Although our tests pass, our testing structure is getting more complex. In particular, running tests with only <code class="language-plaintext highlighter-rouge">mix test</code> causes failures in our suite, since our test requires a connection to another node.</p>

<p>Luckily, ExUnit ships with a facility to tag tests, allowing us to run specific callbacks or even filter tests altogether based on those tags. We have already used the <code class="language-plaintext highlighter-rouge">:capture_log</code> tag in the previous chapter, which has its semantics specified by ExUnit itself.</p>

<p>This time let’s add a <code class="language-plaintext highlighter-rouge">:distributed</code> tag to <code class="language-plaintext highlighter-rouge">test/kv/router_test.exs</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">@tag</span> <span class="ss">:distributed</span>
<span class="n">test</span> <span class="s2">"route requests across nodes"</span> <span class="k">do</span>
</code></pre></div></div>

<p>Writing <code class="language-plaintext highlighter-rouge">@tag :distributed</code> is equivalent to writing <code class="language-plaintext highlighter-rouge">@tag distributed: true</code>.</p>

<p>With the test properly tagged, we can now check if the node is alive on the network and, if not, we can exclude all distributed tests. Open up <code class="language-plaintext highlighter-rouge">test/test_helper.exs</code> inside the <code class="language-plaintext highlighter-rouge">:kv</code> application and add the following:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">exclude</span> <span class="o">=</span>
  <span class="k">if</span> <span class="no">Node</span><span class="o">.</span><span class="n">alive?</span><span class="p">(),</span> <span class="k">do</span><span class="p">:</span> <span class="p">[],</span> <span class="k">else</span><span class="p">:</span> <span class="p">[</span><span class="ss">distributed:</span> <span class="no">true</span><span class="p">]</span>

<span class="no">ExUnit</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="ss">exclude:</span> <span class="n">exclude</span><span class="p">)</span>
</code></pre></div></div>

<p>Now run tests with <code class="language-plaintext highlighter-rouge">mix test</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>mix <span class="nb">test</span>
<span class="go">Excluding tags: [distributed: true]

</span><span class="c">.......
</span><span class="go">
Finished in 0.05 seconds
9 tests, 0 failures, 1 excluded
</span></code></pre></div></div>

<p>This time all tests passed and ExUnit warned us that distributed tests were being excluded. If you run tests with <code class="language-plaintext highlighter-rouge">$ elixir --sname foo -S mix test</code>, one extra test should run and successfully pass as long as the <code class="language-plaintext highlighter-rouge">bar@computer-name</code> node is available.</p>

<p>The <code class="language-plaintext highlighter-rouge">mix test</code> command also allows us to dynamically include and exclude tags. For example, we can run <code class="language-plaintext highlighter-rouge">$ mix test --include distributed</code> to run distributed tests regardless of the value set in <code class="language-plaintext highlighter-rouge">test/test_helper.exs</code>. We could also pass <code class="language-plaintext highlighter-rouge">--exclude</code> to exclude a particular tag from the command line. Finally, <code class="language-plaintext highlighter-rouge">--only</code> can be used to run only tests with a particular tag:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>elixir <span class="nt">--sname</span> foo <span class="nt">-S</span> mix <span class="nb">test</span> <span class="nt">--only</span> distributed
</code></pre></div></div>

<p>You can read more about filters, tags and the default tags in <a href="https://hexdocs.pm/ex_unit/ExUnit.Case.html"><code class="language-plaintext highlighter-rouge">ExUnit.Case</code> module documentation</a>.</p>

<h2 id="wiring-it-all-up" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Wiring it all up</span><a href="#wiring-it-all-up" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Now with our routing system in place, let’s change <code class="language-plaintext highlighter-rouge">KVServer</code> to use the router. Replace the <code class="language-plaintext highlighter-rouge">lookup/2</code> function in <code class="language-plaintext highlighter-rouge">KVServer.Command</code> from this:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defp</span> <span class="n">lookup</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span> <span class="k">do</span>
  <span class="k">case</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="n">bucket</span><span class="p">)</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">pid</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="n">callback</span><span class="o">.</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    <span class="ss">:error</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="ss">:not_found</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>by this:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defp</span> <span class="n">lookup</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span> <span class="k">do</span>
  <span class="k">case</span> <span class="no">KV</span><span class="o">.</span><span class="no">Router</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="ss">:lookup</span><span class="p">,</span> <span class="p">[</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="n">bucket</span><span class="p">])</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">pid</span><span class="p">}</span> <span class="o">-&gt;</span> <span class="n">callback</span><span class="o">.</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
    <span class="ss">:error</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="ss">:not_found</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Instead of directly looking up the registry, we are using the router instead to match a specific node. Then we get a <code class="language-plaintext highlighter-rouge">pid</code> that can be from any process in our cluster. From now on, <code class="language-plaintext highlighter-rouge">GET</code>, <code class="language-plaintext highlighter-rouge">PUT</code> and <code class="language-plaintext highlighter-rouge">DELETE</code> requests are all routed to the appropriate node.</p>

<p>Let’s also make sure that when a new bucket is created it ends up on the correct node. Replace the <code class="language-plaintext highlighter-rouge">run/1</code> function in <code class="language-plaintext highlighter-rouge">KVServer.Command</code>, the one that matches the <code class="language-plaintext highlighter-rouge">:create</code> command, with the following:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">run</span><span class="p">({</span><span class="ss">:create</span><span class="p">,</span> <span class="n">bucket</span><span class="p">})</span> <span class="k">do</span>
  <span class="k">case</span> <span class="no">KV</span><span class="o">.</span><span class="no">Router</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="ss">:create</span><span class="p">,</span> <span class="p">[</span><span class="no">KV</span><span class="o">.</span><span class="no">Registry</span><span class="p">,</span> <span class="n">bucket</span><span class="p">])</span> <span class="k">do</span>
    <span class="n">pid</span> <span class="ow">when</span> <span class="n">is_pid</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"OK</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">}</span>
    <span class="n">_</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="ss">:error</span><span class="p">,</span> <span class="s2">"FAILED TO CREATE BUCKET"</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Now if you run the tests, you will see that an existing test that checks the server interaction will fail, as it will attempt to use the routing table. To address this failure, change the <code class="language-plaintext highlighter-rouge">test_helper.exs</code> for <code class="language-plaintext highlighter-rouge">:kv_server</code> application as we did for <code class="language-plaintext highlighter-rouge">:kv</code> and add <code class="language-plaintext highlighter-rouge">@tag :distributed</code> to this test too:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">@tag</span> <span class="ss">:distributed</span>
<span class="n">test</span> <span class="s2">"server interaction"</span><span class="p">,</span> <span class="p">%{</span><span class="ss">socket:</span> <span class="n">socket</span><span class="p">}</span> <span class="k">do</span>
</code></pre></div></div>

<p>However, keep in mind that by making the test distributed, we will likely run it less frequently, since we may not do the distributed setup on every test run. We will learn how to address this in the next chapter, by effectively learning how to make the routing table configurable.</p>

<h2 id="summing-up" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Summing up</span><a href="#summing-up" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>We have only scratched the surface of what is possible when it comes to distribution.</p>

<p>In all of our examples, we relied on Erlang’s ability to automatically connect nodes whenever there is a request. For example, when we invoked <code class="language-plaintext highlighter-rouge">Node.spawn_link(:"foo@computer-name", fn -&gt; Hello.world() end)</code>, Erlang automatically connected to said node and started a new process. However, you may also want to take a more explicit approach to connections, by using <a href="https://hexdocs.pm/elixir/Node.html#connect/1"><code class="language-plaintext highlighter-rouge">Node.connect/1</code></a> and <a href="https://hexdocs.pm/elixir/Node.html#disconnect/1"><code class="language-plaintext highlighter-rouge">Node.disconnect/1</code></a>.</p>

<p>By default, Erlang establishes a fully meshed network, which means all nodes are connected to each other. Under this topology, the Erlang distribution is known to scale to several dozens of nodes in the same cluster. Erlang also has the concept of hidden nodes, which can allow developers to assemble custom topologies as seen in projects such as <a href="https://github.com/lasp-lang/partisan">Partisan</a>.</p>

<p>In production, you may have nodes connecting and disconnecting at any time. In such scenarios, you need to provide <em>node discoverability</em>. Libraries such as <a href="https://github.com/bitwalker/libcluster/">libcluster</a> and <a href="https://github.com/mrluc/peerage">peerage</a> provide several strategies for node discoverability using DNS, Kubernetes, etc.</p>

<p>Distributed key-value stores, used in real-life, need to consider the fact nodes may go up and down at any time and also migrate the bucket across nodes. Even further, buckets often need to be duplicated between nodes, so a failure in a node does not lead to the whole bucket being lost. This process is called <em>replication</em>. Our implementation won’t attempt to tackle such problems. Instead, we assume there is a fixed number of nodes and therefore use a fixed routing table.</p>

<p>These topics can be daunting at first but remember that most Elixir frameworks abstract those concerns for you. For example, when using <a href="https://phoenixframework.org">the Phoenix web framework</a>, its plug-and-play abstractions take care of sending messages and tracking how users join and leave a cluster. However, if you are interested in distributed systems after all, there is much to explore. Here are some additional references:</p>

<ul>
  <li><a href="http://learnyousomeerlang.com/distribunomicon">The excellent Distribunomicon chapter from Learn You Some Erlang</a></li>
  <li><a href="https://www.erlang.org/doc/man/global.html">Erlang’s global module</a>, which can provide global names and global locks, allowing unique names and unique locks in a whole cluster of machines</li>
  <li><a href="https://www.erlang.org/doc/man/pg.html">Erlang’s pg module</a>, which allows process to join different groups shared across the whole cluster</li>
  <li><a href="https://github.com/phoenixframework/phoenix_pubsub">Phoenix PubSub project</a>, which provides a distributed messaging system and a distributed presence system for tracking users and processes in a cluster</li>
</ul>

<p>You will also find many libraries for building distributed systems within the overall Erlang ecosystem. For now, it is time to go back to our simple distributed key-value store and learn how to configure and package it for production.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/mix-otp/docs-tests-and-with.html" class="previous page-numbers spec" title="Doctests, patterns and with">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/mix-otp/config-and-releases.html" class="previous page-numbers spec" title="Configuration and releases">Next →</a>
            
          </div>
        
        
      
        
        
      
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/mix-otp/distributed-tasks.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/mix-otp/config-and-releases.html" page=":11:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><span title="Configuration and releases">Configuration and releases</span></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Mix and OTP</small>
      <h1>Configuration and releases</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#application-environment">Application environment</a></li><li><a href="#configuration">Configuration</a></li><li><a href="#releases">Releases</a></li><li><a href="#why-releases">Why releases?</a></li><li><a href="#assembling-multiple-releases">Assembling multiple releases</a></li><li><a href="#configuring-releases">Configuring releases</a><ol><li><a href="#operating-system-environment-configuration">Operating System environment configuration</a></li><li><a href="#vm-args">VM args</a></li></ol></li><li><a href="#summing-up">Summing up</a></li></ol></div>

    <blockquote>
  <p>This chapter is part of the <i>Mix and OTP guide</i> and it depends on previous chapters in this guide.
For more information, <a href="/getting-started/mix-otp/introduction-to-mix.html">read the introduction guide</a> or check out the chapter index in the sidebar.</p>
</blockquote>

<p>In this last chapter, we will make the routing table for our distributed key-value store configurable, and then finally package the software for production.</p>

<p>Let’s do this.</p>

<h2 id="application-environment" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Application environment</span><a href="#application-environment" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>So far we have hardcoded the routing table into the <code class="language-plaintext highlighter-rouge">KV.Router</code> module. However, we would like to make the table dynamic. This allows us not only to configure development/test/production, but also to allow different nodes to run with different entries in the routing table. There is a feature of <abbr title="Open Telecom Platform">OTP</abbr> that does exactly that: the application environment.</p>

<p>Each application has an environment that stores the application’s specific configuration by key. For example, we could store the routing table in the <code class="language-plaintext highlighter-rouge">:kv</code> application environment, giving it a default value and allowing other applications to change the table as needed.</p>

<p>Open up <code class="language-plaintext highlighter-rouge">apps/kv/mix.exs</code> and change the <code class="language-plaintext highlighter-rouge">application/0</code> function to return the following:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">application</span> <span class="k">do</span>
  <span class="p">[</span>
    <span class="ss">extra_applications:</span> <span class="p">[</span><span class="ss">:logger</span><span class="p">],</span>
    <span class="ss">env:</span> <span class="p">[</span><span class="ss">routing_table:</span> <span class="p">[]],</span>
    <span class="ss">mod:</span> <span class="p">{</span><span class="no">KV</span><span class="p">,</span> <span class="p">[]}</span>
  <span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We have added a new <code class="language-plaintext highlighter-rouge">:env</code> key to the application. It returns the application default environment, which has an entry of key <code class="language-plaintext highlighter-rouge">:routing_table</code> and value of an empty list. It makes sense for the application environment to ship with an empty table, as the specific routing table depends on the testing/deployment structure.</p>

<p>In order to use the application environment in our code, we need to replace <code class="language-plaintext highlighter-rouge">KV.Router.table/0</code> with the definition below:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">@doc</span> <span class="sd">"""
The routing table.
"""</span>
<span class="k">def</span> <span class="n">table</span> <span class="k">do</span>
  <span class="no">Application</span><span class="o">.</span><span class="n">fetch_env!</span><span class="p">(</span><span class="ss">:kv</span><span class="p">,</span> <span class="ss">:routing_table</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We use <code class="language-plaintext highlighter-rouge">Application.fetch_env!/2</code> to read the entry for <code class="language-plaintext highlighter-rouge">:routing_table</code> in <code class="language-plaintext highlighter-rouge">:kv</code>’s environment. You can find more information and other functions to manipulate the app environment in the <a href="https://hexdocs.pm/elixir/Application.html">Application module</a>.</p>

<p>Since our routing table is now empty, our distributed tests should fail. Restart the apps and re-run tests to see the failure:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>iex <span class="nt">--sname</span> bar <span class="nt">-S</span> mix
<span class="gp">$</span><span class="w"> </span>elixir <span class="nt">--sname</span> foo <span class="nt">-S</span> mix <span class="nb">test</span> <span class="nt">--only</span> distributed
</code></pre></div></div>

<p>We need a way to configure the application environment. That’s when we use configuration files.</p>

<h2 id="configuration" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Configuration</span><a href="#configuration" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Configuration files provide a mechanism for us to configure the environment of any application. Elixir provides two configuration entry points:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">config/config.exs</code> - this file is read at build time, before we compile our application and before we even load our dependencies. This means we can’t access the code in our application nor in our dependencies. However, it means we can control how they are compiled</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">config/runtime.exs</code> - this file is read after our application and dependencies are compiled and therefore it can configure how our application works at runtime. If you want to read system environment variables (via <code class="language-plaintext highlighter-rouge">System.get_env/1</code>) or any sort of external configuration, this is the appropriate place to do so</p>
  </li>
</ul>

<p>For example, we can configure IEx default prompt to another value. Let’s create the <code class="language-plaintext highlighter-rouge">config/runtime.exs</code> file with the following content:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="no">Config</span>
<span class="n">config</span> <span class="ss">:iex</span><span class="p">,</span> <span class="ss">default_prompt:</span> <span class="s2">"&gt;&gt;&gt;"</span>
</code></pre></div></div>

<p>Start IEx with <code class="language-plaintext highlighter-rouge">iex -S mix</code> and you can see that the IEx prompt has changed.</p>

<p>This means we can also configure our <code class="language-plaintext highlighter-rouge">:routing_table</code> directly in the <code class="language-plaintext highlighter-rouge">config/runtime.exs</code> file. However, which configuration value should we use?</p>

<p>Currently we have two tests tagged with <code class="language-plaintext highlighter-rouge">@tag :distributed</code>. The “server interaction” test in <code class="language-plaintext highlighter-rouge">KVServerTest</code>, and the “route requests across nodes” in <code class="language-plaintext highlighter-rouge">KV.RouterTest</code>. Both tests are failing since they require a routing table, which is currently empty.</p>

<p>For simplicity, we will define a routing table that always points to the current node. That’s the table we will use for development and most of our tests. Back in <code class="language-plaintext highlighter-rouge">config/runtime.exs</code>, add this line:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config</span> <span class="ss">:kv</span><span class="p">,</span> <span class="ss">:routing_table</span><span class="p">,</span> <span class="p">[{</span><span class="sx">?a</span><span class="o">..</span><span class="sx">?z</span><span class="p">,</span> <span class="n">node</span><span class="p">()}]</span>
</code></pre></div></div>

<p>With such a simple table available, we can now remove <code class="language-plaintext highlighter-rouge">@tag :distributed</code> from the test in <code class="language-plaintext highlighter-rouge">test/kv_server_test.exs</code>. If you run the complete suite, the test should now pass.</p>

<p>However, for the tests in <code class="language-plaintext highlighter-rouge">KV.RouterTest</code>, we effectively need two nodes in our routing table. To do so, we will write a setup block that runs before all tests in that file. The setup block will change the application environment and revert it back once we are done, like this:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">KV</span><span class="o">.</span><span class="no">RouterTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ExUnit</span><span class="o">.</span><span class="no">Case</span>

  <span class="n">setup_all</span> <span class="k">do</span>
    <span class="n">current</span> <span class="o">=</span> <span class="no">Application</span><span class="o">.</span><span class="n">get_env</span><span class="p">(</span><span class="ss">:kv</span><span class="p">,</span> <span class="ss">:routing_table</span><span class="p">)</span>

    <span class="no">Application</span><span class="o">.</span><span class="n">put_env</span><span class="p">(</span><span class="ss">:kv</span><span class="p">,</span> <span class="ss">:routing_table</span><span class="p">,</span> <span class="p">[</span>
      <span class="p">{</span><span class="sx">?a</span><span class="o">..</span><span class="sx">?m</span><span class="p">,</span> <span class="ss">:"foo@computer-name"</span><span class="p">},</span>
      <span class="p">{</span><span class="sx">?n</span><span class="o">..</span><span class="sx">?z</span><span class="p">,</span> <span class="ss">:"bar@computer-name"</span><span class="p">}</span>
    <span class="p">])</span>

    <span class="n">on_exit</span> <span class="k">fn</span> <span class="o">-&gt;</span> <span class="no">Application</span><span class="o">.</span><span class="n">put_env</span><span class="p">(</span><span class="ss">:kv</span><span class="p">,</span> <span class="ss">:routing_table</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span> <span class="k">end</span>
  <span class="k">end</span>

  <span class="nv">@tag</span> <span class="ss">:distributed</span>
  <span class="n">test</span> <span class="s2">"route requests across nodes"</span> <span class="k">do</span>
</code></pre></div></div>

<p>Note we removed <code class="language-plaintext highlighter-rouge">async: true</code> from <code class="language-plaintext highlighter-rouge">use ExUnit.Case</code>. Since the application environment is a global storage, tests that modify it cannot run concurrently. With all changes in place, all tests should pass, including the distributed one.</p>

<p>Details of other configuration strategies are beyond the scope of this document, but you should be aware that other sources of runtime configuration data can be specified as configuration providers in <code class="language-plaintext highlighter-rouge">mix.exs</code>. For more details see the documentation for the <a href="https://hexdocs.pm/elixir/main/Config.Provider.html#content">Config.Provider module</a>. Excellent libraries for many types of config providers can be found on <a href="https://hex.pm">Hex</a>. These can ease the use of environment variables and configuration files of various formats, such as TOML, YAML, INI, and JSON.</p>

<h2 id="releases" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Releases</span><a href="#releases" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Now that our application runs distributed, you may be wondering how we can package our application to run in production. After all, all of our code so far depends on Erlang and Elixir versions that are installed in your current system. To achieve this goal, Elixir provides releases.</p>

<p>A release is a self-contained directory that consists of your application code, all of its dependencies, plus the whole Erlang Virtual Machine (VM) and runtime. Once a release is assembled, it can be packaged and deployed to a target as long as the target runs on the same operating system (OS) distribution and version as the machine that assembled the release.</p>

<p>In a regular project, we can assemble a release by simply running <code class="language-plaintext highlighter-rouge">mix release</code>. However, we have an umbrella project, and in such cases Elixir requires some extra input from us. Let’s see what is necessary:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ MIX_ENV=prod mix release
** (Mix) Umbrella projects require releases to be explicitly defined with a non-empty applications key that chooses which umbrella children should be part of the releases:

releases: [
  foo: [
    applications: [child_app_foo: :permanent]
  ],
  bar: [
    applications: [child_app_bar: :permanent]
  ]
]

Alternatively you can perform the release from the children applications
</code></pre></div></div>

<p>That’s because an umbrella project gives us plenty of options when deploying the software. We can:</p>

<ul>
  <li>
    <p>deploy all applications in the umbrella to a node that will work as both TCP server and key-value storage</p>
  </li>
  <li>
    <p>deploy the <code class="language-plaintext highlighter-rouge">:kv_server</code> application to work only as a TCP server as long as the routing table points only to other nodes</p>
  </li>
  <li>
    <p>deploy only the <code class="language-plaintext highlighter-rouge">:kv</code> application when we want a node to work only as storage (no TCP access)</p>
  </li>
</ul>

<p>As a starting point, let’s define a release that includes both <code class="language-plaintext highlighter-rouge">:kv_server</code> and <code class="language-plaintext highlighter-rouge">:kv</code> applications. We will also add a version to it. Open up the <code class="language-plaintext highlighter-rouge">mix.exs</code> in the umbrella root and add inside <code class="language-plaintext highlighter-rouge">def project</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="ss">releases:</span> <span class="p">[</span>
  <span class="ss">foo:</span> <span class="p">[</span>
    <span class="ss">version:</span> <span class="s2">"0.0.1"</span><span class="p">,</span>
    <span class="ss">applications:</span> <span class="p">[</span><span class="ss">kv_server:</span> <span class="ss">:permanent</span><span class="p">,</span> <span class="ss">kv:</span> <span class="ss">:permanent</span><span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</code></pre></div></div>

<p>That defines a release named <code class="language-plaintext highlighter-rouge">foo</code> with both <code class="language-plaintext highlighter-rouge">kv_server</code> and <code class="language-plaintext highlighter-rouge">kv</code> applications. Their mode is set to <code class="language-plaintext highlighter-rouge">:permanent</code>, which means that, if those applications crash, the whole node terminates. That’s reasonable since those applications are essential to our system.</p>

<p>Before we assemble the release, let’s also define our routing table for production. Given we expect to have two nodes, we need to update <code class="language-plaintext highlighter-rouge">config/runtime.exs</code> to look like this:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="no">Config</span>
    
<span class="n">config</span> <span class="ss">:kv</span><span class="p">,</span> <span class="ss">:routing_table</span><span class="p">,</span> <span class="p">[{</span><span class="sx">?a</span><span class="o">..</span><span class="sx">?z</span><span class="p">,</span> <span class="n">node</span><span class="p">()}]</span>

<span class="k">if</span> <span class="n">config_env</span><span class="p">()</span> <span class="o">==</span> <span class="ss">:prod</span> <span class="k">do</span>
  <span class="n">config</span> <span class="ss">:kv</span><span class="p">,</span> <span class="ss">:routing_table</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">{</span><span class="sx">?a</span><span class="o">..</span><span class="sx">?m</span><span class="p">,</span> <span class="ss">:"foo@computer-name"</span><span class="p">},</span>
    <span class="p">{</span><span class="sx">?n</span><span class="o">..</span><span class="sx">?z</span><span class="p">,</span> <span class="ss">:"bar@computer-name"</span><span class="p">}</span>
  <span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We have hardcoded the table and node names, which is good enough for our example, but you would likely move it to an external configuration system in an actual production setup. We have also wrapped it in a <code class="language-plaintext highlighter-rouge">config_env() == :prod</code> check, so this configuration does not apply to other environments.</p>

<p>With the configuration in place, let’s give assembling the release another try:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ MIX_ENV=prod mix release foo
* assembling foo-0.0.1 on MIX_ENV=prod
* skipping runtime configuration (config/runtime.exs not found)

Release created at _build/prod/rel/foo!

    # To start your system
    _build/prod/rel/foo/bin/foo start

Once the release is running:

    # To connect to it remotely
    _build/prod/rel/foo/bin/foo remote

    # To stop it gracefully (you may also send SIGINT/SIGTERM)
    _build/prod/rel/foo/bin/foo stop

To list all commands:

    _build/prod/rel/foo/bin/foo
</code></pre></div></div>

<p>Excellent! A release was assembled in <code class="language-plaintext highlighter-rouge">_build/prod/rel/foo</code>. Inside the release, there will be a <code class="language-plaintext highlighter-rouge">bin/foo</code> file which is the entry point to your system. It supports multiple commands, such as:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bin/foo start</code>, <code class="language-plaintext highlighter-rouge">bin/foo start_iex</code>, <code class="language-plaintext highlighter-rouge">bin/foo restart</code>, and <code class="language-plaintext highlighter-rouge">bin/foo stop</code> - for general management of the release</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bin/foo rpc COMMAND</code> and <code class="language-plaintext highlighter-rouge">bin/foo remote</code> - for running commands on the running system or to connect to the running system</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bin/foo eval COMMAND</code> - to start a fresh system that runs a single command and then shuts down</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bin/foo daemon</code> and <code class="language-plaintext highlighter-rouge">bin/foo daemon_iex</code> - to start the system as a daemon on Unix-like systems</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bin/foo install</code> - to install the system as a service on Windows machines</p>
  </li>
</ul>

<p>If you run <code class="language-plaintext highlighter-rouge">bin/foo start</code>, it will start the system using a short name (<code class="language-plaintext highlighter-rouge">--sname</code>) equal to the release name, which in this case is <code class="language-plaintext highlighter-rouge">foo</code>. The next step is to start a system named <code class="language-plaintext highlighter-rouge">bar</code>, so we can connect <code class="language-plaintext highlighter-rouge">foo</code> and <code class="language-plaintext highlighter-rouge">bar</code> together, like we did in the previous chapter. But before we achieve this, let’s talk a bit about the benefits of releases.</p>

<h2 id="why-releases" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Why releases?</span><a href="#why-releases" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Releases allow developers to precompile and package all of their code and the runtime into a single unit. The benefits of releases are:</p>

<ul>
  <li>
    <p>Code preloading. The VM has two mechanisms for loading code: interactive and embedded. By default, it runs in the interactive mode which dynamically loads modules when they are used for the first time. The first time your application calls <code class="language-plaintext highlighter-rouge">Enum.map/2</code>, the VM will find the <code class="language-plaintext highlighter-rouge">Enum</code> module and load it. There’s a downside. When you start a new server in production, it may need to load many other modules, causing the first requests to have an unusual spike in response time. Releases run in embedded mode, which loads all available modules upfront, guaranteeing your system is ready to handle requests after booting.</p>
  </li>
  <li>
    <p>Configuration and customization. Releases give developers fine grained control over system configuration and the VM flags used to start the system.</p>
  </li>
  <li>
    <p>Self-contained. A release does not require the source code to be included in your production artifacts. All of the code is precompiled and packaged. Releases do not even require Erlang or Elixir on your servers, as they include the Erlang VM and its runtime by default. Furthermore, both Erlang and Elixir standard libraries are stripped to bring only the parts you are actually using.</p>
  </li>
  <li>
    <p>Multiple releases. You can assemble different releases with different configuration per application or even with different applications altogether.</p>
  </li>
</ul>

<p>We have written extensive documentation on releases, so <a href="https://hexdocs.pm/mix/Mix.Tasks.Release.html">please check the official docs for more information</a>. For now, we will continue exploring some of the features outlined above.</p>

<h2 id="assembling-multiple-releases" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Assembling multiple releases</span><a href="#assembling-multiple-releases" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>So far, we have assembled a release named <code class="language-plaintext highlighter-rouge">foo</code>, but our routing table contains information for both <code class="language-plaintext highlighter-rouge">foo</code> and <code class="language-plaintext highlighter-rouge">bar</code>. Let’s start <code class="language-plaintext highlighter-rouge">foo</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ _build/prod/rel/foo/bin/foo start
16:58:58.508 [info]  Accepting connections on port 4040
</code></pre></div></div>

<p>And let’s connect to it and issue a request in another terminal:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ telnet 127.0.0.1 4040
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
CREATE bitsandpieces
OK
PUT bitsandpieces sword 1
OK
GET bitsandpieces sword
1
OK
GET shopping foo
Connection closed by foreign host.
</code></pre></div></div>

<p>Our application works already when we operate on the bucket named “bitsandpieces”. But since the “shopping” bucket would be stored on <code class="language-plaintext highlighter-rouge">bar</code>, the request fails as <code class="language-plaintext highlighter-rouge">bar</code> is not available. If you go back to the terminal running <code class="language-plaintext highlighter-rouge">foo</code>, you will see:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>17:16:19.555 [error] Task #PID&lt;0.622.0&gt; started from #PID&lt;0.620.0&gt; terminating
** (stop) exited in: GenServer.call({KV.RouterTasks, :"bar@computer-name"}, {:start_task, [{:"foo@josemac-2", #PID&lt;0.622.0&gt;, #PID&lt;0.622.0&gt;}, [#PID&lt;0.622.0&gt;, #PID&lt;0.620.0&gt;, #PID&lt;0.618.0&gt;], :monitor, {KV.Router, :route, ["shopping", KV.Registry, :lookup, [KV.Registry, "shopping"]]}], :temporary, nil}, :infinity)
    ** (EXIT) no connection to bar@computer-name
    (elixir) lib/gen_server.ex:1010: GenServer.call/3
    (elixir) lib/task/supervisor.ex:454: Task.Supervisor.async/6
    (kv) lib/kv/router.ex:21: KV.Router.route/4
    (kv_server) lib/kv_server/command.ex:74: KVServer.Command.lookup/2
    (kv_server) lib/kv_server.ex:29: KVServer.serve/1
    (elixir) lib/task/supervised.ex:90: Task.Supervised.invoke_mfa/2
    (stdlib) proc_lib.erl:249: :proc_lib.init_p_do_apply/3
Function: #Function&lt;0.128611034/0 in KVServer.loop_acceptor/1&gt;
    Args: []
</code></pre></div></div>

<p>Let’s now define a release for <code class="language-plaintext highlighter-rouge">:bar</code>. One first step could be to define a release exactly like <code class="language-plaintext highlighter-rouge">foo</code> inside <code class="language-plaintext highlighter-rouge">mix.exs</code>. Additionally we will set the <code class="language-plaintext highlighter-rouge">cookie</code> option on both releases to <code class="language-plaintext highlighter-rouge">weknoweachother</code> in order for them to allow connections from each other. See the <a href="http://www.erlang.org/doc/reference_manual/distributed.html">Distributed Erlang Documentation</a> for further information on this topic:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="ss">releases:</span> <span class="p">[</span>
  <span class="ss">foo:</span> <span class="p">[</span>
    <span class="ss">version:</span> <span class="s2">"0.0.1"</span><span class="p">,</span>
    <span class="ss">applications:</span> <span class="p">[</span><span class="ss">kv_server:</span> <span class="ss">:permanent</span><span class="p">,</span> <span class="ss">kv:</span> <span class="ss">:permanent</span><span class="p">],</span>
    <span class="ss">cookie:</span> <span class="s2">"weknoweachother"</span>
  <span class="p">],</span>
  <span class="ss">bar:</span> <span class="p">[</span>
    <span class="ss">version:</span> <span class="s2">"0.0.1"</span><span class="p">,</span>
    <span class="ss">applications:</span> <span class="p">[</span><span class="ss">kv_server:</span> <span class="ss">:permanent</span><span class="p">,</span> <span class="ss">kv:</span> <span class="ss">:permanent</span><span class="p">],</span>
    <span class="ss">cookie:</span> <span class="s2">"weknoweachother"</span>
  <span class="p">]</span>
<span class="p">]</span>
</code></pre></div></div>

<p>And now let’s assemble both releases:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ MIX_ENV=prod mix release foo
$ MIX_ENV=prod mix release bar
</code></pre></div></div>

<p>Stop <code class="language-plaintext highlighter-rouge">foo</code> if it’s still running and re-start it to load the <code class="language-plaintext highlighter-rouge">cookie</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ _build/prod/rel/foo/bin/foo start
</code></pre></div></div>

<p>And start <code class="language-plaintext highlighter-rouge">bar</code> in another terminal:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ _build/prod/rel/bar/bin/bar start
</code></pre></div></div>

<p>You should see an error like the error below happen 5 times, before the application finally shuts down:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>17:21:57.567 [error] Task #PID&lt;0.620.0&gt; started from KVServer.Supervisor terminating
** (MatchError) no match of right hand side value: {:error, :eaddrinuse}
    (kv_server) lib/kv_server.ex:12: KVServer.accept/1
    (elixir) lib/task/supervised.ex:90: Task.Supervised.invoke_mfa/2
    (stdlib) proc_lib.erl:249: :proc_lib.init_p_do_apply/3
Function: #Function&lt;0.98032413/0 in KVServer.Application.start/2&gt;
    Args: []
</code></pre></div></div>

<p>That’s happening because the release <code class="language-plaintext highlighter-rouge">foo</code> is already listening on port <code class="language-plaintext highlighter-rouge">4040</code> and <code class="language-plaintext highlighter-rouge">bar</code> is trying to do the same! One option could be to move the <code class="language-plaintext highlighter-rouge">:port</code> configuration to the application environment, like we did for the routing table, and setup different ports per node.</p>

<p>But let’s try something else. Let’s make it so the <code class="language-plaintext highlighter-rouge">bar</code> release contains only the <code class="language-plaintext highlighter-rouge">:kv</code> application. So it works as a storage but it won’t have a front-end. Change the <code class="language-plaintext highlighter-rouge">:bar</code> information to this:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="ss">releases:</span> <span class="p">[</span>
  <span class="ss">foo:</span> <span class="p">[</span>
    <span class="ss">version:</span> <span class="s2">"0.0.1"</span><span class="p">,</span>
    <span class="ss">applications:</span> <span class="p">[</span><span class="ss">kv_server:</span> <span class="ss">:permanent</span><span class="p">,</span> <span class="ss">kv:</span> <span class="ss">:permanent</span><span class="p">],</span>
    <span class="ss">cookie:</span> <span class="s2">"weknoweachother"</span>
  <span class="p">],</span>
  <span class="ss">bar:</span> <span class="p">[</span>
    <span class="ss">version:</span> <span class="s2">"0.0.1"</span><span class="p">,</span>
    <span class="ss">applications:</span> <span class="p">[</span><span class="ss">kv:</span> <span class="ss">:permanent</span><span class="p">],</span>
    <span class="ss">cookie:</span> <span class="s2">"weknoweachother"</span>
  <span class="p">]</span>
<span class="p">]</span>
</code></pre></div></div>

<p>And now let’s assemble <code class="language-plaintext highlighter-rouge">bar</code> once more:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ MIX_ENV=prod mix release bar
</code></pre></div></div>

<p>And finally successfully boot it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ _build/prod/rel/bar/bin/bar start
</code></pre></div></div>

<p>If you connect to localhost once again and perform another request, now everything should work, as long as the routing table contains the correct node names. Outstanding!</p>

<p>With releases, we were able to “cut different slices” of our project and prepared them to run in production, all packaged into a single directory.</p>

<h2 id="configuring-releases" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Configuring releases</span><a href="#configuring-releases" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Releases also provide built-in hooks for configuring almost every need of the production system:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">config/config.exs</code> - provides build-time application configuration, which is executed before our application compiles. This file often imports configuration files based on the environment, such as <code class="language-plaintext highlighter-rouge">config/dev.exs</code> and <code class="language-plaintext highlighter-rouge">config/prod.exs</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">config/runtime.exs</code> - provides runtime application configuration. It is executed every time the release boots and is further extensible via config providers</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">rel/env.sh.eex</code> and <code class="language-plaintext highlighter-rouge">rel/env.bat.eex</code> - template files that are copied into every release and executed on every command to set up environment variables, including ones specific to the VM, and the general environment</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">rel/vm.args.eex</code> - a template file that is copied into every release and provides static configuration of the Erlang Virtual Machine and other runtime flags</p>
  </li>
</ul>

<p>As we have seen, <code class="language-plaintext highlighter-rouge">config/config.exs</code> and <code class="language-plaintext highlighter-rouge">config/runtime.exs</code> are loaded during releases and regular Mix commands. On the other hand, <code class="language-plaintext highlighter-rouge">rel/env.sh.eex</code> and <code class="language-plaintext highlighter-rouge">rel/vm.args.eex</code> are specific to releases. Let’s take a look.</p>

<h3 id="operating-system-environment-configuration" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Operating System environment configuration</span><a href="#operating-system-environment-configuration" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>Every release contains an environment file, named <code class="language-plaintext highlighter-rouge">env.sh</code> on Unix-like systems and <code class="language-plaintext highlighter-rouge">env.bat</code> on Windows machines, that executes before the Elixir system starts. In this file, you can execute any OS-level code, such as invoke other applications, set environment variables and so on. Some of those environment variables can even configure how the release itself runs.</p>

<p>For instance, releases run using short-names (<code class="language-plaintext highlighter-rouge">--sname</code>). However, if you want to actually run a distributed key-value store in production, you will need multiple nodes and start the release with the <code class="language-plaintext highlighter-rouge">--name</code> option. We can achieve this by setting the <code class="language-plaintext highlighter-rouge">RELEASE_DISTRIBUTION</code> environment variable inside the <code class="language-plaintext highlighter-rouge">env.sh</code> and <code class="language-plaintext highlighter-rouge">env.bat</code> files. Mix already has a template for said files which we can customize, so let’s ask Mix to copy them to our application:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ mix release.init
* creating rel/vm.args.eex
* creating rel/remote.vm.args.eex
* creating rel/env.sh.eex
* creating rel/env.bat.eex
</code></pre></div></div>

<p>If you open up <code class="language-plaintext highlighter-rouge">rel/env.sh.eex</code>, you will see:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>

<span class="c"># # Sets and enables heart (recommended only in daemon mode)</span>
<span class="c"># case $RELEASE_COMMAND in</span>
<span class="c">#   daemon*)</span>
<span class="c">#     HEART_COMMAND="$RELEASE_ROOT/bin/$RELEASE_NAME $RELEASE_COMMAND"</span>
<span class="c">#     export HEART_COMMAND</span>
<span class="c">#     export ELIXIR_ERL_OPTIONS="-heart"</span>
<span class="c">#     ;;</span>
<span class="c">#   *)</span>
<span class="c">#     ;;</span>
<span class="c"># esac</span>

<span class="c"># # Set the release to load code on demand (interactive) instead of preloading (embedded).</span>
<span class="c"># export RELEASE_MODE=interactive</span>

<span class="c"># # Set the release to work across nodes.</span>
<span class="c"># # RELEASE_DISTRIBUTION must be "sname" (local), "name" (distributed) or "none".</span>
<span class="c"># export RELEASE_DISTRIBUTION=name</span>
<span class="c"># export RELEASE_NODE=&lt;%= @release.name %&gt;</span>
</code></pre></div></div>

<p>The steps necessary to work across nodes is already commented out as an example. You can enable full distribution by uncommenting the last two lines by removing the leading  <code class="language-plaintext highlighter-rouge"># </code>.</p>

<p>If you are on Windows, you will have to open up <code class="language-plaintext highlighter-rouge">rel/env.bat.eex</code>, where you will find this:</p>

<div class="language-bat highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo <span class="na">off</span>
<span class="c">rem Set the release to load code on demand (interactive) instead of preloading (embedded).</span>
<span class="c">rem set RELEASE_MODE=interactive</span>

<span class="c">rem Set the release to work across nodes.</span>
<span class="c">rem RELEASE_DISTRIBUTION must be "sname" (local), "name" (distributed) or "none".</span>
<span class="c">rem set RELEASE_DISTRIBUTION=name</span>
<span class="c">rem set RELEASE_NODE=&lt;%= @release.name %&gt;</span>
</code></pre></div></div>

<p>Once again, uncomment the last two lines by removing the leading <code class="language-plaintext highlighter-rouge">rem </code> to enable full distribution. And that’s all!</p>

<h3 id="vm-args" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">VM args</span><a href="#vm-args" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">rel/vm.args.eex</code> allows you to specify low-level flags that control how the Erlang VM and its runtime operate. You specify entries as if you were specifying arguments in the command line with code comments also supported. Here is the default generated file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Customize flags given to the VM: https://www.erlang.org/doc/man/erl.html
## -mode/-name/-sname/-setcookie are configured via env vars, do not set them here

## Increase number of concurrent ports/sockets
##+Q 65536

## Tweak GC to run more often
##-env ERL_FULLSWEEP_AFTER 10
</code></pre></div></div>

<p>You can see <a href="http://www.erlang.org/doc/man/erl.html">a complete list of VM args and flags in the Erlang documentation</a>.</p>

<h2 id="summing-up" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Summing up</span><a href="#summing-up" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Throughout the guide, we have built a very simple distributed key-value store as an opportunity to explore many constructs like generic servers, supervisors, tasks, agents, applications and more. Not only that, we have written tests for the whole application, got familiar with ExUnit, and learned how to use the Mix build tool to accomplish a wide range of tasks.</p>

<p>If you are looking for a distributed key-value store to use in production, you should definitely look into <a href="http://basho.com/products/riak-kv/">Riak</a>, which also runs in the Erlang <abbr title="Virtual Machine">VM</abbr>. In Riak, the buckets are replicated, to avoid data loss, and instead of a router, they use <a href="https://en.wikipedia.org/wiki/Consistent_hashing">consistent hashing</a> to map a bucket to a node. A consistent hashing algorithm helps reduce the amount of data that needs to be migrated when new storage nodes are added to your live system.</p>

<p>Of course, Elixir can be used for much more than distributed key-value stores. Embedded systems, data-processing and data-ingestion, web applications, audio/video streaming systems, and others are many of the different domains Elixir excels at. We hope this guide has prepared you to explore any of those domains or any future domain you may desire to bring Elixir into.</p>

<p>Happy coding!</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
  
    
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/mix-otp/distributed-tasks.html" class="previous page-numbers spec" title="Distributed tasks and tags">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
          </div>
        
        
      
    
  
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/mix-otp/config-and-releases.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><br></div><div page=":META-PROGRAMMING_IN_ELIXIR:"><div class="wrap" path="/getting-started/meta/quote-and-unquote.html" page=":1:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><span title="Quote and unquote">Quote and unquote</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Meta-programming in Elixir</small>
      <h1>Quote and unquote</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#quoting">Quoting</a></li><li><a href="#unquoting">Unquoting</a></li><li><a href="#escaping">Escaping</a></li></ol></div>

    <p>This guide aims to introduce the meta-programming techniques available in Elixir. The ability to represent an Elixir program by its own data structures is at the heart of meta-programming. This chapter starts by exploring those structures and the associated <code class="language-plaintext highlighter-rouge">quote</code> and <code class="language-plaintext highlighter-rouge">unquote</code> constructs, so we can take a look at macros in the next chapter and finally build our own domain specific language.</p>

<blockquote>
  <p>The Elixir guides are also available in EPUB format:</p>

  <ul>
    <li><a href="https://repo.hex.pm/guides/elixir/elixir-getting-started-guide.epub">Getting started guide</a></li>
    <li><a href="https://repo.hex.pm/guides/elixir/mix-and-otp.epub">Mix and OTP guide</a></li>
    <li><a href="https://repo.hex.pm/guides/elixir/meta-programming-in-elixir.epub">Meta-programming guide</a></li>
  </ul>
</blockquote>

<h2 id="quoting" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Quoting</span><a href="#quoting" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>The building block of an Elixir program is a tuple with three elements. For example, the function call <code class="language-plaintext highlighter-rouge">sum(1, 2, 3)</code> is represented internally as:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="ss">:sum</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>
</code></pre></div></div>

<p>You can get the representation of any expression by using the <code class="language-plaintext highlighter-rouge">quote</code> macro:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:sum</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>
</code></pre></div></div>

<p>The first element is the function name, the second is a keyword list containing metadata and the third is the arguments list.</p>

<p>Operators are also represented as such tuples:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span>
<span class="p">{</span><span class="ss">:+</span><span class="p">,</span> <span class="p">[</span><span class="ss">context:</span> <span class="no">Elixir</span><span class="p">,</span> <span class="kn">import</span><span class="p">:</span> <span class="no">Kernel</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}</span>
</code></pre></div></div>

<p>Even a map is represented as a call to <code class="language-plaintext highlighter-rouge">%{}</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="p">%{</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">}</span>
<span class="p">{</span><span class="ss">:%{}</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">}]}</span>
</code></pre></div></div>

<p>Variables are also represented using such triplets, except the last element is an atom, instead of a list:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="n">x</span>
<span class="p">{</span><span class="ss">:x</span><span class="p">,</span> <span class="p">[],</span> <span class="no">Elixir</span><span class="p">}</span>
</code></pre></div></div>

<p>When quoting more complex expressions, we can see that the code is represented in such tuples, which are often nested inside each other in a structure resembling a tree. Many languages would call such representations an Abstract Syntax Tree (AST). Elixir calls them quoted expressions:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:sum</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="ss">:+</span><span class="p">,</span> <span class="p">[</span><span class="ss">context:</span> <span class="no">Elixir</span><span class="p">,</span> <span class="kn">import</span><span class="p">:</span> <span class="no">Kernel</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]},</span> <span class="mi">4</span><span class="p">]}</span>
</code></pre></div></div>

<p>Sometimes when working with quoted expressions, it may be useful to get the textual code representation back. This can be done with <code class="language-plaintext highlighter-rouge">Macro.to_string/1</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Macro</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="s2">"sum(1, 2 + 3, 4)"</span>
</code></pre></div></div>

<p>In general, the tuples above are structured according to the following format:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="n">atom</span> <span class="o">|</span> <span class="n">tuple</span><span class="p">,</span> <span class="n">list</span><span class="p">,</span> <span class="n">list</span> <span class="o">|</span> <span class="n">atom</span><span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>The first element is an atom or another tuple in the same representation;</li>
  <li>The second element is a keyword list containing metadata, like numbers and contexts;</li>
  <li>The third element is either a list of arguments for the function call or an atom. When this element is an atom, it means the tuple represents a variable.</li>
</ul>

<p>Besides the tuple defined above, there are five Elixir literals that, when quoted, return themselves (and not a tuple). They are:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="ss">:sum</span>         <span class="c1">#=&gt; Atoms</span>
<span class="mf">1.0</span>          <span class="c1">#=&gt; Numbers</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>       <span class="c1">#=&gt; Lists</span>
<span class="s2">"strings"</span>    <span class="c1">#=&gt; Strings</span>
<span class="p">{</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">}</span> <span class="c1">#=&gt; Tuples with two elements</span>
</code></pre></div></div>

<p>Most Elixir code has a straight-forward translation to its underlying quoted expression. We recommend you try out different code samples and see what the results are. For example, what does <code class="language-plaintext highlighter-rouge">String.upcase("foo")</code> expand to? We have also learned that <code class="language-plaintext highlighter-rouge">if(true, do: :this, else: :that)</code> is the same as <code class="language-plaintext highlighter-rouge">if true do :this else :that end</code>. How does this affirmation hold with quoted expressions?</p>

<h2 id="unquoting" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Unquoting</span><a href="#unquoting" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Quote is about retrieving the inner representation of some particular chunk of code. However, sometimes it may be necessary to inject some other particular chunk of code inside the representation we want to retrieve.</p>

<p>For example, imagine you have a variable <code class="language-plaintext highlighter-rouge">number</code> which contains the number you want to inject inside a quoted expression.</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">13</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Macro</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="mi">11</span> <span class="o">+</span> <span class="n">number</span><span class="p">)</span>
<span class="s2">"11 + number"</span>
</code></pre></div></div>

<p>That’s not what we wanted, since the value of the <code class="language-plaintext highlighter-rouge">number</code> variable has not been injected and <code class="language-plaintext highlighter-rouge">number</code> has been quoted in the expression. In order to inject the <em>value</em> of the <code class="language-plaintext highlighter-rouge">number</code> variable, <code class="language-plaintext highlighter-rouge">unquote</code> has to be used inside the quoted representation:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">13</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Macro</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="mi">11</span> <span class="o">+</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">number</span><span class="p">))</span>
<span class="s2">"11 + 13"</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">unquote</code> can even be used to inject function names:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">fun</span> <span class="o">=</span> <span class="ss">:hello</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Macro</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">fun</span><span class="p">)(</span><span class="ss">:world</span><span class="p">))</span>
<span class="s2">"hello(:world)"</span>
</code></pre></div></div>

<p>In some cases, it may be necessary to inject many values inside a list. For example, imagine you have a list containing <code class="language-plaintext highlighter-rouge">[1, 2, 6]</code> and we want to inject <code class="language-plaintext highlighter-rouge">[3, 4, 5]</code> into it. Using <code class="language-plaintext highlighter-rouge">unquote</code> won’t yield the desired result:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">inner</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Macro</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">inner</span><span class="p">),</span> <span class="mi">6</span><span class="p">])</span>
<span class="s2">"[1, 2, [3, 4, 5], 6]"</span>
</code></pre></div></div>

<p>That’s when <code class="language-plaintext highlighter-rouge">unquote_splicing</code> becomes handy:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">inner</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Macro</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">unquote_splicing</span><span class="p">(</span><span class="n">inner</span><span class="p">),</span> <span class="mi">6</span><span class="p">])</span>
<span class="s2">"[1, 2, 3, 4, 5, 6]"</span>
</code></pre></div></div>

<p>Unquoting is very useful when working with macros. When writing macros, developers are able to receive code chunks and inject them inside other code chunks, which can be used to transform code or write code that generates code during compilation.</p>

<h2 id="escaping" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Escaping</span><a href="#escaping" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>As we saw at the beginning of this chapter, only some values are valid quoted expressions in Elixir. For example, a map is not a valid quoted expression. Neither is a tuple with four elements. However, such values <em>can</em> be expressed as a quoted expression:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="p">%{</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">}</span>
<span class="p">{</span><span class="ss">:%{}</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">}]}</span>
</code></pre></div></div>

<p>In some cases, you may need to inject such <em>values</em> into <em>quoted expressions</em>. To do that, we need to first escape those values into quoted expressions with the help of <code class="language-plaintext highlighter-rouge">Macro.escape/1</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="p">%{</span><span class="ss">hello:</span> <span class="ss">:world</span><span class="p">}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Macro</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">map</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:%{}</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="ss">hello:</span> <span class="ss">:world</span><span class="p">]}</span>
</code></pre></div></div>

<p>Macros receive quoted expressions and must return quoted expressions. However, sometimes during the execution of a macro, you may need to work with values and making a distinction between values and quoted expressions will be required.</p>

<p>In other words, it is important to make a distinction between a regular Elixir value (like a list, a map, a process, a reference, etc) and a quoted expression. Some values, such as integers, atoms, and strings, have a quoted expression equal to the value itself. Other values, like maps, need to be explicitly converted. Finally, values like functions and references cannot be converted to a quoted expression at all.</p>

<p>You can read more about <code class="language-plaintext highlighter-rouge">quote</code> and <code class="language-plaintext highlighter-rouge">unquote</code> in the <a href="https://hexdocs.pm/elixir/Kernel.SpecialForms.html"><code class="language-plaintext highlighter-rouge">Kernel.SpecialForms</code> module</a>. Documentation for <code class="language-plaintext highlighter-rouge">Macro.escape/1</code> and other functions related to quoted expressions can be found in the <a href="https://hexdocs.pm/elixir/Macro.html"><code class="language-plaintext highlighter-rouge">Macro</code> module</a>.</p>

<p>In this introduction, we have laid the groundwork to finally write our first macro, so let’s move to the next chapter.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
  
    
  
    
      
        
          <div class="pagination loop-pagination">
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/meta/macros.html" class="previous page-numbers spec" title="Macros">Next →</a>
            
          </div>
        
        
      
        
        
      
        
        
      
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/meta/quote-and-unquote.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/meta/macros.html" page=":2:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><span title="Macros">Macros</span></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/domain-specific-languages.html" title="Domain-specific languages">Domain-specific languages</a></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Meta-programming in Elixir</small>
      <h1>Macros</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#foreword">Foreword</a></li><li><a href="#our-first-macro">Our first macro</a></li><li><a href="#macro-hygiene">Macro hygiene</a></li><li><a href="#the-environment">The environment</a></li><li><a href="#private-macros">Private macros</a></li><li><a href="#write-macros-responsibly">Write macros responsibly</a></li></ol></div>

    <h2 id="foreword" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Foreword</span><a href="#foreword" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Even though Elixir attempts its best to provide a safe environment for macros, the major responsibility of writing clean code with macros falls on developers. Macros are harder to write than ordinary Elixir functions and it’s considered to be bad style to use them when they’re not necessary. So write macros responsibly.</p>

<p>Elixir already provides mechanisms to write your everyday code in a simple and readable fashion by using its data structures and functions. Macros should only be used as a last resort. Remember that <strong>explicit is better than implicit</strong>. <strong>Clear code is better than concise code.</strong></p>

<h2 id="our-first-macro" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Our first macro</span><a href="#our-first-macro" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Macros in Elixir are defined via <code class="language-plaintext highlighter-rouge">defmacro/2</code>.</p>

<blockquote>
  <p>For this chapter, we will be using files instead of running code samples in IEx. That’s because the code samples will span multiple lines of code and typing them all in IEx can be counter-productive. You should be able to run the code samples by saving them into a <code class="language-plaintext highlighter-rouge">macros.exs</code> file and running it with <code class="language-plaintext highlighter-rouge">elixir macros.exs</code> or <code class="language-plaintext highlighter-rouge">iex macros.exs</code>.</p>
</blockquote>

<p>In order to better understand how macros work, let’s create a new module where we are going to implement <code class="language-plaintext highlighter-rouge">unless</code>, which does the opposite of <code class="language-plaintext highlighter-rouge">if</code>, as a macro and as a function:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Unless</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">fun_unless</span><span class="p">(</span><span class="n">clause</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">expression</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">if</span><span class="p">(</span><span class="n">!clause</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">expression</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">defmacro</span> <span class="n">macro_unless</span><span class="p">(</span><span class="n">clause</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">expression</span><span class="p">)</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span>
      <span class="k">if</span><span class="p">(</span><span class="n">!unquote</span><span class="p">(</span><span class="n">clause</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">expression</span><span class="p">))</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The function receives the arguments and passes them to <code class="language-plaintext highlighter-rouge">if</code>. However, as we learned in the <a href="/getting-started/meta/quote-and-unquote.html">previous chapter</a>, the macro will receive quoted expressions, inject them into the quote, and finally return another quoted expression.</p>

<p>Let’s start <code class="language-plaintext highlighter-rouge">iex</code> with the module above:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>iex macros.exs
</code></pre></div></div>

<p>And play with those definitions:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="kn">require</span> <span class="no">Unless</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Unless</span><span class="o">.</span><span class="n">macro_unless</span> <span class="no">true</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="s2">"this should never be printed"</span>
<span class="no">nil</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Unless</span><span class="o">.</span><span class="n">fun_unless</span> <span class="no">true</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="s2">"this should never be printed"</span>
<span class="s2">"this should never be printed"</span>
<span class="no">nil</span>
</code></pre></div></div>

<p>Note that in our macro implementation, the sentence was not printed, although it was printed in our function implementation. That’s because the arguments to a function call are evaluated before calling the function. However, macros do not evaluate their arguments. Instead, they receive the arguments as quoted expressions which are then transformed into other quoted expressions. In this case, we have rewritten our <code class="language-plaintext highlighter-rouge">unless</code> macro to become an <code class="language-plaintext highlighter-rouge">if</code> behind the scenes.</p>

<p>In other words, when invoked as:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Unless</span><span class="o">.</span><span class="n">macro_unless</span> <span class="no">true</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="s2">"this should never be printed"</span>
</code></pre></div></div>

<p>Our <code class="language-plaintext highlighter-rouge">macro_unless</code> macro received the following:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">macro_unless</span><span class="p">(</span><span class="no">true</span><span class="p">,</span> <span class="p">[</span><span class="k">do</span><span class="p">:</span> <span class="p">{{:</span><span class="o">.</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[{</span><span class="ss">:__aliases__</span><span class="p">,</span> <span class="p">[</span><span class="ss">alias:</span> <span class="no">false</span><span class="p">],</span> <span class="p">[</span><span class="ss">:IO</span><span class="p">]},</span> <span class="ss">:puts</span><span class="p">]},</span> <span class="p">[],</span> <span class="p">[</span><span class="s2">"this should never be printed"</span><span class="p">]}])</span>
</code></pre></div></div>

<p>And it then returned a quoted expression as follows:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="ss">:if</span><span class="p">,</span> <span class="p">[],</span>
 <span class="p">[{</span><span class="ss">:!</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="no">true</span><span class="p">]},</span>
  <span class="p">[</span><span class="k">do</span><span class="p">:</span> <span class="p">{{:</span><span class="o">.</span><span class="p">,</span> <span class="p">[],</span>
     <span class="p">[{</span><span class="ss">:__aliases__</span><span class="p">,</span>
       <span class="p">[],</span> <span class="p">[</span><span class="ss">:IO</span><span class="p">]},</span>
      <span class="ss">:puts</span><span class="p">]},</span> <span class="p">[],</span> <span class="p">[</span><span class="s2">"this should never be printed"</span><span class="p">]}]]}</span>
</code></pre></div></div>

<p>We can actually verify that this is the case by using <code class="language-plaintext highlighter-rouge">Macro.expand_once/2</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">expr</span> <span class="o">=</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="no">Unless</span><span class="o">.</span><span class="n">macro_unless</span><span class="p">(</span><span class="no">true</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="s2">"this should never be printed"</span><span class="p">)</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">res</span>  <span class="o">=</span> <span class="no">Macro</span><span class="o">.</span><span class="n">expand_once</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">__ENV__</span><span class="p">)</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="no">Macro</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="k">if</span><span class="p">(</span><span class="n">!true</span><span class="p">)</span> <span class="k">do</span>
  <span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="s2">"this should never be printed"</span><span class="p">)</span>
<span class="k">end</span>
<span class="ss">:ok</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Macro.expand_once/2</code> receives a quoted expression and expands it according to the current environment. In this case, it expanded/invoked the <code class="language-plaintext highlighter-rouge">Unless.macro_unless/2</code> macro and returned its result. We then proceeded to convert the returned quoted expression to a string and print it (we will talk about <code class="language-plaintext highlighter-rouge">__ENV__</code> later in this chapter).</p>

<p>That’s what macros are all about. They are about receiving quoted expressions and transforming them into something else. In fact, <code class="language-plaintext highlighter-rouge">unless/2</code> in Elixir is implemented as a macro:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmacro</span> <span class="k">unless</span><span class="p">(</span><span class="n">clause</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">expression</span><span class="p">)</span> <span class="k">do</span>
  <span class="kn">quote</span> <span class="k">do</span>
    <span class="k">if</span><span class="p">(</span><span class="n">!unquote</span><span class="p">(</span><span class="n">clause</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">expression</span><span class="p">))</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Constructs such as <code class="language-plaintext highlighter-rouge">unless/2</code>, <code class="language-plaintext highlighter-rouge">defmacro/2</code>, <code class="language-plaintext highlighter-rouge">def/2</code>, <code class="language-plaintext highlighter-rouge">defprotocol/2</code>, and many others used throughout this getting started guide are implemented in pure Elixir, often as a macro. This means that the constructs being used to build the language can be used by developers to extend the language to the domains they are working on.</p>

<p>We can define any function and macro we want, including ones that override the built-in definitions provided by Elixir. The only exceptions are Elixir special forms which are not implemented in Elixir and therefore cannot be overridden, <a href="https://hexdocs.pm/elixir/Kernel.SpecialForms.html#summary">the full list of special forms is available in <code class="language-plaintext highlighter-rouge">Kernel.SpecialForms</code></a>.</p>

<h2 id="macro-hygiene" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Macro hygiene</span><a href="#macro-hygiene" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir macros have late resolution. This guarantees that a variable defined inside a quote won’t conflict with a variable defined in the context where that macro is expanded. For example:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Hygiene</span> <span class="k">do</span>
  <span class="k">defmacro</span> <span class="n">no_interference</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">defmodule</span> <span class="no">HygieneTest</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">go</span> <span class="k">do</span>
    <span class="kn">require</span> <span class="no">Hygiene</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">13</span>
    <span class="no">Hygiene</span><span class="o">.</span><span class="n">no_interference</span><span class="p">()</span>
    <span class="n">a</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">HygieneTest</span><span class="o">.</span><span class="n">go</span>
<span class="c1"># =&gt; 13</span>
</code></pre></div></div>

<p>In the example above, even though the macro injects <code class="language-plaintext highlighter-rouge">a = 1</code>, it does not affect the variable <code class="language-plaintext highlighter-rouge">a</code> defined by the <code class="language-plaintext highlighter-rouge">go</code> function. If a macro wants to explicitly affect the context, it can use <code class="language-plaintext highlighter-rouge">var!</code>:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Hygiene</span> <span class="k">do</span>
  <span class="k">defmacro</span> <span class="n">interference</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="n">var!</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">defmodule</span> <span class="no">HygieneTest</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">go</span> <span class="k">do</span>
    <span class="kn">require</span> <span class="no">Hygiene</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">13</span>
    <span class="no">Hygiene</span><span class="o">.</span><span class="n">interference</span><span class="p">()</span>
    <span class="n">a</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">HygieneTest</span><span class="o">.</span><span class="n">go</span>
<span class="c1"># =&gt; 1</span>
</code></pre></div></div>

<p>The code above will work but issue a warning: <code class="language-plaintext highlighter-rouge">variable "a" is unused</code>. The macro is overriding the original value and the original value is never used.</p>

<p>Variable hygiene only works because Elixir annotates variables with their context. For example, a variable <code class="language-plaintext highlighter-rouge">x</code> defined on line 3 of a module would be represented as:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="ss">:x</span><span class="p">,</span> <span class="p">[</span><span class="ss">line:</span> <span class="mi">3</span><span class="p">],</span> <span class="no">nil</span><span class="p">}</span>
</code></pre></div></div>

<p>However, a quoted variable is represented as:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Sample</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">quoted</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="n">x</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Sample</span><span class="o">.</span><span class="n">quoted</span><span class="p">()</span> <span class="c1">#=&gt; {:x, [line: 3], Sample}</span>
</code></pre></div></div>

<p>Notice that the third element in the quoted variable is the atom <code class="language-plaintext highlighter-rouge">Sample</code>, instead of <code class="language-plaintext highlighter-rouge">nil</code>, which marks the variable as coming from the <code class="language-plaintext highlighter-rouge">Sample</code> module. Therefore, Elixir considers these two variables as coming from different contexts and handles them accordingly.</p>

<p>Elixir provides similar mechanisms for imports and aliases too. This guarantees that a macro will behave as specified by its source module rather than conflicting with the target module where the macro is expanded. Hygiene can be bypassed under specific situations by using macros like <code class="language-plaintext highlighter-rouge">var!/2</code> and <code class="language-plaintext highlighter-rouge">alias!/1</code>, although one must be careful when using those as they directly change the user environment.</p>

<p>Sometimes variable names might be dynamically created. In such cases, <code class="language-plaintext highlighter-rouge">Macro.var/2</code> can be used to define new variables:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Sample</span> <span class="k">do</span>
  <span class="k">defmacro</span> <span class="n">initialize_to_char_count</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Enum</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="k">fn</span> <span class="n">name</span> <span class="o">-&gt;</span>
      <span class="n">var</span> <span class="o">=</span> <span class="no">Macro</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="no">nil</span><span class="p">)</span>
      <span class="n">length</span> <span class="o">=</span> <span class="n">name</span> <span class="o">|&gt;</span> <span class="no">Atom</span><span class="o">.</span><span class="n">to_string</span> <span class="o">|&gt;</span> <span class="no">String</span><span class="o">.</span><span class="n">length</span>

      <span class="kn">quote</span> <span class="k">do</span>
        <span class="kn">unquote</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">=</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">run</span> <span class="k">do</span>
    <span class="n">initialize_to_char_count</span> <span class="p">[</span><span class="ss">:red</span><span class="p">,</span> <span class="ss">:green</span><span class="p">,</span> <span class="ss">:yellow</span><span class="p">]</span>
    <span class="p">[</span><span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">yellow</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="o">&gt;</span> <span class="no">Sample</span><span class="o">.</span><span class="n">run</span> <span class="c1">#=&gt; [3, 5, 6]</span>
</code></pre></div></div>

<p>Take note of the second argument to <code class="language-plaintext highlighter-rouge">Macro.var/2</code>. This is the context being used and will determine hygiene as described in the next section.</p>

<h2 id="the-environment" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The environment</span><a href="#the-environment" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>When calling <code class="language-plaintext highlighter-rouge">Macro.expand_once/2</code> earlier in this chapter, we used the special form <code class="language-plaintext highlighter-rouge">__ENV__</code>.</p>

<p><code class="language-plaintext highlighter-rouge">__ENV__</code> returns an instance of the <code class="language-plaintext highlighter-rouge">Macro.Env</code> struct which contains useful information about the compilation environment, including the current module, file, and line, all variables defined in the current scope, as well as imports, requires and so on:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">__ENV__</span><span class="o">.</span><span class="n">module</span>
<span class="no">nil</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">__ENV__</span><span class="o">.</span><span class="n">file</span>
<span class="s2">"iex"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">__ENV__</span><span class="o">.</span><span class="n">requires</span>
<span class="p">[</span><span class="no">IEx</span><span class="o">.</span><span class="no">Helpers</span><span class="p">,</span> <span class="no">Kernel</span><span class="p">,</span> <span class="no">Kernel</span><span class="o">.</span><span class="no">Typespec</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="kn">require</span> <span class="no">Integer</span>
<span class="no">nil</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">__ENV__</span><span class="o">.</span><span class="n">requires</span>
<span class="p">[</span><span class="no">IEx</span><span class="o">.</span><span class="no">Helpers</span><span class="p">,</span> <span class="no">Integer</span><span class="p">,</span> <span class="no">Kernel</span><span class="p">,</span> <span class="no">Kernel</span><span class="o">.</span><span class="no">Typespec</span><span class="p">]</span>
</code></pre></div></div>

<p>Many of the functions in the <code class="language-plaintext highlighter-rouge">Macro</code> module expect an environment. You can read more about these functions in <a href="https://hexdocs.pm/elixir/Macro.html">the docs for the <code class="language-plaintext highlighter-rouge">Macro</code> module</a> and learn more about the compilation environment in the <a href="https://hexdocs.pm/elixir/Macro.Env.html">docs for <code class="language-plaintext highlighter-rouge">Macro.Env</code></a>.</p>

<h2 id="private-macros" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Private macros</span><a href="#private-macros" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir also supports private macros via <code class="language-plaintext highlighter-rouge">defmacrop</code>. As private functions, these macros are only available inside the module that defines them, and only at compilation time.</p>

<p>It is important that a macro is defined before its usage. Failing to define a macro before its invocation will raise an error at runtime, since the macro won’t be expanded and will be translated to a function call:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">defmodule</span> <span class="no">Sample</span> <span class="k">do</span>
<span class="o">...&gt;</span>  <span class="k">def</span> <span class="n">four</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">two</span> <span class="o">+</span> <span class="n">two</span>
<span class="o">...&gt;</span>  <span class="k">defmacrop</span> <span class="n">two</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="mi">2</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="o">**</span> <span class="p">(</span><span class="no">CompileError</span><span class="p">)</span> <span class="ss">iex:</span><span class="mi">2</span><span class="p">:</span> <span class="n">function</span> <span class="n">two</span><span class="o">/</span><span class="mi">0</span> <span class="n">undefined</span>
</code></pre></div></div>

<h2 id="write-macros-responsibly" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Write macros responsibly</span><a href="#write-macros-responsibly" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Macros are a powerful construct and Elixir provides many mechanisms to ensure they are used responsibly.</p>

<ul>
  <li>
    <p>Macros are hygienic: by default, variables defined inside a macro are not going to affect the user code. Furthermore, function calls and aliases available in the macro context are not going to leak into the user context.</p>
  </li>
  <li>
    <p>Macros are lexical: it is impossible to inject code or macros globally. In order to use a macro, you need to explicitly <code class="language-plaintext highlighter-rouge">require</code> or <code class="language-plaintext highlighter-rouge">import</code> the module that defines the macro.</p>
  </li>
  <li>
    <p>Macros are explicit: it is impossible to run a macro without explicitly invoking it. For example, some languages allow developers to completely rewrite functions behind the scenes, often via parse transforms or via some reflection mechanisms. In Elixir, a macro must be explicitly invoked in the caller during compilation time.</p>
  </li>
  <li>
    <p>Macros’ language is clear: many languages provide syntax shortcuts for <code class="language-plaintext highlighter-rouge">quote</code> and <code class="language-plaintext highlighter-rouge">unquote</code>. In Elixir, we preferred to have them explicitly spelled out, in order to clearly delimit the boundaries of a macro definition and its quoted expressions.</p>
  </li>
</ul>

<p>Even with such guarantees, the developer plays a big role when writing macros responsibly. If you are confident you need to resort to macros, remember that macros are not your API. Keep your macro definitions short, including their quoted contents. For example, instead of writing a macro like this:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">MyModule</span> <span class="k">do</span>
  <span class="k">defmacro</span> <span class="n">my_macro</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span>
      <span class="n">do_this</span><span class="p">(</span><span class="kn">unquote</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
      <span class="o">...</span>
      <span class="n">do_that</span><span class="p">(</span><span class="kn">unquote</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
      <span class="o">...</span>
      <span class="n">and_that</span><span class="p">(</span><span class="kn">unquote</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>write:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">MyModule</span> <span class="k">do</span>
  <span class="k">defmacro</span> <span class="n">my_macro</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span>
      <span class="c1"># Keep what you need to do here to a minimum</span>
      <span class="c1"># and move everything else to a function</span>
      <span class="no">MyModule</span><span class="o">.</span><span class="n">do_this_that_and_that</span><span class="p">(</span><span class="kn">unquote</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">do_this_that_and_that</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">do_this</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="n">do_that</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="n">and_that</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This makes your code clearer and easier to test and maintain, as you can invoke and test <code class="language-plaintext highlighter-rouge">do_this_that_and_that/3</code> directly. It also helps you design an actual API for developers that do not want to rely on macros.</p>

<p>With those lessons, we finish our introduction to macros. The next chapter is a brief discussion on DSLs that shows how we can mix macros and module attributes to annotate and extend modules and functions.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
  
    
  
    
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/meta/quote-and-unquote.html" class="previous page-numbers spec" title="Quote and unquote">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
              
              <a href="/getting-started/meta/domain-specific-languages.html" class="previous page-numbers spec" title="Domain-specific languages">Next →</a>
            
          </div>
        
        
      
        
        
      
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/meta/macros.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/getting-started/meta/domain-specific-languages.html" page=":3:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>


  <a class="spec" href="/docs.html" style="display: block;margin-bottom: 20px">API Documentation</a>

  
  
    <div class="widget">
     <h3 class="widget-title">Getting Started</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/introduction.html" title="Introduction">Introduction</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-types.html" title="Basic types">Basic types</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/basic-operators.html" title="Basic operators">Basic operators</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/pattern-matching.html" title="Pattern matching">Pattern matching</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/case-cond-and-if.html" title="case, cond, and if">case, cond, and if</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/binaries-strings-and-char-lists.html" title="Binaries, strings, and charlists">Binaries, strings, and charlists</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/keywords-and-maps.html" title="Keyword lists and maps">Keyword lists and maps</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/modules-and-functions.html" title="Modules and Functions">Modules and Functions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/recursion.html" title="Recursion">Recursion</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/enumerables-and-streams.html" title="Enumerables and streams">Enumerables and streams</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/processes.html" title="Processes">Processes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/io-and-the-file-system.html" title="IO and the file system">IO and the file system</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/alias-require-and-import.html" title="alias, require, and import">alias, require, and import</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/module-attributes.html" title="Module attributes">Module attributes</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/structs.html" title="Structs">Structs</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/protocols.html" title="Protocols">Protocols</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/comprehensions.html" title="Comprehensions">Comprehensions</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/sigils.html" title="Sigils">Sigils</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/try-catch-and-rescue.html" title="try, catch, and rescue">try, catch, and rescue</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/optional-syntax.html" title="Optional syntax sheet">Optional syntax sheet</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/erlang-libraries.html" title="Erlang libraries">Erlang libraries</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/debugging.html" title="Debugging">Debugging</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/typespecs-and-behaviours.html" title="Typespecs and behaviours">Typespecs and behaviours</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/where-to-go-next.html" title="Where to go next">Where to go next</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Mix and OTP</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/introduction-to-mix.html" title="Introduction to Mix">Introduction to Mix</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/agent.html" title="Agent">Agent</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/genserver.html" title="GenServer">GenServer</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/supervisor-and-application.html" title="Supervisor and Application">Supervisor and Application</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dynamic-supervisor.html" title="Dynamic supervisors">Dynamic supervisors</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/ets.html" title="ETS">ETS</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/dependencies-and-umbrella-projects.html" title="Dependencies and umbrella projects">Dependencies and umbrella projects</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/task-and-gen-tcp.html" title="Task and gen_tcp">Task and gen_tcp</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/docs-tests-and-with.html" title="Doctests, patterns and with">Doctests, patterns and with</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/distributed-tasks.html" title="Distributed tasks and tags">Distributed tasks and tags</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/mix-otp/config-and-releases.html" title="Configuration and releases">Configuration and releases</a></li>
          
        
      </ol>
    </div>
  
    <div class="widget">
     <h3 class="widget-title">Meta-programming in Elixir</h3>
      <ol>
        
          
          
            <li><a class="spec" href="/getting-started/meta/quote-and-unquote.html" title="Quote and unquote">Quote and unquote</a></li>
          
        
          
          
            <li><a class="spec" href="/getting-started/meta/macros.html" title="Macros">Macros</a></li>
          
        
          
          
            <li><span title="Domain-specific languages">Domain-specific languages</span></li>
          
        
      </ol>
    </div>
  
</div>

<div id="content">
  <article>
    <div class="getting-started-title">
      <small>Meta-programming in Elixir</small>
      <h1>Domain-specific languages</h1>
    </div>

    <div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#foreword">Foreword</a></li><li><a href="#building-our-own-test-case">Building our own test case</a></li><li><a href="#the-test-macro">The <code class="language-plaintext highlighter-rouge">test</code> macro</a></li><li><a href="#storing-information-with-attributes">Storing information with attributes</a></li></ol></div>

    <h2 id="foreword" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Foreword</span><a href="#foreword" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p><a href="https://en.wikipedia.org/wiki/Domain-specific_language">Domain-specific languages (DSL)</a> allow developers to tailor their application to a particular domain. You don’t need macros in order to have a DSL: every data structure and every function you define in your module is part of your Domain-specific language.</p>

<p>For example, imagine we want to implement a Validator module which provides a data validation domain-specific language. We could implement it using data structures, functions or macros. Let’s see what those different DSLs would look like:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 1. data structures</span>
<span class="kn">import</span> <span class="no">Validator</span>
<span class="n">validate</span> <span class="n">user</span><span class="p">,</span> <span class="ss">name:</span> <span class="p">[</span><span class="ss">length:</span> <span class="mi">1</span><span class="o">..</span><span class="mi">100</span><span class="p">],</span>
               <span class="ss">email:</span> <span class="p">[</span><span class="ss">matches:</span> <span class="sr">~r/@/</span><span class="p">]</span>

<span class="c1"># 2. functions</span>
<span class="kn">import</span> <span class="no">Validator</span>
<span class="n">user</span>
<span class="o">|&gt;</span> <span class="n">validate_length</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="mi">1</span><span class="o">..</span><span class="mi">100</span><span class="p">)</span>
<span class="o">|&gt;</span> <span class="n">validate_matches</span><span class="p">(</span><span class="ss">:email</span><span class="p">,</span> <span class="sr">~r/@/</span><span class="p">)</span>

<span class="c1"># 3. macros + modules</span>
<span class="k">defmodule</span> <span class="no">MyValidator</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Validator</span>
  <span class="n">validate_length</span> <span class="ss">:name</span><span class="p">,</span> <span class="mi">1</span><span class="o">..</span><span class="mi">100</span>
  <span class="n">validate_matches</span> <span class="ss">:email</span><span class="p">,</span> <span class="sr">~r/@/</span>
<span class="k">end</span>

<span class="no">MyValidator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</code></pre></div></div>

<p>Of all the approaches above, the first is definitely the most flexible. If our domain rules can be encoded with data structures, they are by far the easiest to compose and implement, as Elixir’s standard library is filled with functions for manipulating different data types.</p>

<p>The second approach uses function calls which better suits more complex APIs (for example, if you need to pass many options) and reads nicely in Elixir thanks to the pipe operator.</p>

<p>The third approach uses macros, and is by far the most complex. It will take more lines of code to implement, it is hard and expensive to test (compared to testing simple functions), and it limits how the user may use the library since all validations need to be defined inside a module.</p>

<p>To drive the point home, imagine you want to validate a certain attribute only if a given condition is met. We could easily achieve it with the first solution, by manipulating the data structure accordingly, or with the second solution by using conditionals (if/else) before invoking the function. However, it is impossible to do so with the macros approach unless its DSL is augmented.</p>

<p>In other words:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>data &gt; functions &gt; macros
</code></pre></div></div>

<p>That said, there are still cases where using macros and modules to build domain-specific languages is useful. Since we have explored data structures and function definitions in the Getting Started guide, this chapter will explore how to use macros and module attributes to tackle more complex DSLs.</p>

<h2 id="building-our-own-test-case" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Building our own test case</span><a href="#building-our-own-test-case" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>The goal in this chapter is to build a module named <code class="language-plaintext highlighter-rouge">TestCase</code> that allows us to write the following:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">MyTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">TestCase</span>

  <span class="n">test</span> <span class="s2">"arithmetic operations"</span> <span class="k">do</span>
    <span class="mi">4</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span>
  <span class="k">end</span>

  <span class="n">test</span> <span class="s2">"list operations"</span> <span class="k">do</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">++</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">MyTest</span><span class="o">.</span><span class="n">run</span>
</code></pre></div></div>

<p>In the example above, by using <code class="language-plaintext highlighter-rouge">TestCase</code>, we can write tests using the <code class="language-plaintext highlighter-rouge">test</code> macro, which defines a function named <code class="language-plaintext highlighter-rouge">run</code> to automatically run all tests for us. Our prototype will rely on the match operator (<code class="language-plaintext highlighter-rouge">=</code>) as a mechanism to do assertions.</p>

<h2 id="the-test-macro" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">The <code class="language-plaintext highlighter-rouge">test</code> macro</span><a href="#the-test-macro" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Let’s start by creating a module that defines and imports the <code class="language-plaintext highlighter-rouge">test</code> macro when used:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">TestCase</span> <span class="k">do</span>
  <span class="c1"># Callback invoked by `use`.</span>
  <span class="c1">#</span>
  <span class="c1"># For now it returns a quoted expression that</span>
  <span class="c1"># imports the module itself into the user code.</span>
  <span class="nv">@doc</span> <span class="no">false</span>
  <span class="k">defmacro</span> <span class="n">__using__</span><span class="p">(</span><span class="n">_opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span>
      <span class="kn">import</span> <span class="no">TestCase</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="nv">@doc</span> <span class="sd">"""
  Defines a test case with the given description.

  ## Examples

      test "arithmetic operations" do
        4 = 2 + 2
      end

  """</span>
  <span class="k">defmacro</span> <span class="n">test</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">block</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">function_name</span> <span class="o">=</span> <span class="no">String</span><span class="o">.</span><span class="n">to_atom</span><span class="p">(</span><span class="s2">"test "</span> <span class="o">&lt;&gt;</span> <span class="n">description</span><span class="p">)</span>
    <span class="kn">quote</span> <span class="k">do</span>
      <span class="k">def</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">function_name</span><span class="p">)(),</span> <span class="k">do</span><span class="p">:</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Assuming we defined <code class="language-plaintext highlighter-rouge">TestCase</code> in a file named <code class="language-plaintext highlighter-rouge">tests.exs</code>, we can open it up by running <code class="language-plaintext highlighter-rouge">iex tests.exs</code> and define our first tests:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">defmodule</span> <span class="no">MyTest</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="kn">use</span> <span class="no">TestCase</span>
<span class="o">...&gt;</span>
<span class="o">...&gt;</span>   <span class="n">test</span> <span class="s2">"hello"</span> <span class="k">do</span>
<span class="o">...&gt;</span>     <span class="s2">"hello"</span> <span class="o">=</span> <span class="s2">"world"</span>
<span class="o">...&gt;</span>   <span class="k">end</span>
<span class="o">...&gt;</span> <span class="k">end</span>
</code></pre></div></div>

<p>For now, we don’t have a mechanism to run tests, but we know that a function named “test hello” was defined behind the scenes. When we invoke it, it should fail:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">MyTest</span><span class="o">.</span><span class="s2">"test hello"</span><span class="p">()</span>
<span class="o">**</span> <span class="p">(</span><span class="no">MatchError</span><span class="p">)</span> <span class="n">no</span> <span class="n">match</span> <span class="n">of</span> <span class="n">right</span> <span class="n">hand</span> <span class="n">side</span> <span class="ss">value:</span> <span class="s2">"world"</span>
</code></pre></div></div>

<h2 id="storing-information-with-attributes" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Storing information with attributes</span><a href="#storing-information-with-attributes" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>In order to finish our <code class="language-plaintext highlighter-rouge">TestCase</code> implementation, we need to be able to access all defined test cases. One way of doing this is by retrieving the tests at runtime via <code class="language-plaintext highlighter-rouge">__MODULE__.__info__(:functions)</code>, which returns a list of all functions in a given module. However, considering that we may want to store more information about each test besides the test name, a more flexible approach is required.</p>

<p>When discussing module attributes in earlier chapters, we mentioned how they can be used as temporary storage. That’s exactly the property we will apply in this section.</p>

<p>In the <code class="language-plaintext highlighter-rouge">__using__/1</code> implementation, we will initialize a module attribute named <code class="language-plaintext highlighter-rouge">@tests</code> to an empty list, then store the name of each defined test in this attribute so the tests can be invoked from the <code class="language-plaintext highlighter-rouge">run</code> function.</p>

<p>Here is the updated code for the <code class="language-plaintext highlighter-rouge">TestCase</code> module:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">TestCase</span> <span class="k">do</span>
  <span class="nv">@doc</span> <span class="no">false</span>
  <span class="k">defmacro</span> <span class="n">__using__</span><span class="p">(</span><span class="n">_opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span>
      <span class="kn">import</span> <span class="no">TestCase</span>

      <span class="c1"># Initialize @tests to an empty list</span>
      <span class="nv">@tests</span> <span class="p">[]</span>

      <span class="c1"># Invoke TestCase.__before_compile__/1 before the module is compiled</span>
      <span class="nv">@before_compile</span> <span class="no">TestCase</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="nv">@doc</span> <span class="sd">"""
  Defines a test case with the given description.

  ## Examples

      test "arithmetic operations" do
        4 = 2 + 2
      end

  """</span>
  <span class="k">defmacro</span> <span class="n">test</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">block</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">function_name</span> <span class="o">=</span> <span class="no">String</span><span class="o">.</span><span class="n">to_atom</span><span class="p">(</span><span class="s2">"test "</span> <span class="o">&lt;&gt;</span> <span class="n">description</span><span class="p">)</span>
    <span class="kn">quote</span> <span class="k">do</span>
      <span class="c1"># Prepend the newly defined test to the list of tests</span>
      <span class="nv">@tests</span> <span class="p">[</span><span class="kn">unquote</span><span class="p">(</span><span class="n">function_name</span><span class="p">)</span> <span class="o">|</span> <span class="nv">@tests</span><span class="p">]</span>
      <span class="k">def</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">function_name</span><span class="p">)(),</span> <span class="k">do</span><span class="p">:</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c1"># This will be invoked right before the target module is compiled</span>
  <span class="c1"># giving us the perfect opportunity to inject the `run/0` function</span>
  <span class="nv">@doc</span> <span class="no">false</span>
  <span class="k">defmacro</span> <span class="n">__before_compile__</span><span class="p">(</span><span class="n">_env</span><span class="p">)</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span>
      <span class="k">def</span> <span class="n">run</span> <span class="k">do</span>
        <span class="no">Enum</span><span class="o">.</span><span class="n">each</span> <span class="nv">@tests</span><span class="p">,</span> <span class="k">fn</span> <span class="n">name</span> <span class="o">-&gt;</span>
          <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="s2">"Running </span><span class="si">#{</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
          <span class="n">apply</span><span class="p">(</span><span class="bp">__MODULE__</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>By starting a new IEx session, we can now define our tests and run them:</p>

<div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="k">defmodule</span> <span class="no">MyTest</span> <span class="k">do</span>
<span class="o">...&gt;</span>   <span class="kn">use</span> <span class="no">TestCase</span>
<span class="o">...&gt;</span>
<span class="o">...&gt;</span>   <span class="n">test</span> <span class="s2">"hello"</span> <span class="k">do</span>
<span class="o">...&gt;</span>     <span class="s2">"hello"</span> <span class="o">=</span> <span class="s2">"world"</span>
<span class="o">...&gt;</span>   <span class="k">end</span>
<span class="o">...&gt;</span> <span class="k">end</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">MyTest</span><span class="o">.</span><span class="n">run</span>
<span class="no">Running</span> <span class="n">test</span> <span class="n">hello</span>
<span class="o">**</span> <span class="p">(</span><span class="no">MatchError</span><span class="p">)</span> <span class="n">no</span> <span class="n">match</span> <span class="n">of</span> <span class="n">right</span> <span class="n">hand</span> <span class="n">side</span> <span class="ss">value:</span> <span class="s2">"world"</span>
</code></pre></div></div>

<p>Although we have overlooked some details, this is the main idea behind creating domain-specific modules in Elixir. Macros enable us to return quoted expressions that are executed in the caller, which we can then use to transform code and store relevant information in the target module via module attributes. Finally, callbacks such as <code class="language-plaintext highlighter-rouge">@before_compile</code> allow us to inject code into the module when its definition is complete.</p>

<p>Besides <code class="language-plaintext highlighter-rouge">@before_compile</code>, there are other useful module attributes like <code class="language-plaintext highlighter-rouge">@on_definition</code> and <code class="language-plaintext highlighter-rouge">@after_compile</code>, which you can read more about in <a href="https://hexdocs.pm/elixir/Module.html">the docs for the <code class="language-plaintext highlighter-rouge">Module</code> module</a>. You can also find useful information about macros and the compilation environment in the documentation for the <a href="https://hexdocs.pm/elixir/Macro.html"><code class="language-plaintext highlighter-rouge">Macro</code> module</a> and <a href="https://hexdocs.pm/elixir/Macro.Env.html"><code class="language-plaintext highlighter-rouge">Macro.Env</code></a>.</p>

  </article><!-- .hfeed -->

  
  
  
  
  

  
  
    
  
    
  
    
      
        
        
      
        
        
      
        
          <div class="pagination loop-pagination">
            
              <a href="/getting-started/meta/macros.html" class="previous page-numbers spec" title="Macros">← Previous</a>
            
              <a class="page-numbers spec" href="#container">Top</a>
            
          </div>
        
        
      
    
  

  <div id="edit-on-github">
    <span>Is something wrong?</span>
    <a href="https://github.com/elixir-lang/elixir-lang.github.com/edit/main/getting-started/meta/domain-specific-languages.markdown">
      Edit this page on GitHub.
    </a>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><br></div></div><div class="wrap" path="/install.html" page=":INSTALL:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="content">
  
<h1 id="install">Install</h1>

<div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#distributions">Distributions</a><ol><li><a href="#macos">macOS</a></li><li><a href="#gnulinux">GNU/Linux</a></li><li><a href="#bsd">BSD</a></li><li><a href="#windows">Windows</a></li><li><a href="#raspberry-pi-and-embedded-devices">Raspberry Pi and embedded devices</a></li><li><a href="#docker">Docker</a></li></ol></li><li><a href="#precompiled-package">Precompiled package</a><ol><li><a href="#mirrors-and-nightly-builds">Mirrors and nightly builds</a></li></ol></li><li><a href="#compiling-with-version-managers">Compiling with version managers</a></li><li><a href="#compiling-from-source-unix-and-mingw">Compiling from source (Unix and MinGW)</a></li><li><a href="#installing-erlang">Installing Erlang</a></li><li><a href="#setting-path-environment-variable">Setting PATH environment variable</a></li><li><a href="#checking-the-installed-version-of-elixir">Checking the installed version of Elixir</a></li></ol></div>

<p>The quickest way to install Elixir is through a distribution or using one of the available installers. If not available, then we recommend the precompiled packages or compiling it.</p>

<p>Note that Elixir v1.14 requires Erlang 23.0 or later. Many of the instructions below will automatically install Erlang for you. In case they do not, read the “Installing Erlang” section below.</p>

<h2 id="distributions" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Distributions</span><a href="#distributions" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>The preferred option for installing Elixir. Choose your operating system and tool.</p>

<p><strong>If your distribution contains an old Elixir/Erlang version, see the sections below for installing Elixir/Erlang from version managers or from source</strong>.</p>

<h3 id="macos" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">macOS</span><a href="#macos" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<ul>
  <li>Using <a href="https://brew.sh/">Homebrew</a>:
    <ul>
      <li>Run: <code class="language-plaintext highlighter-rouge">brew install elixir</code></li>
    </ul>
  </li>
  <li>Using <a href="https://www.macports.org/">Macports</a>:
    <ul>
      <li>Run: <code class="language-plaintext highlighter-rouge">sudo port install elixir</code></li>
    </ul>
  </li>
</ul>

<h3 id="gnulinux" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">GNU/Linux</span><a href="#gnulinux" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<ul>
  <li><strong>Alpine Linux</strong> (Community repository)
    <ul>
      <li>Run: <code class="language-plaintext highlighter-rouge">apk add elixir</code></li>
    </ul>
  </li>
  <li><strong>Arch Linux</strong> (Community repository)
    <ul>
      <li>Run: <code class="language-plaintext highlighter-rouge">pacman -S elixir</code></li>
    </ul>
  </li>
  <li><strong>Debian</strong>
    <ul>
      <li>Run: <code class="language-plaintext highlighter-rouge">sudo apt-get install elixir</code></li>
    </ul>
  </li>
  <li><strong>Fedora 21 (and older)</strong>
    <ul>
      <li>Run: <code class="language-plaintext highlighter-rouge">yum install elixir</code></li>
    </ul>
  </li>
  <li><strong>Fedora 22 (and newer)</strong>
    <ul>
      <li>Run <code class="language-plaintext highlighter-rouge">dnf install elixir erlang</code></li>
    </ul>
  </li>
  <li><strong>Gentoo</strong>
    <ul>
      <li>Run: <code class="language-plaintext highlighter-rouge">emerge --ask dev-lang/elixir</code></li>
    </ul>
  </li>
  <li><strong>GNU Guix</strong>
    <ul>
      <li>Run: <code class="language-plaintext highlighter-rouge">guix package -i elixir</code></li>
    </ul>
  </li>
  <li><strong>openSUSE (and SLES)</strong>
    <ul>
      <li>Add Elixir/Erlang repository: <code class="language-plaintext highlighter-rouge">zypper ar -f obs://devel:languages:erlang/ Elixir-Factory</code></li>
      <li>Run: <code class="language-plaintext highlighter-rouge">zypper in elixir</code></li>
      <li>Optional: if you want to use the latest Erlang, you can use this repository: <code class="language-plaintext highlighter-rouge">zypper ar -f  obs://devel:languages:erlang:Factory Erlang-Factory</code></li>
    </ul>
  </li>
  <li><strong>Slackware</strong>
    <ul>
      <li>Using Sbopkg:
        <ul>
          <li>Run: <code class="language-plaintext highlighter-rouge">sbopkg -ki "erlang-otp elixir"</code></li>
        </ul>
      </li>
      <li>Manually:
        <ul>
          <li>Download, build and install from SlackBuilds.org: <a href="https://slackbuilds.org/repository/14.2/development/erlang-otp/"><code class="language-plaintext highlighter-rouge">erlang-otp</code></a>, and <a href="https://slackbuilds.org/repository/14.2/development/elixir"><code class="language-plaintext highlighter-rouge">elixir</code></a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Solus</strong>
    <ul>
      <li>Run: <code class="language-plaintext highlighter-rouge">eopkg install elixir</code></li>
    </ul>
  </li>
  <li><strong>Ubuntu</strong>
    <ul>
      <li>Run: <code class="language-plaintext highlighter-rouge">sudo apt-get install elixir</code></li>
    </ul>
  </li>
  <li><strong>Void Linux</strong>
    <ul>
      <li>Run: <code class="language-plaintext highlighter-rouge">xbps-install -S elixir</code></li>
    </ul>
  </li>
</ul>

<h3 id="bsd" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">BSD</span><a href="#bsd" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<ul>
  <li><strong>FreeBSD</strong>
    <ul>
      <li>The latest Elixir release is named <a href="https://freshports.org/lang/elixir-devel">lang/elixir-devel</a>.
The default Elixir, <a href="https://freshports.org/lang/elixir">lang/elixir</a>, may
lag slightly as dependent ports are often not able to be updated to the
newest Elixir release immediately.</li>
      <li>Using ports:
        <ul>
          <li>Run: <code class="language-plaintext highlighter-rouge">cd /usr/ports/lang/elixir &amp;&amp; make install clean</code></li>
        </ul>
      </li>
      <li>Using pkg:
        <ul>
          <li>Run: <code class="language-plaintext highlighter-rouge">pkg install elixir</code> or <code class="language-plaintext highlighter-rouge">pkg install elixir-devel</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>OpenBSD</strong>
    <ul>
      <li>Run: <code class="language-plaintext highlighter-rouge">pkg_add elixir</code></li>
    </ul>
  </li>
</ul>

<h3 id="windows" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Windows</span><a href="#windows" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<ul>
  <li>Using our web installer:
    <ul>
      <li><a href="https://github.com/elixir-lang/elixir-windows-setup/releases/download/v2.4/elixir-websetup.exe">Download the installer</a></li>
      <li>Click next, next, …, finish</li>
      <li>If you run into issues, check out the <a href="https://github.com/elixir-lang/elixir-windows-setup">Windows Installer issues tracker</a></li>
    </ul>
  </li>
  <li>Using Scoop:
    <ul>
      <li>Install Erlang: <code class="language-plaintext highlighter-rouge">scoop install erlang</code></li>
      <li>Install Elixir: <code class="language-plaintext highlighter-rouge">scoop install elixir</code></li>
    </ul>
  </li>
  <li>Using <a href="https://community.chocolatey.org/">Chocolatey</a>:
    <ul>
      <li>Install Elixir (installs Erlang as a dependency): <code class="language-plaintext highlighter-rouge">choco install elixir</code></li>
    </ul>
  </li>
</ul>

<h3 id="raspberry-pi-and-embedded-devices" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Raspberry Pi and embedded devices</span><a href="#raspberry-pi-and-embedded-devices" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>To build and package an Elixir application, with the whole operating system, and burn that into a disk or deploy it overwhere, <a href="https://www.nerves-project.org">check out the Nerves project</a>.</p>

<p>If you want to install Elixir as part of an existing Operating System, please follow the relevant steps above for your Operating System or install from precompiled/source.</p>

<h3 id="docker" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Docker</span><a href="#docker" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>If you are familiar with Docker you can use the official Docker image to get started quickly with Elixir.</p>

<ul>
  <li>Enter interactive mode
    <ul>
      <li>Run: <code class="language-plaintext highlighter-rouge">docker run -it --rm elixir</code></li>
    </ul>
  </li>
  <li>Enter bash within container with installed <code class="language-plaintext highlighter-rouge">elixir</code>
    <ul>
      <li>Run: <code class="language-plaintext highlighter-rouge">docker run -it --rm elixir bash</code></li>
    </ul>
  </li>
</ul>

<p>The above will automatically point to the latest Erlang and Elixir available. For production usage, we recommend using <a href="https://hub.docker.com/r/hexpm/elixir">Hex.pm Docker images</a>, which are immutable and point to a specific Erlang and Elixir version.</p>

<h2 id="precompiled-package" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Precompiled package</span><a href="#precompiled-package" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Elixir provides a precompiled package for every release. First <a href="/install.html#installing-erlang">install Erlang</a> and then download the appropriate precompiled Elixir below. You can consult your Erlang/OTP version by running <code class="language-plaintext highlighter-rouge">erl -s halt</code>:</p>

<ul>
  <li><a href="https://github.com/elixir-lang/elixir/releases/download/v1.14.3/elixir-otp-25.zip">Elixir 1.14.3 on Erlang 25</a></li>
  <li><a href="https://github.com/elixir-lang/elixir/releases/download/v1.14.3/elixir-otp-24.zip">Elixir 1.14.3 on Erlang 24</a></li>
  <li><a href="https://github.com/elixir-lang/elixir/releases/download/v1.14.3/elixir-otp-23.zip">Elixir 1.14.3 on Erlang 23</a></li>
</ul>

<p>Once you download the release, unpack it, and you are ready to run the <code class="language-plaintext highlighter-rouge">elixir</code> and <code class="language-plaintext highlighter-rouge">iex</code> commands from the <code class="language-plaintext highlighter-rouge">bin</code> directory. However, we recommend you to <a href="#setting-path-environment-variable">add Elixir’s bin path to your PATH environment variable</a> to ease development.</p>

<h3 id="mirrors-and-nightly-builds" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Mirrors and nightly builds</span><a href="#mirrors-and-nightly-builds" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h3>

<p>The links above point directly to the GitHub release. We also host and mirror precompiled packages and nightly builds globally via <code class="language-plaintext highlighter-rouge">repo.hex.pm</code> using the following URL scheme:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://repo.hex.pm/builds/elixir/${ELIXIR_VERSION}-otp-${OTP_VERSION}.zip
</code></pre></div></div>

<p>For example, to use Elixir v1.13.3 with Erlang/OTP 24.x, use:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://repo.hex.pm/builds/elixir/v1.13.3-otp-24.zip
</code></pre></div></div>

<p>To use nightly for a given Erlang/OTP version (such as 25), use:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://repo.hex.pm/builds/elixir/main-otp-25.zip
</code></pre></div></div>

<h2 id="compiling-with-version-managers" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Compiling with version managers</span><a href="#compiling-with-version-managers" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>There are many tools that allow developers to install and manage multiple Erlang and Elixir versions. They are useful if you have multiple projects running on different Elixir or Erlang versions, can’t install Erlang or Elixir as mentioned above or if the version provided by your package manager is outdated. Here are some of those tools:</p>

<ul>
  <li><a href="https://github.com/asdf-vm/asdf">asdf</a> - install and manage different <a href="https://github.com/asdf-vm/asdf-elixir">Elixir</a> and <a href="https://github.com/asdf-vm/asdf-erlang">Erlang</a> versions</li>
  <li><a href="https://github.com/taylor/kiex">kiex</a> - install and manage different Elixir versions</li>
  <li><a href="https://github.com/yrashk/kerl">kerl</a> - install and manage different Erlang versions</li>
</ul>

<p>Keep in mind that each Elixir version supports specific Erlang/OTP versions. <a href="https://hexdocs.pm/elixir/compatibility-and-deprecations.html#compatibility-between-elixir-and-erlang-otp">Check the compatibility table</a> if you have questions or run into issues.</p>

<p>If you would prefer to compile from source manually, don’t worry, we got your back too.</p>

<h2 id="compiling-from-source-unix-and-mingw" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Compiling from source (Unix and MinGW)</span><a href="#compiling-from-source-unix-and-mingw" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>You can download and compile Elixir in few steps. The first one is to <a href="/install.html#installing-erlang">install Erlang</a>.</p>

<p>Next you should download source code (<a href="https://github.com/elixir-lang/elixir/archive/v1.14.3.zip">.zip</a>, <a href="https://github.com/elixir-lang/elixir/archive/v1.14.3.tar.gz">.tar.gz</a>) of the <a href="https://github.com/elixir-lang/elixir/releases/tag/v1.14.3">latest release</a>, unpack it and then run <code class="language-plaintext highlighter-rouge">make</code> inside the unpacked directory (note: if you are running on Windows, <a href="https://github.com/elixir-lang/elixir/wiki/Windows">read this page on setting up your environment for compiling Elixir</a>).</p>

<p>After compiling, you are ready to run the elixir and <code class="language-plaintext highlighter-rouge">iex</code> commands from the bin directory. It is recommended that you <a href="#setting-path-environment-variable">add Elixir’s bin path to your PATH environment variable</a> to ease development.</p>

<p>In case you are feeling a bit more adventurous, you can also compile from main:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone https://github.com/elixir-lang/elixir.git
<span class="nv">$ </span><span class="nb">cd </span>elixir
<span class="nv">$ </span>make clean <span class="nb">test</span>
</code></pre></div></div>

<p>If the tests pass, you are ready to go. Otherwise, feel free to open an issue <a href="https://github.com/elixir-lang/elixir">in the issues tracker on GitHub</a>.</p>

<h2 id="installing-erlang" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Installing Erlang</span><a href="#installing-erlang" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>The only prerequisite for Elixir is Erlang, version 23.0 or later. When installing Elixir, Erlang is generally installed automatically for you. However, if you want to install Erlang manually, you might check:</p>

<ul>
  <li><a href="http://www.erlang.org/downloads.html">Source code distribution and Windows installers from Erlang’s official website</a></li>
  <li><a href="https://www.erlang-solutions.com/resources/download.html">Precompiled packages for some Unix-like installations</a></li>
  <li><a href="https://docs.riak.com/riak/kv/latest/setup/installing/source/erlang/">A general list of installation methods from the Riak documentation</a>.</li>
</ul>

<p>After Erlang is installed, you should be able to open up the command line (or command prompt) and check the Erlang version by typing <code class="language-plaintext highlighter-rouge">erl -s erlang halt</code>. You will see some information similar to:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Erlang/OTP 23.0 [64-bit] [smp:2:2] [...]
</code></pre></div></div>

<p>Notice that depending on how you installed Erlang, Erlang binaries might not be available in your PATH. Be sure to have Erlang binaries in your <a href="https://en.wikipedia.org/wiki/Environment_variable">PATH</a>, otherwise Elixir won’t work!</p>

<h2 id="setting-path-environment-variable" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Setting PATH environment variable</span><a href="#setting-path-environment-variable" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>It is highly recommended to add Elixir’s bin path to your PATH environment variable to ease development.</p>

<p>On Windows, there are <a href="http://www.computerhope.com/issues/ch000549.htm">instructions for different versions</a> explaining the process.</p>

<p>On Unix systems, you need to <a href="https://unix.stackexchange.com/a/117470/101951">find your shell profile file</a>, and then add to the end of this file the following line reflecting the path to your Elixir installation:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PATH</span><span class="s2">:/path/to/elixir/bin"</span>
</code></pre></div></div>

<h2 id="checking-the-installed-version-of-elixir" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Checking the installed version of Elixir</span><a href="#checking-the-installed-version-of-elixir" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<p>Once you have Elixir installed, you can check its version by running <code class="language-plaintext highlighter-rouge">elixir --version</code>.</p>

</div><!-- #content -->

<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>

  <div class="widget">
  <h3 class="widget-title">Important links</h3>
  <ul>
    <li class="menu-item development"><a class="spec" href="/development.html">Development &amp; Team</a></li>
    <li><a class="spec" href="https://github.com/elixir-lang/elixir">Source code &amp; issues tracker</a></li>
  </ul>
</div>

<div id="mini-docu" class="widget">
  <a href="https://cult.honeypot.io/originals/elixir-the-documentary">
    <div class="mini-docu-cta">
      <div class="mini-docu-copy">Watch the Elixir<br>mini-documentary!</div>
    </div>
  </a>
</div>

<!-- <div class="widget events">
  <h3 class="widget-title">Upcoming events</h3>
  
</div> -->


<div class="widget">
  <h3 class="widget-title">Join the Community</h3>
  <ul>
    <li><a class="spec" href="https://hex.pm">Hex.pm package manager</a></li>
    <li><a class="spec" href="https://twitter.com/elixirlang">@elixirlang on Twitter</a></li>
    <li><a class="spec" href="irc://irc.libera.chat/elixir">#elixir on irc.libera.chat</a></li>
    <li><a class="spec" href="http://elixirforum.com">Elixir Forum</a></li>
    <li><a class="spec" href="https://elixir-slackin.herokuapp.com/">Elixir on Slack</a></li>
    <li><a class="spec" href="https://discord.gg/elixir">Elixir on Discord</a></li>
    <li><a class="spec" href="https://www.meetup.com/topics/elixir/">Meetups around the world</a></li>
    <li><a class="spec" href="https://github.com/elixir-lang/elixir/wiki">Wiki with events and resources maintained by the community</a></li>
  </ul>
</div>

<div id="eef" class="widget">
  <a href="https://erlef.org/" title="Join the Erlang Ecosystem Foundation"><img src="/images/logo/eef.png" alt="Join the Erlang Ecosystem Foundation" width="174" style="margin-top:-10px"></a>
</div>

</div>

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/learning.html" page=":LEARNING:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="content">
  <h1 id="learning">Learning</h1>

<div id="toc" class="toc"> <ol class="jekyll-toc"><li><a href="#books">Books</a></li><li><a href="#in-depth-books">In-depth books</a></li><li><a href="#courses">Courses</a></li><li><a href="#screencasts">Screencasts</a></li><li><a href="#other-resources">Other resources</a></li></ol></div>

<p>Our website provides a <a href="/getting-started/introduction.html">Getting Started guide</a> to learn more about Elixir’s foundations. Later on, it explores how to build projects with <a href="/getting-started/mix-otp/introduction-to-mix.html">Mix and OTP</a>. Elixir also includes <a href="/docs.html">extensive API documentation</a>.</p>

<p>Outside of our website, the Elixir Community has also produced plenty of resources to learn the language from different backgrounds and other perspectives. We list some of them below. We are sure you will find a resource that suits your pace and goals.</p>

<h2 id="books" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Books</span><a href="#books" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<h4 class="resource">Elixir in Action</h4>

<p><a class="cover" href="https://www.manning.com/books/elixir-in-action-second-edition" title="Elixir in Action – by Saša Jurić"><img src="/images/learning/elixir-in-action.jpg" alt="Elixir in Action cover" width="190"></a></p>

<p>Elixir in Action is a tutorial book that aims to bring developers new to Elixir and Erlang to the point where they can develop complex systems on their own. No knowledge about Elixir, Erlang, or functional programming is required, but it is assumed that a reader has a few years of production experience using mainstream OO languages, for example C#, Java, Python, or Ruby.</p>

<p>The book starts with a basic introduction to the Elixir language and functional programming idioms. The central part of the book deals with Erlang VM and OTP, discussing topics such as concurrent programming, fault-tolerance, and distributed systems. Finally, you’ll learn how to package your code into components, create a standalone deployable release, and troubleshoot the running system. The theory is demonstrated through a simplistic example that is gradually expanded throughout the book into a fully standalone releasable system.</p>

<div class="clear"></div>

<h4 class="resource">Programming Elixir 1.6</h4>

<p><a class="cover" href="https://pragprog.com/book/elixir16/programming-elixir-1-6" title="Programming Elixir 1.6: Functional |> Concurrent |> Pragmatic |> Fun – by Dave Thomas"><img src="/images/learning/programming-elixir-1-6.jpg" alt="Programming Elixir cover" width="190"></a></p>

<p>This book is the introduction to Elixir for experienced programmers, completely updated for Elixir 1.6 and beyond. Explore functional programming without the academic overtones (tell me about monads just one more time). Create concurrent applications, but get them right without all the locking and consistency headaches.</p>

<p>Meet Elixir, a modern, functional, concurrent language built on the rock-solid Erlang VM. Elixir’s pragmatic syntax and built-in support for metaprogramming will make you productive and keep you interested for the long haul. Maybe the time is right for the Next Big Thing. Maybe it’s Elixir.</p>

<div class="clear"></div>

<h4 class="resource">Adopting Elixir</h4>

<p><a class="cover" href="https://pragprog.com/book/tvmelixir/adopting-elixir" title="Adopting Elixir: From Concept to Production – by Ben Marx, José Valim, Bruce Tate"><img src="/images/learning/adopting-elixir.jpg" alt="Programming Elixir cover" width="190"></a></p>

<p>Adoption is more than programming. Elixir is an exciting new language, but to successfully get your application from start to finish, you’re going to need to know more than just the language. You need the case studies and strategies in this book.</p>

<p>Learn the best practices for the whole life of your application, from design and team-building, to managing stakeholders, to deployment and monitoring. Go beyond the syntax and the tools to learn the techniques you need to develop your Elixir application from concept to production.</p>

<div class="clear"></div>

<h4 class="resource">Joy of Elixir</h4>

<p><a class="cover" href="http://joyofelixir.com" title="Joy of Elixir"><img src="/images/learning/joy-of-elixir.jpg" alt="Joy of Elixir" width="190"></a></p>

<p><a href="https://joyofelixir.com">Joy of Elixir</a> is a gentle introduction to programming, aimed at people who already know some things about computers, but who have little-to-no programming experience.</p>

<p>This book will teach you the core concepts of the Elixir programming language in a fun and enjoyable way. If you’re completely new to programming and you want to learn how to make a computer do things using the power of programming and you want to experience some joy while doing it, then read this book!</p>

<div class="clear"></div>

<h4 class="resource">Learn Functional Programming With Elixir</h4>

<p><a class="cover" href="https://pragprog.com/book/cdc-elixir/learn-functional-programming-with-elixir" title="Learn Functional Programming With Elixir: New Foundations for a New World – by Ulisses Almeida"><img src="/images/learning/learn-functional-programming-with-elixir.jpg" alt="Learn Functional Programming with Elixir cover" width="190"></a></p>

<p>Elixir’s straightforward syntax and this guided tour give you a clean, simple path to learn modern functional programming techniques. No previous functional programming experience required! This book walks you through the right concepts at the right pace, as you explore immutable values and explicit data transformation, functions, modules, recursive functions, pattern matching, high-order functions, polymorphism, and failure handling, all while avoiding side effects. Don’t board the Elixir train with an imperative mindset! To get the most out of functional languages, you need to think functionally. This book will get you there.</p>

<div class="clear"></div>

<h4 class="resource">The Toy Robot Walkthrough</h4>

<p><a class="cover" href="http://leanpub.com/elixir-toyrobot" title="The Toy Robot Walkthrough - Elixir Version"><img src="/images/learning/toy-robot.png" alt="Toy Robot" width="190"></a></p>

<p><a href="http://leanpub.com/elixir-toyrobot">The Toy Robot</a> is a common interview exercise for new programmers. This short book will take you through how to implement it in Elixir in a BDD-style, with some great explanations and imagery along the way.</p>

<p>If you’re a new Elixir developer who’s gone through some basic Elixir tutorials and you’re looking for the next thing to build your skills, this book is a great start. It covers the Toy Robot exercise from start to finish, testing with Elixir features such as ExUnit and Doctests along the way.</p>

<div class="clear"></div>

<h4 class="resource">Elixir Succinctly<span class="free">free</span></h4>

<p><a class="cover" href="https://www.syncfusion.com/ebooks/elixir-succinctly" title="Elixir Succinctly"><img src="https://cdn.syncfusion.com/content/images/downloads/ebook/ebook-cover/elixir-succinctly.png" alt="Elixir Succinctly" width="190"></a></p>

<p><a href="https://www.syncfusion.com/ebooks/elixir-succinctly">Elixir Succinctly</a> is a free ebook to start learning Elixir. It covers the installation and the first steps with the language and the syntax.  It then describes the Erlang/OTP platform, describing messages, processes, and GenServer. The final part covers the building of a sample Elixir application.</p>

<div class="clear"></div>

<h2 id="in-depth-books" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">In-depth books</span><a href="#in-depth-books" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<h4 class="resource">Metaprogramming Elixir</h4>

<p><a class="cover" href="https://pragprog.com/book/cmelixir/metaprogramming-elixir" title="Metaprogramming Elixir: Write Less Code, Get More Done and Have Fun – by Chris Mccord"><img src="/images/learning/metaprogramming-elixir.jpg" alt="Metaprogramming Elixir cover" width="190"></a></p>

<p>Write code that writes code with Elixir macros. Macros make metaprogramming possible and define the language itself. In this book, you’ll learn how to use macros to extend the language with fast, maintainable code and share functionality in ways you never thought possible. You’ll discover how to extend Elixir with your own first-class features, optimize performance, and create domain-specific languages.</p>

<div class="clear"></div>

<h4 class="resource">Designing Elixir Systems with OTP</h4>

<p><a class="cover" href="https://pragprog.com/book/jgotp/designing-elixir-systems-with-otp" title="Designing Elixir Systems with OTP: Write Highly Scalable, Self-Healing Software with Layers – by James Edward Gray, II and Bruce A. Tate"><img src="/images/learning/designing-elixir-systems.jpg" alt="Designing Elixir Systems with OTP cover" width="190"></a></p>

<p>You know how to code in Elixir; now learn to think in it. Learn to design libraries with intelligent layers that shape the right data structures, flow from one function into the next, and present the right APIs. Embrace the same OTP that’s kept our telephone systems reliable and fast for over 30 years. Move beyond understanding the OTP functions to knowing what’s happening under the hood, and why that matters. Using that knowledge, instinctively know how to design systems that deliver fast and resilient services to your users, all with an Elixir focus.</p>

<div class="clear"></div>

<h4 class="resource">Concurrent Data Processing in Elixir</h4>

<p><a class="cover" href="https://pragprog.com/titles/sgdpelixir/concurrent-data-processing-in-elixir" title="Concurrent Data Processing in Elixir – by Svilen Gospodinov"><img src="/images/learning/concurrent-data-processing.jpg" alt="Concurrent Data Processing cover" width="190"></a></p>

<p>Learn different ways of writing concurrent code in Elixir and increase your application’s performance, without sacrificing scalability or fault-tolerance. Most projects benefit from running background tasks and processing data concurrently, but the world of OTP and various libraries can be challenging. Which Supervisor and what strategy to use? What about GenServer? Maybe you need back-pressure, but is GenStage, Flow, or Broadway a better choice? You will learn everything you need to know to answer these questions, start building highly concurrent applications in no time, and write code that’s not only fast, but also resilient to errors and easy to scale.</p>

<div class="clear"></div>

<h4 class="resource">Erlang in Anger<span class="free">free</span></h4>

<p><a class="cover" href="http://www.erlang-in-anger.com" title="Erlang in Anger – by Fred Hebert"><img src="/images/learning/erlang-in-anger.png" alt="Erlang in Anger cover" width="190"></a></p>

<p>This book intends to be a little guide about how to be the Erlang medic in a time of war. It is first and foremost a collection of tips and tricks to help understand where failures come from, and a dictionary of different code snippets and practices that helped developers debug production systems that were built in Erlang.</p>

<div class="clear"></div>

<h2 id="courses" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Courses</span><a href="#courses" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<h4 class="resource">Elixir School<span class="free">free</span></h4>

<p><a class="cover" href="http://elixirschool.com" title="Elixir School"><img src="/images/learning/elixir-school.jpg" alt="Elixir School" width="190"></a></p>

<p>Elixir-School is an open and community driven effort inspired by Twitter’s Scala School. The site’s content consists of peer-reviewed lessons on various Elixir topics that range in difficulty. The lessons are currently available in over 10 languages to help make programming Elixir more accessible to non-English speakers.</p>

<div class="clear"></div>

<h4 class="resource">Pragmatic Studio's Elixir/OTP Course</h4>

<p><a class="cover" href="https://pragmaticstudio.com/elixir" title="Pragmatic Studio's Elixir/OTP Course"><img src="/images/learning/pragmaticstudio-elixir.png" alt="Pragmatic Studio's Elixir/OTP Course" width="190"></a></p>

<p>Put Elixir and OTP into action as you build a concurrent, fault-tolerant application from scratch in this 6-hour video course from The Pragmatic Studio. By developing a real app with real code, you’ll gain practical experience putting all the pieces together to craft applications the Elixir/OTP way.</p>

<p>The first half of the course focuses on core Elixir facets, principles, and techniques. In the second half, we go beyond the basics and focus on what sets Elixir/OTP apart: concurrent processes, the actor model, OTP behaviors, and fault recovery.</p>

<p>If you’re new to Elixir, you’ll get step-by-step guidance in an engaging format you won’t find anywhere else. If you have experience with Elixir, you’ll gain a deeper understanding of things you’ve been taking for granted and fill in any knowledge gaps.</p>

<div class="clear"></div>

<h4 class="resource">grox.io's Elixir Course</h4>

<p><a class="cover" href="https://grox.io/language/elixir/course" title="grox.io's Multi-Format Elixir Course"><img src="/images/learning/groxio-elixir.png" alt="grox.io's Multi-Format Elixir Course" width="190"></a></p>

<p>Learning complex concepts like programming languages is best with multiple formats. Groxio’s learning method embraces an interactive mini-book for beginners, video overviews for novices, an online book for presenting higher level concepts, videos with live coding to simulate advanced pair programming through projects meaningful to beginners and experts.</p>

<p>The Elixir module is a full program with a book with 80 pages, 8 videos, dozens of exercises, and two full test-first projects. Beginners can learn the language, and experts can fill in typical blind spots like writing sigils, building macros, and using streams.</p>

<div class="clear"></div>

<h4 class="resource">grox.io's OTP Course</h4>

<p><a class="cover" href="https://grox.io/language/otp/course" title="grox.io's Multi-Format OTP Course"><img src="/images/learning/groxio-otp.png" alt="grox.io's Multi-Format OTP Course" width="190"></a></p>

<p>This course teaches OTP from a design perspective by showing a system for breaking projects into layers. This course builds on those layering concepts with a 60 page book, 12 videos, projects, and curated links to go into deeper detail for tricky OTP concepts.</p>

<p>Understand how back-pressure works, step inside supervision trees, and learn to build your dynamic supervisors. Learn OTP for the first time, or solidify your intuition by building the base concepts by reading a book, watching videos, and working through guided projects using Groxio’s blend of media, designed to take you from novice to expert.</p>

<div class="clear"></div>

<h4 class="resource">ThinkingElixir.com's Pattern Matching Course<span class="free">free</span></h4>

<p><a class="cover" href="https://thinkingelixir.com/available-courses/pattern-matching/" title="ThinkingElixir.com's Pattern Matching Course"><img src="/images/learning/thinking-elixir-pattern-matching-course-tile-190px.png" alt="ThinkingElixir.com's Free Pattern Matching Course" width="190"></a></p>

<p>Pattern matching is a really powerful language feature. It is built in to almost every corner or Elixir. In order for you to even <em>read</em> Elixir code and follow along, you have to understand Pattern Matching.</p>

<p>Once you “get” pattern matching, it feels like a super power. Pattern Matching makes new patterns of coding possible. You start to unlearn some of the patterns you’ve used in other languages because now you can create even clearer and more elegant code than was possible before!</p>

<p>The course covers getting setup with Elixir, the data types, how to pattern match each of them, and more! An included TDD project helps you easily apply what you’re learning.</p>

<div class="clear"></div>

<h4 class="resource">LearnElixir.tv</h4>

<p><a class="cover" href="http://www.learnelixir.tv" title="Your video guide to Elixir: Learn it step by step.">
  <img src="/images/learning/learn-elixir-tv.png" alt="LearnElixir.tv cover" width="190">
</a></p>

<p>LearnElixir.tv is a video course which provides in-depth, step-by-step videos about Elixir’s main features. Videos range from 7 to 15 minutes in length.</p>

<p>It’s intended to help beginners get familiar with all of Elixir’s features by building their knowledge incrementally. Experienced Elixir developers might also learn a trick or two.</p>

<div class="clear"></div>

<h4 class="resource">Educative.io's Metaprogramming in Elixir Course</h4>

<p><a class="cover" href="https://www.educative.io/courses/metaprogramming-elixir" title="Educative.io's Metaprogramming in Elixir Course">
  <img src="/images/learning/educative-io-metaprogramming.png" alt="Educative.io's Metaprogramming in Elixir Course" width="190">
</a></p>

<p>Get introduced to the concept of metaprogramming. Learn how to level up your programming skills by discovering the full potential of the macro system in Elixir. Understand the ins and outs of metaprogramming at a fundamental level and write incredible libraries by doing more with less code.</p>

<div class="clear"></div>

<h4 class="resource">Learn-Elixir.dev</h4>

<p><a class="cover" href="https://learn-elixir.dev" title="Learn Elixir Development">
  <img src="/images/learning/learn-elixir-dev.png" alt="Learn-Elixir.dev cover" width="190">
</a></p>

<p>At your own pace, progress through 132 videos, 30 quizzes, 9 assignments, and 2 major projects of your choosing to demonstrate your working knowledge of a production-level quality of code. You’ll learn Syntax/Fundamentals,  REST, GraphQL with Absinthe, Phoenix, OTP, Testing, Ecto, architecture, how to scale, how to go distributed, and more…</p>

<p>Join our weekly live coaching sessions every Wednesday at 12:00-noon pacific time to close any gaps in knowledge and get specific answers to your specific questions!</p>

<p>Found your start-up, migrate a codebase, build that app! Our midterm and final projects create a great win-win scenario for you to complete your personal project while mastering the language. Or if you’re more career-focused we can offer referrals, recommendations, or references and host your completed projects on GitHub to show hiring managers your proficiency programming Elixir.</p>

<div class="clear"></div>

<h2 id="screencasts" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Screencasts</span><a href="#screencasts" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<h4 class="resource">ElixirCasts.io<span class="free">free</span></h4>

<p><a class="cover" href="https://elixircasts.io" title="ElixirCasts: Elixir and Phoenix screencasts.">
  <img src="/images/learning/elixircasts.png" alt="elixircasts.io cover" width="190">
</a></p>

<p>ElixirCasts is a collection of simple screencasts that cover a wide range of Elixir and Phoenix topics. Each episode tackles a specific problem or explores a new library, demystifying it in a language that’s easy to understand.</p>

<p>Episodes range from beginner focused to more moderate and advanced topics. Come build your knowledge of Elixir with us, one episode at a time.</p>

<div class="clear"></div>

<h4 class="resource">Alchemist Camp<span class="free">free</span></h4>

<p><a class="cover" href="http://alchemist.camp" title="Alchemist Camp: Learn Elixir and Phoenix by building things"><img src="/images/learning/alchemist-camp.png" alt="Alchemist Camp cover" width="190"></a></p>

<p>Alchemist Camp is the largest producer of free Elixir screencasts and has dozens of hours of screencasts on YouTube. The videos are often longer-form and focused around projects, such as building a small Phoenix clone, or an OTP worker to regularly collect statistics from multiple APIs. Content is driven by viewer request.</p>

<p>Alchemist Camp is aimed at people who have some web development experience and want to ship real-world projects in Elixir.</p>

<div class="clear"></div>

<h2 id="other-resources" class="jekyll-toc-top-level-header jekyll-toc-header"><span class="jekyll-toc-wrapper">Other resources</span><a href="#other-resources" title="Link here" class="jekyll-toc-anchor jekyll-toc-link-here"><span class="jekyll-toc-icon icon icon-link"></span></a><a href="#toc" title="Back to Table of Contents" class="jekyll-toc-anchor jekyll-toc-back-to-top"><span class="jekyll-toc-icon icon icon-chevron-up"></span></a></h2>

<h4 class="resource">Elixir Flashcards</h4>

<p><a class="cover" href="https://elixircards.co.uk/" title="Elixir Flashcards"><img src="/images/learning/flashcards_army.jpg" alt="Elixir Flashcards" width="190"></a></p>

<p>Elixir flashcards are a set of beautifully crafted, professionally printed, poker sized flashcards to help you master the Elixir language.</p>

<p>Flashcards are a great way to highlight knowledge gaps, identify misconceptions or false beliefs, and help you memorise key concepts.
When used in groups or teams, flashcards can help spark interesting discussions, and help bring people together to learn in a fun way by playing games.</p>

<p>Combined with books, tutorials and screencasts, using flashcards is the killer combination to master Elixir.</p>

<div class="clear"></div>

<h4 class="resource">Elixir Koans<span class="free">free</span></h4>

<p><a class="cover" href="http://elixirkoans.io/" title="Elixir Koans"><img src="/images/learning/elixir-koans-logo.png" alt="Elixir Koans" width="190"></a></p>

<p>Elixir koans is a fun, easy way to get started with the Elixir programming language. It is an idiomatic tour of the language.</p>

<div class="clear"></div>

<h4 class="resource">Exercism.io<span class="free">free</span></h4>

<p><a class="cover" href="https://exercism.io/tracks/elixir" title="Elixir Track on Exercism.io"> <img src="https://assets.exercism.io/tracks/elixir-bordered-turquoise.png" alt="Exercism.io Elixir track" width="190"></a></p>

<p>Exercism.io is an open source platform that provides free practice and mentoring in many languages, including Elixir.
It features exercises of varying difficulty, from string processing to using OTP, that are mentored by volunteers.
Once you have completed an exercise you can also view other students’ solutions.</p>

<div class="clear"></div>

<h4 class="resource">Running in Production Podcast<span class="free">free</span></h4>

<p><a class="cover" href="https://runninginproduction.com/tags/elixir" title="Running in Production Podcast"><img src="/images/learning/running-in-production-logo.jpg" alt="Running in Production Podcast" width="190"></a></p>

<p>Running in Production is a podcast where developers and engineers talk about
running small and large Elixir / Phoenix web apps in production.</p>

<p>Topics include tech stacks, success stories, lessons learned and deployment tips.</p>

<div class="clear"></div>

</div><!-- #content -->

<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>

  <div class="widget">
  <h3 class="widget-title">Important links</h3>
  <ul>
    <li class="menu-item development"><a class="spec" href="/development.html">Development &amp; Team</a></li>
    <li><a class="spec" href="https://github.com/elixir-lang/elixir">Source code &amp; issues tracker</a></li>
  </ul>
</div>

<div id="mini-docu" class="widget">
  <a href="https://cult.honeypot.io/originals/elixir-the-documentary">
    <div class="mini-docu-cta">
      <div class="mini-docu-copy">Watch the Elixir<br>mini-documentary!</div>
    </div>
  </a>
</div>

<!-- <div class="widget events">
  <h3 class="widget-title">Upcoming events</h3>
  
</div> -->


<div class="widget">
  <h3 class="widget-title">Join the Community</h3>
  <ul>
    <li><a class="spec" href="https://hex.pm">Hex.pm package manager</a></li>
    <li><a class="spec" href="https://twitter.com/elixirlang">@elixirlang on Twitter</a></li>
    <li><a class="spec" href="irc://irc.libera.chat/elixir">#elixir on irc.libera.chat</a></li>
    <li><a class="spec" href="http://elixirforum.com">Elixir Forum</a></li>
    <li><a class="spec" href="https://elixir-slackin.herokuapp.com/">Elixir on Slack</a></li>
    <li><a class="spec" href="https://discord.gg/elixir">Elixir on Discord</a></li>
    <li><a class="spec" href="https://www.meetup.com/topics/elixir/">Meetups around the world</a></li>
    <li><a class="spec" href="https://github.com/elixir-lang/elixir/wiki">Wiki with events and resources maintained by the community</a></li>
  </ul>
</div>

<div id="eef" class="widget">
  <a href="https://erlef.org/" title="Join the Erlang Ecosystem Foundation"><img src="/images/logo/eef.png" alt="Join the Erlang Ecosystem Foundation" width="174" style="margin-top:-10px"></a>
</div>

</div>

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/docs.html" page=":DOCS:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="content">
  <h1 id="documentation">Documentation</h1>

<p>The Elixir programming language is broken into 6 applications. The links below
reference the documentation for the modules and functions in each of those
applications. For a general introduction to the language, see our <a href="/getting-started/introduction.html">guides</a>.</p>

<h4 id="stable">Stable
  
    <small>(<a href="https://github.com/elixir-lang/elixir/releases/download/v1.14.3/Docs.zip">download</a>)</small>
  
</h4>

<ul>
  <li><a href="https://hexdocs.pm/elixir/">Elixir</a> - standard library</li>
  <li><a href="https://hexdocs.pm/eex/">EEx</a> - templating library</li>
  <li><a href="https://hexdocs.pm/ex_unit/">ExUnit</a> - unit test library</li>
  <li><a href="https://hexdocs.pm/iex/">IEx</a> - interactive shell</li>
  <li><a href="https://hexdocs.pm/logger/">Logger</a> - built-in Logger</li>
  <li><a href="https://hexdocs.pm/mix/">Mix</a> - build tool</li>
</ul>

<h4 id="development">Development</h4>

<ul>
  <li><a href="https://hexdocs.pm/elixir/main/">Elixir</a> - standard library</li>
  <li><a href="https://hexdocs.pm/eex/main/">EEx</a> - templating library</li>
  <li><a href="https://hexdocs.pm/ex_unit/main/">ExUnit</a> - unit test library</li>
  <li><a href="https://hexdocs.pm/iex/main/">IEx</a> - interactive shell</li>
  <li><a href="https://hexdocs.pm/logger/main/">Logger</a> - built-in Logger</li>
  <li><a href="https://hexdocs.pm/mix/main/">Mix</a> - build tool</li>
</ul>

<h4 id="v1.14">v1.14
  <small>(<a href="https://github.com/elixir-lang/elixir/releases/download/v1.14.3/Docs.zip">download</a>)</small>
</h4>

<ul>
  <li><a href="https://hexdocs.pm/elixir/1.14.3/">Elixir</a> - standard library</li>
  <li><a href="https://hexdocs.pm/eex/1.14.3/">EEx</a> - templating library</li>
  <li><a href="https://hexdocs.pm/ex_unit/1.14.3/">ExUnit</a> - unit test library</li>
  <li><a href="https://hexdocs.pm/iex/1.14.3/">IEx</a> - interactive shell</li>
  <li><a href="https://hexdocs.pm/logger/1.14.3/">Logger</a> - built-in Logger</li>
  <li><a href="https://hexdocs.pm/mix/1.14.3/">Mix</a> - build tool</li>
</ul>

<h4 id="v1.13">v1.13
  <small>(<a href="https://github.com/elixir-lang/elixir/releases/download/v1.13.4/Docs.zip">download</a>)</small>
</h4>

<ul>
  <li><a href="https://hexdocs.pm/elixir/1.13.4/">Elixir</a> - standard library</li>
  <li><a href="https://hexdocs.pm/eex/1.13.4/">EEx</a> - templating library</li>
  <li><a href="https://hexdocs.pm/ex_unit/1.13.4/">ExUnit</a> - unit test library</li>
  <li><a href="https://hexdocs.pm/iex/1.13.4/">IEx</a> - interactive shell</li>
  <li><a href="https://hexdocs.pm/logger/1.13.4/">Logger</a> - built-in Logger</li>
  <li><a href="https://hexdocs.pm/mix/1.13.4/">Mix</a> - build tool</li>
</ul>

<h4 id="v1.12">v1.12
  <small>(<a href="https://github.com/elixir-lang/elixir/releases/download/v1.12.3/Docs.zip">download</a>)</small>
</h4>

<ul>
  <li><a href="https://hexdocs.pm/elixir/1.12.3/">Elixir</a> - standard library</li>
  <li><a href="https://hexdocs.pm/eex/1.12.3/">EEx</a> - templating library</li>
  <li><a href="https://hexdocs.pm/ex_unit/1.12.3/">ExUnit</a> - unit test library</li>
  <li><a href="https://hexdocs.pm/iex/1.12.3/">IEx</a> - interactive shell</li>
  <li><a href="https://hexdocs.pm/logger/1.12.3/">Logger</a> - built-in Logger</li>
  <li><a href="https://hexdocs.pm/mix/1.12.3/">Mix</a> - build tool</li>
</ul>

<h4 id="v1.11">v1.11
  <small>(<a href="https://github.com/elixir-lang/elixir/releases/download/v1.11.4/Docs.zip">download</a>)</small>
</h4>

<ul>
  <li><a href="https://hexdocs.pm/elixir/1.11.4/">Elixir</a> - standard library</li>
  <li><a href="https://hexdocs.pm/eex/1.11.4/">EEx</a> - templating library</li>
  <li><a href="https://hexdocs.pm/ex_unit/1.11.4/">ExUnit</a> - unit test library</li>
  <li><a href="https://hexdocs.pm/iex/1.11.4/">IEx</a> - interactive shell</li>
  <li><a href="https://hexdocs.pm/logger/1.11.4/">Logger</a> - built-in Logger</li>
  <li><a href="https://hexdocs.pm/mix/1.11.4/">Mix</a> - build tool</li>
</ul>

<h4 id="v1.10">v1.10
  <small>(<a href="https://github.com/elixir-lang/elixir/releases/download/v1.10.4/Docs.zip">download</a>)</small>
</h4>

<ul>
  <li><a href="https://hexdocs.pm/elixir/1.10.4/">Elixir</a> - standard library</li>
  <li><a href="https://hexdocs.pm/eex/1.10.4/">EEx</a> - templating library</li>
  <li><a href="https://hexdocs.pm/ex_unit/1.10.4/">ExUnit</a> - unit test library</li>
  <li><a href="https://hexdocs.pm/iex/1.10.4/">IEx</a> - interactive shell</li>
  <li><a href="https://hexdocs.pm/logger/1.10.4/">Logger</a> - built-in Logger</li>
  <li><a href="https://hexdocs.pm/mix/1.10.4/">Mix</a> - build tool</li>
</ul>

<h4 id="v1.9">v1.9
  <small>(<a href="https://github.com/elixir-lang/elixir/releases/download/v1.9.4/Docs.zip">download</a>)</small>
</h4>

<ul>
  <li><a href="https://hexdocs.pm/elixir/1.9.4/">Elixir</a> - standard library</li>
  <li><a href="https://hexdocs.pm/eex/1.9.4/">EEx</a> - templating library</li>
  <li><a href="https://hexdocs.pm/ex_unit/1.9.4/">ExUnit</a> - unit test library</li>
  <li><a href="https://hexdocs.pm/iex/1.9.4/">IEx</a> - interactive shell</li>
  <li><a href="https://hexdocs.pm/logger/1.9.4/">Logger</a> - built-in Logger</li>
  <li><a href="https://hexdocs.pm/mix/1.9.4/">Mix</a> - build tool</li>
</ul>

<h4 id="v1.8">v1.8
  <small>(<a href="https://github.com/elixir-lang/elixir/releases/download/v1.8.2/Docs.zip">download</a>)</small>
</h4>

<ul>
  <li><a href="https://hexdocs.pm/elixir/1.8.2/">Elixir</a> - standard library</li>
  <li><a href="https://hexdocs.pm/eex/1.8.2/">EEx</a> - templating library</li>
  <li><a href="https://hexdocs.pm/ex_unit/1.8.2/">ExUnit</a> - unit test library</li>
  <li><a href="https://hexdocs.pm/iex/1.8.2/">IEx</a> - interactive shell</li>
  <li><a href="https://hexdocs.pm/logger/1.8.2/">Logger</a> - built-in Logger</li>
  <li><a href="https://hexdocs.pm/mix/1.8.2/">Mix</a> - build tool</li>
</ul>

<h4 id="v1.7">v1.7
  <small>(<a href="https://github.com/elixir-lang/elixir/releases/download/v1.7.4/Docs.zip">download</a>)</small>
</h4>

<ul>
  <li><a href="https://hexdocs.pm/elixir/1.7.4/">Elixir</a> - standard library</li>
  <li><a href="https://hexdocs.pm/eex/1.7.4/">EEx</a> - templating library</li>
  <li><a href="https://hexdocs.pm/ex_unit/1.7.4/">ExUnit</a> - unit test library</li>
  <li><a href="https://hexdocs.pm/iex/1.7.4/">IEx</a> - interactive shell</li>
  <li><a href="https://hexdocs.pm/logger/1.7.4/">Logger</a> - built-in Logger</li>
  <li><a href="https://hexdocs.pm/mix/1.7.4/">Mix</a> - build tool</li>
</ul>

<h4 id="v1.6">v1.6
  <small>(<a href="https://github.com/elixir-lang/elixir/releases/download/v1.6.6/Docs.zip">download</a>)</small>
</h4>

<ul>
  <li><a href="https://hexdocs.pm/elixir/1.6.6/">Elixir</a> - standard library</li>
  <li><a href="https://hexdocs.pm/eex/1.6.6/">EEx</a> - templating library</li>
  <li><a href="https://hexdocs.pm/ex_unit/1.6.6/">ExUnit</a> - unit test library</li>
  <li><a href="https://hexdocs.pm/iex/1.6.6/">IEx</a> - interactive shell</li>
  <li><a href="https://hexdocs.pm/logger/1.6.6/">Logger</a> - built-in Logger</li>
  <li><a href="https://hexdocs.pm/mix/1.6.6/">Mix</a> - build tool</li>
</ul>

<h4 id="v1.5">v1.5
  <small>(<a href="https://github.com/elixir-lang/elixir/releases/download/v1.5.3/Docs.zip">download</a>)</small>
</h4>

<ul>
  <li><a href="https://hexdocs.pm/elixir/1.5.3/">Elixir</a> - standard library</li>
  <li><a href="https://hexdocs.pm/eex/1.5.3/">EEx</a> - templating library</li>
  <li><a href="https://hexdocs.pm/ex_unit/1.5.3/">ExUnit</a> - unit test library</li>
  <li><a href="https://hexdocs.pm/iex/1.5.3/">IEx</a> - interactive shell</li>
  <li><a href="https://hexdocs.pm/logger/1.5.3/">Logger</a> - built-in Logger</li>
  <li><a href="https://hexdocs.pm/mix/1.5.3/">Mix</a> - build tool</li>
</ul>

<h4 id="v1.4">v1.4
  <small>(<a href="https://github.com/elixir-lang/elixir/releases/download/v1.4.5/Docs.zip">download</a>)</small>
</h4>

<ul>
  <li><a href="https://hexdocs.pm/elixir/1.4.5/">Elixir</a> - standard library</li>
  <li><a href="https://hexdocs.pm/eex/1.4.5/">EEx</a> - templating library</li>
  <li><a href="https://hexdocs.pm/ex_unit/1.4.5/">ExUnit</a> - unit test library</li>
  <li><a href="https://hexdocs.pm/iex/1.4.5/">IEx</a> - interactive shell</li>
  <li><a href="https://hexdocs.pm/logger/1.4.5/">Logger</a> - built-in Logger</li>
  <li><a href="https://hexdocs.pm/mix/1.4.5/">Mix</a> - build tool</li>
</ul>

<h4 id="v1.3">v1.3
  <small>(<a href="https://github.com/elixir-lang/elixir/releases/download/v1.3.4/Docs.zip">download</a>)</small>
</h4>

<ul>
  <li><a href="https://hexdocs.pm/elixir/1.3.4/">Elixir</a> - standard library</li>
  <li><a href="https://hexdocs.pm/eex/1.3.4/">EEx</a> - templating library</li>
  <li><a href="https://hexdocs.pm/ex_unit/1.3.4/">ExUnit</a> - unit test library</li>
  <li><a href="https://hexdocs.pm/iex/1.3.4/">IEx</a> - interactive shell</li>
  <li><a href="https://hexdocs.pm/logger/1.3.4/">Logger</a> - built-in Logger</li>
  <li><a href="https://hexdocs.pm/mix/1.3.4/">Mix</a> - build tool</li>
</ul>

<h4 id="v1.2">v1.2
  <small>(<a href="https://github.com/elixir-lang/elixir/releases/download/v1.2.6/Docs.zip">download</a>)</small>
</h4>

<ul>
  <li><a href="https://hexdocs.pm/elixir/1.2.6/">Elixir</a> - standard library</li>
  <li><a href="https://hexdocs.pm/eex/1.2.6/">EEx</a> - templating library</li>
  <li><a href="https://hexdocs.pm/ex_unit/1.2.6/">ExUnit</a> - unit test library</li>
  <li><a href="https://hexdocs.pm/iex/1.2.6/">IEx</a> - interactive shell</li>
  <li><a href="https://hexdocs.pm/logger/1.2.6/">Logger</a> - built-in Logger</li>
  <li><a href="https://hexdocs.pm/mix/1.2.6/">Mix</a> - build tool</li>
</ul>

<h4 id="v1.1">v1.1
  <small>(<a href="https://github.com/elixir-lang/elixir/releases/download/v1.1.1/Docs.zip">download</a>)</small>
</h4>

<ul>
  <li><a href="https://hexdocs.pm/elixir/1.1.1/">Elixir</a> - standard library</li>
  <li><a href="https://hexdocs.pm/eex/1.1.1/">EEx</a> - templating library</li>
  <li><a href="https://hexdocs.pm/ex_unit/1.1.1/">ExUnit</a> - unit test library</li>
  <li><a href="https://hexdocs.pm/iex/1.1.1/">IEx</a> - interactive shell</li>
  <li><a href="https://hexdocs.pm/logger/1.1.1/">Logger</a> - built-in Logger</li>
  <li><a href="https://hexdocs.pm/mix/1.1.1/">Mix</a> - build tool</li>
</ul>

<h4 id="v1.0">v1.0
  
</h4>

<ul>
  <li><a href="https://hexdocs.pm/elixir/1.0.5/">Elixir</a> - standard library</li>
  <li><a href="https://hexdocs.pm/eex/1.0.5/">EEx</a> - templating library</li>
  <li><a href="https://hexdocs.pm/ex_unit/1.0.5/">ExUnit</a> - unit test library</li>
  <li><a href="https://hexdocs.pm/iex/1.0.5/">IEx</a> - interactive shell</li>
  <li><a href="https://hexdocs.pm/logger/1.0.5/">Logger</a> - built-in Logger</li>
  <li><a href="https://hexdocs.pm/mix/1.0.5/">Mix</a> - build tool</li>
</ul>


</div><!-- #content -->

<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>

  <div class="widget">
  <h3 class="widget-title">Important links</h3>
  <ul>
    <li class="menu-item development"><a class="spec" href="/development.html">Development &amp; Team</a></li>
    <li><a class="spec" href="https://github.com/elixir-lang/elixir">Source code &amp; issues tracker</a></li>
  </ul>
</div>

<div id="mini-docu" class="widget">
  <a href="https://cult.honeypot.io/originals/elixir-the-documentary">
    <div class="mini-docu-cta">
      <div class="mini-docu-copy">Watch the Elixir<br>mini-documentary!</div>
    </div>
  </a>
</div>

<!-- <div class="widget events">
  <h3 class="widget-title">Upcoming events</h3>
  
</div> -->


<div class="widget">
  <h3 class="widget-title">Join the Community</h3>
  <ul>
    <li><a class="spec" href="https://hex.pm">Hex.pm package manager</a></li>
    <li><a class="spec" href="https://twitter.com/elixirlang">@elixirlang on Twitter</a></li>
    <li><a class="spec" href="irc://irc.libera.chat/elixir">#elixir on irc.libera.chat</a></li>
    <li><a class="spec" href="http://elixirforum.com">Elixir Forum</a></li>
    <li><a class="spec" href="https://elixir-slackin.herokuapp.com/">Elixir on Slack</a></li>
    <li><a class="spec" href="https://discord.gg/elixir">Elixir on Discord</a></li>
    <li><a class="spec" href="https://www.meetup.com/topics/elixir/">Meetups around the world</a></li>
    <li><a class="spec" href="https://github.com/elixir-lang/elixir/wiki">Wiki with events and resources maintained by the community</a></li>
  </ul>
</div>

<div id="eef" class="widget">
  <a href="https://erlef.org/" title="Join the Erlang Ecosystem Foundation"><img src="/images/logo/eef.png" alt="Join the Erlang Ecosystem Foundation" width="174" style="margin-top:-10px"></a>
</div>

</div>

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/development.html">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="content">
  <h1 id="development--team">Development &amp; Team</h1>

<p>This page outlines the language’s past and future development.</p>

<h2 id="development">Development</h2>

<p>José Valim created Elixir in 2012 as a Research and Development project inside Plataformatec. Elixir’s goal is to be <a href="/blog/2013/08/08/elixir-design-goals/">a productive and extensible language</a> for writing maintainable and reliable software.</p>

<p>Elixir runs on top of the Erlang Virtual Machine, which provides a scalable and fault-tolerant foundation. Elixir was designed to leverage this foundation without performance costs and aims to contribute to the wider ecosystem whenever possible.</p>

<p>Elixir’s source code is under the <a href="https://github.com/elixir-lang/elixir/blob/main/LICENSE">Apache 2 License</a> and is maintained by the <a href="#team">Elixir Team</a>. The source code and contribution guidelines can be found on <a href="https://github.com/elixir-lang/elixir">the language repository</a>.</p>

<p>Elixir v1.0 was released in September 2014 and a new minor version is released every 6 months, around May and November of every year. New releases are announced in the read-only <a href="https://groups.google.com/group/elixir-lang-ann">announcements mailing list</a> with a link to the complete CHANGELOG. All security releases <a href="https://groups.google.com/forum/#!searchin/elixir-lang-ann/%5Bsecurity%5D%7Csort:date">will be tagged with “[security]”</a>. Security vulnerabilities should be disclosed to <a href="mailto:elixir-security@googlegroups.com">elixir-security@googlegroups.com</a>. Our <a href="https://hexdocs.pm/elixir/compatibility-and-deprecations.html#content">compatibility and deprecation policies</a> are also documented.</p>

<p>Since v1.0, the language development has become focused to provide a compact and consistent core. The Elixir team focuses on language features that:</p>

<ol>
  <li>are necessary for developing the language itself</li>
  <li>bring important concepts/features to the community in a way its effect can only be maximized or leveraged by making it part of the language</li>
</ol>

<p>The language development is open, both in terms of source code and of collaborations. All features and bug fixes planned for the next releases can be found <a href="https://github.com/elixir-lang/elixir/issues">in the issues tracker</a>. Features that may cause a larger impact on the ecosystem are first proposed to the community in <a href="https://groups.google.com/group/elixir-lang-core">the Elixir mailing list</a> as well as in <a href="https://elixirforum.com/c/elixir-news">the “Elixir News” section in the Elixir Forum</a>.</p>

<p>Community members are welcome to propose new features for Elixir. Before submitting a proposal, members are encouraged to gather feedback from around the community in whatever venues seem best. However, in order for a proposal to be considered for inclusion by the Elixir Core team, it must go through the Elixir mailing list. This often includes discussion and refinement of the proposal. The Elixir Core team has the final say on whether a proposal is accepted or rejected. While members are encouraged to gain support from the rest of the community, popularity does not mean that a proposal will be accepted.</p>

<p>To remain focused, Elixir trusts its ecosystem to bring diversity and broaden its use cases. Therefore the language was designed to be extensible: the constructs available to build the language are also available for developers to extend the language and bring it to different domains. Projects such as <a href="http://phoenixframework.org">the Phoenix web framework</a>, <a href="http://nerves-project.org">the Nerves embedded framework</a>, and <a href="https://github.com/elixir-nx/nx">Numerical Elixir</a> are such examples.</p>

<p>Elixir also relies on a vibrant community to support its growth. The community is behind the meetups, events, learning resources, open source projects, and more. See the sidebar, the <a href="/learning.html">Learning Resources</a> and <a href="https://hex.pm/">the Hex Package Manager website</a> for some examples and more information.</p>

<p>The best way to support the language is by getting involved in its community and contributing to the ecosystem.</p>

<p>Welcome!</p>

<h2 id="team">Team</h2>

<p>The Elixir Team is composed by:</p>

<ul>
  <li>José Valim</li>
  <li>Eric Meadows-Jönsson</li>
  <li>Andrea Leopardi</li>
  <li>Fernando Tapia Rico</li>
</ul>

<p>We are also grateful to the past members of the Elixir Team:</p>

<ul>
  <li>Alexei Sholik</li>
  <li>James Fish</li>
  <li>Aleksei Magusev</li>
  <li>Michał Muskała</li>
</ul>

<p>Finally, we thank all of our <a href="https://github.com/elixir-lang/elixir/graphs/contributors">contributors</a>.</p>

</div><!-- #content -->

<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>

  <div class="widget">
  <h3 class="widget-title">Important links</h3>
  <ul>
    <li class="menu-item development"><a class="spec" href="/development.html">Development &amp; Team</a></li>
    <li><a class="spec" href="https://github.com/elixir-lang/elixir">Source code &amp; issues tracker</a></li>
  </ul>
</div>

<div id="mini-docu" class="widget">
  <a href="https://cult.honeypot.io/originals/elixir-the-documentary">
    <div class="mini-docu-cta">
      <div class="mini-docu-copy">Watch the Elixir<br>mini-documentary!</div>
    </div>
  </a>
</div>

<!-- <div class="widget events">
  <h3 class="widget-title">Upcoming events</h3>
  
</div> -->


<div class="widget">
  <h3 class="widget-title">Join the Community</h3>
  <ul>
    <li><a class="spec" href="https://hex.pm">Hex.pm package manager</a></li>
    <li><a class="spec" href="https://twitter.com/elixirlang">@elixirlang on Twitter</a></li>
    <li><a class="spec" href="irc://irc.libera.chat/elixir">#elixir on irc.libera.chat</a></li>
    <li><a class="spec" href="http://elixirforum.com">Elixir Forum</a></li>
    <li><a class="spec" href="https://elixir-slackin.herokuapp.com/">Elixir on Slack</a></li>
    <li><a class="spec" href="https://discord.gg/elixir">Elixir on Discord</a></li>
    <li><a class="spec" href="https://www.meetup.com/topics/elixir/">Meetups around the world</a></li>
    <li><a class="spec" href="https://github.com/elixir-lang/elixir/wiki">Wiki with events and resources maintained by the community</a></li>
  </ul>
</div>

<div id="eef" class="widget">
  <a href="https://erlef.org/" title="Join the Erlang Ecosystem Foundation"><img src="/images/logo/eef.png" alt="Join the Erlang Ecosystem Foundation" width="174" style="margin-top:-10px"></a>
</div>

</div>

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/cases.html" page=":CASES:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="content">
  <h1>Cases</h1>

<p>Click on the cases below to learn more about how companies across different industries are using the power of Elixir and its ecosystem to create and grow their businesses. Cases are listed in the order they have been published.</p>

<div class="cases-boxes">
  
  
    <a class="cases-box" href="/blog/2020/08/20/embedded-elixir-at-farmbot/" title="Case: Embedded Elixir at Farmbot">
      
        <div class="cases-image" style="background-image: url('/images/cases/logos/farmbot.png')"></div>
      
      <div class="cases-tag">
        
          <span>#embedded</span>
        
          <span>#nerves</span>
        
      </div>
    </a>
  
    <a class="cases-box" href="/blog/2020/09/24/paas-with-elixir-at-Heroku/" title="Case: PaaS with Elixir at Heroku">
      
        <div class="cases-image" style="background-image: url('/images/cases/logos/heroku.png')"></div>
      
      <div class="cases-tag">
        
          <span>#paas</span>
        
          <span>#phoenix</span>
        
      </div>
    </a>
  
    <a class="cases-box" href="/blog/2020/10/08/real-time-communication-at-scale-with-elixir-at-discord/" title="Case: Real time communication at scale with Elixir at Discord">
      
        <div class="cases-image" style="background-image: url('/images/cases/logos/discord.png')"></div>
      
      <div class="cases-tag">
        
          <span>#real-time</span>
        
          <span>#genstage</span>
        
          <span>#otp</span>
        
      </div>
    </a>
  
    <a class="cases-box" href="/blog/2020/10/27/delivering-social-change-with-elixir-at-change.org/" title="Case: Delivering social change with Elixir at Change.org">
      
        <div class="cases-image" style="background-image: url('/images/cases/logos/change.png')"></div>
      
      <div class="cases-tag">
        
          <span>#social</span>
        
          <span>#broadway</span>
        
      </div>
    </a>
  
    <a class="cases-box" href="/blog/2020/11/17/real-time-collaboration-with-elixir-at-slab/" title="Case: Real-time collaboration with Elixir at Slab">
      
        <div class="cases-image" style="background-image: url('/images/cases/logos/slab.png')"></div>
      
      <div class="cases-tag">
        
          <span>#collab</span>
        
          <span>#phoenix</span>
        
          <span>#otp</span>
        
      </div>
    </a>
  
    <a class="cases-box" href="/blog/2020/12/10/integrating-travel-with-elixir-at-duffel/" title="Case: Integrating travel with Elixir at Duffel">
      
        <div class="cases-image" style="background-image: url('/images/cases/logos/duffel.png')"></div>
      
      <div class="cases-tag">
        
          <span>#api</span>
        
          <span>#integration</span>
        
          <span>#xml</span>
        
      </div>
    </a>
  
    <a class="cases-box" href="/blog/2021/01/13/orchestrating-computer-vision-with-elixir-at-v7/" title="Case: Orchestrating computer vision with Elixir at V7">
      
        <div class="cases-image" style="background-image: url('/images/cases/logos/v7.png')"></div>
      
      <div class="cases-tag">
        
          <span>#computer-vision</span>
        
          <span>#phoenix</span>
        
      </div>
    </a>
  
    <a class="cases-box" href="/blog/2021/02/03/social-messaging-with-elixir-at-community/" title="Case: Social messaging with Elixir at Community">
      
        <div class="cases-image" style="background-image: url('/images/cases/logos/community.png')"></div>
      
      <div class="cases-tag">
        
          <span>#messaging</span>
        
          <span>#broadway</span>
        
      </div>
    </a>
  
    <a class="cases-box" href="/blog/2021/04/02/marketing-and-sales-intelligence-with-elixir-at-pepsico/" title="Case: Marketing and sales intelligence with Elixir at PepsiCo">
      
        <div class="cases-image" style="background-image: url('/images/cases/logos/pepsico.png')"></div>
      
      <div class="cases-tag">
        
          <span>#biz-intelligence</span>
        
          <span>#phoenix</span>
        
      </div>
    </a>
  
    <a class="cases-box" href="/blog/2021/06/02/social-virtual-spaces-with-elixir-at-mozilla/" title="Case: Social virtual spaces with Elixir at Mozilla">
      
        <div class="cases-image" style="background-image: url('/images/cases/logos/mozilla-hubs.png')"></div>
      
      <div class="cases-tag">
        
          <span>#virtual-spaces</span>
        
          <span>#phoenix</span>
        
      </div>
    </a>
  
    <a class="cases-box" href="/blog/2021/07/29/bootstraping-a-multiplayer-server-with-elixir-at-x-plane/" title="Case: Bootstrapping a multiplayer server with Elixir at X-Plane">
      
        <div class="cases-image" style="background-image: url('/images/cases/logos/x-plane.png')"></div>
      
      <div class="cases-tag">
        
          <span>#multiplayer</span>
        
          <span>#udp</span>
        
          <span>#otp</span>
        
      </div>
    </a>
  
    <a class="cases-box" href="/blog/2021/11/10/embracing-open-data-with-elixir-at-the-ministry-of-ecological-transition-in-france/" title="Case: Embracing open data with Elixir at the Ministry of Ecological Transition in France">
      
        <div class="cases-image" style="background-image: url('/images/cases/logos/met-france.svg')"></div>
      
      <div class="cases-tag">
        
          <span>#open-data</span>
        
          <span>#gov</span>
        
          <span>#phoenix</span>
        
      </div>
    </a>
  
</div>

<p></p>

</div><!-- #content -->

<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>

  <div class="widget">
  <h3 class="widget-title">Important links</h3>
  <ul>
    <li class="menu-item development"><a class="spec" href="/development.html">Development &amp; Team</a></li>
    <li><a class="spec" href="https://github.com/elixir-lang/elixir">Source code &amp; issues tracker</a></li>
  </ul>
</div>

<div id="mini-docu" class="widget">
  <a href="https://cult.honeypot.io/originals/elixir-the-documentary">
    <div class="mini-docu-cta">
      <div class="mini-docu-copy">Watch the Elixir<br>mini-documentary!</div>
    </div>
  </a>
</div>

<!-- <div class="widget events">
  <h3 class="widget-title">Upcoming events</h3>
  
</div> -->


<div class="widget">
  <h3 class="widget-title">Join the Community</h3>
  <ul>
    <li><a class="spec" href="https://hex.pm">Hex.pm package manager</a></li>
    <li><a class="spec" href="https://twitter.com/elixirlang">@elixirlang on Twitter</a></li>
    <li><a class="spec" href="irc://irc.libera.chat/elixir">#elixir on irc.libera.chat</a></li>
    <li><a class="spec" href="http://elixirforum.com">Elixir Forum</a></li>
    <li><a class="spec" href="https://elixir-slackin.herokuapp.com/">Elixir on Slack</a></li>
    <li><a class="spec" href="https://discord.gg/elixir">Elixir on Discord</a></li>
    <li><a class="spec" href="https://www.meetup.com/topics/elixir/">Meetups around the world</a></li>
    <li><a class="spec" href="https://github.com/elixir-lang/elixir/wiki">Wiki with events and resources maintained by the community</a></li>
  </ul>
</div>

<div id="eef" class="widget">
  <a href="https://erlef.org/" title="Join the Erlang Ecosystem Foundation"><img src="/images/logo/eef.png" alt="Join the Erlang Ecosystem Foundation" width="174" style="margin-top:-10px"></a>
</div>

</div>

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/blog/" page=":BLOG:">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="content">
  <div class="hfeed">
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2022/12/22/cheatsheets-and-8-other-features-in-exdoc-that-improve-the-developer-experience/" title="Cheatsheets and other 8 ExDoc features that improve the developer experience" rel="bookmark">Cheatsheets and other 8 ExDoc features that improve the developer experience</a></h2>
        <div class="byline">December 22, 2022 · by Hugo Baraúna . in <a href="/blog/categories.html#Announcements" class="category">Announcements</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>This post explains the motivation behind the new ExDoc Cheatsheet feature. It also highlights other ExDoc features that show how ExDoc has been evolving to make the documentation experience in Elixir better and better.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2022/12/22/cheatsheets-and-8-other-features-in-exdoc-that-improve-the-developer-experience/" title="Cheatsheets and other 8 ExDoc features that improve the developer experience" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2022/10/05/my-future-with-elixir-set-theoretic-types/" title="My Future with Elixir: set-theoretic types" rel="bookmark">My Future with Elixir: set-theoretic types</a></h2>
        <div class="byline">October 05, 2022 · by José Valim . in <a href="/blog/categories.html#Announcements" class="category">Announcements</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>We announce and explore the possibilities for bringing set-theoretic types into Elixir.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2022/10/05/my-future-with-elixir-set-theoretic-types/" title="My Future with Elixir: set-theoretic types" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2022/09/01/elixir-v1-14-0-released/" title="Elixir v1.14 released" rel="bookmark">Elixir v1.14 released</a></h2>
        <div class="byline">September 01, 2022 · by Andrea Leopardi . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v1.14 is out with a focus on debugging and developer experience</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2022/09/01/elixir-v1-14-0-released/" title="Elixir v1.14 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2021/12/03/elixir-v1-13-0-released/" title="Elixir v1.13 released" rel="bookmark">Elixir v1.13 released</a></h2>
        <div class="byline">December 03, 2021 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v1.13 is out with a focus on developer tooling</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2021/12/03/elixir-v1-13-0-released/" title="Elixir v1.13 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2021/11/10/embracing-open-data-with-elixir-at-the-ministry-of-ecological-transition-in-france/" title="Embracing open data with Elixir at the Ministry of Ecological Transition in France" rel="bookmark">Embracing open data with Elixir at the Ministry of Ecological Transition in France</a></h2>
        <div class="byline">November 10, 2021 · by José Valim . in <a href="/blog/categories.html#Elixir in Production" class="category">Elixir in Production</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>A case study of how Elixir is being used at the Ministry of Ecological Transition in France.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2021/11/10/embracing-open-data-with-elixir-at-the-ministry-of-ecological-transition-in-france/" title="Embracing open data with Elixir at the Ministry of Ecological Transition in France" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2021/07/29/bootstraping-a-multiplayer-server-with-elixir-at-x-plane/" title="Bootstrapping a multiplayer server with Elixir at X-Plane" rel="bookmark">Bootstrapping a multiplayer server with Elixir at X-Plane</a></h2>
        <div class="byline">July 29, 2021 · by José Valim . in <a href="/blog/categories.html#Elixir in Production" class="category">Elixir in Production</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>A case study of how Elixir is being used at X-Plane.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2021/07/29/bootstraping-a-multiplayer-server-with-elixir-at-x-plane/" title="Bootstrapping a multiplayer server with Elixir at X-Plane" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2021/06/02/social-virtual-spaces-with-elixir-at-mozilla/" title="Social virtual spaces with Elixir at Mozilla" rel="bookmark">Social virtual spaces with Elixir at Mozilla</a></h2>
        <div class="byline">June 02, 2021 · by José Valim . in <a href="/blog/categories.html#Elixir in Production" class="category">Elixir in Production</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>A case study of how Elixir is being used at Mozilla.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2021/06/02/social-virtual-spaces-with-elixir-at-mozilla/" title="Social virtual spaces with Elixir at Mozilla" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2021/05/19/elixir-v1-12-0-released/" title="Elixir v1.12 released" rel="bookmark">Elixir v1.12 released</a></h2>
        <div class="byline">May 19, 2021 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v1.12 is out with improvements to scripting, tighter Erlang/OTP 24 integration, stepped ranges, and dozen of new functions across the standard library</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2021/05/19/elixir-v1-12-0-released/" title="Elixir v1.12 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2021/04/02/marketing-and-sales-intelligence-with-elixir-at-pepsico/" title="Marketing and sales intelligence with Elixir at PepsiCo" rel="bookmark">Marketing and sales intelligence with Elixir at PepsiCo</a></h2>
        <div class="byline">April 02, 2021 · by José Valim . in <a href="/blog/categories.html#Elixir in Production" class="category">Elixir in Production</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>A case study of how Elixir is being used at PepsiCo.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2021/04/02/marketing-and-sales-intelligence-with-elixir-at-pepsico/" title="Marketing and sales intelligence with Elixir at PepsiCo" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2021/02/03/social-messaging-with-elixir-at-community/" title="Social messaging with Elixir at Community" rel="bookmark">Social messaging with Elixir at Community</a></h2>
        <div class="byline">February 03, 2021 · by José Valim . in <a href="/blog/categories.html#Elixir in Production" class="category">Elixir in Production</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>A case study of how Elixir is being used at Community.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2021/02/03/social-messaging-with-elixir-at-community/" title="Social messaging with Elixir at Community" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2021/01/13/orchestrating-computer-vision-with-elixir-at-v7/" title="Orchestrating computer vision with Elixir at V7" rel="bookmark">Orchestrating computer vision with Elixir at V7</a></h2>
        <div class="byline">January 13, 2021 · by José Valim . in <a href="/blog/categories.html#Elixir in Production" class="category">Elixir in Production</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>A case study of how Elixir is being used at V7.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2021/01/13/orchestrating-computer-vision-with-elixir-at-v7/" title="Orchestrating computer vision with Elixir at V7" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2020/12/10/integrating-travel-with-elixir-at-duffel/" title="Integrating travel with Elixir at Duffel" rel="bookmark">Integrating travel with Elixir at Duffel</a></h2>
        <div class="byline">December 10, 2020 · by José Valim . in <a href="/blog/categories.html#Elixir in Production" class="category">Elixir in Production</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>A case study of how Elixir is being used at Duffel.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2020/12/10/integrating-travel-with-elixir-at-duffel/" title="Integrating travel with Elixir at Duffel" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2020/11/17/real-time-collaboration-with-elixir-at-slab/" title="Real-time collaboration with Elixir at Slab" rel="bookmark">Real-time collaboration with Elixir at Slab</a></h2>
        <div class="byline">November 17, 2020 · by José Valim . in <a href="/blog/categories.html#Elixir in Production" class="category">Elixir in Production</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>A case study of how Elixir is being used at Slab.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2020/11/17/real-time-collaboration-with-elixir-at-slab/" title="Real-time collaboration with Elixir at Slab" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2020/10/27/delivering-social-change-with-elixir-at-change.org/" title="Delivering social change with Elixir at Change.org" rel="bookmark">Delivering social change with Elixir at Change.org</a></h2>
        <div class="byline">October 27, 2020 · by José Valim . in <a href="/blog/categories.html#Elixir in Production" class="category">Elixir in Production</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>A case study of how Elixir is being used at Change.org.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2020/10/27/delivering-social-change-with-elixir-at-change.org/" title="Delivering social change with Elixir at Change.org" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2020/10/08/real-time-communication-at-scale-with-elixir-at-discord/" title="Real time communication at scale with Elixir at Discord" rel="bookmark">Real time communication at scale with Elixir at Discord</a></h2>
        <div class="byline">October 08, 2020 · by José Valim . in <a href="/blog/categories.html#Elixir in Production" class="category">Elixir in Production</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>A case study of how Elixir is being used at Discord.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2020/10/08/real-time-communication-at-scale-with-elixir-at-discord/" title="Real time communication at scale with Elixir at Discord" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2020/10/06/elixir-v1-11-0-released/" title="Elixir v1.11 released" rel="bookmark">Elixir v1.11 released</a></h2>
        <div class="byline">October 06, 2020 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v1.11 is out with improvements to the compiler and tighter integration with Erlang/OTP</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2020/10/06/elixir-v1-11-0-released/" title="Elixir v1.11 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2020/09/24/paas-with-elixir-at-Heroku/" title="PaaS with Elixir at Heroku" rel="bookmark">PaaS with Elixir at Heroku</a></h2>
        <div class="byline">September 24, 2020 · by José Valim . in <a href="/blog/categories.html#Elixir in Production" class="category">Elixir in Production</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>A case study of how Elixir is being used at Heroku.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2020/09/24/paas-with-elixir-at-Heroku/" title="PaaS with Elixir at Heroku" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2020/08/20/embedded-elixir-at-farmbot/" title="Embedded Elixir at Farmbot" rel="bookmark">Embedded Elixir at Farmbot</a></h2>
        <div class="byline">August 20, 2020 · by José Valim . in <a href="/blog/categories.html#Elixir in Production" class="category">Elixir in Production</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>A case study of how Elixir is being used at Farmbot.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2020/08/20/embedded-elixir-at-farmbot/" title="Embedded Elixir at Farmbot" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2020/01/27/elixir-v1-10-0-released/" title="Elixir v1.10 released" rel="bookmark">Elixir v1.10 released</a></h2>
        <div class="byline">January 27, 2020 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v1.10 is out with standard library, compiler, and releases improvements.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2020/01/27/elixir-v1-10-0-released/" title="Elixir v1.10 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2019/06/24/elixir-v1-9-0-released/" title="Elixir v1.9 released" rel="bookmark">Elixir v1.9 released</a></h2>
        <div class="byline">June 24, 2019 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v1.9 is out with releases support, improved configuration and more.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2019/06/24/elixir-v1-9-0-released/" title="Elixir v1.9 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2019/02/25/mint-a-new-http-library-for-elixir/" title="Mint, a new HTTP client for Elixir" rel="bookmark">Mint, a new HTTP client for Elixir</a></h2>
        <div class="byline">February 25, 2019 · by Eric Meadows-Jönsson . in <a href="/blog/categories.html#Announcements" class="category">Announcements</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Mint is a new low-level HTTP client that aims to provide a small and functional core that others can build on top.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2019/02/25/mint-a-new-http-library-for-elixir/" title="Mint, a new HTTP client for Elixir" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2019/01/14/elixir-v1-8-0-released/" title="Elixir v1.8 released" rel="bookmark">Elixir v1.8 released</a></h2>
        <div class="byline">January 14, 2019 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v1.8 comes with many improvements at the infrastructure level, improving compilation time, speeding up common patterns, and adding features around introspection of the system.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2019/01/14/elixir-v1-8-0-released/" title="Elixir v1.8 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2018/07/25/elixir-v1-7-0-released/" title="Elixir v1.7 released" rel="bookmark">Elixir v1.7 released</a></h2>
        <div class="byline">July 25, 2018 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v1.7 includes many quality of life improvements, focusing on documentation, Logger and ExUnit, as well as a new Elixir Core team member!</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2018/07/25/elixir-v1-7-0-released/" title="Elixir v1.7 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2018/06/28/gsoc-projects/" title="Google Summer of Code 2018 projects" rel="bookmark">Google Summer of Code 2018 projects</a></h2>
        <div class="byline">June 28, 2018 · by Andrea Leopardi . in <a href="/blog/categories.html#Announcements" class="category">Announcements</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Once again Elixir is participating in Google Summer of Code 2018. In this post, we'll have a look at the active projects.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2018/06/28/gsoc-projects/" title="Google Summer of Code 2018 projects" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2018/01/17/elixir-v1-6-0-released/" title="Elixir v1.6 released" rel="bookmark">Elixir v1.6 released</a></h2>
        <div class="byline">January 17, 2018 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v1.6 includes a code formatter, defguard, dynamic supervision and new module attributes that improves code quality and the developer experience</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2018/01/17/elixir-v1-6-0-released/" title="Elixir v1.6 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2017/10/31/stream-data-property-based-testing-and-data-generation-for-elixir/" title="StreamData: Property-based testing and data generation" rel="bookmark">StreamData: Property-based testing and data generation</a></h2>
        <div class="byline">October 31, 2017 · by Andrea Leopardi . in <a href="/blog/categories.html#Announcements" class="category">Announcements</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>We are working on data generation and property-based testing for the next versions of Elixir.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2017/10/31/stream-data-property-based-testing-and-data-generation-for-elixir/" title="StreamData: Property-based testing and data generation" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2017/07/25/elixir-v1-5-0-released/" title="Elixir v1.5 released" rel="bookmark">Elixir v1.5 released</a></h2>
        <div class="byline">July 25, 2017 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v1.5 integrates with Erlang/OTP 20 and bring changes that improves the language reach and the developer experience</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2017/07/25/elixir-v1-5-0-released/" title="Elixir v1.5 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2017/01/05/elixir-v1-4-0-released/" title="Elixir v1.4 released" rel="bookmark">Elixir v1.4 released</a></h2>
        <div class="byline">January 05, 2017 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v1.4 brings many improvements to the language, its standard library and the Mix build tool.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2017/01/05/elixir-v1-4-0-released/" title="Elixir v1.4 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2016/07/14/announcing-genstage/" title="Announcing GenStage" rel="bookmark">Announcing GenStage</a></h2>
        <div class="byline">July 14, 2016 · by José Valim . in <a href="/blog/categories.html#Announcements" class="category">Announcements</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>GenStage is a new Elixir behaviour for exchanging events with back-pressure between Elixir processes. In this blog post we will cover the background that led us to GenStage, some example use cases, and what we are exploring for future releases.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2016/07/14/announcing-genstage/" title="Announcing GenStage" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2016/06/21/elixir-v1-3-0-released/" title="Elixir v1.3 released" rel="bookmark">Elixir v1.3 released</a></h2>
        <div class="byline">June 21, 2016 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v1.3 brings many improvements to the language, the compiler and its tooling, specially Mix (Elixir's build tool) and ExUnit (Elixir's test framework).</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2016/06/21/elixir-v1-3-0-released/" title="Elixir v1.3 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2016/01/03/elixir-v1-2-0-released/" title="Elixir v1.2 released" rel="bookmark">Elixir v1.2 released</a></h2>
        <div class="byline">January 03, 2016 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v1.2 brings enhancements, bug fixes, performance improvements and more into Elixir.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2016/01/03/elixir-v1-2-0-released/" title="Elixir v1.2 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2015/09/28/elixir-v1-1-0-released/" title="Elixir v1.1 released" rel="bookmark">Elixir v1.1 released</a></h2>
        <div class="byline">September 28, 2015 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v1.1 brings enhancements, bug fixes, performance improvements and more into Elixir.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2015/09/28/elixir-v1-1-0-released/" title="Elixir v1.1 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2014/09/18/elixir-v1-0-0-released/" title="Elixir v1.0 released" rel="bookmark">Elixir v1.0 released</a></h2>
        <div class="byline">September 18, 2014 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v1.0 is finally out!</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2014/09/18/elixir-v1-0-0-released/" title="Elixir v1.0 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2014/08/07/elixir-v0-15-0-released/" title="Elixir v0.15.0 released" rel="bookmark">Elixir v0.15.0 released</a></h2>
        <div class="byline">August 07, 2014 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v0.15.0 introduces Elixir's Logger, Mix aliases and is the last stop before Elixir v1.0. We are also glad to welcome Alexei into our team!</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2014/08/07/elixir-v0-15-0-released/" title="Elixir v0.15.0 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2014/06/17/elixir-v0-14-0-released/" title="Elixir v0.14.0 released" rel="bookmark">Elixir v0.14.0 released</a></h2>
        <div class="byline">June 17, 2014 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v0.14.0 is released and expands the work on structs and bringing more of OTP right into Elixir and Mix</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2014/06/17/elixir-v0-14-0-released/" title="Elixir v0.14.0 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2014/04/21/elixir-v0-13-0-released/" title="Elixir v0.13.0 released, hex.pm and ElixirConf announced" rel="bookmark">Elixir v0.13.0 released, hex.pm and ElixirConf announced</a></h2>
        <div class="byline">April 21, 2014 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v0.13.0 comes with substantial improvements to the language: maps, structs, comprehensiona and more. It also marks the announcement of the hex.pm package manager and the announcement of ElixirConf!</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2014/04/21/elixir-v0-13-0-released/" title="Elixir v0.13.0 released, hex.pm and ElixirConf announced" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2013/12/15/elixir-v0-12-0-released/" title="Elixir v0.12.0 released" rel="bookmark">Elixir v0.12.0 released</a></h2>
        <div class="byline">December 15, 2013 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v0.12.0 is out with improved enumerables, build patterns and welcoming a new member to our team</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2013/12/15/elixir-v0-12-0-released/" title="Elixir v0.12.0 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2013/12/11/elixir-s-new-continuable-enumerators/" title="Elixir's new continuable enumerators" rel="bookmark">Elixir's new continuable enumerators</a></h2>
        <div class="byline">December 11, 2013 · by Peter Minten . in <a href="/blog/categories.html#Internals" class="category">Internals</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>In 0.12.0 Elixir's enumerators have gained the ability to suspend value production and to terminate early.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2013/12/11/elixir-s-new-continuable-enumerators/" title="Elixir's new continuable enumerators" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2013/11/05/elixir-v0-11-0-released/" title="Elixir v0.11.0 released" rel="bookmark">Elixir v0.11.0 released</a></h2>
        <div class="byline">November 05, 2013 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v0.11.0 is out and it focus on improving and optimizing the patterns often used by the community.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2013/11/05/elixir-v0-11-0-released/" title="Elixir v0.11.0 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2013/08/08/elixir-design-goals/" title="Elixir Design Goals" rel="bookmark">Elixir Design Goals</a></h2>
        <div class="byline">August 08, 2013 · by José Valim . in <a href="/blog/categories.html#Internals" class="category">Internals</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Highlight of Elixir design goals.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2013/08/08/elixir-design-goals/" title="Elixir Design Goals" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2013/07/13/elixir-v0-10-0-released/" title="Elixir v0.10.0 released" rel="bookmark">Elixir v0.10.0 released</a></h2>
        <div class="byline">July 13, 2013 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v0.10.0 is out with support for streams, sets, pretty printing and many improvements for Mix and ExUnit.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2013/07/13/elixir-v0-10-0-released/" title="Elixir v0.10.0 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2013/05/23/elixir-v0-9-0-released/" title="Elixir v0.9.0 released" rel="bookmark">Elixir v0.9.0 released</a></h2>
        <div class="byline">May 23, 2013 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v0.9.0 is released with support for reducers, umbrella projects, faster compilation times and dropped support for R15 and earlier OTP versions.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2013/05/23/elixir-v0-9-0-released/" title="Elixir v0.9.0 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2013/05/02/elixir-on-xen/" title="Elixir on Xen" rel="bookmark">Elixir on Xen</a></h2>
        <div class="byline">May 02, 2013 · by José Valim . in <a href="/blog/categories.html#Announcements" class="category">Announcements</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>The Erlang on Xen team has added support for Elixir and we will tell you how you can use it!</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2013/05/02/elixir-on-xen/" title="Elixir on Xen" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2013/04/29/elixir-v0-8-2-released/" title="Elixir v0.8.2 released" rel="bookmark">Elixir v0.8.2 released</a></h2>
        <div class="byline">April 29, 2013 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v0.8.2 is released with bug fixes, better Erlang R16 support and doctests.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2013/04/29/elixir-v0-8-2-released/" title="Elixir v0.8.2 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2013/04/19/google-summer-of-code-2013/" title="Google Summer of Code 2013" rel="bookmark">Google Summer of Code 2013</a></h2>
        <div class="byline">April 19, 2013 · by José Valim . in <a href="/blog/categories.html#Announcements" class="category">Announcements</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir is taking part in Google Summer of Code 2013! Are you a student? Join us!</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2013/04/19/google-summer-of-code-2013/" title="Google Summer of Code 2013" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2013/01/27/elixir-v0-8-0-released/" title="Elixir v0.8.0 released" rel="bookmark">Elixir v0.8.0 released</a></h2>
        <div class="byline">January 27, 2013 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>On the last 9th January, we celebrated two years since Elixir's first commit and to celebrate this occasion we have prepared a big release. Elixir v0.8 is out, with documentation, optimizations, bug fixes and shiny new features. Let's take a look at them!</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2013/01/27/elixir-v0-8-0-released/" title="Elixir v0.8.0 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2012/12/04/elixir-v0-7-2-released/" title="Elixir v0.7.2 released" rel="bookmark">Elixir v0.7.2 released</a></h2>
        <div class="byline">December 04, 2012 · by Yurii Rashkovskii . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v0.7.2 is released, new, improved type specifications syntax and many other improvements.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2012/12/04/elixir-v0-7-2-released/" title="Elixir v0.7.2 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2012/11/18/elixir-v0-7-1-released/" title="Elixir v0.7.1 released" rel="bookmark">Elixir v0.7.1 released</a></h2>
        <div class="byline">November 18, 2012 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v0.7.1 was released to celebrate the end of a two months journey traveling around Europe, United States and Brazil talking about Elixir.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2012/11/18/elixir-v0-7-1-released/" title="Elixir v0.7.1 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2012/10/20/elixir-v0-7-0-released/" title="Elixir v0.7.0 released" rel="bookmark">Elixir v0.7.0 released</a></h2>
        <div class="byline">October 20, 2012 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Elixir v0.7.0 is released with many improvements! Read on for more information.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2012/10/20/elixir-v0-7-0-released/" title="Elixir v0.7.0 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2012/08/01/elixir-v0-6-0-released/" title="Elixir v0.6.0 released" rel="bookmark">Elixir v0.6.0 released</a></h2>
        <div class="byline">August 01, 2012 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>We have finally released Elixir v0.6.0! This release includes a build tool called Mix, support for Erlang typespecs, many improvements to IEx and improved IO, File and Macro support.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2012/08/01/elixir-v0-6-0-released/" title="Elixir v0.6.0 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2012/05/25/elixir-v0-5-0-released/" title="Elixir v0.5.0 released" rel="bookmark">Elixir v0.5.0 released</a></h2>
        <div class="byline">May 25, 2012 · by José Valim . in <a href="/blog/categories.html#Releases" class="category">Releases</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>We have finally released Elixir v0.5.0! This marks the first release since the language was rewritten. In this blog post, we will discuss what we achieved during this time and what are the next steps!</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2012/05/25/elixir-v0-5-0-released/" title="Elixir v0.5.0 released" rel="bookmark">Continue reading →</a></p>
  </div>
  
    <div class="hentry post">
      <div class="sticky-header">
        <h2 class="entry-title"><a class="spec" href="/blog/2012/04/24/a-peek-inside-elixir-s-parallel-compiler/" title="A peek inside Elixir's Parallel Compiler" rel="bookmark">A peek inside Elixir's Parallel Compiler</a></h2>
        <div class="byline">April 24, 2012 · by José Valim . in <a href="/blog/categories.html#Internals" class="category">Internals</a></div>
      </div><!-- .sticky-header -->

      <div class="entry-summary">
        <p>Today, a parallel compiler just landed in Elixir main. The goal of the parallel compiler is to compile files in parallel, automatically detecting dependencies between files. In this blog post, we are going to take a peek into the parallel compiler internals and learn more about Erlang and Elixir in the process.</p>
      </div><!-- .entry-summary -->

      <p><a href="/blog/2012/04/24/a-peek-inside-elixir-s-parallel-compiler/" title="A peek inside Elixir's Parallel Compiler" rel="bookmark">Continue reading →</a></p>
  </div>
  
</div><!-- .hfeed -->

</div><!-- #content -->

<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>

  <div class="rss-button">
    <a href="https://elixir-lang.org/atom.xml" target="_blank"><img src="/images/social/RSSButton.png" alt="RSS button"></a>
  </div>
  <div class="widget categories-list">
  <h3 class="widget-title">Blog Categories</h3>
  <ul>
  
  
    
    <li>
    
      <a class="spec" href="/blog/categories.html#Announcements">Announcements</a>
    
    </li>
  
    
    <li>
    
      <a class="spec" href="/cases.html">Elixir in Production</a>
    
    </li>
  
    
    <li>
    
      <a class="spec" href="/blog/categories.html#Internals">Internals</a>
    
    </li>
  
    
    <li>
    
      <a class="spec" href="/blog/categories.html#Releases">Releases</a>
    
    </li>
  
  </ul>
</div>

  <div class="widget">
  <h3 class="widget-title">Important links</h3>
  <ul>
    <li class="menu-item development"><a class="spec" href="/development.html">Development &amp; Team</a></li>
    <li><a class="spec" href="https://github.com/elixir-lang/elixir">Source code &amp; issues tracker</a></li>
  </ul>
</div>

<div id="mini-docu" class="widget">
  <a href="https://cult.honeypot.io/originals/elixir-the-documentary">
    <div class="mini-docu-cta">
      <div class="mini-docu-copy">Watch the Elixir<br>mini-documentary!</div>
    </div>
  </a>
</div>

<!-- <div class="widget events">
  <h3 class="widget-title">Upcoming events</h3>
  
</div> -->


<div class="widget">
  <h3 class="widget-title">Join the Community</h3>
  <ul>
    <li><a class="spec" href="https://hex.pm">Hex.pm package manager</a></li>
    <li><a class="spec" href="https://twitter.com/elixirlang">@elixirlang on Twitter</a></li>
    <li><a class="spec" href="irc://irc.libera.chat/elixir">#elixir on irc.libera.chat</a></li>
    <li><a class="spec" href="http://elixirforum.com">Elixir Forum</a></li>
    <li><a class="spec" href="https://elixir-slackin.herokuapp.com/">Elixir on Slack</a></li>
    <li><a class="spec" href="https://discord.gg/elixir">Elixir on Discord</a></li>
    <li><a class="spec" href="https://www.meetup.com/topics/elixir/">Meetups around the world</a></li>
    <li><a class="spec" href="https://github.com/elixir-lang/elixir/wiki">Wiki with events and resources maintained by the community</a></li>
  </ul>
</div>

<div id="eef" class="widget">
  <a href="https://erlef.org/" title="Join the Erlang Ecosystem Foundation"><img src="/images/logo/eef.png" alt="Join the Erlang Ecosystem Foundation" width="174" style="margin-top:-10px"></a>
</div>

</div>

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div class="wrap" path="/blog/categories.html">
    <div id="header">
      <div id="branding">
        <a id="site-title" href="/" title="Elixir" rel="Home">
          <img class="logo" src="/images/logo/logo.png" alt="Elixir Logo">
        </a>
      </div>

      <div id="menu-primary" class="menu-container">
        <ul id="menu-primary-items">
          <li class="menu-item home"><a class="spec" href="/">Home</a></li>
          <li class="menu-item install"><a class="spec" href="/install.html">Install</a></li>
          <li class="menu-item learning"><a class="spec" href="/learning.html">Learning</a></li>
          <li class="menu-item docs"><a class="spec" href="/docs.html">Docs</a></li>
          <li class="menu-item getting-started"><a class="spec" href="/getting-started/introduction.html">Guides</a></li>
          <li class="menu-item cases"><a class="spec" href="/cases.html">Cases</a></li>
          <li class="menu-item blog"><a class="spec" href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="main">


<div id="content">
  <div class="hcat">
  <h2>Posts by category:</h2>
  <ul>
  
  
    <li>
      <h5 id="Announcements">» Announcements</h5>
      <ul>
      
        
          
        
      
        
          
            <li><a href="/blog/2022/12/22/cheatsheets-and-8-other-features-in-exdoc-that-improve-the-developer-experience/">Cheatsheets and other 8 ExDoc features that improve the developer experience</a> <span class="byline">‐ December 22, 2022</span></li>
          
        
          
            <li><a href="/blog/2022/10/05/my-future-with-elixir-set-theoretic-types/">My Future with Elixir: set-theoretic types</a> <span class="byline">‐ October 05, 2022</span></li>
          
        
          
            <li><a href="/blog/2019/02/25/mint-a-new-http-library-for-elixir/">Mint, a new HTTP client for Elixir</a> <span class="byline">‐ February 25, 2019</span></li>
          
        
          
            <li><a href="/blog/2018/06/28/gsoc-projects/">Google Summer of Code 2018 projects</a> <span class="byline">‐ June 28, 2018</span></li>
          
        
          
            <li><a href="/blog/2017/10/31/stream-data-property-based-testing-and-data-generation-for-elixir/">StreamData: Property-based testing and data generation</a> <span class="byline">‐ October 31, 2017</span></li>
          
        
          
            <li><a href="/blog/2016/07/14/announcing-genstage/">Announcing GenStage</a> <span class="byline">‐ July 14, 2016</span></li>
          
        
          
            <li><a href="/blog/2013/05/02/elixir-on-xen/">Elixir on Xen</a> <span class="byline">‐ May 02, 2013</span></li>
          
        
          
            <li><a href="/blog/2013/04/19/google-summer-of-code-2013/">Google Summer of Code 2013</a> <span class="byline">‐ April 19, 2013</span></li>
          
        
      
      </ul>
    </li>
  
    <li>
      <h5 id="Elixir in Production">» Elixir in production</h5>
      <ul>
      
        
          
        
      
        
          
            <li><a href="/blog/2021/11/10/embracing-open-data-with-elixir-at-the-ministry-of-ecological-transition-in-france/">Embracing open data with Elixir at the Ministry of Ecological Transition in France</a> <span class="byline">‐ November 10, 2021</span></li>
          
        
          
            <li><a href="/blog/2021/07/29/bootstraping-a-multiplayer-server-with-elixir-at-x-plane/">Bootstrapping a multiplayer server with Elixir at X-Plane</a> <span class="byline">‐ July 29, 2021</span></li>
          
        
          
            <li><a href="/blog/2021/06/02/social-virtual-spaces-with-elixir-at-mozilla/">Social virtual spaces with Elixir at Mozilla</a> <span class="byline">‐ June 02, 2021</span></li>
          
        
          
            <li><a href="/blog/2021/04/02/marketing-and-sales-intelligence-with-elixir-at-pepsico/">Marketing and sales intelligence with Elixir at PepsiCo</a> <span class="byline">‐ April 02, 2021</span></li>
          
        
          
            <li><a href="/blog/2021/02/03/social-messaging-with-elixir-at-community/">Social messaging with Elixir at Community</a> <span class="byline">‐ February 03, 2021</span></li>
          
        
          
            <li><a href="/blog/2021/01/13/orchestrating-computer-vision-with-elixir-at-v7/">Orchestrating computer vision with Elixir at V7</a> <span class="byline">‐ January 13, 2021</span></li>
          
        
          
            <li><a href="/blog/2020/12/10/integrating-travel-with-elixir-at-duffel/">Integrating travel with Elixir at Duffel</a> <span class="byline">‐ December 10, 2020</span></li>
          
        
          
            <li><a href="/blog/2020/11/17/real-time-collaboration-with-elixir-at-slab/">Real-time collaboration with Elixir at Slab</a> <span class="byline">‐ November 17, 2020</span></li>
          
        
          
            <li><a href="/blog/2020/10/27/delivering-social-change-with-elixir-at-change.org/">Delivering social change with Elixir at Change.org</a> <span class="byline">‐ October 27, 2020</span></li>
          
        
          
            <li><a href="/blog/2020/10/08/real-time-communication-at-scale-with-elixir-at-discord/">Real time communication at scale with Elixir at Discord</a> <span class="byline">‐ October 08, 2020</span></li>
          
        
          
            <li><a href="/blog/2020/09/24/paas-with-elixir-at-Heroku/">PaaS with Elixir at Heroku</a> <span class="byline">‐ September 24, 2020</span></li>
          
        
          
            <li><a href="/blog/2020/08/20/embedded-elixir-at-farmbot/">Embedded Elixir at Farmbot</a> <span class="byline">‐ August 20, 2020</span></li>
          
        
      
      </ul>
    </li>
  
    <li>
      <h5 id="Internals">» Internals</h5>
      <ul>
      
        
          
        
      
        
          
            <li><a href="/blog/2013/12/11/elixir-s-new-continuable-enumerators/">Elixir's new continuable enumerators</a> <span class="byline">‐ December 11, 2013</span></li>
          
        
          
            <li><a href="/blog/2013/08/08/elixir-design-goals/">Elixir Design Goals</a> <span class="byline">‐ August 08, 2013</span></li>
          
        
          
            <li><a href="/blog/2012/04/24/a-peek-inside-elixir-s-parallel-compiler/">A peek inside Elixir's Parallel Compiler</a> <span class="byline">‐ April 24, 2012</span></li>
          
        
      
      </ul>
    </li>
  
    <li>
      <h5 id="Releases">» Releases</h5>
      <ul>
      
        
          
        
      
        
          
            <li><a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a> <span class="byline">‐ September 01, 2022</span></li>
          
        
          
            <li><a href="/blog/2021/12/03/elixir-v1-13-0-released/">Elixir v1.13 released</a> <span class="byline">‐ December 03, 2021</span></li>
          
        
          
            <li><a href="/blog/2021/05/19/elixir-v1-12-0-released/">Elixir v1.12 released</a> <span class="byline">‐ May 19, 2021</span></li>
          
        
          
            <li><a href="/blog/2020/10/06/elixir-v1-11-0-released/">Elixir v1.11 released</a> <span class="byline">‐ October 06, 2020</span></li>
          
        
          
            <li><a href="/blog/2020/01/27/elixir-v1-10-0-released/">Elixir v1.10 released</a> <span class="byline">‐ January 27, 2020</span></li>
          
        
          
            <li><a href="/blog/2019/06/24/elixir-v1-9-0-released/">Elixir v1.9 released</a> <span class="byline">‐ June 24, 2019</span></li>
          
        
          
            <li><a href="/blog/2019/01/14/elixir-v1-8-0-released/">Elixir v1.8 released</a> <span class="byline">‐ January 14, 2019</span></li>
          
        
          
            <li><a href="/blog/2018/07/25/elixir-v1-7-0-released/">Elixir v1.7 released</a> <span class="byline">‐ July 25, 2018</span></li>
          
        
          
            <li><a href="/blog/2018/01/17/elixir-v1-6-0-released/">Elixir v1.6 released</a> <span class="byline">‐ January 17, 2018</span></li>
          
        
          
            <li><a href="/blog/2017/07/25/elixir-v1-5-0-released/">Elixir v1.5 released</a> <span class="byline">‐ July 25, 2017</span></li>
          
        
          
            <li><a href="/blog/2017/01/05/elixir-v1-4-0-released/">Elixir v1.4 released</a> <span class="byline">‐ January 05, 2017</span></li>
          
        
          
            <li><a href="/blog/2016/06/21/elixir-v1-3-0-released/">Elixir v1.3 released</a> <span class="byline">‐ June 21, 2016</span></li>
          
        
          
            <li><a href="/blog/2016/01/03/elixir-v1-2-0-released/">Elixir v1.2 released</a> <span class="byline">‐ January 03, 2016</span></li>
          
        
          
            <li><a href="/blog/2015/09/28/elixir-v1-1-0-released/">Elixir v1.1 released</a> <span class="byline">‐ September 28, 2015</span></li>
          
        
          
            <li><a href="/blog/2014/09/18/elixir-v1-0-0-released/">Elixir v1.0 released</a> <span class="byline">‐ September 18, 2014</span></li>
          
        
          
            <li><a href="/blog/2014/08/07/elixir-v0-15-0-released/">Elixir v0.15.0 released</a> <span class="byline">‐ August 07, 2014</span></li>
          
        
          
            <li><a href="/blog/2014/06/17/elixir-v0-14-0-released/">Elixir v0.14.0 released</a> <span class="byline">‐ June 17, 2014</span></li>
          
        
          
            <li><a href="/blog/2014/04/21/elixir-v0-13-0-released/">Elixir v0.13.0 released, hex.pm and ElixirConf announced</a> <span class="byline">‐ April 21, 2014</span></li>
          
        
          
            <li><a href="/blog/2013/12/15/elixir-v0-12-0-released/">Elixir v0.12.0 released</a> <span class="byline">‐ December 15, 2013</span></li>
          
        
          
            <li><a href="/blog/2013/11/05/elixir-v0-11-0-released/">Elixir v0.11.0 released</a> <span class="byline">‐ November 05, 2013</span></li>
          
        
          
            <li><a href="/blog/2013/07/13/elixir-v0-10-0-released/">Elixir v0.10.0 released</a> <span class="byline">‐ July 13, 2013</span></li>
          
        
          
            <li><a href="/blog/2013/05/23/elixir-v0-9-0-released/">Elixir v0.9.0 released</a> <span class="byline">‐ May 23, 2013</span></li>
          
        
          
            <li><a href="/blog/2013/04/29/elixir-v0-8-2-released/">Elixir v0.8.2 released</a> <span class="byline">‐ April 29, 2013</span></li>
          
        
          
            <li><a href="/blog/2013/01/27/elixir-v0-8-0-released/">Elixir v0.8.0 released</a> <span class="byline">‐ January 27, 2013</span></li>
          
        
          
            <li><a href="/blog/2012/12/04/elixir-v0-7-2-released/">Elixir v0.7.2 released</a> <span class="byline">‐ December 04, 2012</span></li>
          
        
          
            <li><a href="/blog/2012/11/18/elixir-v0-7-1-released/">Elixir v0.7.1 released</a> <span class="byline">‐ November 18, 2012</span></li>
          
        
          
            <li><a href="/blog/2012/10/20/elixir-v0-7-0-released/">Elixir v0.7.0 released</a> <span class="byline">‐ October 20, 2012</span></li>
          
        
          
            <li><a href="/blog/2012/08/01/elixir-v0-6-0-released/">Elixir v0.6.0 released</a> <span class="byline">‐ August 01, 2012</span></li>
          
        
          
            <li><a href="/blog/2012/05/25/elixir-v0-5-0-released/">Elixir v0.5.0 released</a> <span class="byline">‐ May 25, 2012</span></li>
          
        
      
      </ul>
    </li>
  
  </ul>
</div><!-- .hfeed -->

</div><!-- #content -->

<div id="sidebar-primary" class="sidebar">
  <div class="widget news">
  <h3>
    News: <a href="/blog/2022/09/01/elixir-v1-14-0-released/">Elixir v1.14 released</a>
  </h3>
</div>

<div class="widget search">
  <form method="post" role="search" id="search-form" class="search-form" action="https://duckduckgo.com/?kg=p" onsubmit="document.getElementById('searchq').value = document.getElementById('searchfield').value + ' (site:elixir-lang.org | site:hexdocs.pm/elixir | site:hexdocs.pm/mix | site:hexdocs.pm/eex | site:hexdocs.pm/logger | site:hexdocs.pm/iex | site:hexdocs.pm/ex_unit)'; return true;">
		<input type="hidden" id="searchq" name="q" value="" aria-hidden="true">

    		<input class="search-text" type="search" placeholder="Search..." id="searchfield" aria-label="Search box">
		<input class="search-submit button" name="submit" type="submit" value="Search" aria-label="Search button">
	</form>
</div>

  <div class="rss-button">
    <a href="https://elixir-lang.org/atom.xml" target="_blank"><img src="/images/social/RSSButton.png" alt="RSS button"></a>
  </div>
  <div class="widget categories-list">
  <h3 class="widget-title">Blog Categories</h3>
  <ul>
  
  
    
    <li>
    
      <a class="spec" href="/blog/categories.html#Announcements">Announcements</a>
    
    </li>
  
    
    <li>
    
      <a class="spec" href="/cases.html">Elixir in Production</a>
    
    </li>
  
    
    <li>
    
      <a class="spec" href="/blog/categories.html#Internals">Internals</a>
    
    </li>
  
    
    <li>
    
      <a class="spec" href="/blog/categories.html#Releases">Releases</a>
    
    </li>
  
  </ul>
</div>

  <div class="widget">
  <h3 class="widget-title">Important links</h3>
  <ul>
    <li class="menu-item development"><a class="spec" href="/development.html">Development &amp; Team</a></li>
    <li><a class="spec" href="https://github.com/elixir-lang/elixir">Source code &amp; issues tracker</a></li>
  </ul>
</div>

<div id="mini-docu" class="widget">
  <a href="https://cult.honeypot.io/originals/elixir-the-documentary">
    <div class="mini-docu-cta">
      <div class="mini-docu-copy">Watch the Elixir<br>mini-documentary!</div>
    </div>
  </a>
</div>

<!-- <div class="widget events">
  <h3 class="widget-title">Upcoming events</h3>
  
</div> -->


<div class="widget">
  <h3 class="widget-title">Join the Community</h3>
  <ul>
    <li><a class="spec" href="https://hex.pm">Hex.pm package manager</a></li>
    <li><a class="spec" href="https://twitter.com/elixirlang">@elixirlang on Twitter</a></li>
    <li><a class="spec" href="irc://irc.libera.chat/elixir">#elixir on irc.libera.chat</a></li>
    <li><a class="spec" href="http://elixirforum.com">Elixir Forum</a></li>
    <li><a class="spec" href="https://elixir-slackin.herokuapp.com/">Elixir on Slack</a></li>
    <li><a class="spec" href="https://discord.gg/elixir">Elixir on Discord</a></li>
    <li><a class="spec" href="https://www.meetup.com/topics/elixir/">Meetups around the world</a></li>
    <li><a class="spec" href="https://github.com/elixir-lang/elixir/wiki">Wiki with events and resources maintained by the community</a></li>
  </ul>
</div>

<div id="eef" class="widget">
  <a href="https://erlef.org/" title="Join the Erlang Ecosystem Foundation"><img src="/images/logo/eef.png" alt="Join the Erlang Ecosystem Foundation" width="174" style="margin-top:-10px"></a>
</div>

</div>

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="trademark">
        © 2012–2023 The Elixir Team.<br>
        Elixir and the Elixir logo are <a href="/trademarks">registered trademarks of The Elixir Team</a>.
      </div>
    </div><div></div><!-- .wrap -->
  </div>
~~~
